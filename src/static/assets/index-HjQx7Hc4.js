const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/IndicatorTabPanel-CcYllUzH.js","assets/vendor-CskpE250.js","assets/vendor-icons-Bhvuh2b4.js","assets/LanPageView-Cu3fgJ85.js","assets/LanHostModal-6oKiDgnz.js","assets/BaseModal-Cc8qeVVd.js","assets/IframeModal-Oz-hMsqD.js","assets/ItemEditorModal-pIh3E0T4.js","assets/CommandPaletteModal-DKX5v6ax.js"])))=>i.map(i=>d[i]);
import{o as f,c as b,r as Or,n as z,h as br,w as ge,a as Me,b as Ye,d as Ne,e as B,f as C,g as he,u as i,i as U,j as Se,k as g,F as X,t as O,l as H,m as ve,p as L,q as ae,s as W,v as Yi,x as Rt,T as Qi,y as kn,z as Br,A as Gr,B as pn,C as We,D as Zi,E as Xi}from"./vendor-CskpE250.js";import{s as yr,a as hr,b as ea,c as ta,d as Ir,e as na,f as gn,g as ra,h as wr,i as Sr,j as _r,k as vt,l as oa,m as kr,n as ia,o as aa,p as $r,q as sa,r as la,t as mn,H as ht,N as Ot,S as Ge,F as Nr,C as Vr,u as Hr,T as In,v as Fr,w as Kr,D as wn,x as ua,y as ca,W as da,A as fa,E as pa,z as ga,M as Cr,P as ma,B as Ur,G as $n,L as Cn,I as va,K as ba,J as ya,O as Er,Q as zr,R as Tr,U as Sn,V as ha,X as Ia,Y as wa,Z as Sa,_ as vn,$ as jr,a0 as _a,a1 as qr,a2 as ka,a3 as $a,a4 as Wr,a5 as Ca,a6 as Ea,a7 as Ta,a8 as La,a9 as Pa,aa as En,ab as Tn,ac as xa,ad as Aa,ae as Ma,af as Da,ag as Jr,ah as Yr}from"./vendor-icons-Bhvuh2b4.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))c(s);new MutationObserver(s=>{for(const p of s)if(p.type==="childList")for(const m of p.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&c(m)}).observe(document,{childList:!0,subtree:!0});function l(s){const p={};return s.integrity&&(p.integrity=s.integrity),s.referrerPolicy&&(p.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?p.credentials="include":s.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function c(s){if(s.ep)return;s.ep=!0;const p=l(s);fetch(s.href,p)}})();const Ra="modulepreload",Oa=function(r){return"/static/"+r},Lr={},Ae=function(u,l,c){let s=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),v=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));s=Promise.allSettled(l.map(h=>{if(h=Oa(h),h in Lr)return;Lr[h]=!0;const S=h.endsWith(".css"),_=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${_}`))return;const I=document.createElement("link");if(I.rel=S?"stylesheet":Ra,S||(I.as="script"),I.crossOrigin="",I.href=h,v&&I.setAttribute("nonce",v),document.head.appendChild(I),S)return new Promise((T,x)=>{I.addEventListener("load",T),I.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${h}`)))})}))}function p(m){const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=m,window.dispatchEvent(v),!v.defaultPrevented)throw m}return s.then(m=>{for(const v of m||[])v.status==="rejected"&&p(v.reason);return u().catch(p)})},Ba=["type","title","aria-label","disabled"],we={__name:"IconButton",props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"button"},title:{type:String,default:""},ariaLabel:{type:String,default:""},buttonClass:{type:String,default:""}},emits:["click"],setup(r){return(u,l)=>(f(),b("button",{class:z(["ghost icon-btn",[r.buttonClass,{active:r.active}]]),type:r.type,title:r.title,"aria-label":r.ariaLabel||r.title,disabled:r.disabled,onClick:l[0]||(l[0]=c=>u.$emit("click",c))},[Or(u.$slots,"default")],10,Ba))}},Ga="X-Dashboard-Token";function Na(){var l;if(typeof window>"u")return"";const r=((l=window.localStorage)==null?void 0:l.getItem("dashboard_admin_token"))||"";if(String(r).trim())return String(r).trim();const u=window.__DASHBOARD_ADMIN_TOKEN__||"";return String(u).trim()}function Va(r,u,l){const c=u&&typeof r=="object"&&r!==null?r.detail:null;let s=`Request failed: ${l}`;return Array.isArray(c)?s=c.map(p=>typeof p=="object"&&p!==null&&"message"in p?String(p.message||""):JSON.stringify(p)).join("; "):typeof c=="string"&&c?s=c:typeof r=="string"&&r&&(s=r),s}async function De(r,u={}){const{requireAdminToken:l=!1,headers:c={},...s}=u,p={};if(c instanceof Headers)c.forEach((I,T)=>{p[T]=I});else if(Array.isArray(c))for(const[I,T]of c)p[I]=String(T);else Object.assign(p,c);const m={Accept:"application/json",...p};if(l){const I=Na();I&&(m[Ga]=I)}const v=await fetch(r,{credentials:"same-origin",headers:m,...s}),S=(v.headers.get("content-type")||"").includes("application/json"),_=S?await v.json():await v.text();if(!v.ok){const T=new Error(Va(_,S,v.status));throw T.status=v.status,T.body=_,T}return _}const Qe="/api/v1/dashboard";function Ha(){return De(`${Qe}/config`)}function Fa(r){return De(`${Qe}/iframe/${encodeURIComponent(r)}/source`,{requireAdminToken:!0})}function Ka(r=[]){const u=new URLSearchParams;for(const c of r)u.append("item_id",c);const l=u.toString();return De(`${Qe}/health${l?`?${l}`:""}`)}function Ua(r){return De(`${Qe}/config`,{requireAdminToken:!0,method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}function za(){return De(`${Qe}/lan/state`)}function ja(){return De(`${Qe}/lan/run`,{requireAdminToken:!0,method:"POST"})}const bn="oko-particles-js",qa="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js",Wa=7e3;let bt=null;function _n(){return typeof window.particlesJS=="function"}function Ja(r){return new Promise(u=>{let l=!1;const c=p=>{l||(l=!0,u(p))},s=window.setTimeout(()=>{c(_n())},Wa);r.addEventListener("load",()=>{window.clearTimeout(s),c(_n())},{once:!0}),r.addEventListener("error",()=>{window.clearTimeout(s),c(!1)},{once:!0})})}async function Ya(){return typeof window>"u"||typeof document>"u"?!1:_n()?!0:bt||(bt=(async()=>{let r=document.getElementById(bn)instanceof HTMLScriptElement?document.getElementById(bn):null;r||(r=document.createElement("script"),r.id=bn,r.src=qa,r.async=!0,r.defer=!0,document.head.appendChild(r));const u=await Ja(r);return u||(bt=null),u})(),bt)}function M(r){const u=`#${r.hex}`;return(l,{attrs:c})=>br("svg",{...c,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",role:"img","aria-hidden":"true",style:c.style?[c.style,{color:u}]:{color:u}},[br("path",{d:r.path})])}const Bt={homeassistant:M(mn),"home-assistant":M(mn),ha:M(mn),openwrt:M(la),adguard:M(sa),proxmox:M($r),pve:M($r),grafana:M(aa),gitea:M(ia),jellyfin:M(kr),jellyseerr:M(kr),sonarr:M(vt),radarr:M(oa),lidarr:M(vt),readarr:M(vt),bazarr:M(vt),prowlarr:M(vt),qbittorrent:M(_r),qb:M(_r),postgres:M(Sr),postgresql:M(Sr),docker:M(wr),dockge:M(wr),cockpit:M(ra),npm:M(gn),nginxproxymanager:M(gn),"nginx-proxy-manager":M(gn),nginx:M(na),openai:M(Ir),ai:M(Ir),portainer:M(ta),ytsync:M(hr),youtube:M(ea),youtubeshorts:M(hr),termius:M(yr),termix:M(yr)},Gt={home:ht,house:ht,дом:ht,dom:ht,route:ka,net:Ot,network:Ot,сеть:Ot,dashboard:qr,infra:Ge,infrastructure:Ge,инфраструктура:Ge,server:Ge,core:_a,ops:jr,media:vn,медиа:vn,tv:vn,iot:Vr,cloud:Sa,wifi:wa,monitor:Ia,cockpit:ha,proxmox:Ge,grafana:Hr,gitea:Sn,git:Sn,jellyfin:Nr,navidrome:Cr,tunnel:Tr,tunnels:Tr,stats:zr,services:Er,service:Er,health:Fr,alerts:In,alert:In,security:Kr,auth:ya,key:ba,db:wn,database:wn,storage:va,link:Cn,iframe:$n,terminal:Ur,package:ma,music:Cr,camera:ga,eye:pa,observability:fa,workflow:da,settings:ca,spark:ua},Qr=[{re:/\b(home|house|dom|дом)\b/,icon:ht},{re:/\b(net|network|route|vpn|edge|сеть|маршрут|туннел)\b/,icon:Ot},{re:/\b(infra|server|cluster|pve|проксмокс|инфраструктур)\b/,icon:Ge},{re:/\b(media|tv|video|stream|jellyfin|медиа)\b/,icon:Nr},{re:/\b(iot|sensor|home-assistant|умн|дом)\b/,icon:Vr},{re:/\b(stat|metric|chart|grafana|аналит|monitor)\b/,icon:Hr},{re:/\b(alert|error|warn|critical|ошиб|авар)\b/,icon:In},{re:/\b(health|status|pulse|heart|состояни)\b/,icon:Fr},{re:/\b(auth|token|secret|lock|ключ|безопас)\b/,icon:Kr},{re:/\b(db|database|postgres|mysql|redis)\b/,icon:wn}],Je={page:qr,group:Wr,subgroup:$a,itemLink:Cn,itemIframe:$n,widget:zr};function Zr(r){return String(r||"").toLowerCase().replace(/[^a-z0-9а-яё._-]+/gi," ").split(/[\s._-]+/).filter(Boolean)}function Xr(r){if(Bt[r])return Bt[r];for(const[u,l]of Object.entries(Bt))if(r.includes(u))return l;if(Gt[r])return Gt[r];for(const[u,l]of Object.entries(Gt))if(r.includes(u))return l;return null}function Ze(r,u){for(const c of r)for(const s of Zr(c)){const p=Xr(s);if(p)return p}const l=r.map(c=>String(c||"").toLowerCase()).filter(Boolean).join(" ");for(const c of Qr)if(c.re.test(l))return c.icon;return u}function Qa(r){return Ze([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],Je.page)}function Za(r){return Ze([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.description],Je.group)}function Xa(r){return Ze([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],Je.subgroup)}function es(r){return Ze([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,r==null?void 0:r.url,...(r==null?void 0:r.tags)||[]],(r==null?void 0:r.type)==="iframe"?Je.itemIframe:Je.itemLink)}function ts(r){var u;return Ze([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,(u=r==null?void 0:r.data)==null?void 0:u.endpoint],Je.widget)}function It(r,u="node"){return String(r||"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")||u}function Be(r,u){const l=It(r,"node");let c=l,s=2;for(;u.has(c);)c=`${l}-${s}`,s+=1;return c}function Nt(r){const u=new Set;for(const l of r.groups||[])for(const c of l.subgroups||[])u.add(c.id);return u}function Mt(r){const u=new Set;for(const l of r.groups||[])for(const c of l.subgroups||[])for(const s of c.items||[])u.add(s.id);return u}function Ie(r,u){return(r.groups||[]).find(l=>l.id===u)||null}function me(r,u,l){const c=Ie(r,u);return c&&(c.subgroups||[]).find(s=>s.id===l)||null}function Dt(r){return String((r==null?void 0:r.key)||"").startsWith("group:")}function Pr(r){var s,p;const u=new Set((r.groups||[]).map(m=>m.id)),l=Nt(r),c=new Set([...u,...l]);for(const m of((s=r.layout)==null?void 0:s.pages)||[]){const v=[];for(const h of m.blocks||[]){if(h.type==="groups"){h.group_ids=(h.group_ids||[]).filter(S=>c.has(S)),h.group_ids.length&&v.push(h);continue}(h.widgets||[]).length&&v.push(h)}!v.length&&((p=r.groups)!=null&&p.length)&&v.push({type:"groups",group_ids:[r.groups[0].id]}),m.blocks=v}}function xr(r,u,l){var m;const c=((m=r.layout)==null?void 0:m.pages)||[];if(!c.length)return;const s=c.find(v=>v.id===u)||c[0];let p=s.blocks.find(v=>v.type==="groups");if(!p){p={type:"groups",group_ids:[l]},s.blocks.push(p);return}p.group_ids.includes(l)||p.group_ids.push(l)}function Ar(r,u,l){const c=r.groups||[],s=c.findIndex(h=>h.id===u),p=c.findIndex(h=>h.id===l);if(s<0||p<0||s===p)return!1;const[m]=c.splice(s,1),v=s<p?p-1:p;return c.splice(v,0,m),!0}function Mr(r,u,l,c,s){const p=Ie(r,u),m=Ie(r,c);if(!p||!m)return!1;const v=(p.subgroups||[]).findIndex(_=>_.id===l),h=(m.subgroups||[]).findIndex(_=>_.id===s);if(v<0||h<0)return!1;if(u!==c&&p.subgroups.length<=1)throw new Error("В исходной группе должна остаться минимум одна подгруппа.");const[S]=p.subgroups.splice(v,1);if(u===c){const _=v<h?h-1:h;return p.subgroups.splice(_,0,S),!0}return m.subgroups.splice(h,0,S),!0}function Dr(r,u,l,c,s,p,m){const v=me(r,u,l),h=me(r,s,p);if(!v||!h)return!1;const S=(v.items||[]).findIndex(T=>T.id===c),_=(h.items||[]).findIndex(T=>T.id===m);if(S<0||_<0)return!1;if(l!==p&&v.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[I]=v.items.splice(S,1);if(l===p){const T=S<_?_-1:_;return v.items.splice(T,0,I),!0}return h.items.splice(_,0,I),!0}function Rr(r,u,l,c,s,p){const m=me(r,u,l),v=me(r,s,p);if(!m||!v)return!1;const h=(m.items||[]).findIndex(_=>_.id===c);if(h<0)return!1;if(l!==p&&m.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[S]=m.items.splice(h,1);return v.items.push(S),!0}function ns(r){const u=String(r||"").trim();if(!u)throw new Error("URL не может быть пустым");const l=/^https?:\/\//i.test(u)?u:`https://${u}`;let c;try{c=new URL(l)}catch{throw new Error(`Некорректный URL: ${u}`)}if(!["http:","https:"].includes(c.protocol))throw new Error(`Разрешены только http/https URL: ${u}`);return c.toString()}function rs(r){const u=String(r||"").trim();if(!u)return"";const l=/^https?:\/\//i.test(u)?u:`https://${u}`;try{const c=new URL(l);return["http:","https:"].includes(c.protocol)?c.origin:""}catch{return""}}let yt=null;function le(){if(yt)return yt;const r="/static/img/emblem-mark.png",u=3e4,l=16e3,c=9e3,s=700,p=1e4,m="lan",v=new Set(["stat_list","table"]),h="https://example.com",S="sidebar-particles",_="hero-title-particles",I="hero-controls-particles",T={fps_limit:58,particles:{number:{value:88,density:{enable:!0,value_area:700}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.36,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:120,color:"#2dd4bf",opacity:.24,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},x={fps_limit:58,particles:{number:{value:92,density:{enable:!0,value_area:720}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.4,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:132,color:"#2dd4bf",opacity:.26,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},G=Object.freeze([{value:"detailed",label:"Карточки"},{value:"tile",label:"Плитка"},{value:"icon",label:"Значки"}]),ee=Object.freeze([{value:"groups",label:"Только группы"},{value:"tags_in_groups",label:"Группы + теги"},{value:"tags",label:"Только теги"},{value:"flat",label:"Без групп (плитка)"}]),A=["detailed","hidden"],N=18,j=10;function R(){return{id:"",title:"",type:"link",url:h,icon:"",siteInput:"",tagsInput:"",open:"new_tab",healthcheckEnabled:!1,healthcheckUrl:"",healthcheckIntervalSec:30,healthcheckTimeoutMs:1500,iframeSandboxMode:"default",iframeAllowInput:"",iframeReferrerPolicy:"",authProfile:""}}const y=B(null),F=B(!0),J=B(""),Y=B(""),ne=B(""),_e=B(!1),K=B(""),D=B(!1),fe=B(typeof document>"u"?!0:document.visibilityState!=="hidden"),ue=B("detailed"),ye=B("groups"),re=B("all"),oe=B("detailed"),te=B("idle"),se=B(""),$e=B(null),Ve=B(!1),V=B(!1),be=B(""),Q=B(!1),Xe=B(""),ce=B(0),et=he({open:!1,host:null}),Ce=he({}),wt=he({}),St=new Map;let tt=0,Re=0,nt=0,_t=!1,Vt=!1,Ee=0;const k=he({groupKey:"",subgroupId:"",itemId:""}),pe=he({}),rt=he({}),P=he({type:"",groupId:"",subgroupId:"",itemId:""}),ot=he({}),Z=he({open:!1,title:"",src:"",allow:"",sandbox:!1,referrerPolicy:"",loading:!1,error:""}),E=he({open:!1,mode:"create",groupId:"",subgroupId:"",originalItemId:"",submitting:!1,error:"",form:R()}),Te=C(()=>{var t,n;if(!y.value)return[];const e=((n=(t=y.value)==null?void 0:t.layout)==null?void 0:n.pages)||[];return e.some(o=>o.id===m)?e:[...e,{id:m,title:"LAN",icon:"network",blocks:[]}]}),Ht=C(()=>{var e;return((e=y.value)==null?void 0:e.widgets)||[]}),Ln=C(()=>{var e,t;return((t=(e=y.value)==null?void 0:e.security)==null?void 0:t.auth_profiles)||[]}),eo=C(()=>{var e,t;return((t=(e=y.value)==null?void 0:e.app)==null?void 0:t.title)||"Oko"}),to=C(()=>{var e,t;return((t=(e=y.value)==null?void 0:e.app)==null?void 0:t.tagline)||"Your Infrastructure in Sight"}),no=C(()=>G),ro=C(()=>ee),Pn=C(()=>ue.value==="icon"),xn=C(()=>ue.value==="tile"),An=C(()=>Pn.value||xn.value),Ft=C(()=>oe.value!=="hidden"),kt=C(()=>oe.value==="hidden"),oo=C(()=>!1),io=C(()=>Ft.value?"Режим меню: полное. Нажмите, чтобы скрыть меню":"Режим меню: скрыто. Нажмите, чтобы вернуть полное меню"),Mn=C(()=>{var e,t;return((t=(e=$e.value)==null?void 0:e.result)==null?void 0:t.hosts)||[]}),ao=C(()=>{var t,n;const e=((n=(t=$e.value)==null?void 0:t.result)==null?void 0:n.scanned_cidrs)||[];return e.length?e.join(", "):"нет данных"}),so=C(()=>te.value==="saving"?"Сохранение...":te.value==="saved"?"Сохранено":te.value==="error"?"Ошибка сохранения":D.value?"Готово":"Сохранение выключено"),$t=C(()=>{var n;const e=new Map;for(const o of((n=y.value)==null?void 0:n.groups)||[])for(const a of o.subgroups||[])for(const d of a.items||[]){const w=ct(d,o);if(!w)continue;const $=w.toLowerCase();e.has($)||e.set($,w)}const t=Array.from(e.entries()).sort((o,a)=>o[1].localeCompare(a[1],"ru",{sensitivity:"base"}));return[{value:"all",label:"Все sites"},...t.map(([o,a])=>({value:o,label:a}))]}),Ct=C(()=>{const e=new Map;for(const t of Ht.value)e.set(t.id,t);return e}),Kt=C(()=>{var t;const e=new Map;for(const n of((t=y.value)==null?void 0:t.groups)||[])e.set(n.id,n);return e}),Dn=C(()=>{var t;const e=new Map;for(const n of((t=y.value)==null?void 0:t.groups)||[])for(const o of n.subgroups||[])e.set(o.id,{group:n,subgroup:o});return e}),lo=C(()=>{const e=new Map;for(const t of Te.value)for(const n of t.blocks||[])if((n==null?void 0:n.type)==="groups")for(const o of n.group_ids||[])e.has(o)||e.set(o,t.id);return e}),Rn=C(()=>{const e=new Map;for(const t of Mn.value||[]){const n=String((t==null?void 0:t.ip)||"").trim();if(n)for(const o of(t==null?void 0:t.dashboard_items)||[]){const a=String((o==null?void 0:o.id)||"").trim();a&&!e.has(a)&&e.set(a,n)}}return e}),uo=C(()=>{var n;const e=[],t=lo.value;for(const o of((n=y.value)==null?void 0:n.groups)||[])for(const a of o.subgroups||[])for(const d of a.items||[]){const w=Ko(d==null?void 0:d.url),$=Rn.value.get(d.id)||"",q=(d.tags||[]).map(ke=>String(ke||"").trim()).filter(Boolean),ie=ct(d,o);if(re.value!=="all"&&ie.toLowerCase()!==re.value)continue;const Oe=t.get(o.id)||t.get(a.id)||"",xe=String(d.title||"").trim(),qe=[xe,String(d.id||""),String(d.url||""),w,$,ie,String(o.title||""),String(a.title||""),...q].join(" ").toLowerCase();e.push({id:d.id,item:d,title:xe,titleLower:xe.toLowerCase(),host:w.toLowerCase(),ip:$.toLowerCase(),site:ie.toLowerCase(),tagsLower:q.map(ke=>ke.toLowerCase()),groupId:o.id,groupKey:`group:${o.id}`,groupTitle:String(o.title||""),subgroupId:a.id,subgroupTitle:String(a.title||""),pageId:Oe,searchBlob:qe})}return e}),it=C(()=>{const e=String(Xe.value||"").trim().toLowerCase(),t=uo.value;if(!e)return t.slice().sort((a,d)=>a.title.localeCompare(d.title,"ru",{sensitivity:"base"})).slice(0,j);const n=e.split(/\s+/).filter(Boolean),o=[];for(const a of t){let d=0,w=!0;for(const $ of n){if(!a.searchBlob.includes($)){w=!1;break}a.titleLower.startsWith($)?d+=12:a.titleLower.includes($)&&(d+=8),a.host.startsWith($)?d+=7:a.host.includes($)&&(d+=4),a.ip===$?d+=14:a.ip.includes($)&&(d+=6),a.site&&a.site.includes($)&&(d+=5),a.tagsLower.some(q=>q.includes($))&&(d+=3)}w&&o.push({entry:a,score:d})}return o.sort((a,d)=>d.score!==a.score?d.score-a.score:a.entry.title.localeCompare(d.entry.title,"ru",{sensitivity:"base"})),o.slice(0,N).map(a=>a.entry)}),On=C(()=>it.value[ce.value]||null),Le=C(()=>Te.value.find(e=>e.id===Y.value)||Te.value[0]||null),Ut=C(()=>{var e;return((e=Le.value)==null?void 0:e.id)===m}),He=C(()=>{if(!Le.value)return[];const e=[];for(const t of Le.value.blocks||[])(t==null?void 0:t.type)==="groups"&&e.push(...t.group_ids||[]);return Jt(e)}),Bn=C(()=>{const e=Qn(He.value),t=ne.value.trim().toLowerCase();return t?e.map(n=>{if(String(n.title||"").toLowerCase().includes(t)||String(n.description||"").toLowerCase().includes(t))return{...n,subgroups:n.subgroups||[]};const a=(n.subgroups||[]).map(d=>{if(String(d.title||"").toLowerCase().includes(t))return{...d,items:d.items||[]};const $=(d.items||[]).filter(q=>{const ie=String(q.title||"").toLowerCase().includes(t),Oe=String(q.url||"").toLowerCase().includes(t),xe=(q.tags||[]).some(ke=>String(ke).toLowerCase().includes(t)),qe=ct(q,n).toLowerCase().includes(t);return ie||Oe||xe||qe});return $.length?{...d,items:$}:null}).filter(Boolean);return a.length?{...n,subgroups:a}:null}).filter(Boolean):e}),co=C(()=>{const e=[];for(const t of Bn.value){e.push({key:`group:${t.key}`,type:"group",groupKey:t.key,group:t});for(const n of t.subgroups||[])e.push({key:`subgroup:${t.key}:${n.id}`,type:"subgroup",groupKey:t.key,subgroupId:n.id,subgroup:n})}return e}),at=C(()=>{const e=[];for(const t of He.value)for(const n of t.subgroups||[])for(const o of n.items||[])e.push(o.id);return e}),fo=C(()=>{var n;const e=at.value;let t=0;for(const o of e)(n=ze(o))!=null&&n.ok&&(t+=1);return{online:t,total:e.length}}),Et=C(()=>{if(!Le.value)return[];const e=[];for(const t of Le.value.blocks||[])qn(t)&&e.push(...t.widgets||[]);return Array.from(new Set(e))}),Tt=C(()=>Wn(Et.value)),po=C(()=>{const e=Tt.value.length;if(!e)return"нет данных";const t=Tt.value.filter(n=>st(n)).length;return`${e} · больших ${t}`}),go=C(()=>{var e;return(((e=Le.value)==null?void 0:e.blocks)||[]).filter(t=>(t==null?void 0:t.type)==="groups")}),Gn=C(()=>{const e=Ct.value.get(K.value);return!e||!st(e)?null:Et.value.includes(e.id)?e:null});function Nn(e){if(!e)return;const t=document.documentElement;e.accent&&(t.style.setProperty("--accent",e.accent),t.style.setProperty("--accent-soft",e.accent)),e.background&&t.style.setProperty("--bg",e.background),e.border&&t.style.setProperty("--border",e.border),e.card&&(t.style.setProperty("--surface",e.card),t.style.setProperty("--surface-strong",e.card)),t.style.setProperty("--glow-enabled",e.glow===!1?"0":"1")}function Vn(e){if(!e)return;const t=document.documentElement;e.gap!=null&&t.style.setProperty("--grid-gap",`${Number(e.gap)}px`),e.card_radius!=null&&t.style.setProperty("--card-radius",`${Number(e.card_radius)}px`),e.columns!=null&&t.style.setProperty("--layout-columns",String(Number(e.columns)))}function mo(){D.value=!D.value,se.value="",D.value||Fe()}function vo(){if(ue.value==="detailed"){ue.value="tile";return}if(ue.value==="tile"){ue.value="icon";return}ue.value="detailed"}function bo(){oe.value!=="detailed"&&oe.value!=="hidden"&&(oe.value="detailed");const e=A.indexOf(oe.value),n=((e>=0?e:0)+1)%A.length;oe.value=A[n],Ft.value||(ne.value="",ut()),kt.value&&(ye.value="flat")}function yo(e){return e?e.type==="group"?nr(e.groupKey):e.type==="subgroup"?rr(e.groupKey,e.subgroupId):!1:!1}function ho(e){var t,n;return e?e.type==="group"?`Группа: ${((t=e.group)==null?void 0:t.title)||""}`:e.type==="subgroup"?`Подгруппа: ${((n=e.subgroup)==null?void 0:n.title)||""}`:"":""}function Io(e){if(e){if(e.type==="group"){pe[e.groupKey]=!0,k.groupKey=e.groupKey,k.subgroupId="",k.itemId="";return}e.type==="subgroup"&&er(e.groupKey,e.subgroupId)}}function wo(e,t,n){if(!An.value)return;const o=(n==null?void 0:n.__originGroupKey)||e,a=(n==null?void 0:n.__originSubgroupId)||t;Qt(o,a,n.id),an(n)}function Hn(e){return JSON.parse(JSON.stringify(e))}function zt(e){return ns(e)}async function Fn(){var e;if(y.value){te.value="saving",se.value="";try{const t=await Ua(y.value);y.value=t.config,(!Y.value||!Te.value.some(n=>n.id===Y.value))&&(Y.value=((e=Te.value[0])==null?void 0:e.id)||""),te.value="saved",Re&&clearTimeout(Re),Re=window.setTimeout(()=>{te.value==="saved"&&(te.value="idle")},1400)}catch(t){throw te.value="error",se.value=(t==null?void 0:t.message)||"Ошибка сохранения YAML",t}}}async function de(e){if(!y.value)return!1;const t=Hn(y.value);try{return e(y.value)===!1?!1:(Pr(y.value),lt(),await Fn(),!0)}catch(n){return y.value=t,te.value="error",se.value=(n==null?void 0:n.message)||"Не удалось применить изменения",!1}}function jt(e,t){return{id:e,type:"link",title:t,url:h,icon:null,site:null,tags:[],open:"new_tab"}}async function So(){if(!D.value||!y.value)return;const e=window.prompt("Название новой группы","Новая группа");if(e==null)return;const t=e.trim();t&&await de(n=>{const o=new Set((n.groups||[]).map(ie=>ie.id)),a=Nt(n),d=Mt(n),w=Be(t,o),$=Be(`${w}-core`,a),q=Be(`${w}-service`,d);n.groups.push({id:w,title:t,icon:"folder",description:"",layout:"auto",subgroups:[{id:$,title:"Core",items:[jt(q,"Новый сервис")]}]}),xr(n,Y.value,w),pe[`group:${w}`]=!0,k.groupKey=`group:${w}`,k.subgroupId=$,k.itemId=q})}async function _o(e){if(!D.value||!y.value)return;const t=window.prompt("Название подгруппы","Новая подгруппа");if(t==null)return;const n=t.trim();n&&await de(o=>{const a=Ie(o,e);if(!a)throw new Error(`Группа '${e}' не найдена`);const d=Nt(o),w=Mt(o),$=Be(`${e}-${n}`,d),q=Be(`${$}-service`,w);a.subgroups.push({id:$,title:n,items:[jt(q,"Новый сервис")]}),pe[`group:${e}`]=!0,k.groupKey=`group:${e}`,k.subgroupId=$,k.itemId=q})}async function ko(e,t){!D.value||!y.value||Un(e,t)}function qt(e){return String(e||"").split(",").map(t=>t.trim()).filter(Boolean)}function Wt(e,t,n,o){const a=Number(e);if(!Number.isFinite(a))return t;const d=Math.trunc(a);return Math.min(o,Math.max(n,d))}function Kn(e=!1){E.submitting&&!e||(E.open=!1,E.mode="create",E.groupId="",E.subgroupId="",E.originalItemId="",E.error="",E.submitting=!1,E.form=R())}function Un(e,t){if(!me(y.value,e,t)){te.value="error",se.value=`Подгруппа '${t}' не найдена`;return}E.open=!0,E.mode="create",E.groupId=e,E.subgroupId=t,E.originalItemId="",E.error="",E.submitting=!1,E.form=R()}function zn(e,t,n){var d,w,$;const o=me(y.value,e,t),a=((o==null?void 0:o.items)||[]).find(q=>q.id===n);if(!o||!a){te.value="error",se.value=`Элемент '${n}' не найден`;return}E.open=!0,E.mode="edit",E.groupId=e,E.subgroupId=t,E.originalItemId=n,E.error="",E.submitting=!1,E.form={id:a.id,title:a.title,type:a.type,url:String(a.url||h),icon:a.icon||"",siteInput:String(a.site||""),tagsInput:(a.tags||[]).join(", "),open:a.open||"new_tab",healthcheckEnabled:!!(a.type==="link"&&a.healthcheck),healthcheckUrl:a.type==="link"&&a.healthcheck?String(a.healthcheck.url):String(a.url||h),healthcheckIntervalSec:a.type==="link"&&a.healthcheck?Number(a.healthcheck.interval_sec||30):30,healthcheckTimeoutMs:a.type==="link"&&a.healthcheck?Number(a.healthcheck.timeout_ms||1500):1500,iframeSandboxMode:a.type==="iframe"?((d=a.iframe)==null?void 0:d.sandbox)==null?"default":a.iframe.sandbox?"enabled":"disabled":"default",iframeAllowInput:a.type==="iframe"?(((w=a.iframe)==null?void 0:w.allow)||[]).join(", "):"",iframeReferrerPolicy:a.type==="iframe"&&(($=a.iframe)==null?void 0:$.referrer_policy)||"",authProfile:a.type==="iframe"&&a.auth_profile||""}}function jn(e){const t=E.form,n=String(t.title||"").trim();if(!n)throw new Error("Название сервиса обязательно");const o=String(t.type||"").trim().toLowerCase();if(!["link","iframe"].includes(o))throw new Error("Тип сервиса должен быть 'link' или 'iframe'");const a=String(t.open||"new_tab");if(!["new_tab","same_tab"].includes(a))throw new Error("Параметр open должен быть 'new_tab' или 'same_tab'");const d=zt(t.url||h),w=Mt(e);E.mode==="edit"&&w.delete(E.originalItemId);const $=String(t.id||"").trim(),q=`${E.subgroupId}-${n}`,ie=It($||q,"service"),Oe=$?ie:Be(ie,w);if($&&w.has(Oe))throw new Error(`ID '${Oe}' уже существует`);const xe={id:Oe,type:o,title:n,url:d,icon:String(t.icon||"").trim()||null,site:String(t.siteInput||"").trim()||null,tags:qt(t.tagsInput),open:a};if(o==="link"){const At={...xe};if(t.healthcheckEnabled){const Ji=zt(t.healthcheckUrl||d);At.healthcheck={type:"http",url:Ji,interval_sec:Wt(t.healthcheckIntervalSec,30,1,3600),timeout_ms:Wt(t.healthcheckTimeoutMs,1500,100,12e4)}}return At}const qe=String(t.iframeSandboxMode||"default");let ke=null;qe==="enabled"&&(ke=!0),qe==="disabled"&&(ke=!1);const mt=String(t.authProfile||"").trim();if(mt&&!Ln.value.some(At=>At.id===mt))throw new Error(`Auth profile '${mt}' не найден`);const vr={...xe,iframe:{sandbox:ke,allow:qt(t.iframeAllowInput),referrer_policy:String(t.iframeReferrerPolicy||"").trim()||null}};return mt&&(vr.auth_profile=mt),vr}async function $o(){if(!E.open||E.submitting||!y.value)return;E.submitting=!0,E.error="";const e=await de(t=>{const n=me(t,E.groupId,E.subgroupId);if(!n)throw new Error(`Подгруппа '${E.subgroupId}' не найдена`);const o=jn(t);if(E.mode==="create")return n.items.push(o),k.groupKey=`group:${E.groupId}`,k.subgroupId=E.subgroupId,k.itemId=o.id,!0;const a=(n.items||[]).findIndex(d=>d.id===E.originalItemId);if(a<0)throw new Error(`Элемент '${E.originalItemId}' не найден`);return n.items.splice(a,1,o),k.groupKey=`group:${E.groupId}`,k.subgroupId=E.subgroupId,(k.itemId===E.originalItemId||!k.itemId)&&(k.itemId=o.id),!0});E.submitting=!1,e?Kn(!0):E.error=se.value||"Не удалось сохранить сервис"}async function Co(e){if(!D.value||!y.value)return;const t=Ie(y.value,e);if(!t)return;const n=window.prompt("Название группы",t.title);if(n==null)return;const o=window.prompt("Описание группы",t.description||"");if(o==null)return;const a=window.prompt("Режим группы (auto | full | inline)",t.layout||"auto");a!=null&&await de(d=>{const w=Ie(d,e);if(!w)throw new Error(`Группа '${e}' не найдена`);const $=String(a||"").trim().toLowerCase()||"auto";if(!["auto","full","inline"].includes($))throw new Error("Режим группы должен быть 'auto', 'full' или 'inline'");w.title=n.trim()||w.title,w.description=o.trim(),w.layout=$})}async function Eo(e,t){if(!D.value||!y.value)return;const n=me(y.value,e,t);if(!n)return;const o=window.prompt("Название подгруппы",n.title);o!=null&&await de(a=>{const d=me(a,e,t);if(!d)throw new Error(`Подгруппа '${t}' не найдена`);d.title=o.trim()||d.title})}async function To(e,t,n){!D.value||!y.value||zn(e,t,n)}async function Lo(e){if(!D.value||!y.value)return;const t=Ie(y.value,e);if(t){if(y.value.groups.length<=1){te.value="error",se.value="Нельзя удалить последнюю группу.";return}window.confirm(`Удалить группу "${t.title}"?`)&&await de(n=>{const o=(n.groups||[]).findIndex(a=>a.id===e);if(o<0)return!1;n.groups.splice(o,1),k.groupKey="",k.subgroupId="",k.itemId=""})}}async function Po(e,t){if(!D.value||!y.value)return;const n=Ie(y.value,e),o=((n==null?void 0:n.subgroups)||[]).find(a=>a.id===t);if(!(!n||!o)){if(n.subgroups.length<=1){te.value="error",se.value="В группе должна остаться хотя бы одна подгруппа.";return}window.confirm(`Удалить подгруппу "${o.title}"?`)&&await de(a=>{const d=Ie(a,e);if(!d)return!1;const w=(d.subgroups||[]).findIndex($=>$.id===t);if(w<0)return!1;d.subgroups.splice(w,1),k.subgroupId="",k.itemId=""})}}async function xo(e,t,n){if(!D.value||!y.value)return;const o=me(y.value,e,t),a=((o==null?void 0:o.items)||[]).find(d=>d.id===n);if(!(!o||!a)){if(o.items.length<=1){te.value="error",se.value="В подгруппе должен остаться хотя бы один элемент.";return}window.confirm(`Удалить сервис "${a.title}"?`)&&await de(d=>{const w=me(d,e,t);if(!w)return!1;const $=(w.items||[]).findIndex(q=>q.id===n);if($<0)return!1;w.items.splice($,1),k.itemId===n&&(k.itemId="")})}}function Fe(){P.type="",P.groupId="",P.subgroupId="",P.itemId=""}function Ao(e,t){if(!D.value||!Dt(t))return;const n=t.id;P.type="group",P.groupId=n,P.subgroupId="",P.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`group:${n}`))}function Mo(e,t,n){D.value&&(P.type="subgroup",P.groupId=t,P.subgroupId=n,P.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`subgroup:${n}`)))}function Do(e,t,n,o){D.value&&(P.type="item",P.groupId=t,P.subgroupId=n,P.itemId=o,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`item:${o}`)))}function Ro(e,t){if(!D.value||!Dt(t))return;const n=t.id;P.type==="group"&&P.groupId!==n&&e.preventDefault()}async function Oo(e,t){if(!D.value||!Dt(t))return;const n=t.id;if(P.type!=="group"||!P.groupId||P.groupId===n)return;e.preventDefault();const o=P.groupId;Fe(),await de(a=>Ar(a,o,n))}function Bo(e,t,n){if(D.value){if(P.type==="subgroup"){if(P.subgroupId===n)return;e.preventDefault();return}P.type==="item"&&e.preventDefault()}}async function Go(e,t,n){if(D.value){if(P.type==="subgroup"){e.preventDefault();const o=P.groupId,a=P.subgroupId;Fe(),await de(d=>Mr(d,o,a,t,n));return}if(P.type==="item"){e.preventDefault();const o=P.groupId,a=P.subgroupId,d=P.itemId;Fe(),await de(w=>Rr(w,o,a,d,t,n))}}}function No(e,t,n,o){D.value&&P.type==="item"&&P.itemId!==o&&e.preventDefault()}async function Vo(e,t,n,o){if(!D.value||P.type!=="item"||!P.itemId||P.itemId===o)return;e.preventDefault();const a=P.groupId,d=P.subgroupId,w=P.itemId;Fe(),await de($=>Dr($,a,d,w,t,n,o))}function qn(e){return(e==null?void 0:e.type)==="widget_row"||(e==null?void 0:e.type)==="widget_grid"}function Wn(e=[]){return e.map(t=>Ct.value.get(t)).filter(Boolean)}function st(e){return v.has(String((e==null?void 0:e.type)||""))}function Ho(e){return sr(e).slice(0,2)}function Jn(e){const t=Tt.value.find(n=>n.id===e);!t||!st(t)||(K.value=t.id)}function Fo(e){st(e)&&Jn(e.id)}function Jt(e=[]){const t=[];for(const n of e){const o=Kt.value.get(n);if(o){t.push({key:`group:${o.id}`,id:o.id,title:o.title,icon:o.icon||null,description:o.description||"",layout:o.layout||"auto",subgroups:o.subgroups||[]});continue}const a=Dn.value.get(n);a&&t.push({key:`subgroup:${a.subgroup.id}`,id:a.group.id,title:a.group.title,icon:a.group.icon||null,description:a.group.description||"",layout:a.group.layout||"auto",subgroups:[a.subgroup]})}return t}function lt(){const e=new Set(He.value.map(t=>t.key));for(const t of Object.keys(pe))e.has(t)||delete pe[t];for(const t of He.value)pe[t.key]==null&&(pe[t.key]=!0);k.groupKey&&!e.has(k.groupKey)&&ut()}function ut(){k.groupKey="",k.subgroupId="",k.itemId=""}function Ko(e){try{return new URL(String(e||"")).hostname||""}catch{return""}}function Uo(e,t,n){const o=String((e==null?void 0:e.site)||"").trim();if(o)return o;const a=String((t==null?void 0:t.site)||"").trim();if(a)return a;const d=(n||[]).find(w=>String(w||"").toLowerCase().startsWith("site:"));return d?String(d).slice(5).trim():""}function Yn(e){return((e==null?void 0:e.tags)||[]).map(t=>String(t||"").trim()).filter(Boolean)}function zo(e){const t=String(e||"");return t.startsWith("group:")&&Kt.value.get(t.slice(6))||null}function ct(e,t=null){return Uo(e,t,Yn(e))}function jo(e,t=""){const n=zo((e==null?void 0:e.__originGroupKey)||t);return ct(e,n)}function Qn(e=[]){return re.value==="all"?e:e.map(t=>{const n=(t.subgroups||[]).map(o=>({...o,items:(o.items||[]).filter(a=>ct(a,t).toLowerCase()===re.value)})).filter(o=>o.items.length>0);return n.length?{...t,subgroups:n}:null}).filter(Boolean)}function qo(e){const t=String(e||"all").trim().toLowerCase(),n=new Set($t.value.map(o=>o.value));re.value=n.has(t)?t:"all"}function Zn(){Xe.value="",ce.value=0,Q.value=!0}function Yt(){Q.value=!1,Xe.value="",ce.value=0}function Wo(){if(Q.value){Yt();return}Zn()}function Jo(e){Xe.value=String(e||""),ce.value=0}function Yo(e){const t=it.value.length-1;if(t<0){ce.value=0;return}ce.value=Math.min(Math.max(e,0),t)}function Qo(e){const t=it.value.length;if(!t){ce.value=0;return}const o=(ce.value+e+t)%t;ce.value=o}function Zo(e){e&&(e.pageId&&(Y.value=e.pageId),Qt(e.groupKey,e.subgroupId,e.item.id))}function Xn(e){e&&(Zo(e),an(e.item),Yt())}function Xo(){Xn(On.value)}async function ei(e){var t;(t=e==null?void 0:e.item)!=null&&t.url&&await fr(e.item.url)}function ti(e){pe[e]=!tr(e),k.groupKey=e,k.subgroupId="",k.itemId=""}function er(e,t){pe[e]=!0,k.groupKey=e,k.subgroupId=t,k.itemId=""}function Qt(e,t,n){pe[e]=!0,k.groupKey=e,k.subgroupId=t,k.itemId=n}function tr(e){return!!pe[e]}function nr(e){return k.groupKey===e&&!k.subgroupId&&!k.itemId}function rr(e,t){return k.groupKey===e&&k.subgroupId===t&&!k.itemId}function ni(e){return k.itemId===e}function ri(e=[]){const t=Jt(e),n=Qn(t),o=kt.value?n:ai(n),a=ui(o),d=a.length;return a.map(w=>({...w,__visibleCount:d}))}function oi(){return!!(k.groupKey||k.subgroupId||k.itemId)}function ii(e){return String(e||"").trim()||"Без тега"}function or(e){const t=new Set(Yn(e).map(n=>ii(n)).filter(Boolean));return t.size||t.add("Без тега"),Array.from(t)}function Zt(e,t,n){return{...e,__originGroupKey:t,__originSubgroupId:n}}function ai(e=[]){return oi()?e.map(t=>{if(k.groupKey&&t.key!==k.groupKey)return null;let n=t.subgroups||[];return k.subgroupId&&(n=n.filter(o=>o.id===k.subgroupId)),k.itemId&&(n=n.map(o=>({...o,items:(o.items||[]).filter(a=>a.id===k.itemId)})).filter(o=>o.items.length>0)),n.length?{...t,subgroups:n}:null}).filter(Boolean):e}function si(e=[]){return e.map(t=>{const n=new Map;for(const d of t.subgroups||[])for(const w of d.items||[])for(const $ of or(w))n.has($)||n.set($,[]),n.get($).push(Zt(w,t.key,d.id));const a=Array.from(n.entries()).sort(([d],[w])=>d.localeCompare(w,"ru",{sensitivity:"base"})).map(([d,w])=>({id:`tag-${It(`${t.id}-${d}`,"tag")}`,title:`#${d}`,icon:"tag",items:w}));return a.length?{...t,subgroups:a}:null}).filter(Boolean)}function li(e=[]){const t=new Map;for(const o of e)for(const a of o.subgroups||[])for(const d of a.items||[])for(const w of or(d))t.has(w)||t.set(w,[]),t.get(w).push(Zt(d,o.key,a.id));return Array.from(t.entries()).sort(([o],[a])=>o.localeCompare(a,"ru",{sensitivity:"base"})).map(([o,a])=>{const d=It(o,"tag");return{key:`tags:${d}`,id:`tags-${d}`,title:`#${o}`,icon:"tag",description:"Сервисы, сгруппированные только по тегам.",layout:"inline",subgroups:[{id:`tags-${d}-items`,title:"Сервисы",items:a}]}})}function ir(e=[]){const t=[];for(const n of e)for(const o of n.subgroups||[])for(const a of o.items||[])t.push(Zt(a,n.key,o.id));return t.length?[{key:"flat:all",id:"flat-all",title:"Все сервисы",icon:"layout-grid",description:"Плоское отображение без группировки.",layout:"full",subgroups:[{id:"flat-all-items",title:"Плитка",items:t}]}]:[]}function ui(e=[]){return kt.value?ir(e):ye.value==="tags_in_groups"?si(e):ye.value==="tags"?li(e):ye.value==="flat"?ir(e):e}function ci(e){const t=String((e==null?void 0:e.layout)||"auto").toLowerCase();return t==="inline"?!0:t==="full"?!1:Number((e==null?void 0:e.__visibleCount)||0)>1}function di(e){return(e.subgroups||[]).reduce((t,n)=>t+(n.items||[]).length,0)}function fi(e){return((e==null?void 0:e.items)||[]).length}function pi(e){var n;let t=0;for(const o of e.subgroups||[])for(const a of o.items||[])(n=ze(a.id))!=null&&n.ok&&(t+=1);return t}function ar(){for(const e of Object.keys(ot))delete ot[e]}function Xt(e){return rs(e)}function en(e){const t=Xt(e==null?void 0:e.url);return t?`${String((e==null?void 0:e.id)||"")}|${t}`:""}function gi(e){const t=Xt(e==null?void 0:e.url);if(!t)return"";const n=en(e);return n&&ot[n]?"":`${t}/favicon.ico`}function mi(e){const t=en(e);t&&(ot[t]=!0)}function vi(e){return Qa(e)}function bi(e){return Za(e)}function yi(e){return Xa(e)}function hi(e){return es(e)}function Ii(e){return ts(e)}function Ke(e){return Ce[e]||null}function tn(e,t){return`${e}:${t}`}function wi(e,t){return!!wt[tn(e,t)]}function Pe(e,t){if(!t||typeof t!="string")return null;if(t==="$")return e;if(!t.startsWith("$."))return null;let n=e;const o=t.slice(2).split(".");for(const a of o){if(n==null)return null;const d=a.match(/^(.*)\[\*\]$/);if(d){const w=d[1],$=w?n==null?void 0:n[w]:n;return Array.isArray($)?$:[]}n=n==null?void 0:n[a]}return n}function Si(e){var o,a,d;const t=(o=Ke(e.id))==null?void 0:o.payload;return Pe(t,(d=(a=e.data)==null?void 0:a.mapping)==null?void 0:d.value)??"—"}function _i(e){var o,a,d;const t=(o=Ke(e.id))==null?void 0:o.payload;return Pe(t,(d=(a=e.data)==null?void 0:a.mapping)==null?void 0:d.subtitle)??""}function ki(e){var o,a,d;const t=(o=Ke(e.id))==null?void 0:o.payload;return Pe(t,(d=(a=e.data)==null?void 0:a.mapping)==null?void 0:d.trend)??""}function sr(e){var a,d;const t=(a=Ke(e.id))==null?void 0:a.payload,n=((d=e.data)==null?void 0:d.mapping)||{},o=Pe(t,n.items);return Array.isArray(o)?o.map(w=>{const $=Pe(w,n.item_title)??"-",q=Pe(w,n.item_value)??"-";return{title:$,value:q}}):[]}function $i(e){var a,d,w;const t=(a=Ke(e.id))==null?void 0:a.payload,n=(w=(d=e.data)==null?void 0:d.mapping)==null?void 0:w.rows,o=Pe(t,n);return Array.isArray(o)?o:Array.isArray(t)?t:Array.isArray(t==null?void 0:t.items)?t.items:[]}function Lt(e){return e?e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/")?e:`/${e}`:""}function dt(){for(const e of St.values())clearInterval(e);St.clear()}function Ue(){tt&&(clearTimeout(tt),tt=0)}function ze(e){return rt[e]||null}function Ci(e){return!!(e!=null&&e.ok&&e.latency_ms!=null&&e.latency_ms>=s)}function nn(e){if(!e)return"unknown";const t=String(e.level||"").toLowerCase();return["online","degraded","down","unknown","indirect_failure"].includes(t)?t:Ci(e)?"degraded":e.ok?"online":"down"}function Ei(e){const t=ze(e),n=nn(t);return n==="online"?"ok":n==="degraded"?"degraded":n==="down"||n==="indirect_failure"?"down":"unknown"}function Ti(e){const t=ze(e);if(!t)return"Проверка...";const n=nn(t);return n==="online"?t.latency_ms!=null?`Online • ${t.latency_ms} ms`:"Online":n==="degraded"?t.latency_ms!=null?`Degraded • ${t.latency_ms} ms`:t.status_code!=null?`Degraded • HTTP ${t.status_code}`:t.error?`Degraded • ${t.error}`:t.reason?`Degraded • ${String(t.reason).replaceAll("_"," ")}`:"Degraded":n==="indirect_failure"?"Indirect failure":n==="down"?t.error?`Offline • ${t.error}`:t.status_code!=null?`Offline • HTTP ${t.status_code}`:"Offline":"Unknown"}async function je(e=null){if(!Array.isArray(e)&&!fe.value)return;const t=Array.isArray(e)&&e.length?e:at.value,n=Array.from(new Set(t.map(o=>String(o||"").trim()).filter(Boolean)));if(n.length)try{const o=await Ka(n);for(const a of o.items||[])rt[a.item_id]=a}catch{for(const o of n)rt[o]||(rt[o]={item_id:o,ok:!1,checked_url:"",status_code:null,latency_ms:null,error:"healthcheck unavailable"})}}async function rn(){Ue(),await je(),lr()}function Li(){let e=!1,t=!1;for(const n of at.value){const o=nn(ze(n));if(o==="down"||o==="indirect_failure"){e=!0;break}o==="degraded"&&(t=!0)}return e?c:t?l:u}function lr(){if(Ue(),!fe.value)return;const e=Li();tt=window.setTimeout(async()=>{await je(),lr()},e)}async function Pt(e){var a;const t=Ct.value.get(e);if(!t)return;const n=Lt((a=t.data)==null?void 0:a.endpoint);if(!n)return;Ce[e]||(Ce[e]={loading:!1,error:"",payload:null,lastUpdated:0});const o=Ce[e];o.loading=!0,o.error="";try{o.payload=await De(n),o.lastUpdated=Date.now()}catch(d){o.error=(d==null?void 0:d.message)||"Ошибка загрузки виджета"}finally{o.loading=!1}}async function on(){var t,n;dt();const e=[];for(const o of Ht.value){if(e.push(Pt(o.id)),!Lt((t=o.data)==null?void 0:t.endpoint))continue;const a=Math.max(1,Number(((n=o.data)==null?void 0:n.refresh_sec)||0))*1e3,d=window.setInterval(()=>{Pt(o.id)},a);St.set(o.id,d)}await Promise.all(e)}async function Pi(e,t){const n=tn(e,t.id),o=Lt(t.endpoint);if(o){wt[n]=!0;try{await De(o,{method:String(t.method||"GET").toUpperCase()}),await Pt(e)}catch(a){Ce[e]||(Ce[e]={loading:!1,error:"",payload:null,lastUpdated:0}),Ce[e].error=(a==null?void 0:a.message)||"Не удалось выполнить действие"}finally{wt[n]=!1}}}async function ur(){var e,t,n;F.value=!0,J.value="",te.value="idle",se.value="",ar();try{const o=await Ha();y.value=o,(!Y.value||!Te.value.some(a=>a.id===Y.value))&&(Y.value=((e=Te.value[0])==null?void 0:e.id)||""),ut(),lt(),Nn((t=o==null?void 0:o.ui)==null?void 0:t.theme),Vn((n=o==null?void 0:o.ui)==null?void 0:n.grid),await on(),await rn(),fe.value||pr()}catch(o){J.value=(o==null?void 0:o.message)||"Не удалось загрузить dashboard-конфигурацию",y.value=null,dt(),Ue()}finally{F.value=!1}}async function cr(e){var o,a,d,w,$,q;const t=!!(((d=(a=(o=y.value)==null?void 0:o.security)==null?void 0:a.iframe)==null?void 0:d.default_sandbox)??!0),n=(w=e==null?void 0:e.iframe)==null?void 0:w.sandbox;Z.open=!0,Z.title=e.title,Z.src="",Z.error="",Z.loading=!0,Z.sandbox=n==null?t:!!n,Z.allow=Array.isArray(($=e==null?void 0:e.iframe)==null?void 0:$.allow)?e.iframe.allow.join("; "):"",Z.referrerPolicy=((q=e==null?void 0:e.iframe)==null?void 0:q.referrer_policy)||"";try{const ie=await Fa(e.id);Z.src=ie.src}catch(ie){Z.error=(ie==null?void 0:ie.message)||"Не удалось подготовить iframe"}finally{Z.loading=!1}}function xi(){Z.open=!1,Z.title="",Z.src="",Z.error="",Z.loading=!1,Z.sandbox=!1,Z.allow="",Z.referrerPolicy=""}function dr(e){if(e.open==="same_tab"){window.location.assign(e.url);return}window.open(e.url,"_blank","noopener,noreferrer")}function Ai(e){e!=null&&e.url&&window.open(e.url,"_blank","noopener,noreferrer")}function an(e){if(e.type==="iframe"){cr(e);return}dr(e)}function sn(e){return Rn.value.get(String(e||""))||""}async function ln(e){var n;const t=String(e||"");if(t&&(n=navigator.clipboard)!=null&&n.writeText)try{await navigator.clipboard.writeText(t)}catch{}}async function fr(e){await ln(e)}async function Mi(e){const t=sn(e);t&&await ln(t)}async function Di(e){const t=sn(e);t&&await ln(`ssh ${t}`)}async function Ri(e){e&&await je([e])}function Oi(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?"—":t.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function Bi(e){const t=Number(e||0);return!Number.isFinite(t)||t<=0?"—":t<1e3?`${Math.round(t)} ms`:`${(t/1e3).toFixed(2)} s`}function Gi(e){e&&(et.host=e,et.open=!0)}function un(){et.open=!1,et.host=null}function Ni(e){const t=(e==null?void 0:e.open_ports)||[];return t.length?t.map(n=>n!=null&&n.service?`${n.port} (${n.service})`:`${n.port}`).join(", "):"—"}function Vi(e){return e?e.error?e.error:e.status_code==null?"—":`HTTP ${e.status_code}`:"—"}async function ft({silent:e=!1}={}){if(!_t){_t=!0,e||(Ve.value=!0);try{$e.value=await za(),be.value=""}catch(t){be.value=(t==null?void 0:t.message)||"Не удалось загрузить состояние сканера LAN"}finally{_t=!1,e||(Ve.value=!1)}}}function pt(){nt&&(window.clearInterval(nt),nt=0)}function cn(){pt(),nt=window.setInterval(()=>{ft({silent:!0})},p)}function pr(){Ue(),pt(),dt()}async function Hi(){!y.value||F.value||(await on(),await rn(),Ut.value&&(await ft({silent:!0}),cn()))}async function Fi(){if(!Vt){Vt=!0;try{fe.value?await Hi():pr()}finally{Vt=!1}}}function gr(){fe.value=document.visibilityState!=="hidden",Fi()}async function Ki(){var e;if(!V.value){V.value=!0;try{const t=await ja();$e.value=(t==null?void 0:t.state)||$e.value,be.value=t!=null&&t.accepted||(e=t==null?void 0:t.state)!=null&&e.queued?"":(t==null?void 0:t.message)||""}catch(t){be.value=(t==null?void 0:t.message)||"Не удалось запустить сканирование LAN"}finally{V.value=!1,ft({silent:!0})}}}function Ui(){var e,t;return((t=(e=document.documentElement)==null?void 0:e.dataset)==null?void 0:t.fxMode)||"full"}function zi(e){const t=document.documentElement;let n="high",o="1";e>=120?(n="low",o="0.42"):e>=70&&(n="medium",o="0.68"),t.dataset.motionBudget=n,t.style.setProperty("--motion-budget",o)}function ji(e){const t=Ui();if(t==="off")return null;const n=JSON.parse(JSON.stringify(e));return n.fps_limit=t==="lite"?34:58,t!=="lite"||(n.particles.number.value=Math.max(24,Math.round(n.particles.number.value*.56)),n.particles.opacity.value=Number((n.particles.opacity.value*.72).toFixed(2)),n.particles.move.speed=Number((n.particles.move.speed*.74).toFixed(2)),n.particles.line_linked.opacity=Number((n.particles.line_linked.opacity*.56).toFixed(2)),n.particles.line_linked.distance=Math.max(80,Math.round(n.particles.line_linked.distance*.84)),n.retina_detect=!1),n}function dn(e){const t=document.getElementById(e);t&&(t.innerHTML="",delete t.dataset.particlesReady)}function qi(){dn(S),dn(_),dn(I)}async function Wi(){Ee&&(window.cancelAnimationFrame(Ee),Ee=0),Ee=window.requestAnimationFrame(async()=>{Ee=0,qi(),await fn(),await gt()})}function mr(){Wi()}async function xt(e,t){const n=document.getElementById(e);if(!n)return;const o=ji(t);if(!o){n.innerHTML="",delete n.dataset.particlesReady;return}n.dataset.particlesReady==="1"||!await Ya()||!window.particlesJS||document.getElementById(e)&&n.dataset.particlesReady!=="1"&&(n.innerHTML="",window.particlesJS(e,o),n.dataset.particlesReady="1")}async function fn(){await xt(S,T)}async function gt(){await Promise.all([xt(_,x),xt(I,x)])}return ge(()=>{var e;return(e=Le.value)==null?void 0:e.id},async()=>{K.value="",ne.value="",ut(),lt(),je(),await Me(),await gt()}),ge(()=>{var e;return(e=Gn.value)==null?void 0:e.id},async()=>{await Me(),await gt()}),ge(()=>Et.value,e=>{K.value&&!e.includes(K.value)&&(K.value="")},{deep:!0}),ge(()=>He.value,()=>{lt(),je()},{deep:!0}),ge(()=>it.value.length,e=>{if(!e){ce.value=0;return}ce.value>=e&&(ce.value=e-1)}),ge(()=>$t.value.map(e=>e.value).join("|"),()=>{$t.value.some(e=>e.value===re.value)||(re.value="all")}),ge(()=>Ut.value,e=>{if(e){fe.value&&(ft(),cn());return}un(),pt()}),ge(()=>at.value.length,e=>{zi(e)},{immediate:!0}),Ye(async()=>{window.addEventListener("visibilitychange",gr),window.addEventListener("oko:fx-mode-change",mr),await fn(),await ur(),await Me(),await gt()}),Ne(()=>{dt(),Ue(),pt(),un(),window.removeEventListener("visibilitychange",gr),window.removeEventListener("oko:fx-mode-change",mr),Ee&&(window.cancelAnimationFrame(Ee),Ee=0),Re&&(clearTimeout(Re),Re=0),delete document.documentElement.dataset.motionBudget,document.documentElement.style.removeProperty("--motion-budget"),yt=null}),yt={BRAND_ICON_BY_KEY:Bt,DEFAULT_ITEM_URL:h,EMBLEM_SRC:r,HEALTH_REFRESH_MS:u,HERO_CONTROLS_PARTICLES_ID:I,HERO_PARTICLES_CONFIG:x,HERO_TITLE_PARTICLES_ID:_,ICON_BY_KEY:Gt,ICON_RULES:Qr,LAN_PAGE_ID:m,LAN_SCAN_POLL_MS:p,LARGE_INDICATOR_TYPES:v,SIDEBAR_PARTICLES_CONFIG:T,SIDEBAR_PARTICLES_ID:S,actionBusy:wt,actionKey:tn,activeCommandPaletteEntry:On,activeIndicatorViewId:K,activeIndicatorWidget:Gn,activePage:Le,activePageGroupBlocks:go,activePageId:Y,activePageWidgetIds:Et,addGroup:So,addItem:ko,addSubgroup:_o,allItemIds:Mt,allSubgroupIds:Nt,appTagline:to,appTitle:eo,applyConfigMutation:de,applyGrid:Vn,applyTheme:Nn,authProfileOptions:Ln,buildDefaultItem:jt,buildItemFromEditorForm:jn,clampNumber:Wt,clearDragState:Fe,clearItemFaviconFailures:ar,clearSelectedNode:ut,cloneConfig:Hn,closeIframeModal:xi,closeItemEditor:Kn,closeLanHostModal:un,closeCommandPalette:Yt,commandPaletteActiveIndex:ce,commandPaletteOpen:Q,commandPaletteQuery:Xe,commandPaletteResults:it,config:y,configError:J,copyItemIp:Mi,copyItemSshShortcut:Di,copyCommandPaletteEntryUrl:ei,copyUrl:fr,createBrandIcon:M,defaultItemEditorForm:R,dragState:P,editGroup:Co,editItem:To,editMode:D,editSubgroup:Eo,ensureAbsoluteUrl:zt,ensurePageGroupsReference:xr,expandedGroups:pe,faviconOriginFromUrl:Xt,filteredBlockGroups:ri,filteredTreeGroups:Bn,findGroup:Ie,findSubgroup:me,formatLanDuration:Bi,formatLanHttpStatus:Vi,formatLanMoment:Oi,fromToken:Xr,groupById:Kt,groupOnlineItems:pi,groupTotalItems:di,healthClass:Ei,healthLabel:Ti,healthPollTimer:tt,healthState:ze,healthStates:rt,iframeModal:Z,indicatorPreviewEntries:Ho,initHeroParticles:gt,initParticles:xt,initSidebarParticles:fn,initWidgetPolling:on,isActionBusy:wi,isDirectGroupNode:Dt,isGroupExpanded:tr,isGroupSelected:nr,isIconCardView:Pn,isSidebarDetailed:Ft,isSidebarHidden:kt,isTileCardView:xn,isCompactServiceCardView:An,isInlineGroupLayout:ci,isItemSelected:ni,isLanPage:Ut,isLargeIndicator:st,isSidebarIconActive:yo,isSidebarIconOnly:oo,isSubgroupSelected:rr,isWidgetBlock:qn,itemEditor:E,itemFaviconFailures:ot,itemFaviconKey:en,itemFaviconSrc:gi,itemIp:sn,itemSite:jo,lanCidrsLabel:ao,lanHostModal:et,lanHosts:Mn,lanPortsLabel:Ni,lanScanActionBusy:V,lanScanError:be,lanScanLoading:Ve,lanScanPollTimer:nt,lanScanRefreshInFlight:_t,lanScanState:$e,loadConfig:ur,loadingConfig:F,makeUniqueId:Be,markItemFaviconFailed:mi,moveGroup:Ar,moveCommandPaletteSelection:Qo,moveItemBefore:Dr,moveItemToSubgroupEnd:Rr,moveSubgroup:Mr,normalizeEndpoint:Lt,normalizeIconToken:Zr,normalizeId:It,normalizeLayoutBlocks:Pr,normalizeStringList:qt,onGroupDragOver:Ro,onGroupDragStart:Ao,onGroupDrop:Oo,onItemCardClick:wo,onItemDragOver:No,onItemDragStart:Do,onItemDrop:Vo,onSubgroupDragOver:Bo,onSubgroupDragStart:Mo,onSubgroupDrop:Go,activateCommandPaletteEntry:Xn,activateCommandPaletteSelection:Xo,openCommandPalette:Zn,openCreateItemEditor:Un,openEditItemEditor:zn,openIframeItem:cr,openIndicatorView:Jn,openItem:an,openItemInNewTab:Ai,openLanHostModal:Gi,openLinkItem:dr,pageHealthSummary:fo,pages:Te,persistConfig:Fn,pickSemanticIcon:Ze,refreshHealth:je,recheckItem:Ri,refreshLanScanState:ft,refreshWidget:Pt,removeGroup:Lo,removeItem:xo,removeSubgroup:Po,resetWidgetPolling:dt,resolveBlockGroups:Jt,resolveExpression:Pe,resolveGroupIcon:bi,resolveItemIcon:hi,resolvePageIcon:vi,resolveSubgroupIcon:yi,resolveWidgetIcon:Ii,resolveWidgets:Wn,runLanScanNow:Ki,runWidgetAction:Pi,saveError:se,saveStatus:te,saveStatusLabel:so,saveStatusTimer:Re,setCommandPaletteActiveIndex:Yo,setCommandPaletteQuery:Jo,setSiteFilter:qo,sidebarViewToggleTitle:io,selectItemNode:Qt,selectSidebarIconNode:Io,selectSidebarIndicator:Fo,selectSubgroupNode:er,selectedNode:k,serviceCardView:ue,siteFilter:re,siteFilterOptions:$t,serviceGroupingMode:ye,serviceGroupingOptions:ro,servicePresentationOptions:no,sidebarIconNodeTitle:ho,sidebarIconNodes:co,sidebarIndicatorSummary:po,sidebarIndicators:Tt,sidebarView:oe,startHealthPolling:rn,startLanScanPolling:cn,statCardSubtitle:_i,statCardTrend:ki,statCardValue:Si,statListEntries:sr,statsExpanded:_e,stopHealthPolling:Ue,stopLanScanPolling:pt,subgroupById:Dn,subgroupTotalItems:fi,submitItemEditor:$o,syncTreeGroupsState:lt,tableRows:$i,toggleCommandPalette:Wo,toggleEditMode:mo,toggleGroupNode:ti,toggleServiceCardView:vo,toggleSidebarView:bo,treeFilter:ne,treeGroups:He,visibleTreeItemIds:at,widgetById:Ct,widgetIntervals:St,widgetState:Ke,widgetStates:Ce,widgets:Ht},yt}const os=["title"],is={key:0,class:"item-compact-body"},as=["src"],ss={class:"item-tile-head"},ls=["src"],us={class:"item-tile-title"},cs={class:"item-head"},ds={class:"item-title-row"},fs=["src"],ps={class:"item-type"},gs={class:"item-url"},ms={class:"item-health"},vs={key:0,class:"item-tags"},bs={key:0,class:"tag-pill site-pill"},ys={class:"item-actions"},hs={key:1,class:"item-ssh-shortcut"},Is={__name:"ServiceItemCard",props:{groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0},item:{type:Object,required:!0}},setup(r){const u=r,l=Rt(u,"groupKey"),c=Rt(u,"subgroupId"),s=Rt(u,"item"),p=le(),{isIconCardView:m,isTileCardView:v,isCompactServiceCardView:h,isItemSelected:S,onItemCardClick:_,itemFaviconSrc:I,markItemFaviconFailed:T,resolveItemIcon:x,healthClass:G,healthLabel:ee,itemIp:A,itemSite:N,copyItemIp:j,copyItemSshShortcut:R,openItem:y,openItemInNewTab:F,recheckItem:J,copyUrl:Y}=p,ne=C(()=>G(s.value.id)),_e=C(()=>ee(s.value.id)),K=C(()=>A(s.value.id)),D=C(()=>`ssh ${K.value}`),fe=C(()=>N(s.value,l.value)),ue=B(!1),ye=B(!1);let re=0,oe=0;const te=C(()=>({selected:!h.value&&S(s.value.id),compact:h.value,tile:v.value,[`status-${ne.value}`]:!0,"data-updated":ye.value}));function se(){re&&clearTimeout(re),ue.value=!1,window.requestAnimationFrame(()=>{ue.value=!0,re=window.setTimeout(()=>{ue.value=!1,re=0},900)})}function $e(){oe&&clearTimeout(oe),ye.value=!1,window.requestAnimationFrame(()=>{ye.value=!0,oe=window.setTimeout(()=>{ye.value=!1,oe=0},1250)})}return ge([ne,_e],([Ve,V],[be,Q])=>{be===void 0&&Q===void 0||((Ve!==be||V!==Q)&&$e(),V!==Q&&se())}),Ne(()=>{re&&(clearTimeout(re),re=0),oe&&(clearTimeout(oe),oe=0)}),(Ve,V)=>{var be;return f(),b("article",{class:z(["item-card",te.value]),title:i(h)?s.value.title:void 0,onClick:V[9]||(V[9]=Q=>i(_)(l.value,c.value,s.value))},[i(m)?(f(),b("div",is,[i(I)(s.value)?(f(),b("img",{key:0,src:i(I)(s.value),class:"service-favicon compact-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:V[0]||(V[0]=Q=>i(T)(s.value))},null,40,as)):(f(),U(Se(i(x)(s.value)),{key:1,class:"ui-icon item-icon compact-item-icon"})),g("span",{class:z(["health-dot compact-health-dot",ne.value])},null,2)])):i(v)?(f(),b(X,{key:1},[g("div",ss,[i(I)(s.value)?(f(),b("img",{key:0,src:i(I)(s.value),class:"service-favicon tile-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:V[1]||(V[1]=Q=>i(T)(s.value))},null,40,ls)):(f(),U(Se(i(x)(s.value)),{key:1,class:"ui-icon item-icon tile-item-icon"})),g("span",{class:z(["health-dot tile-health-dot",ne.value])},null,2)]),g("p",us,O(s.value.title),1)],64)):(f(),b(X,{key:2},[g("div",cs,[g("div",ds,[i(I)(s.value)?(f(),b("img",{key:0,src:i(I)(s.value),class:"service-favicon item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:V[2]||(V[2]=Q=>i(T)(s.value))},null,40,fs)):(f(),U(Se(i(x)(s.value)),{key:1,class:"ui-icon item-icon"})),g("h4",null,O(s.value.title),1)]),g("span",ps,O(s.value.type),1)]),g("p",gs,O(s.value.url),1),g("div",ms,[g("span",{class:z(["health-dot",ne.value])},null,2),g("span",{class:z(["health-text",{"is-updating":ue.value}])},O(_e.value),3)]),fe.value||(be=s.value.tags)!=null&&be.length?(f(),b("div",vs,[fe.value?(f(),b("span",bs,"site:"+O(fe.value),1)):H("",!0),(f(!0),b(X,null,ve(s.value.tags,Q=>(f(),b("span",{key:Q,class:"tag-pill"},O(Q),1))),128))])):H("",!0),g("div",ys,[L(we,{title:s.value.type==="iframe"?"Открыть iframe":"Открыть","aria-label":s.value.type==="iframe"?"Открыть iframe":"Открыть",onClick:V[3]||(V[3]=W(Q=>i(y)(s.value),["stop"]))},{default:ae(()=>[(f(),U(Se(s.value.type==="iframe"?i($n):i(Cn)),{class:"ui-icon item-action-icon"}))]),_:1},8,["title","aria-label"]),L(we,{title:"Открыть в новой вкладке","aria-label":"Открыть в новой вкладке",onClick:V[4]||(V[4]=W(Q=>i(F)(s.value),["stop"]))},{default:ae(()=>[L(i(Ca),{class:"ui-icon item-action-icon"})]),_:1}),L(we,{title:"Recheck health","aria-label":"Recheck health",onClick:V[5]||(V[5]=W(Q=>i(J)(s.value.id),["stop"]))},{default:ae(()=>[L(i(Ea),{class:"ui-icon item-action-icon"})]),_:1}),K.value?(f(),U(we,{key:0,title:"Копировать IP","aria-label":"Копировать IP",onClick:V[6]||(V[6]=W(Q=>i(j)(s.value.id),["stop"]))},{default:ae(()=>[L(i(Ge),{class:"ui-icon item-action-icon"})]),_:1})):H("",!0),K.value?(f(),U(we,{key:1,title:"Копировать SSH shortcut","aria-label":"Копировать SSH shortcut",onClick:V[7]||(V[7]=W(Q=>i(R)(s.value.id),["stop"]))},{default:ae(()=>[L(i(Ur),{class:"ui-icon item-action-icon"})]),_:1})):H("",!0),L(we,{title:"Копировать URL","aria-label":"Копировать URL",onClick:V[8]||(V[8]=W(Q=>i(Y)(s.value.url),["stop"]))},{default:ae(()=>[L(i(Ta),{class:"ui-icon item-action-icon"})]),_:1})]),K.value?(f(),b("p",hs,[V[10]||(V[10]=Yi(" SSH: ",-1)),g("code",null,O(D.value),1)])):H("",!0)],64))],10,os)}}},ws={class:"virtual-item-grid"},Ss=120,yn=72,_s={__name:"VirtualizedItemGrid",props:{items:{type:Array,required:!0},groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0}},setup(r){const l=Rt(r,"items"),c=le(),{isIconCardView:s,isTileCardView:p}=c,m=B(null),v=B(yn);let h=null;const S=C(()=>l.value.length>Ss),_=C(()=>S.value&&v.value<l.value.length),I=C(()=>S.value?l.value.slice(0,v.value):l.value);function T(){v.value=Math.min(l.value.length,v.value+yn)}function x(){v.value=yn}function G(){h&&(h.disconnect(),!(!_.value||!m.value)&&h.observe(m.value))}return ge(()=>l.value,async()=>{x(),await Me(),G()},{deep:!0}),ge(()=>_.value,async()=>{await Me(),G()}),Ye(async()=>{h=new IntersectionObserver(ee=>{for(const A of ee)if(A.isIntersecting){T();break}},{root:null,rootMargin:"260px 0px",threshold:0}),await Me(),G()}),Ne(()=>{h==null||h.disconnect(),h=null}),(ee,A)=>(f(),b("div",ws,[L(Qi,{name:"item-grid-transition",tag:"div",class:z(["item-grid",{"icon-card-grid":i(s),"tile-card-grid":i(p)}])},{default:ae(()=>[(f(!0),b(X,null,ve(I.value,N=>(f(),U(Is,{key:N.id,"group-key":N.__originGroupKey||r.groupKey,"subgroup-id":N.__originSubgroupId||r.subgroupId,item:N},null,8,["group-key","subgroup-id","item"]))),128))]),_:1},8,["class"]),_.value?(f(),b("div",{key:0,ref_key:"sentinelRef",ref:m,class:"item-grid-sentinel","aria-hidden":"true"},null,512)):H("",!0)]))}},ks={class:"group-header"},$s={class:"group-title-row"},Cs={key:0,class:"subtitle"},Es={class:"subgroup-title"},Ts={__name:"ServiceGroupCard",props:{group:{type:Object,required:!0}},setup(r){const u=le(),{isInlineGroupLayout:l,resolveGroupIcon:c,resolveSubgroupIcon:s}=u;return(p,m)=>(f(),b("article",{class:z(["panel group-panel",{"group-panel-inline":i(l)(r.group)}])},[g("header",ks,[g("div",$s,[(f(),U(Se(i(c)(r.group)),{class:"ui-icon group-icon"})),g("h2",null,O(r.group.title),1)]),r.group.description?(f(),b("p",Cs,O(r.group.description),1)):H("",!0)]),(f(!0),b(X,null,ve(r.group.subgroups,v=>(f(),b("section",{key:v.id,class:"subgroup"},[g("h3",Es,[(f(),U(Se(i(s)(v)),{class:"ui-icon subgroup-icon"})),g("span",null,O(v.title),1)]),L(_s,{items:v.items,"group-key":r.group.key,"subgroup-id":v.id},null,8,["items","group-key","subgroup-id"])]))),128))],2))}},Ls={class:"groups-grid"},Ps={key:0,class:"panel group-panel group-empty"},xs={key:0,class:"panel group-panel group-empty"},As={__name:"ServicesGroupsPanel",setup(r){const u=le(),{activePage:l,activePageGroupBlocks:c,filteredBlockGroups:s}=u,p=B(null);let m=null;const v={duration:180,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};function h(){if(!(!m||!p.value))for(const S of p.value.querySelectorAll(".block-wrap"))S.dataset.offscreen="0",m.observe(S)}return ge(()=>{var S;return[(S=l.value)==null?void 0:S.id,c.value.length]},async()=>{m&&(m.disconnect(),await Me(),h())}),Ye(async()=>{m=new IntersectionObserver(S=>{for(const _ of S)_.target.dataset.offscreen=_.isIntersecting?"0":"1"},{root:null,rootMargin:"140px 0px",threshold:.02}),await Me(),h()}),Ne(()=>{m==null||m.disconnect(),m=null}),(S,_)=>(f(),b("section",{ref_key:"blocksRootRef",ref:p,class:"page-stack"},[(f(!0),b(X,null,ve(i(c),(I,T)=>(f(),b("section",{key:`${i(l).id}:${T}:groups`,class:"block-wrap"},[kn((f(),b("section",Ls,[(f(!0),b(X,null,ve(i(s)(I.group_ids),x=>(f(),U(Ts,{key:x.key,group:x},null,8,["group"]))),128)),i(s)(I.group_ids).length?H("",!0):(f(),b("article",Ps,[..._[0]||(_[0]=[g("h2",null,"Нет данных для выбранного узла",-1),g("p",{class:"subtitle"},"Выберите другую ветку в боковом дереве.",-1)])]))])),[[i(Br),v]])]))),128)),i(c).length?H("",!0):(f(),b("article",xs,[..._[1]||(_[1]=[g("h2",null,"Для этой страницы нет групп",-1),g("p",{class:"subtitle"},"Откройте нужный индикатор в аккордеоне слева.",-1)])]))],512))}},Ms=["aria-label","aria-expanded","disabled"],Ds={class:"hero-dropdown-label"},Rs={class:"hero-dropdown-value"},Os=["aria-label"],Bs=["aria-selected"],Gs=["onClick"],hn={__name:"HeroDropdown",props:{modelValue:{type:String,default:""},label:{type:String,default:""},ariaLabel:{type:String,default:""},options:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(r,{emit:u}){const l=r,c=u,s=B(!1),p=B(null),m=C(()=>{var T;const I=l.options.find(x=>x.value===l.modelValue);return I?I.label:((T=l.options[0])==null?void 0:T.label)||""});function v(){l.disabled||(s.value=!s.value)}function h(I){c("update:modelValue",I),s.value=!1}function S(I){s.value&&p.value&&!p.value.contains(I.target)&&(s.value=!1)}function _(I){I.key==="Escape"&&(s.value=!1)}return Ye(()=>{window.addEventListener("pointerdown",S),window.addEventListener("keydown",_)}),Ne(()=>{window.removeEventListener("pointerdown",S),window.removeEventListener("keydown",_)}),(I,T)=>(f(),b("div",{ref_key:"rootRef",ref:p,class:"hero-dropdown"},[g("button",{class:"hero-dropdown-trigger",type:"button","aria-label":r.ariaLabel||r.label,"aria-haspopup":"listbox","aria-expanded":s.value,disabled:r.disabled,onClick:v},[Or(I.$slots,"prefix",{},()=>[g("span",Ds,O(r.label),1)]),g("span",Rs,O(m.value),1),L(i(La),{class:z(["ui-icon hero-dropdown-caret",{open:s.value}])},null,8,["class"])],8,Ms),L(Gr,{name:"hero-dropdown-menu-transition"},{default:ae(()=>[s.value?(f(),b("ul",{key:0,class:"hero-dropdown-menu",role:"listbox","aria-label":r.ariaLabel||r.label},[(f(!0),b(X,null,ve(r.options,x=>(f(),b("li",{key:x.value,role:"option","aria-selected":r.modelValue===x.value},[g("button",{class:z(["hero-dropdown-option",{active:r.modelValue===x.value}]),type:"button",onClick:G=>h(x.value)},[g("span",null,O(x.label),1),r.modelValue===x.value?(f(),U(i(Pa),{key:0,class:"ui-icon hero-dropdown-check"})):H("",!0)],10,Gs)],8,Bs))),128))],8,Os)):H("",!0)]),_:1})],512))}},Ns={key:0,class:"hero-logo-square","aria-hidden":"true"},Vs=["src"],Hs=["title","aria-label","aria-selected","onClick"],Fs={class:"hero-page-tab-label"},Ks={__name:"HeroPageTabs",setup(r){let u=!1;const l=le(),{EMBLEM_SRC:c,isSidebarHidden:s,pages:p,activePage:m,activePageId:v,resolvePageIcon:h}=l,S=B(!u),_=C(()=>s.value);let I=0;return Ye(()=>{S.value&&(I=globalThis.setTimeout(()=>{S.value=!1,u=!0},700))}),Ne(()=>{I&&(globalThis.clearTimeout(I),I=0),S.value&&(u=!0)}),(T,x)=>(f(),b("nav",{class:z(["hero-page-tabs",{"hero-page-tabs--intro":S.value,"has-logo-tile":_.value}]),role:"tablist","aria-label":"Разделы"},[_.value?(f(),b("div",Ns,[g("img",{src:i(c),alt:""},null,8,Vs)])):H("",!0),(f(!0),b(X,null,ve(i(p),G=>{var ee,A,N;return f(),b("button",{key:G.id,class:z(["hero-page-tab-btn",{active:((ee=i(m))==null?void 0:ee.id)===G.id,"hero-page-tab-btn--intro-active":S.value&&((A=i(m))==null?void 0:A.id)===G.id}]),type:"button",role:"tab",title:G.title,"aria-label":G.title,"aria-selected":((N=i(m))==null?void 0:N.id)===G.id,onClick:j=>v.value=G.id},[(f(),U(Se(i(h)(G)),{class:"ui-icon hero-page-tab-icon"})),g("span",Fs,O(G.title),1)],10,Hs)}),128))],2))}},Us={class:"hero-layout"},zs={class:"hero panel hero-title-panel"},js={class:"hero-title-content"},qs={class:"hero-controls-content"},Ws={key:0,id:"hero-controls-drawer",class:"hero-controls-drawer"},Js={class:"hero-display-controls"},Ys=["title","aria-label"],Qs=["aria-expanded","title"],Zs={key:0,class:"editor-error hero-editor-error"},Xs={__name:"ServicesHeroPanel",setup(r){const u=le(),l=B(!1),{editMode:c,isSidebarDetailed:s,isSidebarHidden:p,saveStatus:m,saveStatusLabel:v,saveError:h,sidebarViewToggleTitle:S,serviceCardView:_,serviceGroupingMode:I,serviceGroupingOptions:T,servicePresentationOptions:x,siteFilter:G,siteFilterOptions:ee,toggleEditMode:A,addGroup:N,openCommandPalette:j,toggleSidebarView:R}=u;return(y,F)=>(f(),b("section",Us,[g("header",zs,[F[4]||(F[4]=g("div",{id:"hero-title-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),g("div",js,[L(Ks)])]),g("aside",{class:z(["panel hero-control-panel service-hero-controls",{active:i(c)}])},[F[5]||(F[5]=g("div",{id:"hero-controls-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),g("div",qs,[g("div",{class:z(["hero-controls-accordion",{open:l.value}])},[L(Gr,{name:"hero-controls-drawer-transition"},{default:ae(()=>[l.value?(f(),b("div",Ws,[L(we,{"button-class":"hero-icon-btn hero-accordion-action editor-toggle",active:i(c),title:i(c)?"Выключить режим редактирования":"Включить режим редактирования","aria-label":i(c)?"Выключить режим редактирования":"Включить режим редактирования",onClick:i(A)},{default:ae(()=>[L(i(En),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),i(c)?(f(),U(we,{key:0,"button-class":"hero-icon-btn hero-accordion-action",title:"Добавить группу","aria-label":"Добавить группу",onClick:i(N)},{default:ae(()=>[L(i(Tn),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"])):H("",!0),g("div",Js,[L(hn,{modelValue:i(_),"onUpdate:modelValue":F[0]||(F[0]=J=>pn(_)?_.value=J:null),label:"Вид","aria-label":"Режим отображения сервисов",options:i(x)},null,8,["modelValue","options"]),L(hn,{modelValue:i(I),"onUpdate:modelValue":F[1]||(F[1]=J=>pn(I)?I.value=J:null),label:"","aria-label":"Группировка сервисов",options:i(T),disabled:i(p)},{prefix:ae(()=>[L(i(Sn),{class:"ui-icon hero-dropdown-prefix-icon","aria-hidden":"true"})]),_:1},8,["modelValue","options","disabled"]),L(hn,{modelValue:i(G),"onUpdate:modelValue":F[2]||(F[2]=J=>pn(G)?G.value=J:null),label:"Site","aria-label":"Фильтр по площадке",options:i(ee)},{prefix:ae(()=>[L(i(xa),{class:"ui-icon hero-dropdown-prefix-icon","aria-hidden":"true"})]),_:1},8,["modelValue","options"])]),L(we,{"button-class":"hero-icon-btn hero-accordion-action",title:"Быстрый поиск сервисов (Ctrl/Cmd+K)","aria-label":"Быстрый поиск сервисов",onClick:i(j)},{default:ae(()=>[L(i(Aa),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"]),L(we,{"button-class":"hero-icon-btn hero-accordion-action",active:!i(s),title:i(S),"aria-label":i(S),onClick:i(R)},{default:ae(()=>[L(i(Wr),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),i(c)?(f(),b("span",{key:1,class:z(["hero-save-indicator hero-accordion-status",i(m)]),role:"status",title:i(v),"aria-label":i(v)},[L(i(Ma),{class:"ui-icon hero-save-icon"})],10,Ys)):H("",!0)])):H("",!0)]),_:1}),g("button",{class:"hero-controls-trigger",type:"button","aria-expanded":l.value,"aria-controls":"hero-controls-drawer",title:l.value?"Скрыть панель действий":"Показать панель действий",onClick:F[3]||(F[3]=J=>l.value=!l.value)},[L(i(jr),{class:"ui-icon hero-action-icon"}),L(i(Da),{class:z(["ui-icon hero-accordion-caret",{open:l.value}])},null,8,["class"])],8,Qs)],2),i(c)&&i(h)?(f(),b("p",Zs,O(i(h)),1)):H("",!0)])],2)]))}},el={key:0,class:"panel status-panel"},tl={key:1,class:"panel status-panel error-state"},nl={class:"subtitle"},rl={key:3,class:"panel status-panel"},ol={__name:"DashboardMainView",setup(r){const u=We(()=>Ae(()=>import("./IndicatorTabPanel-CcYllUzH.js"),__vite__mapDeps([0,1,2]))),l=We(()=>Ae(()=>import("./LanPageView-Cu3fgJ85.js"),__vite__mapDeps([3,1,2]))),c=le(),{activePage:s,activeIndicatorWidget:p,loadingConfig:m,configError:v,isLanPage:h,loadConfig:S}=c;return(_,I)=>{var T;return f(),b("main",{key:((T=i(s))==null?void 0:T.id)||"empty",class:z(["page",{"indicator-open":!!i(p),"page--lan":i(h)&&!i(p)}])},[i(m)?(f(),b("section",el,[...I[1]||(I[1]=[g("h2",null,"Загрузка конфигурации...",-1),g("p",{class:"subtitle"},"Получаем dashboard-модель из backend.",-1)])])):i(v)?(f(),b("section",tl,[I[2]||(I[2]=g("h2",null,"Ошибка загрузки конфигурации",-1)),g("p",nl,O(i(v)),1),g("button",{class:"ghost",type:"button",onClick:I[0]||(I[0]=(...x)=>i(S)&&i(S)(...x))},"Повторить")])):i(s)?(f(),b(X,{key:2},[i(p)?(f(),U(i(u),{key:0})):(f(),b(X,{key:1},[i(h)?(f(),U(i(l),{key:0})):(f(),b(X,{key:1},[L(Xs),L(As)],64))],64))],64)):(f(),b("section",rl,[...I[3]||(I[3]=[g("h2",null,"Нет доступных страниц",-1),g("p",{class:"subtitle"},"Проверьте `layout.pages` в `dashboard.yaml`.",-1)])]))],2)}}},il={class:"brand"},al=["src"],sl={class:"brand-title"},ll={class:"brand-subtitle"},ul={__name:"SidebarHeaderTabs",setup(r){const u=le(),{EMBLEM_SRC:l,appTitle:c,appTagline:s}=u;return(p,m)=>(f(),b("div",il,[g("img",{src:i(l),alt:"Oko"},null,8,al),g("div",null,[g("p",sl,O(i(c)),1),g("p",ll,O(i(s)),1)])]))}},cl={class:"sidebar-stats-accordion","aria-label":"Индикаторы"},dl=["aria-expanded"],fl={class:"sidebar-stats-toggle-values"},pl={key:0,class:"sidebar-indicators"},gl=["onClick"],ml={class:"widget-head sidebar-indicator-head"},vl={class:"widget-title"},bl={class:"item-type"},yl={key:0,class:"widget-error"},hl={key:1,class:"widget-loading"},Il={class:"widget-value sidebar-indicator-value"},wl={class:"widget-subtitle"},Sl={key:0,class:"widget-trend"},_l={key:0,class:"widget-list sidebar-list-preview"},kl={key:1,class:"widget-empty"},$l={class:"widget-subtitle"},Cl={key:5,class:"widget-empty"},El={key:6,class:"widget-actions sidebar-indicator-actions"},Tl=["onClick"],Ll=["disabled","onClick"],Pl={key:1,class:"widget-empty"},xl={__name:"SidebarIndicatorsAccordion",setup(r){const u=le(),{statsExpanded:l,sidebarIndicatorSummary:c,sidebarIndicators:s,isLargeIndicator:p,activeIndicatorWidget:m,selectSidebarIndicator:v,resolveWidgetIcon:h,widgetState:S,statCardValue:_,statCardSubtitle:I,statCardTrend:T,indicatorPreviewEntries:x,tableRows:G,openIndicatorView:ee,isActionBusy:A,runWidgetAction:N}=u;return(j,R)=>(f(),b("div",cl,[g("button",{class:"sidebar-stats-toggle",type:"button","aria-controls":"sidebar-stats-panel","aria-expanded":i(l),onClick:R[0]||(R[0]=y=>l.value=!i(l))},[R[1]||(R[1]=g("span",{class:"sidebar-stats-toggle-text"},"Индикаторы",-1)),g("span",fl,O(i(c)),1),g("span",{class:z(["sidebar-stats-toggle-caret",{open:i(l)}])},"▴",2)],8,dl),g("div",{id:"sidebar-stats-panel",class:z(["sidebar-stats-panel",{open:i(l)}])},[i(s).length?(f(),b("div",pl,[(f(!0),b(X,null,ve(i(s),y=>{var F,J,Y,ne,_e;return f(),b("article",{key:y.id,class:z(["sidebar-indicator",{interactive:i(p)(y),active:((F=i(m))==null?void 0:F.id)===y.id}]),onClick:K=>i(v)(y)},[g("header",ml,[g("div",vl,[(f(),U(Se(i(h)(y)),{class:"ui-icon widget-icon"})),g("h3",null,O(y.title),1)]),g("span",bl,O(y.type),1)]),(J=i(S)(y.id))!=null&&J.error?(f(),b("p",yl,O((Y=i(S)(y.id))==null?void 0:Y.error),1)):(ne=i(S)(y.id))!=null&&ne.loading?(f(),b("p",hl,"Обновление...")):y.type==="stat_card"?(f(),b(X,{key:2},[g("p",Il,O(i(_)(y)),1),g("p",wl,O(i(I)(y)),1),i(T)(y)?(f(),b("p",Sl,O(i(T)(y)),1)):H("",!0)],64)):y.type==="stat_list"?(f(),b(X,{key:3},[i(x)(y).length?(f(),b("ul",_l,[(f(!0),b(X,null,ve(i(x)(y),K=>(f(),b("li",{key:K.title+K.value},[g("span",null,O(K.title),1),g("strong",null,O(K.value),1)]))),128))])):(f(),b("p",kl,"Нет данных")),R[2]||(R[2]=g("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):y.type==="table"?(f(),b(X,{key:4},[g("p",$l,"Строк: "+O(i(G)(y).length),1),R[3]||(R[3]=g("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):(f(),b("p",Cl,"Неподдерживаемый тип виджета")),(_e=y.data.actions)!=null&&_e.length||i(p)(y)?(f(),b("div",El,[i(p)(y)?(f(),b("button",{key:0,class:"ghost",type:"button",onClick:W(K=>i(ee)(y.id),["stop"])},"Открыть вкладку",8,Tl)):H("",!0),(f(!0),b(X,null,ve(y.data.actions||[],K=>(f(),b("button",{key:K.id,class:"ghost",type:"button",disabled:i(A)(y.id,K.id),onClick:W(D=>i(N)(y.id,K),["stop"])},O(K.title),9,Ll))),128))])):H("",!0)],10,gl)}),128))])):(f(),b("p",Pl,"Для выбранной страницы индикаторы не настроены."))],2)]))}},Al=["draggable"],Ml={class:"tree-node-row"},Dl={class:"tree-text"},Rl={class:"tree-meta"},Ol={key:0,class:"tree-inline-actions"},Bl={__name:"SidebarTreeSubgroupNode",props:{group:{type:Object,required:!0},subgroup:{type:Object,required:!0}},setup(r){const u=le(),{dragState:l,editMode:c,onSubgroupDragStart:s,clearDragState:p,onSubgroupDragOver:m,onSubgroupDrop:v,isSubgroupSelected:h,selectSubgroupNode:S,resolveSubgroupIcon:_,subgroupTotalItems:I,editSubgroup:T,addItem:x,removeSubgroup:G}=u;return(ee,A)=>(f(),b("li",{class:z(["tree-subgroup-item",{dragging:i(l).type==="subgroup"&&i(l).subgroupId===r.subgroup.id}]),draggable:i(c),onDragstart:A[4]||(A[4]=W(N=>i(s)(N,r.group.id,r.subgroup.id),["stop"])),onDragend:A[5]||(A[5]=W((...N)=>i(p)&&i(p)(...N),["stop"])),onDragover:A[6]||(A[6]=W(N=>i(m)(N,r.group.id,r.subgroup.id),["stop"])),onDrop:A[7]||(A[7]=W(N=>i(v)(N,r.group.id,r.subgroup.id),["stop"]))},[g("div",Ml,[g("button",{class:z(["tree-node tree-subgroup",{active:i(h)(r.group.key,r.subgroup.id)}]),type:"button",onClick:A[0]||(A[0]=N=>i(S)(r.group.key,r.subgroup.id))},[(f(),U(Se(i(_)(r.subgroup)),{class:"ui-icon tree-icon tree-sub-icon"})),g("span",Dl,O(r.subgroup.title),1),g("span",Rl,O(i(I)(r.subgroup)),1)],2),i(c)?(f(),b("div",Ol,[L(i(Jr),{class:"ui-icon tree-grip"}),g("button",{class:"tree-mini-btn",type:"button",title:"Редактировать подгруппу",onClick:A[1]||(A[1]=W(N=>i(T)(r.group.id,r.subgroup.id),["stop"]))},[L(i(En),{class:"ui-icon"})]),g("button",{class:"tree-mini-btn",type:"button",title:"Добавить элемент",onClick:A[2]||(A[2]=W(N=>i(x)(r.group.id,r.subgroup.id),["stop"]))},[L(i(Tn),{class:"ui-icon"})]),g("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить подгруппу",onClick:A[3]||(A[3]=W(N=>i(G)(r.group.id,r.subgroup.id),["stop"]))},[L(i(Yr),{class:"ui-icon"})])])):H("",!0)])],42,Al))}},Gl=["draggable"],Nl={class:"tree-node-row"},Vl={class:"tree-text"},Hl={class:"tree-meta"},Fl={key:0,class:"tree-inline-actions"},Kl={class:"tree-subgroups"},Ul={__name:"SidebarTreeGroupNode",props:{group:{type:Object,required:!0}},setup(r){const u=le(),{dragState:l,editMode:c,isDirectGroupNode:s,onGroupDragStart:p,clearDragState:m,onGroupDragOver:v,onGroupDrop:h,isGroupSelected:S,toggleGroupNode:_,isGroupExpanded:I,resolveGroupIcon:T,groupTotalItems:x,editGroup:G,addSubgroup:ee,removeGroup:A}=u;return(N,j)=>(f(),b("li",{class:z(["tree-group-item",{dragging:i(l).type==="group"&&i(l).groupId===r.group.id&&i(s)(r.group)}]),draggable:i(c)&&i(s)(r.group),onDragstart:j[4]||(j[4]=W(R=>i(p)(R,r.group),["stop"])),onDragend:j[5]||(j[5]=W((...R)=>i(m)&&i(m)(...R),["stop"])),onDragover:j[6]||(j[6]=W(R=>i(v)(R,r.group),["stop"])),onDrop:j[7]||(j[7]=W(R=>i(h)(R,r.group),["stop"]))},[g("div",Nl,[g("button",{class:z(["tree-node tree-group",{active:i(S)(r.group.key)}]),type:"button",onClick:j[0]||(j[0]=R=>i(_)(r.group.key))},[g("span",{class:z(["tree-caret",{open:i(I)(r.group.key)}])},"▾",2),(f(),U(Se(i(T)(r.group)),{class:"ui-icon tree-icon"})),g("span",Vl,O(r.group.title),1),g("span",Hl,O(i(x)(r.group)),1)],2),i(c)&&i(s)(r.group)?(f(),b("div",Fl,[L(i(Jr),{class:"ui-icon tree-grip"}),g("button",{class:"tree-mini-btn",type:"button",title:"Редактировать группу",onClick:j[1]||(j[1]=W(R=>i(G)(r.group.id),["stop"]))},[L(i(En),{class:"ui-icon"})]),g("button",{class:"tree-mini-btn",type:"button",title:"Добавить подгруппу",onClick:j[2]||(j[2]=W(R=>i(ee)(r.group.id),["stop"]))},[L(i(Tn),{class:"ui-icon"})]),g("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить группу",onClick:j[3]||(j[3]=W(R=>i(A)(r.group.id),["stop"]))},[L(i(Yr),{class:"ui-icon"})])])):H("",!0)]),kn(g("ul",Kl,[(f(!0),b(X,null,ve(r.group.subgroups,R=>(f(),U(Bl,{key:R.id,group:r.group,subgroup:R},null,8,["group","subgroup"]))),128))],512),[[Zi,i(I)(r.group.key)]])],42,Gl))}},zl={key:0,class:"sidebar-tree","aria-label":"Дерево сервисов"},jl={key:0,class:"tree-root"},ql={key:1,class:"tree-empty"},Wl={__name:"SidebarTreePanel",setup(r){const u=le(),{treeGroups:l,filteredTreeGroups:c}=u,s={duration:160,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};return(p,m)=>i(l).length?(f(),b("section",zl,[i(c).length?kn((f(),b("ul",jl,[(f(!0),b(X,null,ve(i(c),v=>(f(),U(Ul,{key:v.key,group:v},null,8,["group"]))),128))])),[[i(Br),s]]):(f(),b("p",ql,"По вашему запросу ничего не найдено."))])):H("",!0)}},Jl={class:"sidebar"},Yl={class:"sidebar-content"},Ql={__name:"DashboardSidebarView",setup(r){const u=le(),{isSidebarDetailed:l}=u;return(c,s)=>(f(),b("aside",Jl,[s[0]||(s[0]=g("div",{id:"sidebar-particles",class:"sidebar-particles","aria-hidden":"true"},null,-1)),g("div",Yl,[L(ul),i(l)?(f(),U(Wl,{key:0})):H("",!0),i(l)?(f(),U(xl,{key:1})):H("",!0)])]))}},Zl=["src"],Xl={__name:"App",setup(r){const u=()=>Ae(()=>import("./LanHostModal-6oKiDgnz.js"),__vite__mapDeps([4,1,5,2])),l=()=>Ae(()=>import("./IframeModal-Oz-hMsqD.js"),__vite__mapDeps([6,5,1,2])),c=()=>Ae(()=>import("./ItemEditorModal-pIh3E0T4.js"),__vite__mapDeps([7,1,5,2])),s=()=>Ae(()=>import("./CommandPaletteModal-DKX5v6ax.js"),__vite__mapDeps([8,1,5,2])),p=()=>Ae(()=>import("./IndicatorTabPanel-CcYllUzH.js"),__vite__mapDeps([0,1,2])),m=()=>Ae(()=>import("./LanPageView-Cu3fgJ85.js"),__vite__mapDeps([3,1,2])),v=We(u),h=We(l),S=We(c),_=We(s),I=le(),{EMBLEM_SRC:T,closeCommandPalette:x,commandPaletteOpen:G,iframeModal:ee,isSidebarHidden:A,itemEditor:N,lanHostModal:j,toggleCommandPalette:R}=I,y=B(!1);let F=0,J=0,Y=0;function ne(){Promise.allSettled([u(),l(),c(),s(),p(),m()])}function _e(){if("requestIdleCallback"in window){Y=window.requestIdleCallback(()=>{Y=0,ne()},{timeout:2e3});return}J=window.setTimeout(()=>{J=0,ne()},1400)}function K(D){if((D.metaKey||D.ctrlKey)&&!D.altKey&&!D.shiftKey&&D.key.toLowerCase()==="k"){D.preventDefault(),R();return}D.key==="Escape"&&G.value&&(D.preventDefault(),x())}return Ye(()=>{F=globalThis.setTimeout(()=>{y.value=!0},1e3),window.addEventListener("keydown",K),_e()}),Ne(()=>{F&&(globalThis.clearTimeout(F),F=0),J&&(window.clearTimeout(J),J=0),Y&&"cancelIdleCallback"in window&&(window.cancelIdleCallback(Y),Y=0),window.removeEventListener("keydown",K)}),(D,fe)=>(f(),b("div",{class:z(["shell",{"shell-motion-static":y.value}])},[g("img",{class:"center-emblem",src:i(T),alt:"","aria-hidden":"true"},null,8,Zl),g("div",{class:z(["app-shell",{"sidebar-hidden":i(A)}])},[i(A)?H("",!0):(f(),U(Ql,{key:0})),L(ol)],2),i(j).open?(f(),U(i(v),{key:0})):H("",!0),i(ee).open?(f(),U(i(h),{key:1})):H("",!0),i(N).open?(f(),U(i(S),{key:2})):H("",!0),i(G)?(f(),U(i(_),{key:3})):H("",!0)],2))}};async function eu(r){}function tu(){var c,s,p,m;if((s=(c=globalThis.matchMedia)==null?void 0:c.call(globalThis,"(prefers-reduced-motion: reduce)"))==null?void 0:s.matches)return"off";const u=Number(((p=globalThis.navigator)==null?void 0:p.hardwareConcurrency)||8),l=Number(((m=globalThis.navigator)==null?void 0:m.deviceMemory)||8);return u<=4||l<=4?"lite":"full"}function nu(r){const u=document.documentElement,l=u.dataset.fxMode||"";u.dataset.fxMode=r,r==="off"?u.style.setProperty("--glow-enabled","0"):r==="lite"?u.style.setProperty("--glow-enabled","0.58"):u.style.setProperty("--glow-enabled","1"),l&&l!==r&&window.dispatchEvent(new CustomEvent("oko:fx-mode-change",{detail:{mode:r,previousMode:l}}))}function ru(){var l;const r=(l=globalThis.matchMedia)==null?void 0:l.call(globalThis,"(prefers-reduced-motion: reduce)"),u=()=>nu(tu());u(),r!=null&&r.addEventListener?r.addEventListener("change",u):r!=null&&r.addListener&&r.addListener(u)}ru();eu();Xi(Xl).mount("#app");export{Ks as _,we as a,le as u};
