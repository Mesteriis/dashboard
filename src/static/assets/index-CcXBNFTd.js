const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/IndicatorTabPanel-BmncPgs0.js","assets/vendor-D1bzbGly.js","assets/vendor-icons-BtRhSBC4.js","assets/LanPageView-CjoJt7tF.js","assets/LanHostModal-z0QYXnEF.js","assets/BaseModal-DEo4-NpV.js","assets/IframeModal-CA0N5uGI.js","assets/ItemEditorModal-DhbfMtwO.js","assets/DashboardSettingsModal-BRx5VxUs.js","assets/CommandPaletteModal-CxwOh9G_.js"])))=>i.map(i=>d[i]);
import{o as f,c as y,r as fs,n as j,h as Lr,w as se,a as Be,b as tt,d as nt,e as U,f as he,g as T,u as s,i as z,j as Ee,k as v,F as X,t as N,l as F,m as _e,p as D,q as ve,s as J,v as ps,x as Wt,T as gs,y as Rn,z as Qr,A as ms,B as He,C as vs,D as bs,M as ys}from"./vendor-D1bzbGly.js";import{s as Ar,a as xr,b as hs,c as Is,d as Dr,e as ws,f as Tn,g as _s,h as Mr,i as Rr,j as Br,k as _t,l as Ss,m as Or,n as ks,o as Es,p as Nr,q as Ts,r as Cs,t as Cn,H as Et,N as Jt,S as Ke,F as Zr,C as Xr,u as eo,T as An,v as to,w as no,D as xn,x as $s,y as Ps,W as Ls,A as As,E as xs,z as Ds,M as Gr,P as Ms,B as ro,G as Bn,L as On,I as Rs,K as Bs,J as Os,O as Ur,Q as oo,R as Vr,U as Hr,V as Ns,X as Gs,Y as Us,Z as Vs,_ as $n,$ as io,a0 as Hs,a1 as so,a2 as Ks,a3 as Fs,a4 as ao,a5 as zs,a6 as js,a7 as qs,a8 as Nn,a9 as Gn,aa as Ws,ab as Js,ac as Ys,ad as Qs,ae as lo,af as uo}from"./vendor-icons-BtRhSBC4.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const c of document.querySelectorAll('link[rel="modulepreload"]'))u(c);new MutationObserver(c=>{for(const p of c)if(p.type==="childList")for(const g of p.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&u(g)}).observe(document,{childList:!0,subtree:!0});function l(c){const p={};return c.integrity&&(p.integrity=c.integrity),c.referrerPolicy&&(p.referrerPolicy=c.referrerPolicy),c.crossOrigin==="use-credentials"?p.credentials="include":c.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function u(c){if(c.ep)return;c.ep=!0;const p=l(c);fetch(c.href,p)}})();const Zs="modulepreload",Xs=function(r){return"/static/"+r},Kr={},Ie=function(a,l,u){let c=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),m=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));c=Promise.allSettled(l.map(h=>{if(h=Xs(h),h in Kr)return;Kr[h]=!0;const k=h.endsWith(".css"),E=k?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${E}`))return;const _=document.createElement("link");if(_.rel=k?"stylesheet":Zs,k||(_.as="script"),_.crossOrigin="",_.href=h,m&&_.setAttribute("nonce",m),document.head.appendChild(_),k)return new Promise((L,K)=>{_.addEventListener("load",L),_.addEventListener("error",()=>K(new Error(`Unable to preload CSS for ${h}`)))})}))}function p(g){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=g,window.dispatchEvent(m),!m.defaultPrevented)throw g}return c.then(g=>{for(const m of g||[])m.status==="rejected"&&p(m.reason);return a().catch(p)})},ea=["type","title","aria-label","disabled"],we={__name:"IconButton",props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"button"},title:{type:String,default:""},ariaLabel:{type:String,default:""},buttonClass:{type:String,default:""}},emits:["click"],setup(r){return(a,l)=>(f(),y("button",{class:j(["ghost icon-btn",[r.buttonClass,{active:r.active}]]),type:r.type,title:r.title,"aria-label":r.ariaLabel||r.title,disabled:r.disabled,onClick:l[0]||(l[0]=u=>a.$emit("click",u))},[fs(a.$slots,"default")],10,ea))}},ta="X-Dashboard-Token",na="oko-desktop-embedded";function ra(){var u;if(typeof window>"u")return"";let r="";try{r=((u=window.localStorage)==null?void 0:u.getItem("dashboard_admin_token"))||""}catch{r=""}if(String(r).trim())return String(r).trim();const a=window.__OKO_DESKTOP_RUNTIME__;if(a!=null&&a.desktop&&(a==null?void 0:a.mode)==="embedded")return na;const l=window.__DASHBOARD_ADMIN_TOKEN__||"";return String(l).trim()}function oa(r){const a=String(r||"");if(!a||/^https?:\/\//i.test(a))return a;const l=typeof window>"u"?"":String(window.__OKO_API_BASE__||"").trim();if(!l)return a;const u=l.endsWith("/")?l.slice(0,-1):l,c=a.startsWith("/")?a:`/${a}`;return`${u}${c}`}function ia(r,a,l){const u=a&&typeof r=="object"&&r!==null?r.detail:null;let c=`Request failed: ${l}`;return Array.isArray(u)?c=u.map(p=>typeof p=="object"&&p!==null&&"message"in p?String(p.message||""):JSON.stringify(p)).join("; "):typeof u=="string"&&u?c=u:typeof r=="string"&&r&&(c=r),c}async function Oe(r,a={}){const{requireAdminToken:l=!1,headers:u={},...c}=a,p={};if(u instanceof Headers)u.forEach((_,L)=>{p[L]=_});else if(Array.isArray(u))for(const[_,L]of u)p[_]=String(L);else Object.assign(p,u);const g={Accept:"application/json",...p};if(l){const _=ra();_&&(g[ta]=_)}const m=await fetch(oa(r),{credentials:"same-origin",headers:g,...c}),k=(m.headers.get("content-type")||"").includes("application/json"),E=k?await m.json():await m.text();if(!m.ok){const L=new Error(ia(E,k,m.status));throw L.status=m.status,L.body=E,L}return E}const rt="/api/v1/dashboard";function sa(){return Oe(`${rt}/config`)}function aa(r){return Oe(`${rt}/iframe/${encodeURIComponent(r)}/source`,{requireAdminToken:!0})}function la(r=[]){const a=new URLSearchParams;for(const u of r)a.append("item_id",u);const l=a.toString();return Oe(`${rt}/health${l?`?${l}`:""}`)}function ua(r){return Oe(`${rt}/config`,{requireAdminToken:!0,method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}function ca(){return Oe(`${rt}/lan/state`)}function da(){return Oe(`${rt}/lan/run`,{requireAdminToken:!0,method:"POST"})}const Pn="oko-particles-js",fa="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js",pa=7e3;let St=null;function Dn(){return typeof window.particlesJS=="function"}function ga(r){return new Promise(a=>{let l=!1;const u=p=>{l||(l=!0,a(p))},c=window.setTimeout(()=>{u(Dn())},pa);r.addEventListener("load",()=>{window.clearTimeout(c),u(Dn())},{once:!0}),r.addEventListener("error",()=>{window.clearTimeout(c),u(!1)},{once:!0})})}async function ma(){return typeof window>"u"||typeof document>"u"?!1:Dn()?!0:St||(St=(async()=>{let r=document.getElementById(Pn)instanceof HTMLScriptElement?document.getElementById(Pn):null;r||(r=document.createElement("script"),r.id=Pn,r.src=fa,r.async=!0,r.defer=!0,document.head.appendChild(r));const a=await ga(r);return a||(St=null),a})(),St)}function x(r){const a=`#${r.hex}`;return(l,{attrs:u})=>Lr("svg",{...u,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",role:"img","aria-hidden":"true",style:u.style?[u.style,{color:a}]:{color:a}},[Lr("path",{d:r.path})])}const Yt={homeassistant:x(Cn),"home-assistant":x(Cn),ha:x(Cn),openwrt:x(Cs),adguard:x(Ts),proxmox:x(Nr),pve:x(Nr),grafana:x(Es),gitea:x(ks),jellyfin:x(Or),jellyseerr:x(Or),sonarr:x(_t),radarr:x(Ss),lidarr:x(_t),readarr:x(_t),bazarr:x(_t),prowlarr:x(_t),qbittorrent:x(Br),qb:x(Br),postgres:x(Rr),postgresql:x(Rr),docker:x(Mr),dockge:x(Mr),cockpit:x(_s),npm:x(Tn),nginxproxymanager:x(Tn),"nginx-proxy-manager":x(Tn),nginx:x(ws),openai:x(Dr),ai:x(Dr),portainer:x(Is),ytsync:x(xr),youtube:x(hs),youtubeshorts:x(xr),termius:x(Ar),termix:x(Ar)},Qt={home:Et,house:Et,дом:Et,dom:Et,route:Ks,net:Jt,network:Jt,сеть:Jt,dashboard:so,infra:Ke,infrastructure:Ke,инфраструктура:Ke,server:Ke,core:Hs,ops:io,media:$n,медиа:$n,tv:$n,iot:Xr,cloud:Vs,wifi:Us,monitor:Gs,cockpit:Ns,proxmox:Ke,grafana:eo,gitea:Hr,git:Hr,jellyfin:Zr,navidrome:Gr,tunnel:Vr,tunnels:Vr,stats:oo,services:Ur,service:Ur,health:to,alerts:An,alert:An,security:no,auth:Os,key:Bs,db:xn,database:xn,storage:Rs,link:On,iframe:Bn,terminal:ro,package:Ms,music:Gr,camera:Ds,eye:xs,observability:As,workflow:Ls,settings:Ps,spark:$s},co=[{re:/\b(home|house|dom|дом)\b/,icon:Et},{re:/\b(net|network|route|vpn|edge|сеть|маршрут|туннел)\b/,icon:Jt},{re:/\b(infra|server|cluster|pve|проксмокс|инфраструктур)\b/,icon:Ke},{re:/\b(media|tv|video|stream|jellyfin|медиа)\b/,icon:Zr},{re:/\b(iot|sensor|home-assistant|умн|дом)\b/,icon:Xr},{re:/\b(stat|metric|chart|grafana|аналит|monitor)\b/,icon:eo},{re:/\b(alert|error|warn|critical|ошиб|авар)\b/,icon:An},{re:/\b(health|status|pulse|heart|состояни)\b/,icon:to},{re:/\b(auth|token|secret|lock|ключ|безопас)\b/,icon:no},{re:/\b(db|database|postgres|mysql|redis)\b/,icon:xn}],et={page:so,group:ao,subgroup:Fs,itemLink:On,itemIframe:Bn,widget:oo};function fo(r){return String(r||"").toLowerCase().replace(/[^a-z0-9а-яё._-]+/gi," ").split(/[\s._-]+/).filter(Boolean)}function po(r){if(Yt[r])return Yt[r];for(const[a,l]of Object.entries(Yt))if(r.includes(a))return l;if(Qt[r])return Qt[r];for(const[a,l]of Object.entries(Qt))if(r.includes(a))return l;return null}function ot(r,a){for(const u of r)for(const c of fo(u)){const p=po(c);if(p)return p}const l=r.map(u=>String(u||"").toLowerCase()).filter(Boolean).join(" ");for(const u of co)if(u.re.test(l))return u.icon;return a}function va(r){return ot([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],et.page)}function ba(r){return ot([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.description],et.group)}function ya(r){return ot([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],et.subgroup)}function ha(r){return ot([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,r==null?void 0:r.url,...(r==null?void 0:r.tags)||[]],(r==null?void 0:r.type)==="iframe"?et.itemIframe:et.itemLink)}function Ia(r){var a;return ot([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,(a=r==null?void 0:r.data)==null?void 0:a.endpoint],et.widget)}function Tt(r,a="node"){return String(r||"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")||a}function Ve(r,a){const l=Tt(r,"node");let u=l,c=2;for(;a.has(u);)u=`${l}-${c}`,c+=1;return u}function Zt(r){const a=new Set;for(const l of r.groups||[])for(const u of l.subgroups||[])a.add(u.id);return a}function zt(r){const a=new Set;for(const l of r.groups||[])for(const u of l.subgroups||[])for(const c of u.items||[])a.add(c.id);return a}function ke(r,a){return(r.groups||[]).find(l=>l.id===a)||null}function ye(r,a,l){const u=ke(r,a);return u&&(u.subgroups||[]).find(c=>c.id===l)||null}function jt(r){return String((r==null?void 0:r.key)||"").startsWith("group:")}function Fr(r){var c,p;const a=new Set((r.groups||[]).map(g=>g.id)),l=Zt(r),u=new Set([...a,...l]);for(const g of((c=r.layout)==null?void 0:c.pages)||[]){const m=[];for(const h of g.blocks||[]){if(h.type==="groups"){h.group_ids=(h.group_ids||[]).filter(k=>u.has(k)),h.group_ids.length&&m.push(h);continue}(h.widgets||[]).length&&m.push(h)}!m.length&&((p=r.groups)!=null&&p.length)&&m.push({type:"groups",group_ids:[r.groups[0].id]}),g.blocks=m}}function zr(r,a,l){var g;const u=((g=r.layout)==null?void 0:g.pages)||[];if(!u.length)return;const c=u.find(m=>m.id===a)||u[0];let p=c.blocks.find(m=>m.type==="groups");if(!p){p={type:"groups",group_ids:[l]},c.blocks.push(p);return}p.group_ids.includes(l)||p.group_ids.push(l)}function jr(r,a,l){const u=r.groups||[],c=u.findIndex(h=>h.id===a),p=u.findIndex(h=>h.id===l);if(c<0||p<0||c===p)return!1;const[g]=u.splice(c,1),m=c<p?p-1:p;return u.splice(m,0,g),!0}function qr(r,a,l,u,c){const p=ke(r,a),g=ke(r,u);if(!p||!g)return!1;const m=(p.subgroups||[]).findIndex(E=>E.id===l),h=(g.subgroups||[]).findIndex(E=>E.id===c);if(m<0||h<0)return!1;if(a!==u&&p.subgroups.length<=1)throw new Error("В исходной группе должна остаться минимум одна подгруппа.");const[k]=p.subgroups.splice(m,1);if(a===u){const E=m<h?h-1:h;return p.subgroups.splice(E,0,k),!0}return g.subgroups.splice(h,0,k),!0}function Wr(r,a,l,u,c,p,g){const m=ye(r,a,l),h=ye(r,c,p);if(!m||!h)return!1;const k=(m.items||[]).findIndex(L=>L.id===u),E=(h.items||[]).findIndex(L=>L.id===g);if(k<0||E<0)return!1;if(l!==p&&m.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[_]=m.items.splice(k,1);if(l===p){const L=k<E?E-1:E;return m.items.splice(L,0,_),!0}return h.items.splice(E,0,_),!0}function Jr(r,a,l,u,c,p){const g=ye(r,a,l),m=ye(r,c,p);if(!g||!m)return!1;const h=(g.items||[]).findIndex(E=>E.id===u);if(h<0)return!1;if(l!==p&&g.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[k]=g.items.splice(h,1);return m.items.push(k),!0}function wa(r){const a=String(r||"").trim();if(!a)throw new Error("URL не может быть пустым");const l=/^https?:\/\//i.test(a)?a:`https://${a}`;let u;try{u=new URL(l)}catch{throw new Error(`Некорректный URL: ${a}`)}if(!["http:","https:"].includes(u.protocol))throw new Error(`Разрешены только http/https URL: ${a}`);return u.toString()}function _a(r){const a=String(r||"").trim();if(!a)return"";const l=/^https?:\/\//i.test(a)?a:`https://${a}`;try{const u=new URL(l);return["http:","https:"].includes(u.protocol)?u.origin:""}catch{return""}}let kt=null;function ae(){if(kt)return kt;const r="/static/img/emblem-mark.png",a=3e4,l=16e3,u=9e3,c=700,p=1e4,g="lan",m=new Set(["stat_list","table"]),h="https://example.com",k="sidebar-particles",E="hero-title-particles",_="hero-controls-particles",L={fps_limit:58,particles:{number:{value:88,density:{enable:!0,value_area:700}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.36,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:120,color:"#2dd4bf",opacity:.24,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},K={fps_limit:58,particles:{number:{value:92,density:{enable:!0,value_area:720}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.4,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:132,color:"#2dd4bf",opacity:.26,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},V=Object.freeze([{value:"detailed",label:"Карточки"},{value:"tile",label:"Плитка"},{value:"icon",label:"Значки"}]),W=Object.freeze([{value:"groups",label:"Только группы"},{value:"tags_in_groups",label:"Группы + теги"},{value:"tags",label:"Только теги"},{value:"flat",label:"Без групп (плитка)"}]),C=["detailed","hidden"],G=18,q=10,O="oko:dashboard-ui-state:v1",R=new Set(V.map(e=>e.value)),Pe=new Set(W.map(e=>e.value));function Te(){if(typeof window>"u")return null;try{return window.localStorage||null}catch{return null}}function Ce(){const e=Te();if(!e)return null;try{const t=e.getItem(O);if(!t)return null;const n=JSON.parse(t);return n&&typeof n=="object"?n:null}catch{return null}}function le(e){const t=Te();if(t)try{t.setItem(O,JSON.stringify(e))}catch{}}function ue(){return{id:"",title:"",type:"link",url:h,icon:"",siteInput:"",tagsInput:"",open:"new_tab",healthcheckEnabled:!1,healthcheckUrl:"",healthcheckIntervalSec:30,healthcheckTimeoutMs:1500,iframeSandboxMode:"default",iframeAllowInput:"",iframeReferrerPolicy:"",authProfile:""}}const I=U(null),ce=U(!0),de=U(""),Y=U(""),fe=U(""),re=U(!1),Q=U(""),P=U(!1),oe=U(typeof document>"u"?!0:document.visibilityState!=="hidden"),ne=U("detailed"),Se=U("groups"),M=U("all"),ee=U("detailed"),B=U("idle"),be=U(""),ze=U(null),Xt=U(!1),Pt=U(!1),it=U(""),Lt=U(!1),st=U(""),pe=U(0),Ne=he({open:!1}),at=he({open:!1,host:null}),Le=he({}),At=he({}),xt=new Map;let lt=0,Ge=0,ut=0,Dt=!1,en=!1,Ae=0;const w=he({groupKey:"",subgroupId:"",itemId:""}),ie=he({}),ct=he({}),A=he({type:"",groupId:"",subgroupId:"",itemId:""}),dt=he({}),ge=Ce();if(ge){const e=String(ge.serviceCardView||"");R.has(e)&&(ne.value=e);const t=String(ge.serviceGroupingMode||"");Pe.has(t)&&(Se.value=t);const n=String(ge.sidebarView||"");C.includes(n)&&(ee.value=n);const o=String(ge.siteFilter||"").trim().toLowerCase();M.value=o||"all",Y.value=String(ge.activePageId||""),fe.value=String(ge.treeFilter||""),Q.value=String(ge.activeIndicatorViewId||""),re.value=!!ge.statsExpanded,P.value=!!ge.editMode,Ne.open=!!ge.settingsPanelOpen;const i=ge.selectedNode;i&&typeof i=="object"&&(w.groupKey=String(i.groupKey||""),w.subgroupId=String(i.subgroupId||""),w.itemId=String(i.itemId||""));const d=ge.expandedGroups;if(d&&typeof d=="object")for(const[b,S]of Object.entries(d)){const H=String(b||"");H&&(ie[H]=!!S)}}const Z=he({open:!1,title:"",src:"",allow:"",sandbox:!1,referrerPolicy:"",loading:!1,error:""}),$=he({open:!1,mode:"create",groupId:"",subgroupId:"",originalItemId:"",submitting:!1,error:"",form:ue()}),xe=T(()=>{var t,n;if(!I.value)return[];const e=((n=(t=I.value)==null?void 0:t.layout)==null?void 0:n.pages)||[];return e.some(o=>o.id===g)?e:[...e,{id:g,title:"LAN",icon:"network",blocks:[]}]}),tn=T(()=>{var e;return((e=I.value)==null?void 0:e.widgets)||[]}),Un=T(()=>{var e,t;return((t=(e=I.value)==null?void 0:e.security)==null?void 0:t.auth_profiles)||[]}),mo=T(()=>{var e,t;return((t=(e=I.value)==null?void 0:e.app)==null?void 0:t.title)||"Oko"}),vo=T(()=>{var e,t;return((t=(e=I.value)==null?void 0:e.app)==null?void 0:t.tagline)||"Your Infrastructure in Sight"}),bo=T(()=>V),yo=T(()=>W),Vn=T(()=>ne.value==="icon"),Hn=T(()=>ne.value==="tile"),Kn=T(()=>Vn.value||Hn.value),nn=T(()=>ee.value!=="hidden"),Mt=T(()=>ee.value==="hidden"),ho=T(()=>!1),Io=T(()=>nn.value?"Режим меню: полное. Нажмите, чтобы скрыть меню":"Режим меню: скрыто. Нажмите, чтобы вернуть полное меню"),Fn=T(()=>{var e,t;return((t=(e=ze.value)==null?void 0:e.result)==null?void 0:t.hosts)||[]}),wo=T(()=>{var t,n;const e=((n=(t=ze.value)==null?void 0:t.result)==null?void 0:n.scanned_cidrs)||[];return e.length?e.join(", "):"нет данных"}),_o=T(()=>B.value==="saving"?"Сохранение...":B.value==="saved"?"Сохранено":B.value==="error"?"Ошибка сохранения":P.value?"Готово":"Сохранение выключено"),Rt=T(()=>{var n;const e=new Map;for(const o of((n=I.value)==null?void 0:n.groups)||[])for(const i of o.subgroups||[])for(const d of i.items||[]){const b=vt(d,o);if(!b)continue;const S=b.toLowerCase();e.has(S)||e.set(S,b)}const t=Array.from(e.entries()).sort((o,i)=>o[1].localeCompare(i[1],"ru",{sensitivity:"base"}));return[{value:"all",label:"Все sites"},...t.map(([o,i])=>({value:o,label:i}))]}),Bt=T(()=>{const e=new Map;for(const t of tn.value)e.set(t.id,t);return e}),rn=T(()=>{var t;const e=new Map;for(const n of((t=I.value)==null?void 0:t.groups)||[])e.set(n.id,n);return e}),zn=T(()=>{var t;const e=new Map;for(const n of((t=I.value)==null?void 0:t.groups)||[])for(const o of n.subgroups||[])e.set(o.id,{group:n,subgroup:o});return e}),So=T(()=>{const e=new Map;for(const t of xe.value)for(const n of t.blocks||[])if((n==null?void 0:n.type)==="groups")for(const o of n.group_ids||[])e.has(o)||e.set(o,t.id);return e}),jn=T(()=>{const e=new Map;for(const t of Fn.value||[]){const n=String((t==null?void 0:t.ip)||"").trim();if(n)for(const o of(t==null?void 0:t.dashboard_items)||[]){const i=String((o==null?void 0:o.id)||"").trim();i&&!e.has(i)&&e.set(i,n)}}return e}),ko=T(()=>{var n;const e=[],t=So.value;e.push({id:"action:open-settings-panel",type:"action",action:"open_settings_panel",item:null,title:"Открыть панель настроек",titleLower:"открыть панель настроек",host:"",ip:"",site:"",tagsLower:[],groupId:"",groupKey:"",groupTitle:"Команда",subgroupId:"",subgroupTitle:"Интерфейс",pageId:"",searchBlob:"открыть панель настроек settings ui интерфейс control panel параметры фильтры"});for(const o of((n=I.value)==null?void 0:n.groups)||[])for(const i of o.subgroups||[])for(const d of i.items||[]){const b=ri(d==null?void 0:d.url),S=jn.value.get(d.id)||"",H=(d.tags||[]).map($e=>String($e||"").trim()).filter(Boolean),te=vt(d,o);if(M.value!=="all"&&te.toLowerCase()!==M.value)continue;const Ue=t.get(o.id)||t.get(i.id)||"",Re=String(d.title||"").trim(),Ze=[Re,String(d.id||""),String(d.url||""),b,S,te,String(o.title||""),String(i.title||""),...H].join(" ").toLowerCase();e.push({id:d.id,type:"item",action:"",item:d,title:Re,titleLower:Re.toLowerCase(),host:b.toLowerCase(),ip:S.toLowerCase(),site:te.toLowerCase(),tagsLower:H.map($e=>$e.toLowerCase()),groupId:o.id,groupKey:`group:${o.id}`,groupTitle:String(o.title||""),subgroupId:i.id,subgroupTitle:String(i.title||""),pageId:Ue,searchBlob:Ze})}return e}),ft=T(()=>{const e=String(st.value||"").trim().toLowerCase(),t=ko.value;if(!e){const i=t.filter(b=>b.type==="action"),d=t.filter(b=>b.type!=="action").slice().sort((b,S)=>b.title.localeCompare(S.title,"ru",{sensitivity:"base"}));return[...i,...d].slice(0,q)}const n=e.split(/\s+/).filter(Boolean),o=[];for(const i of t){let d=0,b=!0;for(const S of n){if(!i.searchBlob.includes(S)){b=!1;break}i.titleLower.startsWith(S)?d+=12:i.titleLower.includes(S)&&(d+=8),i.host.startsWith(S)?d+=7:i.host.includes(S)&&(d+=4),i.ip===S?d+=14:i.ip.includes(S)&&(d+=6),i.site&&i.site.includes(S)&&(d+=5),i.tagsLower.some(H=>H.includes(S))&&(d+=3)}b&&o.push({entry:i,score:d})}return o.sort((i,d)=>d.score!==i.score?d.score-i.score:i.entry.title.localeCompare(d.entry.title,"ru",{sensitivity:"base"})),o.slice(0,G).map(i=>i.entry)}),qn=T(()=>ft.value[pe.value]||null),De=T(()=>xe.value.find(e=>e.id===Y.value)||xe.value[0]||null),on=T(()=>{var e;return((e=De.value)==null?void 0:e.id)===g}),je=T(()=>{if(!De.value)return[];const e=[];for(const t of De.value.blocks||[])(t==null?void 0:t.type)==="groups"&&e.push(...t.group_ids||[]);return cn(e)}),Wn=T(()=>{const e=lr(je.value),t=fe.value.trim().toLowerCase();return t?e.map(n=>{if(String(n.title||"").toLowerCase().includes(t)||String(n.description||"").toLowerCase().includes(t))return{...n,subgroups:n.subgroups||[]};const i=(n.subgroups||[]).map(d=>{if(String(d.title||"").toLowerCase().includes(t))return{...d,items:d.items||[]};const S=(d.items||[]).filter(H=>{const te=String(H.title||"").toLowerCase().includes(t),Ue=String(H.url||"").toLowerCase().includes(t),Re=(H.tags||[]).some($e=>String($e).toLowerCase().includes(t)),Ze=vt(H,n).toLowerCase().includes(t);return te||Ue||Re||Ze});return S.length?{...d,items:S}:null}).filter(Boolean);return i.length?{...n,subgroups:i}:null}).filter(Boolean):e}),Eo=T(()=>{const e=[];for(const t of Wn.value){e.push({key:`group:${t.key}`,type:"group",groupKey:t.key,group:t});for(const n of t.subgroups||[])e.push({key:`subgroup:${t.key}:${n.id}`,type:"subgroup",groupKey:t.key,subgroupId:n.id,subgroup:n})}return e}),pt=T(()=>{const e=[];for(const t of je.value)for(const n of t.subgroups||[])for(const o of n.items||[])e.push(o.id);return e}),To=T(()=>{var n;const e=pt.value;let t=0;for(const o of e)(n=Ye(o))!=null&&n.ok&&(t+=1);return{online:t,total:e.length}}),Ot=T(()=>{if(!De.value)return[];const e=[];for(const t of De.value.blocks||[])or(t)&&e.push(...t.widgets||[]);return Array.from(new Set(e))}),Nt=T(()=>ir(Ot.value)),Co=T(()=>{const e=Nt.value.length;if(!e)return"нет данных";const t=Nt.value.filter(n=>gt(n)).length;return`${e} · больших ${t}`}),$o=T(()=>{var e;return(((e=De.value)==null?void 0:e.blocks)||[]).filter(t=>(t==null?void 0:t.type)==="groups")}),Jn=T(()=>{const e=Bt.value.get(Q.value);return!e||!gt(e)?null:Ot.value.includes(e.id)?e:null});function Yn(e){if(!e)return;const t=document.documentElement;e.accent&&(t.style.setProperty("--accent",e.accent),t.style.setProperty("--accent-soft",e.accent)),e.background&&t.style.setProperty("--bg",e.background),e.border&&t.style.setProperty("--border",e.border),e.card&&(t.style.setProperty("--surface",e.card),t.style.setProperty("--surface-strong",e.card)),t.style.setProperty("--glow-enabled",e.glow===!1?"0":"1")}function Qn(e){if(!e)return;const t=document.documentElement;e.gap!=null&&t.style.setProperty("--grid-gap",`${Number(e.gap)}px`),e.card_radius!=null&&t.style.setProperty("--card-radius",`${Number(e.card_radius)}px`),e.columns!=null&&t.style.setProperty("--layout-columns",String(Number(e.columns)))}function Po(){P.value=!P.value,be.value="",P.value||qe()}function Lo(){if(ne.value==="detailed"){ne.value="tile";return}if(ne.value==="tile"){ne.value="icon";return}ne.value="detailed"}function Ao(){ee.value!=="detailed"&&ee.value!=="hidden"&&(ee.value="detailed");const e=C.indexOf(ee.value),n=((e>=0?e:0)+1)%C.length;ee.value=C[n],nn.value||(fe.value="",Gt()),Mt.value&&(Se.value="flat")}function xo(e){return e?e.type==="group"?gr(e.groupKey):e.type==="subgroup"?mr(e.groupKey,e.subgroupId):!1:!1}function Do(e){var t,n;return e?e.type==="group"?`Группа: ${((t=e.group)==null?void 0:t.title)||""}`:e.type==="subgroup"?`Подгруппа: ${((n=e.subgroup)==null?void 0:n.title)||""}`:"":""}function Mo(e){if(e){if(e.type==="group"){ie[e.groupKey]=!0,w.groupKey=e.groupKey,w.subgroupId="",w.itemId="";return}e.type==="subgroup"&&fr(e.groupKey,e.subgroupId)}}function Ro(e,t,n){if(!Kn.value)return;const o=(n==null?void 0:n.__originGroupKey)||e,i=(n==null?void 0:n.__originSubgroupId)||t;dn(o,i,n.id),hn(n)}function Zn(e){return JSON.parse(JSON.stringify(e))}function sn(e){return wa(e)}async function Xn(){var e;if(I.value){B.value="saving",be.value="";try{const t=await ua(I.value);I.value=t.config,(!Y.value||!xe.value.some(n=>n.id===Y.value))&&(Y.value=((e=xe.value[0])==null?void 0:e.id)||""),B.value="saved",Ge&&clearTimeout(Ge),Ge=window.setTimeout(()=>{B.value==="saved"&&(B.value="idle")},1400)}catch(t){throw B.value="error",be.value=(t==null?void 0:t.message)||"Ошибка сохранения YAML",t}}}async function me(e){if(!I.value)return!1;const t=Zn(I.value);try{return e(I.value)===!1?!1:(Fr(I.value),mt(),await Xn(),!0)}catch(n){return I.value=t,B.value="error",be.value=(n==null?void 0:n.message)||"Не удалось применить изменения",!1}}function an(e,t){return{id:e,type:"link",title:t,url:h,icon:null,site:null,tags:[],open:"new_tab"}}async function Bo(){if(!P.value||!I.value)return;const e=window.prompt("Название новой группы","Новая группа");if(e==null)return;const t=e.trim();t&&await me(n=>{const o=new Set((n.groups||[]).map(te=>te.id)),i=Zt(n),d=zt(n),b=Ve(t,o),S=Ve(`${b}-core`,i),H=Ve(`${b}-service`,d);n.groups.push({id:b,title:t,icon:"folder",description:"",layout:"auto",subgroups:[{id:S,title:"Core",items:[an(H,"Новый сервис")]}]}),zr(n,Y.value,b),ie[`group:${b}`]=!0,w.groupKey=`group:${b}`,w.subgroupId=S,w.itemId=H})}async function Oo(e){if(!P.value||!I.value)return;const t=window.prompt("Название подгруппы","Новая подгруппа");if(t==null)return;const n=t.trim();n&&await me(o=>{const i=ke(o,e);if(!i)throw new Error(`Группа '${e}' не найдена`);const d=Zt(o),b=zt(o),S=Ve(`${e}-${n}`,d),H=Ve(`${S}-service`,b);i.subgroups.push({id:S,title:n,items:[an(H,"Новый сервис")]}),ie[`group:${e}`]=!0,w.groupKey=`group:${e}`,w.subgroupId=S,w.itemId=H})}async function No(e,t){!P.value||!I.value||tr(e,t)}function ln(e){return String(e||"").split(",").map(t=>t.trim()).filter(Boolean)}function un(e,t,n,o){const i=Number(e);if(!Number.isFinite(i))return t;const d=Math.trunc(i);return Math.min(o,Math.max(n,d))}function er(e=!1){$.submitting&&!e||($.open=!1,$.mode="create",$.groupId="",$.subgroupId="",$.originalItemId="",$.error="",$.submitting=!1,$.form=ue())}function tr(e,t){if(!ye(I.value,e,t)){B.value="error",be.value=`Подгруппа '${t}' не найдена`;return}$.open=!0,$.mode="create",$.groupId=e,$.subgroupId=t,$.originalItemId="",$.error="",$.submitting=!1,$.form=ue()}function nr(e,t,n){var d,b,S;const o=ye(I.value,e,t),i=((o==null?void 0:o.items)||[]).find(H=>H.id===n);if(!o||!i){B.value="error",be.value=`Элемент '${n}' не найден`;return}$.open=!0,$.mode="edit",$.groupId=e,$.subgroupId=t,$.originalItemId=n,$.error="",$.submitting=!1,$.form={id:i.id,title:i.title,type:i.type,url:String(i.url||h),icon:i.icon||"",siteInput:String(i.site||""),tagsInput:(i.tags||[]).join(", "),open:i.open||"new_tab",healthcheckEnabled:!!(i.type==="link"&&i.healthcheck),healthcheckUrl:i.type==="link"&&i.healthcheck?String(i.healthcheck.url):String(i.url||h),healthcheckIntervalSec:i.type==="link"&&i.healthcheck?Number(i.healthcheck.interval_sec||30):30,healthcheckTimeoutMs:i.type==="link"&&i.healthcheck?Number(i.healthcheck.timeout_ms||1500):1500,iframeSandboxMode:i.type==="iframe"?((d=i.iframe)==null?void 0:d.sandbox)==null?"default":i.iframe.sandbox?"enabled":"disabled":"default",iframeAllowInput:i.type==="iframe"?(((b=i.iframe)==null?void 0:b.allow)||[]).join(", "):"",iframeReferrerPolicy:i.type==="iframe"&&((S=i.iframe)==null?void 0:S.referrer_policy)||"",authProfile:i.type==="iframe"&&i.auth_profile||""}}function rr(e){const t=$.form,n=String(t.title||"").trim();if(!n)throw new Error("Название сервиса обязательно");const o=String(t.type||"").trim().toLowerCase();if(!["link","iframe"].includes(o))throw new Error("Тип сервиса должен быть 'link' или 'iframe'");const i=String(t.open||"new_tab");if(!["new_tab","same_tab"].includes(i))throw new Error("Параметр open должен быть 'new_tab' или 'same_tab'");const d=sn(t.url||h),b=zt(e);$.mode==="edit"&&b.delete($.originalItemId);const S=String(t.id||"").trim(),H=`${$.subgroupId}-${n}`,te=Tt(S||H,"service"),Ue=S?te:Ve(te,b);if(S&&b.has(Ue))throw new Error(`ID '${Ue}' уже существует`);const Re={id:Ue,type:o,title:n,url:d,icon:String(t.icon||"").trim()||null,site:String(t.siteInput||"").trim()||null,tags:ln(t.tagsInput),open:i};if(o==="link"){const Ft={...Re};if(t.healthcheckEnabled){const ds=sn(t.healthcheckUrl||d);Ft.healthcheck={type:"http",url:ds,interval_sec:un(t.healthcheckIntervalSec,30,1,3600),timeout_ms:un(t.healthcheckTimeoutMs,1500,100,12e4)}}return Ft}const Ze=String(t.iframeSandboxMode||"default");let $e=null;Ze==="enabled"&&($e=!0),Ze==="disabled"&&($e=!1);const wt=String(t.authProfile||"").trim();if(wt&&!Un.value.some(Ft=>Ft.id===wt))throw new Error(`Auth profile '${wt}' не найден`);const Pr={...Re,iframe:{sandbox:$e,allow:ln(t.iframeAllowInput),referrer_policy:String(t.iframeReferrerPolicy||"").trim()||null}};return wt&&(Pr.auth_profile=wt),Pr}async function Go(){if(!$.open||$.submitting||!I.value)return;$.submitting=!0,$.error="";const e=await me(t=>{const n=ye(t,$.groupId,$.subgroupId);if(!n)throw new Error(`Подгруппа '${$.subgroupId}' не найдена`);const o=rr(t);if($.mode==="create")return n.items.push(o),w.groupKey=`group:${$.groupId}`,w.subgroupId=$.subgroupId,w.itemId=o.id,!0;const i=(n.items||[]).findIndex(d=>d.id===$.originalItemId);if(i<0)throw new Error(`Элемент '${$.originalItemId}' не найден`);return n.items.splice(i,1,o),w.groupKey=`group:${$.groupId}`,w.subgroupId=$.subgroupId,(w.itemId===$.originalItemId||!w.itemId)&&(w.itemId=o.id),!0});$.submitting=!1,e?er(!0):$.error=be.value||"Не удалось сохранить сервис"}async function Uo(e){if(!P.value||!I.value)return;const t=ke(I.value,e);if(!t)return;const n=window.prompt("Название группы",t.title);if(n==null)return;const o=window.prompt("Описание группы",t.description||"");if(o==null)return;const i=window.prompt("Режим группы (auto | full | inline)",t.layout||"auto");i!=null&&await me(d=>{const b=ke(d,e);if(!b)throw new Error(`Группа '${e}' не найдена`);const S=String(i||"").trim().toLowerCase()||"auto";if(!["auto","full","inline"].includes(S))throw new Error("Режим группы должен быть 'auto', 'full' или 'inline'");b.title=n.trim()||b.title,b.description=o.trim(),b.layout=S})}async function Vo(e,t){if(!P.value||!I.value)return;const n=ye(I.value,e,t);if(!n)return;const o=window.prompt("Название подгруппы",n.title);o!=null&&await me(i=>{const d=ye(i,e,t);if(!d)throw new Error(`Подгруппа '${t}' не найдена`);d.title=o.trim()||d.title})}async function Ho(e,t,n){!P.value||!I.value||nr(e,t,n)}async function Ko(e){if(!P.value||!I.value)return;const t=ke(I.value,e);if(t){if(I.value.groups.length<=1){B.value="error",be.value="Нельзя удалить последнюю группу.";return}window.confirm(`Удалить группу "${t.title}"?`)&&await me(n=>{const o=(n.groups||[]).findIndex(i=>i.id===e);if(o<0)return!1;n.groups.splice(o,1),w.groupKey="",w.subgroupId="",w.itemId=""})}}async function Fo(e,t){if(!P.value||!I.value)return;const n=ke(I.value,e),o=((n==null?void 0:n.subgroups)||[]).find(i=>i.id===t);if(!(!n||!o)){if(n.subgroups.length<=1){B.value="error",be.value="В группе должна остаться хотя бы одна подгруппа.";return}window.confirm(`Удалить подгруппу "${o.title}"?`)&&await me(i=>{const d=ke(i,e);if(!d)return!1;const b=(d.subgroups||[]).findIndex(S=>S.id===t);if(b<0)return!1;d.subgroups.splice(b,1),w.subgroupId="",w.itemId=""})}}async function zo(e,t,n){if(!P.value||!I.value)return;const o=ye(I.value,e,t),i=((o==null?void 0:o.items)||[]).find(d=>d.id===n);if(!(!o||!i)){if(o.items.length<=1){B.value="error",be.value="В подгруппе должен остаться хотя бы один элемент.";return}window.confirm(`Удалить сервис "${i.title}"?`)&&await me(d=>{const b=ye(d,e,t);if(!b)return!1;const S=(b.items||[]).findIndex(H=>H.id===n);if(S<0)return!1;b.items.splice(S,1),w.itemId===n&&(w.itemId="")})}}function qe(){A.type="",A.groupId="",A.subgroupId="",A.itemId=""}function jo(e,t){if(!P.value||!jt(t))return;const n=t.id;A.type="group",A.groupId=n,A.subgroupId="",A.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`group:${n}`))}function qo(e,t,n){P.value&&(A.type="subgroup",A.groupId=t,A.subgroupId=n,A.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`subgroup:${n}`)))}function Wo(e,t,n,o){P.value&&(A.type="item",A.groupId=t,A.subgroupId=n,A.itemId=o,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`item:${o}`)))}function Jo(e,t){if(!P.value||!jt(t))return;const n=t.id;A.type==="group"&&A.groupId!==n&&e.preventDefault()}async function Yo(e,t){if(!P.value||!jt(t))return;const n=t.id;if(A.type!=="group"||!A.groupId||A.groupId===n)return;e.preventDefault();const o=A.groupId;qe(),await me(i=>jr(i,o,n))}function Qo(e,t,n){if(P.value){if(A.type==="subgroup"){if(A.subgroupId===n)return;e.preventDefault();return}A.type==="item"&&e.preventDefault()}}async function Zo(e,t,n){if(P.value){if(A.type==="subgroup"){e.preventDefault();const o=A.groupId,i=A.subgroupId;qe(),await me(d=>qr(d,o,i,t,n));return}if(A.type==="item"){e.preventDefault();const o=A.groupId,i=A.subgroupId,d=A.itemId;qe(),await me(b=>Jr(b,o,i,d,t,n))}}}function Xo(e,t,n,o){P.value&&A.type==="item"&&A.itemId!==o&&e.preventDefault()}async function ei(e,t,n,o){if(!P.value||A.type!=="item"||!A.itemId||A.itemId===o)return;e.preventDefault();const i=A.groupId,d=A.subgroupId,b=A.itemId;qe(),await me(S=>Wr(S,i,d,b,t,n,o))}function or(e){return(e==null?void 0:e.type)==="widget_row"||(e==null?void 0:e.type)==="widget_grid"}function ir(e=[]){return e.map(t=>Bt.value.get(t)).filter(Boolean)}function gt(e){return m.has(String((e==null?void 0:e.type)||""))}function ti(e){return hr(e).slice(0,2)}function sr(e){const t=Nt.value.find(n=>n.id===e);!t||!gt(t)||(Q.value=t.id)}function ni(e){gt(e)&&sr(e.id)}function cn(e=[]){const t=[];for(const n of e){const o=rn.value.get(n);if(o){t.push({key:`group:${o.id}`,id:o.id,title:o.title,icon:o.icon||null,description:o.description||"",layout:o.layout||"auto",subgroups:o.subgroups||[]});continue}const i=zn.value.get(n);i&&t.push({key:`subgroup:${i.subgroup.id}`,id:i.group.id,title:i.group.title,icon:i.group.icon||null,description:i.group.description||"",layout:i.group.layout||"auto",subgroups:[i.subgroup]})}return t}function mt(){const e=new Set(je.value.map(t=>t.key));for(const t of Object.keys(ie))e.has(t)||delete ie[t];for(const t of je.value)ie[t.key]==null&&(ie[t.key]=!0);w.groupKey&&!e.has(w.groupKey)&&Gt()}function Gt(){w.groupKey="",w.subgroupId="",w.itemId=""}function ri(e){try{return new URL(String(e||"")).hostname||""}catch{return""}}function oi(e,t,n){const o=String((e==null?void 0:e.site)||"").trim();if(o)return o;const i=String((t==null?void 0:t.site)||"").trim();if(i)return i;const d=(n||[]).find(b=>String(b||"").toLowerCase().startsWith("site:"));return d?String(d).slice(5).trim():""}function ar(e){return((e==null?void 0:e.tags)||[]).map(t=>String(t||"").trim()).filter(Boolean)}function ii(e){const t=String(e||"");return t.startsWith("group:")&&rn.value.get(t.slice(6))||null}function vt(e,t=null){return oi(e,t,ar(e))}function si(e,t=""){const n=ii((e==null?void 0:e.__originGroupKey)||t);return vt(e,n)}function lr(e=[]){return M.value==="all"?e:e.map(t=>{const n=(t.subgroups||[]).map(o=>({...o,items:(o.items||[]).filter(i=>vt(i,t).toLowerCase()===M.value)})).filter(o=>o.items.length>0);return n.length?{...t,subgroups:n}:null}).filter(Boolean)}function ai(e){const t=String(e||"all").trim().toLowerCase(),n=new Set(Rt.value.map(o=>o.value));M.value=n.has(t)?t:"all"}function ur(){st.value="",pe.value=0,Lt.value=!0}function Ut(){Lt.value=!1,st.value="",pe.value=0}function li(){if(Lt.value){Ut();return}ur()}function cr(){Ne.open=!0}function ui(){Ne.open=!1}function ci(){Ne.open=!Ne.open}function di(e){st.value=String(e||""),pe.value=0}function fi(e){const t=ft.value.length-1;if(t<0){pe.value=0;return}pe.value=Math.min(Math.max(e,0),t)}function pi(e){const t=ft.value.length;if(!t){pe.value=0;return}const o=(pe.value+e+t)%t;pe.value=o}function gi(e){e&&(e.pageId&&(Y.value=e.pageId),dn(e.groupKey,e.subgroupId,e.item.id))}function dr(e){if(e){if(e.type==="action"&&e.action==="open_settings_panel"){Ut(),cr();return}gi(e),hn(e.item),Ut()}}function mi(){dr(qn.value)}async function vi(e){var t;(e==null?void 0:e.type)!=="item"||!((t=e==null?void 0:e.item)!=null&&t.url)||await kr(e.item.url)}function bi(e){ie[e]=!pr(e),w.groupKey=e,w.subgroupId="",w.itemId=""}function fr(e,t){ie[e]=!0,w.groupKey=e,w.subgroupId=t,w.itemId=""}function dn(e,t,n){ie[e]=!0,w.groupKey=e,w.subgroupId=t,w.itemId=n}function pr(e){return!!ie[e]}function gr(e){return w.groupKey===e&&!w.subgroupId&&!w.itemId}function mr(e,t){return w.groupKey===e&&w.subgroupId===t&&!w.itemId}function yi(e){return w.itemId===e}function hi(e=[]){const t=cn(e),n=lr(t),o=Mt.value?n:_i(n),i=Ei(o),d=i.length;return i.map(b=>({...b,__visibleCount:d}))}function Ii(){return!!(w.groupKey||w.subgroupId||w.itemId)}function wi(e){return String(e||"").trim()||"Без тега"}function vr(e){const t=new Set(ar(e).map(n=>wi(n)).filter(Boolean));return t.size||t.add("Без тега"),Array.from(t)}function fn(e,t,n){return{...e,__originGroupKey:t,__originSubgroupId:n}}function _i(e=[]){return Ii()?e.map(t=>{if(w.groupKey&&t.key!==w.groupKey)return null;let n=t.subgroups||[];return w.subgroupId&&(n=n.filter(o=>o.id===w.subgroupId)),w.itemId&&(n=n.map(o=>({...o,items:(o.items||[]).filter(i=>i.id===w.itemId)})).filter(o=>o.items.length>0)),n.length?{...t,subgroups:n}:null}).filter(Boolean):e}function Si(e=[]){return e.map(t=>{const n=new Map;for(const d of t.subgroups||[])for(const b of d.items||[])for(const S of vr(b))n.has(S)||n.set(S,[]),n.get(S).push(fn(b,t.key,d.id));const i=Array.from(n.entries()).sort(([d],[b])=>d.localeCompare(b,"ru",{sensitivity:"base"})).map(([d,b])=>({id:`tag-${Tt(`${t.id}-${d}`,"tag")}`,title:`#${d}`,icon:"tag",items:b}));return i.length?{...t,subgroups:i}:null}).filter(Boolean)}function ki(e=[]){const t=new Map;for(const o of e)for(const i of o.subgroups||[])for(const d of i.items||[])for(const b of vr(d))t.has(b)||t.set(b,[]),t.get(b).push(fn(d,o.key,i.id));return Array.from(t.entries()).sort(([o],[i])=>o.localeCompare(i,"ru",{sensitivity:"base"})).map(([o,i])=>{const d=Tt(o,"tag");return{key:`tags:${d}`,id:`tags-${d}`,title:`#${o}`,icon:"tag",description:"Сервисы, сгруппированные только по тегам.",layout:"inline",subgroups:[{id:`tags-${d}-items`,title:"Сервисы",items:i}]}})}function br(e=[]){const t=[];for(const n of e)for(const o of n.subgroups||[])for(const i of o.items||[])t.push(fn(i,n.key,o.id));return t.length?[{key:"flat:all",id:"flat-all",title:"Все сервисы",icon:"layout-grid",description:"Плоское отображение без группировки.",layout:"full",subgroups:[{id:"flat-all-items",title:"Плитка",items:t}]}]:[]}function Ei(e=[]){return Mt.value?br(e):Se.value==="tags_in_groups"?Si(e):Se.value==="tags"?ki(e):Se.value==="flat"?br(e):e}function Ti(e){const t=String((e==null?void 0:e.layout)||"auto").toLowerCase();return t==="inline"?!0:t==="full"?!1:Number((e==null?void 0:e.__visibleCount)||0)>1}function Ci(e){return(e.subgroups||[]).reduce((t,n)=>t+(n.items||[]).length,0)}function $i(e){return((e==null?void 0:e.items)||[]).length}function Pi(e){var n;let t=0;for(const o of e.subgroups||[])for(const i of o.items||[])(n=Ye(i.id))!=null&&n.ok&&(t+=1);return t}function yr(){for(const e of Object.keys(dt))delete dt[e]}function pn(e){return _a(e)}function gn(e){const t=pn(e==null?void 0:e.url);return t?`${String((e==null?void 0:e.id)||"")}|${t}`:""}function Li(e){const t=pn(e==null?void 0:e.url);if(!t)return"";const n=gn(e);return n&&dt[n]?"":`${t}/favicon.ico`}function Ai(e){const t=gn(e);t&&(dt[t]=!0)}function xi(e){return va(e)}function Di(e){return ba(e)}function Mi(e){return ya(e)}function Ri(e){return ha(e)}function Bi(e){return Ia(e)}function We(e){return Le[e]||null}function mn(e,t){return`${e}:${t}`}function Oi(e,t){return!!At[mn(e,t)]}function Me(e,t){if(!t||typeof t!="string")return null;if(t==="$")return e;if(!t.startsWith("$."))return null;let n=e;const o=t.slice(2).split(".");for(const i of o){if(n==null)return null;const d=i.match(/^(.*)\[\*\]$/);if(d){const b=d[1],S=b?n==null?void 0:n[b]:n;return Array.isArray(S)?S:[]}n=n==null?void 0:n[i]}return n}function Ni(e){var o,i,d;const t=(o=We(e.id))==null?void 0:o.payload;return Me(t,(d=(i=e.data)==null?void 0:i.mapping)==null?void 0:d.value)??"—"}function Gi(e){var o,i,d;const t=(o=We(e.id))==null?void 0:o.payload;return Me(t,(d=(i=e.data)==null?void 0:i.mapping)==null?void 0:d.subtitle)??""}function Ui(e){var o,i,d;const t=(o=We(e.id))==null?void 0:o.payload;return Me(t,(d=(i=e.data)==null?void 0:i.mapping)==null?void 0:d.trend)??""}function hr(e){var i,d;const t=(i=We(e.id))==null?void 0:i.payload,n=((d=e.data)==null?void 0:d.mapping)||{},o=Me(t,n.items);return Array.isArray(o)?o.map(b=>{const S=Me(b,n.item_title)??"-",H=Me(b,n.item_value)??"-";return{title:S,value:H}}):[]}function Vi(e){var i,d,b;const t=(i=We(e.id))==null?void 0:i.payload,n=(b=(d=e.data)==null?void 0:d.mapping)==null?void 0:b.rows,o=Me(t,n);return Array.isArray(o)?o:Array.isArray(t)?t:Array.isArray(t==null?void 0:t.items)?t.items:[]}function Vt(e){return e?e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/")?e:`/${e}`:""}function bt(){for(const e of xt.values())clearInterval(e);xt.clear()}function Je(){lt&&(clearTimeout(lt),lt=0)}function Ye(e){return ct[e]||null}function Hi(e){return!!(e!=null&&e.ok&&e.latency_ms!=null&&e.latency_ms>=c)}function vn(e){if(!e)return"unknown";const t=String(e.level||"").toLowerCase();return["online","degraded","down","unknown","indirect_failure"].includes(t)?t:Hi(e)?"degraded":e.ok?"online":"down"}function Ki(e){const t=Ye(e),n=vn(t);return n==="online"?"ok":n==="degraded"?"degraded":n==="down"||n==="indirect_failure"?"down":"unknown"}function Fi(e){const t=Ye(e);if(!t)return"Проверка...";const n=vn(t);return n==="online"?t.latency_ms!=null?`Online • ${t.latency_ms} ms`:"Online":n==="degraded"?t.latency_ms!=null?`Degraded • ${t.latency_ms} ms`:t.status_code!=null?`Degraded • HTTP ${t.status_code}`:t.error?`Degraded • ${t.error}`:t.reason?`Degraded • ${String(t.reason).replaceAll("_"," ")}`:"Degraded":n==="indirect_failure"?"Indirect failure":n==="down"?t.error?`Offline • ${t.error}`:t.status_code!=null?`Offline • HTTP ${t.status_code}`:"Offline":"Unknown"}async function Qe(e=null){if(!Array.isArray(e)&&!oe.value)return;const t=Array.isArray(e)&&e.length?e:pt.value,n=Array.from(new Set(t.map(o=>String(o||"").trim()).filter(Boolean)));if(n.length)try{const o=await la(n);for(const i of o.items||[])ct[i.item_id]=i}catch{for(const o of n)ct[o]||(ct[o]={item_id:o,ok:!1,checked_url:"",status_code:null,latency_ms:null,error:"healthcheck unavailable"})}}async function bn(){Je(),await Qe(),Ir()}function zi(){let e=!1,t=!1;for(const n of pt.value){const o=vn(Ye(n));if(o==="down"||o==="indirect_failure"){e=!0;break}o==="degraded"&&(t=!0)}return e?u:t?l:a}function Ir(){if(Je(),!oe.value)return;const e=zi();lt=window.setTimeout(async()=>{await Qe(),Ir()},e)}async function Ht(e){var i;const t=Bt.value.get(e);if(!t)return;const n=Vt((i=t.data)==null?void 0:i.endpoint);if(!n)return;Le[e]||(Le[e]={loading:!1,error:"",payload:null,lastUpdated:0});const o=Le[e];o.loading=!0,o.error="";try{o.payload=await Oe(n),o.lastUpdated=Date.now()}catch(d){o.error=(d==null?void 0:d.message)||"Ошибка загрузки виджета"}finally{o.loading=!1}}async function yn(){var t,n;bt();const e=[];for(const o of tn.value){if(e.push(Ht(o.id)),!Vt((t=o.data)==null?void 0:t.endpoint))continue;const i=Math.max(1,Number(((n=o.data)==null?void 0:n.refresh_sec)||0))*1e3,d=window.setInterval(()=>{Ht(o.id)},i);xt.set(o.id,d)}await Promise.all(e)}async function ji(e,t){const n=mn(e,t.id),o=Vt(t.endpoint);if(o){At[n]=!0;try{await Oe(o,{method:String(t.method||"GET").toUpperCase()}),await Ht(e)}catch(i){Le[e]||(Le[e]={loading:!1,error:"",payload:null,lastUpdated:0}),Le[e].error=(i==null?void 0:i.message)||"Не удалось выполнить действие"}finally{At[n]=!1}}}async function wr(){var e,t,n;ce.value=!0,de.value="",B.value="idle",be.value="",yr();try{const o=await sa();I.value=o,(!Y.value||!xe.value.some(i=>i.id===Y.value))&&(Y.value=((e=xe.value[0])==null?void 0:e.id)||""),mt(),Yn((t=o==null?void 0:o.ui)==null?void 0:t.theme),Qn((n=o==null?void 0:o.ui)==null?void 0:n.grid),await yn(),await bn(),oe.value||Er()}catch(o){de.value=(o==null?void 0:o.message)||"Не удалось загрузить dashboard-конфигурацию",I.value=null,bt(),Je()}finally{ce.value=!1}}async function _r(e){var o,i,d,b,S,H;const t=!!(((d=(i=(o=I.value)==null?void 0:o.security)==null?void 0:i.iframe)==null?void 0:d.default_sandbox)??!0),n=(b=e==null?void 0:e.iframe)==null?void 0:b.sandbox;Z.open=!0,Z.title=e.title,Z.src="",Z.error="",Z.loading=!0,Z.sandbox=n==null?t:!!n,Z.allow=Array.isArray((S=e==null?void 0:e.iframe)==null?void 0:S.allow)?e.iframe.allow.join("; "):"",Z.referrerPolicy=((H=e==null?void 0:e.iframe)==null?void 0:H.referrer_policy)||"";try{const te=await aa(e.id);Z.src=te.src}catch(te){Z.error=(te==null?void 0:te.message)||"Не удалось подготовить iframe"}finally{Z.loading=!1}}function qi(){Z.open=!1,Z.title="",Z.src="",Z.error="",Z.loading=!1,Z.sandbox=!1,Z.allow="",Z.referrerPolicy=""}function Sr(e){if(e.open==="same_tab"){window.location.assign(e.url);return}window.open(e.url,"_blank","noopener,noreferrer")}function Wi(e){e!=null&&e.url&&window.open(e.url,"_blank","noopener,noreferrer")}function hn(e){if(e.type==="iframe"){_r(e);return}Sr(e)}function In(e){return jn.value.get(String(e||""))||""}async function wn(e){var n;const t=String(e||"");if(t&&(n=navigator.clipboard)!=null&&n.writeText)try{await navigator.clipboard.writeText(t)}catch{}}async function kr(e){await wn(e)}async function Ji(e){const t=In(e);t&&await wn(t)}async function Yi(e){const t=In(e);t&&await wn(`ssh ${t}`)}async function Qi(e){e&&await Qe([e])}function Zi(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?"—":t.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function Xi(e){const t=Number(e||0);return!Number.isFinite(t)||t<=0?"—":t<1e3?`${Math.round(t)} ms`:`${(t/1e3).toFixed(2)} s`}function es(e){e&&(at.host=e,at.open=!0)}function _n(){at.open=!1,at.host=null}function ts(e){const t=(e==null?void 0:e.open_ports)||[];return t.length?t.map(n=>n!=null&&n.service?`${n.port} (${n.service})`:`${n.port}`).join(", "):"—"}function ns(e){return e?e.error?e.error:e.status_code==null?"—":`HTTP ${e.status_code}`:"—"}async function yt({silent:e=!1}={}){if(!Dt){Dt=!0,e||(Xt.value=!0);try{ze.value=await ca(),it.value=""}catch(t){it.value=(t==null?void 0:t.message)||"Не удалось загрузить состояние сканера LAN"}finally{Dt=!1,e||(Xt.value=!1)}}}function ht(){ut&&(window.clearInterval(ut),ut=0)}function Sn(){ht(),ut=window.setInterval(()=>{yt({silent:!0})},p)}function Er(){Je(),ht(),bt()}async function rs(){!I.value||ce.value||(await yn(),await bn(),on.value&&(await yt({silent:!0}),Sn()))}async function os(){if(!en){en=!0;try{oe.value?await rs():Er()}finally{en=!1}}}function Tr(){oe.value=document.visibilityState!=="hidden",os()}async function is(){var e;if(!Pt.value){Pt.value=!0;try{const t=await da();ze.value=(t==null?void 0:t.state)||ze.value,it.value=t!=null&&t.accepted||(e=t==null?void 0:t.state)!=null&&e.queued?"":(t==null?void 0:t.message)||""}catch(t){it.value=(t==null?void 0:t.message)||"Не удалось запустить сканирование LAN"}finally{Pt.value=!1,yt({silent:!0})}}}function ss(){var e,t;return((t=(e=document.documentElement)==null?void 0:e.dataset)==null?void 0:t.fxMode)||"full"}function as(e){const t=document.documentElement;let n="high",o="1";e>=120?(n="low",o="0.42"):e>=70&&(n="medium",o="0.68"),t.dataset.motionBudget=n,t.style.setProperty("--motion-budget",o)}function ls(e){const t=ss();if(t==="off")return null;const n=JSON.parse(JSON.stringify(e));return n.fps_limit=t==="lite"?34:58,t!=="lite"||(n.particles.number.value=Math.max(24,Math.round(n.particles.number.value*.56)),n.particles.opacity.value=Number((n.particles.opacity.value*.72).toFixed(2)),n.particles.move.speed=Number((n.particles.move.speed*.74).toFixed(2)),n.particles.line_linked.opacity=Number((n.particles.line_linked.opacity*.56).toFixed(2)),n.particles.line_linked.distance=Math.max(80,Math.round(n.particles.line_linked.distance*.84)),n.retina_detect=!1),n}function kn(e){const t=document.getElementById(e);t&&(t.innerHTML="",delete t.dataset.particlesReady)}function us(){kn(k),kn(E),kn(_)}async function cs(){Ae&&(window.cancelAnimationFrame(Ae),Ae=0),Ae=window.requestAnimationFrame(async()=>{Ae=0,us(),await En(),await It()})}function Cr(){cs()}async function Kt(e,t){const n=document.getElementById(e);if(!n)return;const o=ls(t);if(!o){n.innerHTML="",delete n.dataset.particlesReady;return}n.dataset.particlesReady==="1"||!await ma()||!window.particlesJS||document.getElementById(e)&&n.dataset.particlesReady!=="1"&&(n.innerHTML="",window.particlesJS(e,o),n.dataset.particlesReady="1")}async function En(){await Kt(k,L)}async function It(){await Promise.all([Kt(E,K),Kt(_,K)])}let $r=!1;return se(()=>{var e;return(e=De.value)==null?void 0:e.id},async()=>{$r?(Q.value="",fe.value="",Gt()):$r=!0,mt(),Qe(),await Be(),await It()}),se(()=>{var e;return(e=Jn.value)==null?void 0:e.id},async()=>{await Be(),await It()}),se(()=>Ot.value,e=>{Q.value&&!e.includes(Q.value)&&(Q.value="")},{deep:!0}),se(()=>je.value,()=>{mt(),Qe()},{deep:!0}),se(()=>ft.value.length,e=>{if(!e){pe.value=0;return}pe.value>=e&&(pe.value=e-1)}),se(()=>Rt.value.map(e=>e.value).join("|"),()=>{Rt.value.some(e=>e.value===M.value)||(M.value="all")}),se(()=>on.value,e=>{if(e){oe.value&&(yt(),Sn());return}_n(),ht()}),se(()=>pt.value.length,e=>{as(e)},{immediate:!0}),se(()=>({activePageId:Y.value,treeFilter:fe.value,activeIndicatorViewId:Q.value,statsExpanded:re.value,editMode:P.value,serviceCardView:ne.value,serviceGroupingMode:Se.value,siteFilter:M.value,sidebarView:ee.value,settingsPanelOpen:Ne.open,selectedNode:{groupKey:w.groupKey,subgroupId:w.subgroupId,itemId:w.itemId},expandedGroups:{...ie}}),e=>{le(e)},{deep:!0}),tt(async()=>{window.addEventListener("visibilitychange",Tr),window.addEventListener("oko:fx-mode-change",Cr),await En(),await wr(),await Be(),await It()}),nt(()=>{bt(),Je(),ht(),_n(),window.removeEventListener("visibilitychange",Tr),window.removeEventListener("oko:fx-mode-change",Cr),Ae&&(window.cancelAnimationFrame(Ae),Ae=0),Ge&&(clearTimeout(Ge),Ge=0),delete document.documentElement.dataset.motionBudget,document.documentElement.style.removeProperty("--motion-budget"),kt=null}),kt={BRAND_ICON_BY_KEY:Yt,DEFAULT_ITEM_URL:h,EMBLEM_SRC:r,HEALTH_REFRESH_MS:a,HERO_CONTROLS_PARTICLES_ID:_,HERO_PARTICLES_CONFIG:K,HERO_TITLE_PARTICLES_ID:E,ICON_BY_KEY:Qt,ICON_RULES:co,LAN_PAGE_ID:g,LAN_SCAN_POLL_MS:p,LARGE_INDICATOR_TYPES:m,SIDEBAR_PARTICLES_CONFIG:L,SIDEBAR_PARTICLES_ID:k,actionBusy:At,actionKey:mn,activeCommandPaletteEntry:qn,activeIndicatorViewId:Q,activeIndicatorWidget:Jn,activePage:De,activePageGroupBlocks:$o,activePageId:Y,activePageWidgetIds:Ot,addGroup:Bo,addItem:No,addSubgroup:Oo,allItemIds:zt,allSubgroupIds:Zt,appTagline:vo,appTitle:mo,applyConfigMutation:me,applyGrid:Qn,applyTheme:Yn,authProfileOptions:Un,buildDefaultItem:an,buildItemFromEditorForm:rr,clampNumber:un,clearDragState:qe,clearItemFaviconFailures:yr,clearSelectedNode:Gt,cloneConfig:Zn,closeIframeModal:qi,closeItemEditor:er,closeLanHostModal:_n,closeCommandPalette:Ut,closeSettingsPanel:ui,commandPaletteActiveIndex:pe,commandPaletteOpen:Lt,commandPaletteQuery:st,commandPaletteResults:ft,config:I,configError:de,copyItemIp:Ji,copyItemSshShortcut:Yi,copyCommandPaletteEntryUrl:vi,copyUrl:kr,createBrandIcon:x,defaultItemEditorForm:ue,dragState:A,editGroup:Uo,editItem:Ho,editMode:P,editSubgroup:Vo,ensureAbsoluteUrl:sn,ensurePageGroupsReference:zr,expandedGroups:ie,faviconOriginFromUrl:pn,filteredBlockGroups:hi,filteredTreeGroups:Wn,findGroup:ke,findSubgroup:ye,formatLanDuration:Xi,formatLanHttpStatus:ns,formatLanMoment:Zi,fromToken:po,groupById:rn,groupOnlineItems:Pi,groupTotalItems:Ci,healthClass:Ki,healthLabel:Fi,healthPollTimer:lt,healthState:Ye,healthStates:ct,iframeModal:Z,indicatorPreviewEntries:ti,initHeroParticles:It,initParticles:Kt,initSidebarParticles:En,initWidgetPolling:yn,isActionBusy:Oi,isDirectGroupNode:jt,isGroupExpanded:pr,isGroupSelected:gr,isIconCardView:Vn,isSidebarDetailed:nn,isSidebarHidden:Mt,isTileCardView:Hn,isCompactServiceCardView:Kn,isInlineGroupLayout:Ti,isItemSelected:yi,isLanPage:on,isLargeIndicator:gt,isSidebarIconActive:xo,isSidebarIconOnly:ho,isSubgroupSelected:mr,isWidgetBlock:or,itemEditor:$,itemFaviconFailures:dt,itemFaviconKey:gn,itemFaviconSrc:Li,itemIp:In,itemSite:si,lanCidrsLabel:wo,lanHostModal:at,lanHosts:Fn,lanPortsLabel:ts,lanScanActionBusy:Pt,lanScanError:it,lanScanLoading:Xt,lanScanPollTimer:ut,lanScanRefreshInFlight:Dt,lanScanState:ze,loadConfig:wr,loadingConfig:ce,makeUniqueId:Ve,markItemFaviconFailed:Ai,moveGroup:jr,moveCommandPaletteSelection:pi,moveItemBefore:Wr,moveItemToSubgroupEnd:Jr,moveSubgroup:qr,normalizeEndpoint:Vt,normalizeIconToken:fo,normalizeId:Tt,normalizeLayoutBlocks:Fr,normalizeStringList:ln,onGroupDragOver:Jo,onGroupDragStart:jo,onGroupDrop:Yo,onItemCardClick:Ro,onItemDragOver:Xo,onItemDragStart:Wo,onItemDrop:ei,onSubgroupDragOver:Qo,onSubgroupDragStart:qo,onSubgroupDrop:Zo,activateCommandPaletteEntry:dr,activateCommandPaletteSelection:mi,openCommandPalette:ur,openSettingsPanel:cr,openCreateItemEditor:tr,openEditItemEditor:nr,openIframeItem:_r,openIndicatorView:sr,openItem:hn,openItemInNewTab:Wi,openLanHostModal:es,openLinkItem:Sr,pageHealthSummary:To,pages:xe,persistConfig:Xn,pickSemanticIcon:ot,refreshHealth:Qe,recheckItem:Qi,refreshLanScanState:yt,refreshWidget:Ht,removeGroup:Ko,removeItem:zo,removeSubgroup:Fo,resetWidgetPolling:bt,resolveBlockGroups:cn,resolveExpression:Me,resolveGroupIcon:Di,resolveItemIcon:Ri,resolvePageIcon:xi,resolveSubgroupIcon:Mi,resolveWidgetIcon:Bi,resolveWidgets:ir,runLanScanNow:is,runWidgetAction:ji,saveError:be,saveStatus:B,saveStatusLabel:_o,saveStatusTimer:Ge,setCommandPaletteActiveIndex:fi,setCommandPaletteQuery:di,setSiteFilter:ai,settingsPanel:Ne,sidebarViewToggleTitle:Io,selectItemNode:dn,selectSidebarIconNode:Mo,selectSidebarIndicator:ni,selectSubgroupNode:fr,selectedNode:w,serviceCardView:ne,siteFilter:M,siteFilterOptions:Rt,serviceGroupingMode:Se,serviceGroupingOptions:yo,servicePresentationOptions:bo,sidebarIconNodeTitle:Do,sidebarIconNodes:Eo,sidebarIndicatorSummary:Co,sidebarIndicators:Nt,sidebarView:ee,startHealthPolling:bn,startLanScanPolling:Sn,statCardSubtitle:Gi,statCardTrend:Ui,statCardValue:Ni,statListEntries:hr,statsExpanded:re,stopHealthPolling:Je,stopLanScanPolling:ht,subgroupById:zn,subgroupTotalItems:$i,submitItemEditor:Go,syncTreeGroupsState:mt,tableRows:Vi,toggleCommandPalette:li,toggleEditMode:Po,toggleGroupNode:bi,toggleSettingsPanel:ci,toggleServiceCardView:Lo,toggleSidebarView:Ao,treeFilter:fe,treeGroups:je,visibleTreeItemIds:pt,widgetById:Bt,widgetIntervals:xt,widgetState:We,widgetStates:Le,widgets:tn},kt}const Sa=["title"],ka={key:0,class:"item-compact-body"},Ea=["src"],Ta={class:"item-tile-head"},Ca=["src"],$a={class:"item-tile-title"},Pa={class:"item-head"},La={class:"item-title-row"},Aa=["src"],xa={class:"item-type"},Da={class:"item-url"},Ma={class:"item-health"},Ra={key:0,class:"item-tags"},Ba={key:0,class:"tag-pill site-pill"},Oa={class:"item-actions"},Na={key:1,class:"item-ssh-shortcut"},Ga={__name:"ServiceItemCard",props:{groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0},item:{type:Object,required:!0}},setup(r){const a=r,l=Wt(a,"groupKey"),u=Wt(a,"subgroupId"),c=Wt(a,"item"),p=ae(),{isIconCardView:g,isTileCardView:m,isCompactServiceCardView:h,isItemSelected:k,onItemCardClick:E,itemFaviconSrc:_,markItemFaviconFailed:L,resolveItemIcon:K,healthClass:V,healthLabel:W,itemIp:C,itemSite:G,copyItemIp:q,copyItemSshShortcut:O,openItem:R,openItemInNewTab:Pe,recheckItem:Te,copyUrl:Ce}=p,le=T(()=>V(c.value.id)),ue=T(()=>W(c.value.id)),I=T(()=>C(c.value.id)),ce=T(()=>`ssh ${I.value}`),de=T(()=>G(c.value,l.value)),Y=U(!1),fe=U(!1);let re=0,Q=0;const P=T(()=>({selected:!h.value&&k(c.value.id),compact:h.value,tile:m.value,[`status-${le.value}`]:!0,"data-updated":fe.value}));function oe(){re&&clearTimeout(re),Y.value=!1,window.requestAnimationFrame(()=>{Y.value=!0,re=window.setTimeout(()=>{Y.value=!1,re=0},900)})}function ne(){Q&&clearTimeout(Q),fe.value=!1,window.requestAnimationFrame(()=>{fe.value=!0,Q=window.setTimeout(()=>{fe.value=!1,Q=0},1250)})}return se([le,ue],([Se,M],[ee,B])=>{ee===void 0&&B===void 0||((Se!==ee||M!==B)&&ne(),M!==B&&oe())}),nt(()=>{re&&(clearTimeout(re),re=0),Q&&(clearTimeout(Q),Q=0)}),(Se,M)=>{var ee;return f(),y("article",{class:j(["item-card",P.value]),title:s(h)?c.value.title:void 0,onClick:M[9]||(M[9]=B=>s(E)(l.value,u.value,c.value))},[s(g)?(f(),y("div",ka,[s(_)(c.value)?(f(),y("img",{key:0,src:s(_)(c.value),class:"service-favicon compact-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:M[0]||(M[0]=B=>s(L)(c.value))},null,40,Ea)):(f(),z(Ee(s(K)(c.value)),{key:1,class:"ui-icon item-icon compact-item-icon"})),v("span",{class:j(["health-dot compact-health-dot",le.value])},null,2)])):s(m)?(f(),y(X,{key:1},[v("div",Ta,[s(_)(c.value)?(f(),y("img",{key:0,src:s(_)(c.value),class:"service-favicon tile-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:M[1]||(M[1]=B=>s(L)(c.value))},null,40,Ca)):(f(),z(Ee(s(K)(c.value)),{key:1,class:"ui-icon item-icon tile-item-icon"})),v("span",{class:j(["health-dot tile-health-dot",le.value])},null,2)]),v("p",$a,N(c.value.title),1)],64)):(f(),y(X,{key:2},[v("div",Pa,[v("div",La,[s(_)(c.value)?(f(),y("img",{key:0,src:s(_)(c.value),class:"service-favicon item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:M[2]||(M[2]=B=>s(L)(c.value))},null,40,Aa)):(f(),z(Ee(s(K)(c.value)),{key:1,class:"ui-icon item-icon"})),v("h4",null,N(c.value.title),1)]),v("span",xa,N(c.value.type),1)]),v("p",Da,N(c.value.url),1),v("div",Ma,[v("span",{class:j(["health-dot",le.value])},null,2),v("span",{class:j(["health-text",{"is-updating":Y.value}])},N(ue.value),3)]),de.value||(ee=c.value.tags)!=null&&ee.length?(f(),y("div",Ra,[de.value?(f(),y("span",Ba,"site:"+N(de.value),1)):F("",!0),(f(!0),y(X,null,_e(c.value.tags,B=>(f(),y("span",{key:B,class:"tag-pill"},N(B),1))),128))])):F("",!0),v("div",Oa,[D(we,{title:c.value.type==="iframe"?"Открыть iframe":"Открыть","aria-label":c.value.type==="iframe"?"Открыть iframe":"Открыть",onClick:M[3]||(M[3]=J(B=>s(R)(c.value),["stop"]))},{default:ve(()=>[(f(),z(Ee(c.value.type==="iframe"?s(Bn):s(On)),{class:"ui-icon item-action-icon"}))]),_:1},8,["title","aria-label"]),D(we,{title:"Открыть в новой вкладке","aria-label":"Открыть в новой вкладке",onClick:M[4]||(M[4]=J(B=>s(Pe)(c.value),["stop"]))},{default:ve(()=>[D(s(zs),{class:"ui-icon item-action-icon"})]),_:1}),D(we,{title:"Recheck health","aria-label":"Recheck health",onClick:M[5]||(M[5]=J(B=>s(Te)(c.value.id),["stop"]))},{default:ve(()=>[D(s(js),{class:"ui-icon item-action-icon"})]),_:1}),I.value?(f(),z(we,{key:0,title:"Копировать IP","aria-label":"Копировать IP",onClick:M[6]||(M[6]=J(B=>s(q)(c.value.id),["stop"]))},{default:ve(()=>[D(s(Ke),{class:"ui-icon item-action-icon"})]),_:1})):F("",!0),I.value?(f(),z(we,{key:1,title:"Копировать SSH shortcut","aria-label":"Копировать SSH shortcut",onClick:M[7]||(M[7]=J(B=>s(O)(c.value.id),["stop"]))},{default:ve(()=>[D(s(ro),{class:"ui-icon item-action-icon"})]),_:1})):F("",!0),D(we,{title:"Копировать URL","aria-label":"Копировать URL",onClick:M[8]||(M[8]=J(B=>s(Ce)(c.value.url),["stop"]))},{default:ve(()=>[D(s(qs),{class:"ui-icon item-action-icon"})]),_:1})]),I.value?(f(),y("p",Na,[M[10]||(M[10]=ps(" SSH: ",-1)),v("code",null,N(ce.value),1)])):F("",!0)],64))],10,Sa)}}},Ua={class:"virtual-item-grid"},Va=120,Ln=72,Ha={__name:"VirtualizedItemGrid",props:{items:{type:Array,required:!0},groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0}},setup(r){const l=Wt(r,"items"),u=ae(),{isIconCardView:c,isTileCardView:p}=u,g=U(null),m=U(Ln);let h=null;const k=T(()=>l.value.length>Va),E=T(()=>k.value&&m.value<l.value.length),_=T(()=>k.value?l.value.slice(0,m.value):l.value);function L(){m.value=Math.min(l.value.length,m.value+Ln)}function K(){m.value=Ln}function V(){h&&(h.disconnect(),!(!E.value||!g.value)&&h.observe(g.value))}return se(()=>l.value,async()=>{K(),await Be(),V()},{deep:!0}),se(()=>E.value,async()=>{await Be(),V()}),tt(async()=>{h=new IntersectionObserver(W=>{for(const C of W)if(C.isIntersecting){L();break}},{root:null,rootMargin:"260px 0px",threshold:0}),await Be(),V()}),nt(()=>{h==null||h.disconnect(),h=null}),(W,C)=>(f(),y("div",Ua,[D(gs,{name:"item-grid-transition",tag:"div",class:j(["item-grid",{"icon-card-grid":s(c),"tile-card-grid":s(p)}])},{default:ve(()=>[(f(!0),y(X,null,_e(_.value,G=>(f(),z(Ga,{key:G.id,"group-key":G.__originGroupKey||r.groupKey,"subgroup-id":G.__originSubgroupId||r.subgroupId,item:G},null,8,["group-key","subgroup-id","item"]))),128))]),_:1},8,["class"]),E.value?(f(),y("div",{key:0,ref_key:"sentinelRef",ref:g,class:"item-grid-sentinel","aria-hidden":"true"},null,512)):F("",!0)]))}},Ka={class:"group-header"},Fa={class:"group-title-row"},za={key:0,class:"subtitle"},ja={class:"subgroup-title"},qa={__name:"ServiceGroupCard",props:{group:{type:Object,required:!0}},setup(r){const a=ae(),{isInlineGroupLayout:l,resolveGroupIcon:u,resolveSubgroupIcon:c}=a;return(p,g)=>(f(),y("article",{class:j(["panel group-panel",{"group-panel-inline":s(l)(r.group)}])},[v("header",Ka,[v("div",Fa,[(f(),z(Ee(s(u)(r.group)),{class:"ui-icon group-icon"})),v("h2",null,N(r.group.title),1)]),r.group.description?(f(),y("p",za,N(r.group.description),1)):F("",!0)]),(f(!0),y(X,null,_e(r.group.subgroups,m=>(f(),y("section",{key:m.id,class:"subgroup"},[v("h3",ja,[(f(),z(Ee(s(c)(m)),{class:"ui-icon subgroup-icon"})),v("span",null,N(m.title),1)]),D(Ha,{items:m.items,"group-key":r.group.key,"subgroup-id":m.id},null,8,["items","group-key","subgroup-id"])]))),128))],2))}},Wa={class:"groups-grid"},Ja={key:0,class:"panel group-panel group-empty"},Ya={key:0,class:"panel group-panel group-empty"},Qa={__name:"ServicesGroupsPanel",setup(r){const a=ae(),{activePage:l,activePageGroupBlocks:u,filteredBlockGroups:c}=a,p=U(null);let g=null;const m={duration:180,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};function h(){if(!(!g||!p.value))for(const k of p.value.querySelectorAll(".block-wrap"))k.dataset.offscreen="0",g.observe(k)}return se(()=>{var k;return[(k=l.value)==null?void 0:k.id,u.value.length]},async()=>{g&&(g.disconnect(),await Be(),h())}),tt(async()=>{g=new IntersectionObserver(k=>{for(const E of k)E.target.dataset.offscreen=E.isIntersecting?"0":"1"},{root:null,rootMargin:"140px 0px",threshold:.02}),await Be(),h()}),nt(()=>{g==null||g.disconnect(),g=null}),(k,E)=>(f(),y("section",{ref_key:"blocksRootRef",ref:p,class:"page-stack"},[(f(!0),y(X,null,_e(s(u),(_,L)=>(f(),y("section",{key:`${s(l).id}:${L}:groups`,class:"block-wrap"},[Rn((f(),y("section",Wa,[(f(!0),y(X,null,_e(s(c)(_.group_ids),K=>(f(),z(qa,{key:K.key,group:K},null,8,["group"]))),128)),s(c)(_.group_ids).length?F("",!0):(f(),y("article",Ja,[...E[0]||(E[0]=[v("h2",null,"Нет данных для выбранного узла",-1),v("p",{class:"subtitle"},"Выберите другую ветку в боковом дереве.",-1)])]))])),[[s(Qr),m]])]))),128)),s(u).length?F("",!0):(f(),y("article",Ya,[...E[1]||(E[1]=[v("h2",null,"Для этой страницы нет групп",-1),v("p",{class:"subtitle"},"Откройте нужный индикатор в аккордеоне слева.",-1)])]))],512))}},Za={key:0,class:"hero-logo-square","aria-hidden":"true"},Xa=["src"],el=["title","aria-label","aria-selected","onClick"],tl={class:"hero-page-tab-label"},nl={__name:"HeroPageTabs",setup(r){let a=!1;const l=ae(),{EMBLEM_SRC:u,isSidebarHidden:c,pages:p,activePage:g,activePageId:m,resolvePageIcon:h}=l,k=U(!a),E=T(()=>c.value);let _=0;return tt(()=>{k.value&&(_=globalThis.setTimeout(()=>{k.value=!1,a=!0},700))}),nt(()=>{_&&(globalThis.clearTimeout(_),_=0),k.value&&(a=!0)}),(L,K)=>(f(),y("nav",{class:j(["hero-page-tabs",{"hero-page-tabs--intro":k.value,"has-logo-tile":E.value}]),role:"tablist","aria-label":"Разделы"},[E.value?(f(),y("div",Za,[v("img",{src:s(u),alt:""},null,8,Xa)])):F("",!0),(f(!0),y(X,null,_e(s(p),V=>{var W,C,G;return f(),y("button",{key:V.id,class:j(["hero-page-tab-btn",{active:((W=s(g))==null?void 0:W.id)===V.id,"hero-page-tab-btn--intro-active":k.value&&((C=s(g))==null?void 0:C.id)===V.id}]),type:"button",role:"tab",title:V.title,"aria-label":V.title,"aria-selected":((G=s(g))==null?void 0:G.id)===V.id,onClick:q=>m.value=V.id},[(f(),z(Ee(s(h)(V)),{class:"ui-icon hero-page-tab-icon"})),v("span",tl,N(V.title),1)],10,el)}),128))],2))}},rl={class:"hero-layout"},ol={class:"hero panel hero-title-panel"},il={class:"hero-title-content"},sl={class:"hero-controls-content"},al={key:0,id:"hero-controls-drawer",class:"hero-controls-drawer"},ll=["title","aria-label"],ul=["aria-expanded","title"],cl={key:0,class:"editor-error hero-editor-error"},Yr="oko:hero-controls-open:v1",dl={__name:"ServicesHeroPanel",setup(r){const a=ae(),l=U(!1),{editMode:u,isSidebarDetailed:c,saveStatus:p,saveStatusLabel:g,saveError:m,sidebarViewToggleTitle:h,toggleEditMode:k,addGroup:E,openCommandPalette:_,openSettingsPanel:L,toggleSidebarView:K}=a;function V(){try{return window.localStorage||null}catch{return null}}return tt(()=>{const W=V();if(!W)return;const C=W.getItem(Yr);l.value=C==="1"}),se(()=>l.value,W=>{const C=V();C&&C.setItem(Yr,W?"1":"0")}),(W,C)=>(f(),y("section",rl,[v("header",ol,[C[1]||(C[1]=v("div",{id:"hero-title-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),v("div",il,[D(nl)])]),v("aside",{class:j(["panel hero-control-panel service-hero-controls",{active:s(u)}])},[C[2]||(C[2]=v("div",{id:"hero-controls-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),v("div",sl,[v("div",{class:j(["hero-controls-accordion",{open:l.value}])},[D(ms,{name:"hero-controls-drawer-transition"},{default:ve(()=>[l.value?(f(),y("div",al,[D(we,{"button-class":"hero-icon-btn hero-accordion-action editor-toggle",active:s(u),title:s(u)?"Выключить режим редактирования":"Включить режим редактирования","aria-label":s(u)?"Выключить режим редактирования":"Включить режим редактирования",onClick:s(k)},{default:ve(()=>[D(s(Nn),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),s(u)?(f(),z(we,{key:0,"button-class":"hero-icon-btn hero-accordion-action",title:"Добавить группу","aria-label":"Добавить группу",onClick:s(E)},{default:ve(()=>[D(s(Gn),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"])):F("",!0),D(we,{"button-class":"hero-icon-btn hero-accordion-action",title:"Быстрый поиск сервисов (Ctrl/Cmd+K)","aria-label":"Быстрый поиск сервисов",onClick:s(_)},{default:ve(()=>[D(s(Ws),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"]),D(we,{"button-class":"hero-icon-btn hero-accordion-action",title:"Панель настроек","aria-label":"Открыть панель настроек",onClick:s(L)},{default:ve(()=>[D(s(Js),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"]),D(we,{"button-class":"hero-icon-btn hero-accordion-action",active:!s(c),title:s(h),"aria-label":s(h),onClick:s(K)},{default:ve(()=>[D(s(ao),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),s(u)?(f(),y("span",{key:1,class:j(["hero-save-indicator hero-accordion-status",s(p)]),role:"status",title:s(g),"aria-label":s(g)},[D(s(Ys),{class:"ui-icon hero-save-icon"})],10,ll)):F("",!0)])):F("",!0)]),_:1}),v("button",{class:"hero-controls-trigger",type:"button","aria-expanded":l.value,"aria-controls":"hero-controls-drawer",title:l.value?"Скрыть панель действий":"Показать панель действий",onClick:C[0]||(C[0]=G=>l.value=!l.value)},[D(s(io),{class:"ui-icon hero-action-icon"}),D(s(Qs),{class:j(["ui-icon hero-accordion-caret",{open:l.value}])},null,8,["class"])],8,ul)],2),s(u)&&s(m)?(f(),y("p",cl,N(s(m)),1)):F("",!0)])],2)]))}},fl={key:0,class:"panel status-panel"},pl={key:1,class:"panel status-panel error-state"},gl={class:"subtitle"},ml={key:3,class:"panel status-panel"},vl={__name:"DashboardMainView",setup(r){const a=He(()=>Ie(()=>import("./IndicatorTabPanel-BmncPgs0.js"),__vite__mapDeps([0,1,2]))),l=He(()=>Ie(()=>import("./LanPageView-CjoJt7tF.js"),__vite__mapDeps([3,1,2]))),u=ae(),{activePage:c,activeIndicatorWidget:p,loadingConfig:g,configError:m,isLanPage:h,loadConfig:k}=u;return(E,_)=>{var L;return f(),y("main",{key:((L=s(c))==null?void 0:L.id)||"empty",class:j(["page",{"indicator-open":!!s(p),"page--lan":s(h)&&!s(p)}])},[s(g)?(f(),y("section",fl,[..._[1]||(_[1]=[v("h2",null,"Загрузка конфигурации...",-1),v("p",{class:"subtitle"},"Получаем dashboard-модель из backend.",-1)])])):s(m)?(f(),y("section",pl,[_[2]||(_[2]=v("h2",null,"Ошибка загрузки конфигурации",-1)),v("p",gl,N(s(m)),1),v("button",{class:"ghost",type:"button",onClick:_[0]||(_[0]=(...K)=>s(k)&&s(k)(...K))},"Повторить")])):s(c)?(f(),y(X,{key:2},[s(p)?(f(),z(s(a),{key:0})):(f(),y(X,{key:1},[s(h)?(f(),z(s(l),{key:0})):(f(),y(X,{key:1},[D(dl),D(Qa)],64))],64))],64)):(f(),y("section",ml,[..._[3]||(_[3]=[v("h2",null,"Нет доступных страниц",-1),v("p",{class:"subtitle"},"Проверьте `layout.pages` в `dashboard.yaml`.",-1)])]))],2)}}},bl={class:"brand"},yl=["src"],hl={class:"brand-title"},Il={class:"brand-subtitle"},wl={__name:"SidebarHeaderTabs",setup(r){const a=ae(),{EMBLEM_SRC:l,appTitle:u,appTagline:c}=a;return(p,g)=>(f(),y("div",bl,[v("img",{src:s(l),alt:"Oko"},null,8,yl),v("div",null,[v("p",hl,N(s(u)),1),v("p",Il,N(s(c)),1)])]))}},_l={class:"sidebar-stats-accordion","aria-label":"Индикаторы"},Sl=["aria-expanded"],kl={class:"sidebar-stats-toggle-values"},El={key:0,class:"sidebar-indicators"},Tl=["onClick"],Cl={class:"widget-head sidebar-indicator-head"},$l={class:"widget-title"},Pl={class:"item-type"},Ll={key:0,class:"widget-error"},Al={key:1,class:"widget-loading"},xl={class:"widget-value sidebar-indicator-value"},Dl={class:"widget-subtitle"},Ml={key:0,class:"widget-trend"},Rl={key:0,class:"widget-list sidebar-list-preview"},Bl={key:1,class:"widget-empty"},Ol={class:"widget-subtitle"},Nl={key:5,class:"widget-empty"},Gl={key:6,class:"widget-actions sidebar-indicator-actions"},Ul=["onClick"],Vl=["disabled","onClick"],Hl={key:1,class:"widget-empty"},Kl={__name:"SidebarIndicatorsAccordion",setup(r){const a=ae(),{statsExpanded:l,sidebarIndicatorSummary:u,sidebarIndicators:c,isLargeIndicator:p,activeIndicatorWidget:g,selectSidebarIndicator:m,resolveWidgetIcon:h,widgetState:k,statCardValue:E,statCardSubtitle:_,statCardTrend:L,indicatorPreviewEntries:K,tableRows:V,openIndicatorView:W,isActionBusy:C,runWidgetAction:G}=a;return(q,O)=>(f(),y("div",_l,[v("button",{class:"sidebar-stats-toggle",type:"button","aria-controls":"sidebar-stats-panel","aria-expanded":s(l),onClick:O[0]||(O[0]=R=>l.value=!s(l))},[O[1]||(O[1]=v("span",{class:"sidebar-stats-toggle-text"},"Индикаторы",-1)),v("span",kl,N(s(u)),1),v("span",{class:j(["sidebar-stats-toggle-caret",{open:s(l)}])},"▴",2)],8,Sl),v("div",{id:"sidebar-stats-panel",class:j(["sidebar-stats-panel",{open:s(l)}])},[s(c).length?(f(),y("div",El,[(f(!0),y(X,null,_e(s(c),R=>{var Pe,Te,Ce,le,ue;return f(),y("article",{key:R.id,class:j(["sidebar-indicator",{interactive:s(p)(R),active:((Pe=s(g))==null?void 0:Pe.id)===R.id}]),onClick:I=>s(m)(R)},[v("header",Cl,[v("div",$l,[(f(),z(Ee(s(h)(R)),{class:"ui-icon widget-icon"})),v("h3",null,N(R.title),1)]),v("span",Pl,N(R.type),1)]),(Te=s(k)(R.id))!=null&&Te.error?(f(),y("p",Ll,N((Ce=s(k)(R.id))==null?void 0:Ce.error),1)):(le=s(k)(R.id))!=null&&le.loading?(f(),y("p",Al,"Обновление...")):R.type==="stat_card"?(f(),y(X,{key:2},[v("p",xl,N(s(E)(R)),1),v("p",Dl,N(s(_)(R)),1),s(L)(R)?(f(),y("p",Ml,N(s(L)(R)),1)):F("",!0)],64)):R.type==="stat_list"?(f(),y(X,{key:3},[s(K)(R).length?(f(),y("ul",Rl,[(f(!0),y(X,null,_e(s(K)(R),I=>(f(),y("li",{key:I.title+I.value},[v("span",null,N(I.title),1),v("strong",null,N(I.value),1)]))),128))])):(f(),y("p",Bl,"Нет данных")),O[2]||(O[2]=v("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):R.type==="table"?(f(),y(X,{key:4},[v("p",Ol,"Строк: "+N(s(V)(R).length),1),O[3]||(O[3]=v("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):(f(),y("p",Nl,"Неподдерживаемый тип виджета")),(ue=R.data.actions)!=null&&ue.length||s(p)(R)?(f(),y("div",Gl,[s(p)(R)?(f(),y("button",{key:0,class:"ghost",type:"button",onClick:J(I=>s(W)(R.id),["stop"])},"Открыть вкладку",8,Ul)):F("",!0),(f(!0),y(X,null,_e(R.data.actions||[],I=>(f(),y("button",{key:I.id,class:"ghost",type:"button",disabled:s(C)(R.id,I.id),onClick:J(ce=>s(G)(R.id,I),["stop"])},N(I.title),9,Vl))),128))])):F("",!0)],10,Tl)}),128))])):(f(),y("p",Hl,"Для выбранной страницы индикаторы не настроены."))],2)]))}},Fl=["draggable"],zl={class:"tree-node-row"},jl={class:"tree-text"},ql={class:"tree-meta"},Wl={key:0,class:"tree-inline-actions"},Jl={__name:"SidebarTreeSubgroupNode",props:{group:{type:Object,required:!0},subgroup:{type:Object,required:!0}},setup(r){const a=ae(),{dragState:l,editMode:u,onSubgroupDragStart:c,clearDragState:p,onSubgroupDragOver:g,onSubgroupDrop:m,isSubgroupSelected:h,selectSubgroupNode:k,resolveSubgroupIcon:E,subgroupTotalItems:_,editSubgroup:L,addItem:K,removeSubgroup:V}=a;return(W,C)=>(f(),y("li",{class:j(["tree-subgroup-item",{dragging:s(l).type==="subgroup"&&s(l).subgroupId===r.subgroup.id}]),draggable:s(u),onDragstart:C[4]||(C[4]=J(G=>s(c)(G,r.group.id,r.subgroup.id),["stop"])),onDragend:C[5]||(C[5]=J((...G)=>s(p)&&s(p)(...G),["stop"])),onDragover:C[6]||(C[6]=J(G=>s(g)(G,r.group.id,r.subgroup.id),["stop"])),onDrop:C[7]||(C[7]=J(G=>s(m)(G,r.group.id,r.subgroup.id),["stop"]))},[v("div",zl,[v("button",{class:j(["tree-node tree-subgroup",{active:s(h)(r.group.key,r.subgroup.id)}]),type:"button",onClick:C[0]||(C[0]=G=>s(k)(r.group.key,r.subgroup.id))},[(f(),z(Ee(s(E)(r.subgroup)),{class:"ui-icon tree-icon tree-sub-icon"})),v("span",jl,N(r.subgroup.title),1),v("span",ql,N(s(_)(r.subgroup)),1)],2),s(u)?(f(),y("div",Wl,[D(s(lo),{class:"ui-icon tree-grip"}),v("button",{class:"tree-mini-btn",type:"button",title:"Редактировать подгруппу",onClick:C[1]||(C[1]=J(G=>s(L)(r.group.id,r.subgroup.id),["stop"]))},[D(s(Nn),{class:"ui-icon"})]),v("button",{class:"tree-mini-btn",type:"button",title:"Добавить элемент",onClick:C[2]||(C[2]=J(G=>s(K)(r.group.id,r.subgroup.id),["stop"]))},[D(s(Gn),{class:"ui-icon"})]),v("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить подгруппу",onClick:C[3]||(C[3]=J(G=>s(V)(r.group.id,r.subgroup.id),["stop"]))},[D(s(uo),{class:"ui-icon"})])])):F("",!0)])],42,Fl))}},Yl=["draggable"],Ql={class:"tree-node-row"},Zl={class:"tree-text"},Xl={class:"tree-meta"},eu={key:0,class:"tree-inline-actions"},tu={class:"tree-subgroups"},nu={__name:"SidebarTreeGroupNode",props:{group:{type:Object,required:!0}},setup(r){const a=ae(),{dragState:l,editMode:u,isDirectGroupNode:c,onGroupDragStart:p,clearDragState:g,onGroupDragOver:m,onGroupDrop:h,isGroupSelected:k,toggleGroupNode:E,isGroupExpanded:_,resolveGroupIcon:L,groupTotalItems:K,editGroup:V,addSubgroup:W,removeGroup:C}=a;return(G,q)=>(f(),y("li",{class:j(["tree-group-item",{dragging:s(l).type==="group"&&s(l).groupId===r.group.id&&s(c)(r.group)}]),draggable:s(u)&&s(c)(r.group),onDragstart:q[4]||(q[4]=J(O=>s(p)(O,r.group),["stop"])),onDragend:q[5]||(q[5]=J((...O)=>s(g)&&s(g)(...O),["stop"])),onDragover:q[6]||(q[6]=J(O=>s(m)(O,r.group),["stop"])),onDrop:q[7]||(q[7]=J(O=>s(h)(O,r.group),["stop"]))},[v("div",Ql,[v("button",{class:j(["tree-node tree-group",{active:s(k)(r.group.key)}]),type:"button",onClick:q[0]||(q[0]=O=>s(E)(r.group.key))},[v("span",{class:j(["tree-caret",{open:s(_)(r.group.key)}])},"▾",2),(f(),z(Ee(s(L)(r.group)),{class:"ui-icon tree-icon"})),v("span",Zl,N(r.group.title),1),v("span",Xl,N(s(K)(r.group)),1)],2),s(u)&&s(c)(r.group)?(f(),y("div",eu,[D(s(lo),{class:"ui-icon tree-grip"}),v("button",{class:"tree-mini-btn",type:"button",title:"Редактировать группу",onClick:q[1]||(q[1]=J(O=>s(V)(r.group.id),["stop"]))},[D(s(Nn),{class:"ui-icon"})]),v("button",{class:"tree-mini-btn",type:"button",title:"Добавить подгруппу",onClick:q[2]||(q[2]=J(O=>s(W)(r.group.id),["stop"]))},[D(s(Gn),{class:"ui-icon"})]),v("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить группу",onClick:q[3]||(q[3]=J(O=>s(C)(r.group.id),["stop"]))},[D(s(uo),{class:"ui-icon"})])])):F("",!0)]),Rn(v("ul",tu,[(f(!0),y(X,null,_e(r.group.subgroups,O=>(f(),z(Jl,{key:O.id,group:r.group,subgroup:O},null,8,["group","subgroup"]))),128))],512),[[vs,s(_)(r.group.key)]])],42,Yl))}},ru={key:0,class:"sidebar-tree","aria-label":"Дерево сервисов"},ou={key:0,class:"tree-root"},iu={key:1,class:"tree-empty"},su={__name:"SidebarTreePanel",setup(r){const a=ae(),{treeGroups:l,filteredTreeGroups:u}=a,c={duration:160,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};return(p,g)=>s(l).length?(f(),y("section",ru,[s(u).length?Rn((f(),y("ul",ou,[(f(!0),y(X,null,_e(s(u),m=>(f(),z(nu,{key:m.key,group:m},null,8,["group"]))),128))])),[[s(Qr),c]]):(f(),y("p",iu,"По вашему запросу ничего не найдено."))])):F("",!0)}},au={class:"sidebar"},lu={class:"sidebar-content"},uu={__name:"DashboardSidebarView",setup(r){const a=ae(),{isSidebarDetailed:l}=a;return(u,c)=>(f(),y("aside",au,[c[0]||(c[0]=v("div",{id:"sidebar-particles",class:"sidebar-particles","aria-hidden":"true"},null,-1)),v("div",lu,[D(wl),s(l)?(f(),z(su,{key:0})):F("",!0),s(l)?(f(),z(Kl,{key:1})):F("",!0)])]))}},cu=["src"],du={__name:"App",setup(r){const a=()=>Ie(()=>import("./LanHostModal-z0QYXnEF.js"),__vite__mapDeps([4,1,5,2])),l=()=>Ie(()=>import("./IframeModal-CA0N5uGI.js"),__vite__mapDeps([6,5,1,2])),u=()=>Ie(()=>import("./ItemEditorModal-DhbfMtwO.js"),__vite__mapDeps([7,1,5,2])),c=()=>Ie(()=>import("./DashboardSettingsModal-BRx5VxUs.js"),__vite__mapDeps([8,1,5,2])),p=()=>Ie(()=>import("./CommandPaletteModal-CxwOh9G_.js"),__vite__mapDeps([9,1,5,2])),g=()=>Ie(()=>import("./IndicatorTabPanel-BmncPgs0.js"),__vite__mapDeps([0,1,2])),m=()=>Ie(()=>import("./LanPageView-CjoJt7tF.js"),__vite__mapDeps([3,1,2])),h=He(a),k=He(l),E=He(u),_=He(c),L=He(p),K=ae(),{EMBLEM_SRC:V,closeCommandPalette:W,closeSettingsPanel:C,commandPaletteOpen:G,iframeModal:q,isSidebarHidden:O,itemEditor:R,lanHostModal:Pe,openSettingsPanel:Te,settingsPanel:Ce,toggleCommandPalette:le}=K,ue=U(!1);let I=0,ce=0,de=0;function Y(){Promise.allSettled([a(),l(),u(),c(),p(),g(),m()])}function fe(){if("requestIdleCallback"in window){de=window.requestIdleCallback(()=>{de=0,Y()},{timeout:2e3});return}ce=window.setTimeout(()=>{ce=0,Y()},1400)}function re(P){if((P.metaKey||P.ctrlKey)&&!P.altKey&&!P.shiftKey&&P.key.toLowerCase()==="k"){P.preventDefault(),le();return}if(P.key==="Escape"&&G.value){P.preventDefault(),W();return}P.key==="Escape"&&Ce.open&&(P.preventDefault(),C())}function Q(P){var ne;const oe=String(((ne=P==null?void 0:P.detail)==null?void 0:ne.action)||"");if(oe){if(oe==="open-search"){le();return}oe==="open-settings"&&Te()}}return tt(()=>{I=globalThis.setTimeout(()=>{ue.value=!0},1e3),window.addEventListener("keydown",re),window.addEventListener("oko:desktop-action",Q),fe()}),nt(()=>{I&&(globalThis.clearTimeout(I),I=0),ce&&(window.clearTimeout(ce),ce=0),de&&"cancelIdleCallback"in window&&(window.cancelIdleCallback(de),de=0),window.removeEventListener("keydown",re),window.removeEventListener("oko:desktop-action",Q)}),(P,oe)=>(f(),y("div",{class:j(["shell",{"shell-motion-static":ue.value}])},[v("img",{class:"center-emblem",src:s(V),alt:"","aria-hidden":"true"},null,8,cu),v("div",{class:j(["app-shell",{"sidebar-hidden":s(O)}])},[s(O)?F("",!0):(f(),z(uu,{key:0})),D(vl)],2),s(Pe).open?(f(),z(s(h),{key:0})):F("",!0),s(q).open?(f(),z(s(k),{key:1})):F("",!0),s(R).open?(f(),z(s(E),{key:2})):F("",!0),s(Ce).open?(f(),z(s(_),{key:3})):F("",!0),s(G)?(f(),z(s(L),{key:4})):F("",!0)],2))}},Xe="http://127.0.0.1:8090";let Fe={desktop:!1,mode:"web",apiBaseUrl:"",remoteBaseUrl:Xe,embeddedRunning:!1},qt=null,Ct=null;function fu(){return typeof window<"u"&&!!window.__TAURI_INTERNALS__}function Mn(r){const a=String(r||"").trim();return a?a.endsWith("/")?a.slice(0,-1):a:""}function $t(r){const a=r,l={desktop:!!(a!=null&&a.desktop),mode:String((a==null?void 0:a.mode)||"web"),apiBaseUrl:Mn(a==null?void 0:a.apiBaseUrl),remoteBaseUrl:Mn(a==null?void 0:a.remoteBaseUrl)||Xe,embeddedRunning:!!(a!=null&&a.embeddedRunning)};return Fe=l,typeof window<"u"&&(window.__OKO_API_BASE__=l.apiBaseUrl||"",window.__OKO_DESKTOP_RUNTIME__=l,window.dispatchEvent(new CustomEvent("oko:api-base-change",{detail:{apiBaseUrl:l.apiBaseUrl}}))),l}function pu(r){typeof window>"u"||window.dispatchEvent(new CustomEvent("oko:desktop-action",{detail:{action:String(r||"")}}))}async function gu(){const[r,a]=await Promise.all([Ie(()=>import("./vendor-D1bzbGly.js").then(u=>u.J),[]),Ie(()=>import("./vendor-D1bzbGly.js").then(u=>u.K),[])]);Ct=r.invoke;const l=await Ct("desktop_get_runtime_profile");return $t(l),await a.listen("desktop://runtime-profile",u=>{$t(u.payload)}),await a.listen("desktop://action",u=>{pu(u.payload)}),Fe}function _u(){return{...Fe}}async function go(){return fu()?(qt||(qt=gu().catch(r=>(qt=null,$t({desktop:!0,mode:"remote",apiBaseUrl:Xe,remoteBaseUrl:Xe,embeddedRunning:!1}),Fe))),qt):($t({desktop:!1,mode:"web",apiBaseUrl:"",remoteBaseUrl:Xe,embeddedRunning:!1}),Fe)}async function Su(r){if(!Ct&&(!(await go()).desktop||!Ct))throw new Error("Desktop runtime bridge is not available");const a={mode:String((r==null?void 0:r.mode)||Fe.mode),remote_base_url:Mn((r==null?void 0:r.remoteBaseUrl)||Fe.remoteBaseUrl||Xe)},l=await Ct("desktop_set_runtime_profile",a);return $t(l)}async function mu(r){}function vu(){var u,c,p,g;if((c=(u=globalThis.matchMedia)==null?void 0:u.call(globalThis,"(prefers-reduced-motion: reduce)"))==null?void 0:c.matches)return"off";const a=Number(((p=globalThis.navigator)==null?void 0:p.hardwareConcurrency)||8),l=Number(((g=globalThis.navigator)==null?void 0:g.deviceMemory)||8);return a<=4||l<=4?"lite":"full"}function bu(r){const a=document.documentElement,l=a.dataset.fxMode||"";a.dataset.fxMode=r,r==="off"?a.style.setProperty("--glow-enabled","0"):r==="lite"?a.style.setProperty("--glow-enabled","0.58"):a.style.setProperty("--glow-enabled","1"),l&&l!==r&&window.dispatchEvent(new CustomEvent("oko:fx-mode-change",{detail:{mode:r,previousMode:l}}))}function yu(){var l;const r=(l=globalThis.matchMedia)==null?void 0:l.call(globalThis,"(prefers-reduced-motion: reduce)"),a=()=>bu(vu());a(),r!=null&&r.addEventListener?r.addEventListener("change",a):r!=null&&r.addListener&&r.addListener(a)}yu();mu();async function hu(){await go(),bs(du).use(ys).mount("#app")}hu();export{nl as _,we as a,_u as g,go as i,Su as s,ae as u};
