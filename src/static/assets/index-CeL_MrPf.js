const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/IndicatorTabPanel-DibL6FeL.js","assets/vendor-D1bzbGly.js","assets/vendor-icons-Cq_RiAeh.js","assets/LanPageView-DS-gFTee.js","assets/LanHostModal-CP-e6s7H.js","assets/BaseModal-DEo4-NpV.js","assets/IframeModal-BkxdZbhd.js","assets/ItemEditorModal-CP_N9HVg.js","assets/DashboardSettingsModal-By-bge4g.js","assets/CommandPaletteModal-D6hucNtL.js"])))=>i.map(i=>d[i]);
import{o as f,c as b,r as Is,n as j,h as Or,w as de,a as Ge,b as it,d as st,e as U,f as Ie,g as C,u as s,i as z,j as $e,k as m,F as X,t as O,l as V,m as _e,p as A,q as he,s as Y,v as ws,x as Zt,T as Ss,y as Vn,z as oo,A as _s,B as ze,C as ks,D as Es,M as Cs}from"./vendor-D1bzbGly.js";import{s as Nr,a as Gr,b as $s,c as Ts,d as Ur,e as Ps,f as Mn,g as Ls,h as Hr,i as Vr,j as Fr,k as Et,l as xs,m as Kr,n as As,o as Ms,p as zr,q as Rs,r as Ds,t as Rn,H as Tt,N as Xt,S as je,F as io,C as so,u as ao,T as Nn,v as lo,w as uo,D as Gn,x as Bs,y as Os,W as Ns,A as Gs,E as Us,z as Hs,M as jr,P as Vs,B as co,G as Fn,L as Kn,I as Fs,K as Ks,J as zs,O as Wr,Q as fo,R as qr,U as Jr,V as js,X as Ws,Y as qs,Z as Js,_ as Dn,$ as po,a0 as Ys,a1 as go,a2 as Qs,a3 as Zs,a4 as mo,a5 as Xs,a6 as ea,a7 as ta,a8 as zn,a9 as jn,aa as na,ab as ra,ac as oa,ad as ia,ae as vo,af as ho}from"./vendor-icons-Cq_RiAeh.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))c(u);new MutationObserver(u=>{for(const p of u)if(p.type==="childList")for(const g of p.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&c(g)}).observe(document,{childList:!0,subtree:!0});function l(u){const p={};return u.integrity&&(p.integrity=u.integrity),u.referrerPolicy&&(p.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?p.credentials="include":u.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function c(u){if(u.ep)return;u.ep=!0;const p=l(u);fetch(u.href,p)}})();const sa="modulepreload",aa=function(r){return"/static/"+r},Yr={},we=function(a,l,c){let u=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),h=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));u=Promise.allSettled(l.map(y=>{if(y=aa(y),y in Yr)return;Yr[y]=!0;const I=y.endsWith(".css"),k=I?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${y}"]${k}`))return;const S=document.createElement("link");if(S.rel=I?"stylesheet":sa,I||(S.as="script"),S.crossOrigin="",S.href=y,h&&S.setAttribute("nonce",h),document.head.appendChild(S),I)return new Promise((R,F)=>{S.addEventListener("load",R),S.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${y}`)))})}))}function p(g){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=g,window.dispatchEvent(h),!h.defaultPrevented)throw g}return u.then(g=>{for(const h of g||[])h.status==="rejected"&&p(h.reason);return a().catch(p)})},la=["type","title","aria-label","disabled"],Se={__name:"IconButton",props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"button"},title:{type:String,default:""},ariaLabel:{type:String,default:""},buttonClass:{type:String,default:""}},emits:["click"],setup(r){return(a,l)=>(f(),b("button",{class:j(["ghost icon-btn",[r.buttonClass,{active:r.active}]]),type:r.type,title:r.title,"aria-label":r.ariaLabel||r.title,disabled:r.disabled,onClick:l[0]||(l[0]=c=>a.$emit("click",c))},[Is(a.$slots,"default")],10,la))}};function rn(r){const a=String(r||"");if(!a||/^https?:\/\//i.test(a))return a;const l=typeof window>"u"?"":String(window.__OKO_API_BASE__||"").trim();if(!l)return a;const c=l.endsWith("/")?l.slice(0,-1):l,u=a.startsWith("/")?a:`/${a}`;return`${c}${u}`}function ua(r,a,l){const c=a&&typeof r=="object"&&r!==null?r.detail:null;let u=`Request failed: ${l}`;return Array.isArray(c)?u=c.map(p=>typeof p=="object"&&p!==null&&"message"in p?String(p.message||""):JSON.stringify(p)).join("; "):typeof c=="string"&&c?u=c:typeof r=="string"&&r&&(u=r),u}async function Pe(r,a={}){const{headers:l={},...c}=a,u={};if(l instanceof Headers)l.forEach((k,S)=>{u[S]=k});else if(Array.isArray(l))for(const[k,S]of l)u[k]=String(S);else Object.assign(u,l);const p={Accept:"application/json",...u},g=await fetch(rn(r),{credentials:"include",headers:p,...c}),y=(g.headers.get("content-type")||"").includes("application/json"),I=y?await g.json():await g.text();if(!g.ok){const S=new Error(ua(I,y,g.status));throw S.status=g.status,S.body=I,S}return I}const Le="/api/v1/dashboard";function ca(){return Pe(`${Le}/config`)}async function Pu(){const r=await fetch(rn(`${Le}/config/backup`),{credentials:"include",headers:{Accept:"application/x-yaml, text/yaml, text/plain, */*"}}),a=await r.text();if(!r.ok)throw new Error(a||`Request failed: ${r.status}`);const c=String(r.headers.get("content-disposition")||"").match(/filename="?([^";]+)"?/i),u=`dashboard-backup-${new Date().toISOString().slice(0,19).replaceAll(":","-")}.yaml`;return{yaml:a,filename:(c==null?void 0:c[1])||u}}function da(r){return Pe(`${Le}/iframe/${encodeURIComponent(r)}/source`).then(a=>{if(!a||typeof a!="object")return a;const l=a;return typeof l.src!="string"?a:{...a,src:rn(l.src)}})}function fa(r=[]){const a=new URLSearchParams;for(const c of r)a.append("item_id",c);const l=a.toString();return Pe(`${Le}/health${l?`?${l}`:""}`)}function pa(r=[]){if(typeof EventSource>"u")return null;const a=new URLSearchParams;for(const u of r)a.append("item_id",u);const l=a.toString(),c=`${Le}/health/stream${l?`?${l}`:""}`;return new EventSource(rn(c),{withCredentials:!0})}function ga(r){return Pe(`${Le}/config`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}function Lu(r){return Pe(`${Le}/config/restore`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({yaml:String(r||"")})})}function ma(){return Pe(`${Le}/lan/state`)}function va(){return Pe(`${Le}/lan/run`,{method:"POST"})}const Bn="oko-particles-js",ha="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js",ba=7e3;let Ct=null;function Un(){return typeof window.particlesJS=="function"}function ya(r){return new Promise(a=>{let l=!1;const c=p=>{l||(l=!0,a(p))},u=window.setTimeout(()=>{c(Un())},ba);r.addEventListener("load",()=>{window.clearTimeout(u),c(Un())},{once:!0}),r.addEventListener("error",()=>{window.clearTimeout(u),c(!1)},{once:!0})})}async function Ia(){return typeof window>"u"||typeof document>"u"?!1:Un()?!0:Ct||(Ct=(async()=>{let r=document.getElementById(Bn)instanceof HTMLScriptElement?document.getElementById(Bn):null;r||(r=document.createElement("script"),r.id=Bn,r.src=ha,r.async=!0,r.defer=!0,document.head.appendChild(r));const a=await ya(r);return a||(Ct=null),a})(),Ct)}function x(r){const a=`#${r.hex}`;return(l,{attrs:c})=>Or("svg",{...c,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",role:"img","aria-hidden":"true",style:c.style?[c.style,{color:a}]:{color:a}},[Or("path",{d:r.path})])}const en={homeassistant:x(Rn),"home-assistant":x(Rn),ha:x(Rn),openwrt:x(Ds),adguard:x(Rs),proxmox:x(zr),pve:x(zr),grafana:x(Ms),gitea:x(As),jellyfin:x(Kr),jellyseerr:x(Kr),sonarr:x(Et),radarr:x(xs),lidarr:x(Et),readarr:x(Et),bazarr:x(Et),prowlarr:x(Et),qbittorrent:x(Fr),qb:x(Fr),postgres:x(Vr),postgresql:x(Vr),docker:x(Hr),dockge:x(Hr),cockpit:x(Ls),npm:x(Mn),nginxproxymanager:x(Mn),"nginx-proxy-manager":x(Mn),nginx:x(Ps),openai:x(Ur),ai:x(Ur),portainer:x(Ts),ytsync:x(Gr),youtube:x($s),youtubeshorts:x(Gr),termius:x(Nr),termix:x(Nr)},tn={home:Tt,house:Tt,дом:Tt,dom:Tt,route:Qs,net:Xt,network:Xt,сеть:Xt,dashboard:go,infra:je,infrastructure:je,инфраструктура:je,server:je,core:Ys,ops:po,media:Dn,медиа:Dn,tv:Dn,iot:so,cloud:Js,wifi:qs,monitor:Ws,cockpit:js,proxmox:je,grafana:ao,gitea:Jr,git:Jr,jellyfin:io,navidrome:jr,tunnel:qr,tunnels:qr,stats:fo,services:Wr,service:Wr,health:lo,alerts:Nn,alert:Nn,security:uo,auth:zs,key:Ks,db:Gn,database:Gn,storage:Fs,link:Kn,iframe:Fn,terminal:co,package:Vs,music:jr,camera:Hs,eye:Us,observability:Gs,workflow:Ns,settings:Os,spark:Bs},bo=[{re:/\b(home|house|dom|дом)\b/,icon:Tt},{re:/\b(net|network|route|vpn|edge|сеть|маршрут|туннел)\b/,icon:Xt},{re:/\b(infra|server|cluster|pve|проксмокс|инфраструктур)\b/,icon:je},{re:/\b(media|tv|video|stream|jellyfin|медиа)\b/,icon:io},{re:/\b(iot|sensor|home-assistant|умн|дом)\b/,icon:so},{re:/\b(stat|metric|chart|grafana|аналит|monitor)\b/,icon:ao},{re:/\b(alert|error|warn|critical|ошиб|авар)\b/,icon:Nn},{re:/\b(health|status|pulse|heart|состояни)\b/,icon:lo},{re:/\b(auth|token|secret|lock|ключ|безопас)\b/,icon:uo},{re:/\b(db|database|postgres|mysql|redis)\b/,icon:Gn}],ot={page:go,group:mo,subgroup:Zs,itemLink:Kn,itemIframe:Fn,widget:fo};function yo(r){return String(r||"").toLowerCase().replace(/[^a-z0-9а-яё._-]+/gi," ").split(/[\s._-]+/).filter(Boolean)}function Io(r){if(en[r])return en[r];for(const[a,l]of Object.entries(en))if(r.includes(a))return l;if(tn[r])return tn[r];for(const[a,l]of Object.entries(tn))if(r.includes(a))return l;return null}function at(r,a){for(const c of r)for(const u of yo(c)){const p=Io(u);if(p)return p}const l=r.map(c=>String(c||"").toLowerCase()).filter(Boolean).join(" ");for(const c of bo)if(c.re.test(l))return c.icon;return a}function wa(r){return at([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],ot.page)}function Sa(r){return at([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.description],ot.group)}function _a(r){return at([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],ot.subgroup)}function ka(r){return at([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,r==null?void 0:r.url,...(r==null?void 0:r.tags)||[]],(r==null?void 0:r.type)==="iframe"?ot.itemIframe:ot.itemLink)}function Ea(r){var a;return at([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,(a=r==null?void 0:r.data)==null?void 0:a.endpoint],ot.widget)}function Pt(r,a="node"){return String(r||"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")||a}function Ke(r,a){const l=Pt(r,"node");let c=l,u=2;for(;a.has(c);)c=`${l}-${u}`,u+=1;return c}function nn(r){const a=new Set;for(const l of r.groups||[])for(const c of l.subgroups||[])a.add(c.id);return a}function qt(r){const a=new Set;for(const l of r.groups||[])for(const c of l.subgroups||[])for(const u of c.items||[])a.add(u.id);return a}function Ce(r,a){return(r.groups||[]).find(l=>l.id===a)||null}function ye(r,a,l){const c=Ce(r,a);return c&&(c.subgroups||[]).find(u=>u.id===l)||null}function Jt(r){return String((r==null?void 0:r.key)||"").startsWith("group:")}function Qr(r){var u,p;const a=new Set((r.groups||[]).map(g=>g.id)),l=nn(r),c=new Set([...a,...l]);for(const g of((u=r.layout)==null?void 0:u.pages)||[]){const h=[];for(const y of g.blocks||[]){if(y.type==="groups"){y.group_ids=(y.group_ids||[]).filter(I=>c.has(I)),y.group_ids.length&&h.push(y);continue}(y.widgets||[]).length&&h.push(y)}!h.length&&((p=r.groups)!=null&&p.length)&&h.push({type:"groups",group_ids:[r.groups[0].id]}),g.blocks=h}}function Zr(r,a,l){var g;const c=((g=r.layout)==null?void 0:g.pages)||[];if(!c.length)return;const u=c.find(h=>h.id===a)||c[0];let p=u.blocks.find(h=>h.type==="groups");if(!p){p={type:"groups",group_ids:[l]},u.blocks.push(p);return}p.group_ids.includes(l)||p.group_ids.push(l)}function Xr(r,a,l){const c=r.groups||[],u=c.findIndex(y=>y.id===a),p=c.findIndex(y=>y.id===l);if(u<0||p<0||u===p)return!1;const[g]=c.splice(u,1),h=u<p?p-1:p;return c.splice(h,0,g),!0}function eo(r,a,l,c,u){const p=Ce(r,a),g=Ce(r,c);if(!p||!g)return!1;const h=(p.subgroups||[]).findIndex(k=>k.id===l),y=(g.subgroups||[]).findIndex(k=>k.id===u);if(h<0||y<0)return!1;if(a!==c&&p.subgroups.length<=1)throw new Error("В исходной группе должна остаться минимум одна подгруппа.");const[I]=p.subgroups.splice(h,1);if(a===c){const k=h<y?y-1:y;return p.subgroups.splice(k,0,I),!0}return g.subgroups.splice(y,0,I),!0}function to(r,a,l,c,u,p,g){const h=ye(r,a,l),y=ye(r,u,p);if(!h||!y)return!1;const I=(h.items||[]).findIndex(R=>R.id===c),k=(y.items||[]).findIndex(R=>R.id===g);if(I<0||k<0)return!1;if(l!==p&&h.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[S]=h.items.splice(I,1);if(l===p){const R=I<k?k-1:k;return h.items.splice(R,0,S),!0}return y.items.splice(k,0,S),!0}function no(r,a,l,c,u,p){const g=ye(r,a,l),h=ye(r,u,p);if(!g||!h)return!1;const y=(g.items||[]).findIndex(k=>k.id===c);if(y<0)return!1;if(l!==p&&g.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[I]=g.items.splice(y,1);return h.items.push(I),!0}function Ca(r){const a=String(r||"").trim();if(!a)throw new Error("URL не может быть пустым");const l=/^https?:\/\//i.test(a)?a:`https://${a}`;let c;try{c=new URL(l)}catch{throw new Error(`Некорректный URL: ${a}`)}if(!["http:","https:"].includes(c.protocol))throw new Error(`Разрешены только http/https URL: ${a}`);return c.toString()}function $a(r){const a=String(r||"").trim();if(!a)return"";const l=/^https?:\/\//i.test(a)?a:`https://${a}`;try{const c=new URL(l);return["http:","https:"].includes(c.protocol)?c.origin:""}catch{return""}}let $t=null;function fe(){if($t)return $t;const r="/static/img/emblem-mark.png",a=3e4,l=16e3,c=9e3,u=3e3,p=700,g=1e4,h="lan",y=new Set(["stat_list","table"]),I="https://example.com",k="sidebar-particles",S="hero-title-particles",R="hero-controls-particles",F={fps_limit:58,particles:{number:{value:88,density:{enable:!0,value_area:700}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.36,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:120,color:"#2dd4bf",opacity:.24,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},N={fps_limit:58,particles:{number:{value:92,density:{enable:!0,value_area:720}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.4,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:132,color:"#2dd4bf",opacity:.26,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},J=Object.freeze([{value:"detailed",label:"Карточки"},{value:"tile",label:"Плитка"},{value:"icon",label:"Значки"}]),T=Object.freeze([{value:"groups",label:"Только группы"},{value:"tags_in_groups",label:"Группы + теги"},{value:"tags",label:"Только теги"},{value:"flat",label:"Без групп (плитка)"}]),D=["detailed","hidden"],W=18,G=10,M="oko:dashboard-ui-state:v1",xe=new Set(J.map(e=>e.value)),Ae=new Set(T.map(e=>e.value));function ke(){if(typeof window>"u")return null;try{return window.localStorage||null}catch{return null}}function pe(){const e=ke();if(!e)return null;try{const t=e.getItem(M);if(!t)return null;const n=JSON.parse(t);return n&&typeof n=="object"?n:null}catch{return null}}function Ee(e){const t=ke();if(t)try{t.setItem(M,JSON.stringify(e))}catch{}}function q(){return{id:"",title:"",type:"link",url:I,icon:"",siteInput:"",tagsInput:"",open:"new_tab",healthcheckEnabled:!1,healthcheckUrl:"",healthcheckIntervalSec:30,healthcheckTimeoutMs:1500,iframeSandboxMode:"default",iframeAllowInput:"",iframeReferrerPolicy:"",authProfile:""}}const E=U(null),se=U(!0),ae=U(""),Q=U(""),ee=U(""),le=U(!1),ue=U(""),P=U(!1),ie=U(typeof document>"u"?!0:document.visibilityState!=="hidden"),te=U("detailed"),B=U("groups"),ne=U("all"),K=U("detailed"),re=U("idle"),be=U(""),qe=U(null),on=U(!1),At=U(!1),lt=U(""),Mt=U(!1),ut=U(""),ge=U(0),Ue=Ie({open:!1}),ct=Ie({open:!1,host:null}),Me=Ie({}),Rt=Ie({}),Dt=new Map;let dt=0,Je=null,ft=0,He=0,pt=0,Bt=!1,sn=!1,Re=0;const w=Ie({groupKey:"",subgroupId:"",itemId:""}),ce=Ie({}),gt=Ie({}),L=Ie({type:"",groupId:"",subgroupId:"",itemId:""}),mt=Ie({}),me=pe();if(me){const e=String(me.serviceCardView||"");xe.has(e)&&(te.value=e);const t=String(me.serviceGroupingMode||"");Ae.has(t)&&(B.value=t);const n=String(me.sidebarView||"");D.includes(n)&&(K.value=n);const o=String(me.siteFilter||"").trim().toLowerCase();ne.value=o||"all",Q.value=String(me.activePageId||""),ee.value=String(me.treeFilter||""),ue.value=String(me.activeIndicatorViewId||""),le.value=!!me.statsExpanded,P.value=!!me.editMode,Ue.open=!!me.settingsPanelOpen;const i=me.selectedNode;i&&typeof i=="object"&&(w.groupKey=String(i.groupKey||""),w.subgroupId=String(i.subgroupId||""),w.itemId=String(i.itemId||""));const d=me.expandedGroups;if(d&&typeof d=="object")for(const[v,_]of Object.entries(d)){const H=String(v||"");H&&(ce[H]=!!_)}}const Z=Ie({open:!1,title:"",src:"",allow:"",sandbox:!1,referrerPolicy:"",loading:!1,error:""}),$=Ie({open:!1,mode:"create",groupId:"",subgroupId:"",originalItemId:"",submitting:!1,error:"",form:q()}),De=C(()=>{var t,n;if(!E.value)return[];const e=((n=(t=E.value)==null?void 0:t.layout)==null?void 0:n.pages)||[];return e.some(o=>o.id===h)?e:[...e,{id:h,title:"LAN",icon:"network",blocks:[]}]}),an=C(()=>{var e;return((e=E.value)==null?void 0:e.widgets)||[]}),Wn=C(()=>{var e,t;return((t=(e=E.value)==null?void 0:e.security)==null?void 0:t.auth_profiles)||[]}),_o=C(()=>{var e,t;return((t=(e=E.value)==null?void 0:e.app)==null?void 0:t.title)||"Oko"}),ko=C(()=>{var e,t;return((t=(e=E.value)==null?void 0:e.app)==null?void 0:t.tagline)||"Your Infrastructure in Sight"}),Eo=C(()=>J),Co=C(()=>T),qn=C(()=>te.value==="icon"),Jn=C(()=>te.value==="tile"),Yn=C(()=>qn.value||Jn.value),ln=C(()=>K.value!=="hidden"),Ot=C(()=>K.value==="hidden"),$o=C(()=>!1),To=C(()=>ln.value?"Режим меню: полное. Нажмите, чтобы скрыть меню":"Режим меню: скрыто. Нажмите, чтобы вернуть полное меню"),Qn=C(()=>{var e,t;return((t=(e=qe.value)==null?void 0:e.result)==null?void 0:t.hosts)||[]}),Po=C(()=>{var t,n;const e=((n=(t=qe.value)==null?void 0:t.result)==null?void 0:n.scanned_cidrs)||[];return e.length?e.join(", "):"нет данных"}),Lo=C(()=>re.value==="saving"?"Сохранение...":re.value==="saved"?"Сохранено":re.value==="error"?"Ошибка сохранения":P.value?"Готово":"Сохранение выключено"),Nt=C(()=>{var n;const e=new Map;for(const o of((n=E.value)==null?void 0:n.groups)||[])for(const i of o.subgroups||[])for(const d of i.items||[]){const v=yt(d,o);if(!v)continue;const _=v.toLowerCase();e.has(_)||e.set(_,v)}const t=Array.from(e.entries()).sort((o,i)=>o[1].localeCompare(i[1],"ru",{sensitivity:"base"}));return[{value:"all",label:"Все sites"},...t.map(([o,i])=>({value:o,label:i}))]}),Gt=C(()=>{const e=new Map;for(const t of an.value)e.set(t.id,t);return e}),un=C(()=>{var t;const e=new Map;for(const n of((t=E.value)==null?void 0:t.groups)||[])e.set(n.id,n);return e}),Zn=C(()=>{var t;const e=new Map;for(const n of((t=E.value)==null?void 0:t.groups)||[])for(const o of n.subgroups||[])e.set(o.id,{group:n,subgroup:o});return e}),xo=C(()=>{const e=new Map;for(const t of De.value)for(const n of t.blocks||[])if((n==null?void 0:n.type)==="groups")for(const o of n.group_ids||[])e.has(o)||e.set(o,t.id);return e}),Xn=C(()=>{const e=new Map;for(const t of Qn.value||[]){const n=String((t==null?void 0:t.ip)||"").trim();if(n)for(const o of(t==null?void 0:t.dashboard_items)||[]){const i=String((o==null?void 0:o.id)||"").trim();i&&!e.has(i)&&e.set(i,n)}}return e}),Ao=C(()=>{var n;const e=[],t=xo.value;e.push({id:"action:open-settings-panel",type:"action",action:"open_settings_panel",item:null,title:"Открыть панель настроек",titleLower:"открыть панель настроек",host:"",ip:"",site:"",tagsLower:[],groupId:"",groupKey:"",groupTitle:"Команда",subgroupId:"",subgroupTitle:"Интерфейс",pageId:"",searchBlob:"открыть панель настроек settings ui интерфейс control panel параметры фильтры"});for(const o of((n=E.value)==null?void 0:n.groups)||[])for(const i of o.subgroups||[])for(const d of i.items||[]){const v=di(d==null?void 0:d.url),_=Xn.value.get(d.id)||"",H=(d.tags||[]).map(Te=>String(Te||"").trim()).filter(Boolean),oe=yt(d,o);if(ne.value!=="all"&&oe.toLowerCase()!==ne.value)continue;const Fe=t.get(o.id)||t.get(i.id)||"",Ne=String(d.title||"").trim(),nt=[Ne,String(d.id||""),String(d.url||""),v,_,oe,String(o.title||""),String(i.title||""),...H].join(" ").toLowerCase();e.push({id:d.id,type:"item",action:"",item:d,title:Ne,titleLower:Ne.toLowerCase(),host:v.toLowerCase(),ip:_.toLowerCase(),site:oe.toLowerCase(),tagsLower:H.map(Te=>Te.toLowerCase()),groupId:o.id,groupKey:`group:${o.id}`,groupTitle:String(o.title||""),subgroupId:i.id,subgroupTitle:String(i.title||""),pageId:Fe,searchBlob:nt})}return e}),vt=C(()=>{const e=String(ut.value||"").trim().toLowerCase(),t=Ao.value;if(!e){const i=t.filter(v=>v.type==="action"),d=t.filter(v=>v.type!=="action").slice().sort((v,_)=>v.title.localeCompare(_.title,"ru",{sensitivity:"base"}));return[...i,...d].slice(0,G)}const n=e.split(/\s+/).filter(Boolean),o=[];for(const i of t){let d=0,v=!0;for(const _ of n){if(!i.searchBlob.includes(_)){v=!1;break}i.titleLower.startsWith(_)?d+=12:i.titleLower.includes(_)&&(d+=8),i.host.startsWith(_)?d+=7:i.host.includes(_)&&(d+=4),i.ip===_?d+=14:i.ip.includes(_)&&(d+=6),i.site&&i.site.includes(_)&&(d+=5),i.tagsLower.some(H=>H.includes(_))&&(d+=3)}v&&o.push({entry:i,score:d})}return o.sort((i,d)=>d.score!==i.score?d.score-i.score:i.entry.title.localeCompare(d.entry.title,"ru",{sensitivity:"base"})),o.slice(0,W).map(i=>i.entry)}),er=C(()=>vt.value[ge.value]||null),Be=C(()=>De.value.find(e=>e.id===Q.value)||De.value[0]||null),cn=C(()=>{var e;return((e=Be.value)==null?void 0:e.id)===h}),Ye=C(()=>{if(!Be.value)return[];const e=[];for(const t of Be.value.blocks||[])(t==null?void 0:t.type)==="groups"&&e.push(...t.group_ids||[]);return mn(e)}),tr=C(()=>{const e=mr(Ye.value),t=ee.value.trim().toLowerCase();return t?e.map(n=>{if(String(n.title||"").toLowerCase().includes(t)||String(n.description||"").toLowerCase().includes(t))return{...n,subgroups:n.subgroups||[]};const i=(n.subgroups||[]).map(d=>{if(String(d.title||"").toLowerCase().includes(t))return{...d,items:d.items||[]};const _=(d.items||[]).filter(H=>{const oe=String(H.title||"").toLowerCase().includes(t),Fe=String(H.url||"").toLowerCase().includes(t),Ne=(H.tags||[]).some(Te=>String(Te).toLowerCase().includes(t)),nt=yt(H,n).toLowerCase().includes(t);return oe||Fe||Ne||nt});return _.length?{...d,items:_}:null}).filter(Boolean);return i.length?{...n,subgroups:i}:null}).filter(Boolean):e}),Mo=C(()=>{const e=[];for(const t of tr.value){e.push({key:`group:${t.key}`,type:"group",groupKey:t.key,group:t});for(const n of t.subgroups||[])e.push({key:`subgroup:${t.key}:${n.id}`,type:"subgroup",groupKey:t.key,subgroupId:n.id,subgroup:n})}return e}),Qe=C(()=>{const e=[];for(const t of Ye.value)for(const n of t.subgroups||[])for(const o of n.items||[])e.push(o.id);return e}),Ro=C(()=>{var n;const e=Qe.value;let t=0;for(const o of e)(n=tt(o))!=null&&n.ok&&(t+=1);return{online:t,total:e.length}}),Ut=C(()=>{if(!Be.value)return[];const e=[];for(const t of Be.value.blocks||[])dr(t)&&e.push(...t.widgets||[]);return Array.from(new Set(e))}),Ht=C(()=>fr(Ut.value)),Do=C(()=>{const e=Ht.value.length;if(!e)return"нет данных";const t=Ht.value.filter(n=>ht(n)).length;return`${e} · больших ${t}`}),Bo=C(()=>{var e;return(((e=Be.value)==null?void 0:e.blocks)||[]).filter(t=>(t==null?void 0:t.type)==="groups")}),nr=C(()=>{const e=Gt.value.get(ue.value);return!e||!ht(e)?null:Ut.value.includes(e.id)?e:null});function rr(e){if(!e)return;const t=document.documentElement;e.accent&&(t.style.setProperty("--accent",e.accent),t.style.setProperty("--accent-soft",e.accent)),e.background&&t.style.setProperty("--bg",e.background),e.border&&t.style.setProperty("--border",e.border),e.card&&(t.style.setProperty("--surface",e.card),t.style.setProperty("--surface-strong",e.card)),t.style.setProperty("--glow-enabled",e.glow===!1?"0":"1")}function or(e){if(!e)return;const t=document.documentElement;e.gap!=null&&t.style.setProperty("--grid-gap",`${Number(e.gap)}px`),e.card_radius!=null&&t.style.setProperty("--card-radius",`${Number(e.card_radius)}px`),e.columns!=null&&t.style.setProperty("--layout-columns",String(Number(e.columns)))}function Oo(){P.value=!P.value,be.value="",P.value||Ze()}function No(){if(te.value==="detailed"){te.value="tile";return}if(te.value==="tile"){te.value="icon";return}te.value="detailed"}function Go(){K.value!=="detailed"&&K.value!=="hidden"&&(K.value="detailed");const e=D.indexOf(K.value),n=((e>=0?e:0)+1)%D.length;K.value=D[n],ln.value||(ee.value="",Vt()),Ot.value&&(B.value="flat")}function Uo(e){return e?e.type==="group"?wr(e.groupKey):e.type==="subgroup"?Sr(e.groupKey,e.subgroupId):!1:!1}function Ho(e){var t,n;return e?e.type==="group"?`Группа: ${((t=e.group)==null?void 0:t.title)||""}`:e.type==="subgroup"?`Подгруппа: ${((n=e.subgroup)==null?void 0:n.title)||""}`:"":""}function Vo(e){if(e){if(e.type==="group"){ce[e.groupKey]=!0,w.groupKey=e.groupKey,w.subgroupId="",w.itemId="";return}e.type==="subgroup"&&yr(e.groupKey,e.subgroupId)}}function Fo(e,t,n){if(!Yn.value)return;const o=(n==null?void 0:n.__originGroupKey)||e,i=(n==null?void 0:n.__originSubgroupId)||t;vn(o,i,n.id),Cn(n)}function ir(e){return JSON.parse(JSON.stringify(e))}function dn(e){return Ca(e)}async function sr(){var e;if(E.value){re.value="saving",be.value="";try{const t=await ga(E.value);E.value=t.config,(!Q.value||!De.value.some(n=>n.id===Q.value))&&(Q.value=((e=De.value[0])==null?void 0:e.id)||""),re.value="saved",He&&clearTimeout(He),He=window.setTimeout(()=>{re.value==="saved"&&(re.value="idle")},1400)}catch(t){throw re.value="error",be.value=(t==null?void 0:t.message)||"Ошибка сохранения YAML",t}}}async function ve(e){if(!E.value)return!1;const t=ir(E.value);try{return e(E.value)===!1?!1:(Qr(E.value),bt(),await sr(),!0)}catch(n){return E.value=t,re.value="error",be.value=(n==null?void 0:n.message)||"Не удалось применить изменения",!1}}function fn(e,t){return{id:e,type:"link",title:t,url:I,icon:null,site:null,tags:[],open:"new_tab"}}async function Ko(){if(!P.value||!E.value)return;const e=window.prompt("Название новой группы","Новая группа");if(e==null)return;const t=e.trim();t&&await ve(n=>{const o=new Set((n.groups||[]).map(oe=>oe.id)),i=nn(n),d=qt(n),v=Ke(t,o),_=Ke(`${v}-core`,i),H=Ke(`${v}-service`,d);n.groups.push({id:v,title:t,icon:"folder",description:"",layout:"auto",subgroups:[{id:_,title:"Core",items:[fn(H,"Новый сервис")]}]}),Zr(n,Q.value,v),ce[`group:${v}`]=!0,w.groupKey=`group:${v}`,w.subgroupId=_,w.itemId=H})}async function zo(e){if(!P.value||!E.value)return;const t=window.prompt("Название подгруппы","Новая подгруппа");if(t==null)return;const n=t.trim();n&&await ve(o=>{const i=Ce(o,e);if(!i)throw new Error(`Группа '${e}' не найдена`);const d=nn(o),v=qt(o),_=Ke(`${e}-${n}`,d),H=Ke(`${_}-service`,v);i.subgroups.push({id:_,title:n,items:[fn(H,"Новый сервис")]}),ce[`group:${e}`]=!0,w.groupKey=`group:${e}`,w.subgroupId=_,w.itemId=H})}async function jo(e,t){!P.value||!E.value||lr(e,t)}function pn(e){return String(e||"").split(",").map(t=>t.trim()).filter(Boolean)}function gn(e,t,n,o){const i=Number(e);if(!Number.isFinite(i))return t;const d=Math.trunc(i);return Math.min(o,Math.max(n,d))}function ar(e=!1){$.submitting&&!e||($.open=!1,$.mode="create",$.groupId="",$.subgroupId="",$.originalItemId="",$.error="",$.submitting=!1,$.form=q())}function lr(e,t){if(!ye(E.value,e,t)){re.value="error",be.value=`Подгруппа '${t}' не найдена`;return}$.open=!0,$.mode="create",$.groupId=e,$.subgroupId=t,$.originalItemId="",$.error="",$.submitting=!1,$.form=q()}function ur(e,t,n){var d,v,_;const o=ye(E.value,e,t),i=((o==null?void 0:o.items)||[]).find(H=>H.id===n);if(!o||!i){re.value="error",be.value=`Элемент '${n}' не найден`;return}$.open=!0,$.mode="edit",$.groupId=e,$.subgroupId=t,$.originalItemId=n,$.error="",$.submitting=!1,$.form={id:i.id,title:i.title,type:i.type,url:String(i.url||I),icon:i.icon||"",siteInput:String(i.site||""),tagsInput:(i.tags||[]).join(", "),open:i.open||"new_tab",healthcheckEnabled:!!(i.type==="link"&&i.healthcheck),healthcheckUrl:i.type==="link"&&i.healthcheck?String(i.healthcheck.url):String(i.url||I),healthcheckIntervalSec:i.type==="link"&&i.healthcheck?Number(i.healthcheck.interval_sec||30):30,healthcheckTimeoutMs:i.type==="link"&&i.healthcheck?Number(i.healthcheck.timeout_ms||1500):1500,iframeSandboxMode:i.type==="iframe"?((d=i.iframe)==null?void 0:d.sandbox)==null?"default":i.iframe.sandbox?"enabled":"disabled":"default",iframeAllowInput:i.type==="iframe"?(((v=i.iframe)==null?void 0:v.allow)||[]).join(", "):"",iframeReferrerPolicy:i.type==="iframe"&&((_=i.iframe)==null?void 0:_.referrer_policy)||"",authProfile:i.type==="iframe"&&i.auth_profile||""}}function cr(e){const t=$.form,n=String(t.title||"").trim();if(!n)throw new Error("Название сервиса обязательно");const o=String(t.type||"").trim().toLowerCase();if(!["link","iframe"].includes(o))throw new Error("Тип сервиса должен быть 'link' или 'iframe'");const i=String(t.open||"new_tab");if(!["new_tab","same_tab"].includes(i))throw new Error("Параметр open должен быть 'new_tab' или 'same_tab'");const d=dn(t.url||I),v=qt(e);$.mode==="edit"&&v.delete($.originalItemId);const _=String(t.id||"").trim(),H=`${$.subgroupId}-${n}`,oe=Pt(_||H,"service"),Fe=_?oe:Ke(oe,v);if(_&&v.has(Fe))throw new Error(`ID '${Fe}' уже существует`);const Ne={id:Fe,type:o,title:n,url:d,icon:String(t.icon||"").trim()||null,site:String(t.siteInput||"").trim()||null,tags:pn(t.tagsInput),open:i};if(o==="link"){const Wt={...Ne};if(t.healthcheckEnabled){const ys=dn(t.healthcheckUrl||d);Wt.healthcheck={type:"http",url:ys,interval_sec:gn(t.healthcheckIntervalSec,30,1,3600),timeout_ms:gn(t.healthcheckTimeoutMs,1500,100,12e4)}}return Wt}const nt=String(t.iframeSandboxMode||"default");let Te=null;nt==="enabled"&&(Te=!0),nt==="disabled"&&(Te=!1);const kt=String(t.authProfile||"").trim();if(kt&&!Wn.value.some(Wt=>Wt.id===kt))throw new Error(`Auth profile '${kt}' не найден`);const Br={...Ne,iframe:{sandbox:Te,allow:pn(t.iframeAllowInput),referrer_policy:String(t.iframeReferrerPolicy||"").trim()||null}};return kt&&(Br.auth_profile=kt),Br}async function Wo(){if(!$.open||$.submitting||!E.value)return;$.submitting=!0,$.error="";const e=await ve(t=>{const n=ye(t,$.groupId,$.subgroupId);if(!n)throw new Error(`Подгруппа '${$.subgroupId}' не найдена`);const o=cr(t);if($.mode==="create")return n.items.push(o),w.groupKey=`group:${$.groupId}`,w.subgroupId=$.subgroupId,w.itemId=o.id,!0;const i=(n.items||[]).findIndex(d=>d.id===$.originalItemId);if(i<0)throw new Error(`Элемент '${$.originalItemId}' не найден`);return n.items.splice(i,1,o),w.groupKey=`group:${$.groupId}`,w.subgroupId=$.subgroupId,(w.itemId===$.originalItemId||!w.itemId)&&(w.itemId=o.id),!0});$.submitting=!1,e?ar(!0):$.error=be.value||"Не удалось сохранить сервис"}async function qo(e){if(!P.value||!E.value)return;const t=Ce(E.value,e);if(!t)return;const n=window.prompt("Название группы",t.title);if(n==null)return;const o=window.prompt("Описание группы",t.description||"");if(o==null)return;const i=window.prompt("Режим группы (auto | full | inline)",t.layout||"auto");i!=null&&await ve(d=>{const v=Ce(d,e);if(!v)throw new Error(`Группа '${e}' не найдена`);const _=String(i||"").trim().toLowerCase()||"auto";if(!["auto","full","inline"].includes(_))throw new Error("Режим группы должен быть 'auto', 'full' или 'inline'");v.title=n.trim()||v.title,v.description=o.trim(),v.layout=_})}async function Jo(e,t){if(!P.value||!E.value)return;const n=ye(E.value,e,t);if(!n)return;const o=window.prompt("Название подгруппы",n.title);o!=null&&await ve(i=>{const d=ye(i,e,t);if(!d)throw new Error(`Подгруппа '${t}' не найдена`);d.title=o.trim()||d.title})}async function Yo(e,t,n){!P.value||!E.value||ur(e,t,n)}async function Qo(e){if(!P.value||!E.value)return;const t=Ce(E.value,e);if(t){if(E.value.groups.length<=1){re.value="error",be.value="Нельзя удалить последнюю группу.";return}window.confirm(`Удалить группу "${t.title}"?`)&&await ve(n=>{const o=(n.groups||[]).findIndex(i=>i.id===e);if(o<0)return!1;n.groups.splice(o,1),w.groupKey="",w.subgroupId="",w.itemId=""})}}async function Zo(e,t){if(!P.value||!E.value)return;const n=Ce(E.value,e),o=((n==null?void 0:n.subgroups)||[]).find(i=>i.id===t);if(!(!n||!o)){if(n.subgroups.length<=1){re.value="error",be.value="В группе должна остаться хотя бы одна подгруппа.";return}window.confirm(`Удалить подгруппу "${o.title}"?`)&&await ve(i=>{const d=Ce(i,e);if(!d)return!1;const v=(d.subgroups||[]).findIndex(_=>_.id===t);if(v<0)return!1;d.subgroups.splice(v,1),w.subgroupId="",w.itemId=""})}}async function Xo(e,t,n){if(!P.value||!E.value)return;const o=ye(E.value,e,t),i=((o==null?void 0:o.items)||[]).find(d=>d.id===n);if(!(!o||!i)){if(o.items.length<=1){re.value="error",be.value="В подгруппе должен остаться хотя бы один элемент.";return}window.confirm(`Удалить сервис "${i.title}"?`)&&await ve(d=>{const v=ye(d,e,t);if(!v)return!1;const _=(v.items||[]).findIndex(H=>H.id===n);if(_<0)return!1;v.items.splice(_,1),w.itemId===n&&(w.itemId="")})}}function Ze(){L.type="",L.groupId="",L.subgroupId="",L.itemId=""}function ei(e,t){if(!P.value||!Jt(t))return;const n=t.id;L.type="group",L.groupId=n,L.subgroupId="",L.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`group:${n}`))}function ti(e,t,n){P.value&&(L.type="subgroup",L.groupId=t,L.subgroupId=n,L.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`subgroup:${n}`)))}function ni(e,t,n,o){P.value&&(L.type="item",L.groupId=t,L.subgroupId=n,L.itemId=o,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`item:${o}`)))}function ri(e,t){if(!P.value||!Jt(t))return;const n=t.id;L.type==="group"&&L.groupId!==n&&e.preventDefault()}async function oi(e,t){if(!P.value||!Jt(t))return;const n=t.id;if(L.type!=="group"||!L.groupId||L.groupId===n)return;e.preventDefault();const o=L.groupId;Ze(),await ve(i=>Xr(i,o,n))}function ii(e,t,n){if(P.value){if(L.type==="subgroup"){if(L.subgroupId===n)return;e.preventDefault();return}L.type==="item"&&e.preventDefault()}}async function si(e,t,n){if(P.value){if(L.type==="subgroup"){e.preventDefault();const o=L.groupId,i=L.subgroupId;Ze(),await ve(d=>eo(d,o,i,t,n));return}if(L.type==="item"){e.preventDefault();const o=L.groupId,i=L.subgroupId,d=L.itemId;Ze(),await ve(v=>no(v,o,i,d,t,n))}}}function ai(e,t,n,o){P.value&&L.type==="item"&&L.itemId!==o&&e.preventDefault()}async function li(e,t,n,o){if(!P.value||L.type!=="item"||!L.itemId||L.itemId===o)return;e.preventDefault();const i=L.groupId,d=L.subgroupId,v=L.itemId;Ze(),await ve(_=>to(_,i,d,v,t,n,o))}function dr(e){return(e==null?void 0:e.type)==="widget_row"||(e==null?void 0:e.type)==="widget_grid"}function fr(e=[]){return e.map(t=>Gt.value.get(t)).filter(Boolean)}function ht(e){return y.has(String((e==null?void 0:e.type)||""))}function ui(e){return Cr(e).slice(0,2)}function pr(e){const t=Ht.value.find(n=>n.id===e);!t||!ht(t)||(ue.value=t.id)}function ci(e){ht(e)&&pr(e.id)}function mn(e=[]){const t=[];for(const n of e){const o=un.value.get(n);if(o){t.push({key:`group:${o.id}`,id:o.id,title:o.title,icon:o.icon||null,description:o.description||"",layout:o.layout||"auto",subgroups:o.subgroups||[]});continue}const i=Zn.value.get(n);i&&t.push({key:`subgroup:${i.subgroup.id}`,id:i.group.id,title:i.group.title,icon:i.group.icon||null,description:i.group.description||"",layout:i.group.layout||"auto",subgroups:[i.subgroup]})}return t}function bt(){const e=new Set(Ye.value.map(t=>t.key));for(const t of Object.keys(ce))e.has(t)||delete ce[t];for(const t of Ye.value)ce[t.key]==null&&(ce[t.key]=!0);w.groupKey&&!e.has(w.groupKey)&&Vt()}function Vt(){w.groupKey="",w.subgroupId="",w.itemId=""}function di(e){try{return new URL(String(e||"")).hostname||""}catch{return""}}function fi(e,t,n){const o=String((e==null?void 0:e.site)||"").trim();if(o)return o;const i=String((t==null?void 0:t.site)||"").trim();if(i)return i;const d=(n||[]).find(v=>String(v||"").toLowerCase().startsWith("site:"));return d?String(d).slice(5).trim():""}function gr(e){return((e==null?void 0:e.tags)||[]).map(t=>String(t||"").trim()).filter(Boolean)}function pi(e){const t=String(e||"");return t.startsWith("group:")&&un.value.get(t.slice(6))||null}function yt(e,t=null){return fi(e,t,gr(e))}function gi(e,t=""){const n=pi((e==null?void 0:e.__originGroupKey)||t);return yt(e,n)}function mr(e=[]){return ne.value==="all"?e:e.map(t=>{const n=(t.subgroups||[]).map(o=>({...o,items:(o.items||[]).filter(i=>yt(i,t).toLowerCase()===ne.value)})).filter(o=>o.items.length>0);return n.length?{...t,subgroups:n}:null}).filter(Boolean)}function mi(e){const t=String(e||"all").trim().toLowerCase(),n=new Set(Nt.value.map(o=>o.value));ne.value=n.has(t)?t:"all"}function vr(){ut.value="",ge.value=0,Mt.value=!0}function Ft(){Mt.value=!1,ut.value="",ge.value=0}function vi(){if(Mt.value){Ft();return}vr()}function hr(){Ue.open=!0}function hi(){Ue.open=!1}function bi(){Ue.open=!Ue.open}function yi(e){ut.value=String(e||""),ge.value=0}function Ii(e){const t=vt.value.length-1;if(t<0){ge.value=0;return}ge.value=Math.min(Math.max(e,0),t)}function wi(e){const t=vt.value.length;if(!t){ge.value=0;return}const o=(ge.value+e+t)%t;ge.value=o}function Si(e){e&&(e.pageId&&(Q.value=e.pageId),vn(e.groupKey,e.subgroupId,e.item.id))}function br(e){if(e){if(e.type==="action"&&e.action==="open_settings_panel"){Ft(),hr();return}Si(e),Cn(e.item),Ft()}}function _i(){br(er.value)}async function ki(e){var t;(e==null?void 0:e.type)!=="item"||!((t=e==null?void 0:e.item)!=null&&t.url)||await xr(e.item.url)}function Ei(e){ce[e]=!Ir(e),w.groupKey=e,w.subgroupId="",w.itemId=""}function yr(e,t){ce[e]=!0,w.groupKey=e,w.subgroupId=t,w.itemId=""}function vn(e,t,n){ce[e]=!0,w.groupKey=e,w.subgroupId=t,w.itemId=n}function Ir(e){return!!ce[e]}function wr(e){return w.groupKey===e&&!w.subgroupId&&!w.itemId}function Sr(e,t){return w.groupKey===e&&w.subgroupId===t&&!w.itemId}function Ci(e){return w.itemId===e}function $i(e=[]){const t=mn(e),n=mr(t),o=Ot.value?n:Li(n),i=Mi(o),d=i.length;return i.map(v=>({...v,__visibleCount:d}))}function Ti(){return!!(w.groupKey||w.subgroupId||w.itemId)}function Pi(e){return String(e||"").trim()||"Без тега"}function _r(e){const t=new Set(gr(e).map(n=>Pi(n)).filter(Boolean));return t.size||t.add("Без тега"),Array.from(t)}function hn(e,t,n){return{...e,__originGroupKey:t,__originSubgroupId:n}}function Li(e=[]){return Ti()?e.map(t=>{if(w.groupKey&&t.key!==w.groupKey)return null;let n=t.subgroups||[];return w.subgroupId&&(n=n.filter(o=>o.id===w.subgroupId)),w.itemId&&(n=n.map(o=>({...o,items:(o.items||[]).filter(i=>i.id===w.itemId)})).filter(o=>o.items.length>0)),n.length?{...t,subgroups:n}:null}).filter(Boolean):e}function xi(e=[]){return e.map(t=>{const n=new Map;for(const d of t.subgroups||[])for(const v of d.items||[])for(const _ of _r(v))n.has(_)||n.set(_,[]),n.get(_).push(hn(v,t.key,d.id));const i=Array.from(n.entries()).sort(([d],[v])=>d.localeCompare(v,"ru",{sensitivity:"base"})).map(([d,v])=>({id:`tag-${Pt(`${t.id}-${d}`,"tag")}`,title:`#${d}`,icon:"tag",items:v}));return i.length?{...t,subgroups:i}:null}).filter(Boolean)}function Ai(e=[]){const t=new Map;for(const o of e)for(const i of o.subgroups||[])for(const d of i.items||[])for(const v of _r(d))t.has(v)||t.set(v,[]),t.get(v).push(hn(d,o.key,i.id));return Array.from(t.entries()).sort(([o],[i])=>o.localeCompare(i,"ru",{sensitivity:"base"})).map(([o,i])=>{const d=Pt(o,"tag");return{key:`tags:${d}`,id:`tags-${d}`,title:`#${o}`,icon:"tag",description:"Сервисы, сгруппированные только по тегам.",layout:"inline",subgroups:[{id:`tags-${d}-items`,title:"Сервисы",items:i}]}})}function kr(e=[]){const t=[];for(const n of e)for(const o of n.subgroups||[])for(const i of o.items||[])t.push(hn(i,n.key,o.id));return t.length?[{key:"flat:all",id:"flat-all",title:"Все сервисы",icon:"layout-grid",description:"Плоское отображение без группировки.",layout:"full",subgroups:[{id:"flat-all-items",title:"Плитка",items:t}]}]:[]}function Mi(e=[]){return Ot.value?kr(e):B.value==="tags_in_groups"?xi(e):B.value==="tags"?Ai(e):B.value==="flat"?kr(e):e}function Ri(e){const t=String((e==null?void 0:e.layout)||"auto").toLowerCase();return t==="inline"?!0:t==="full"?!1:Number((e==null?void 0:e.__visibleCount)||0)>1}function Di(e){return(e.subgroups||[]).reduce((t,n)=>t+(n.items||[]).length,0)}function Bi(e){return((e==null?void 0:e.items)||[]).length}function Oi(e){var n;let t=0;for(const o of e.subgroups||[])for(const i of o.items||[])(n=tt(i.id))!=null&&n.ok&&(t+=1);return t}function Er(){for(const e of Object.keys(mt))delete mt[e]}function bn(e){return $a(e)}function yn(e){const t=bn(e==null?void 0:e.url);return t?`${String((e==null?void 0:e.id)||"")}|${t}`:""}function Ni(e){const t=bn(e==null?void 0:e.url);if(!t)return"";const n=yn(e);return n&&mt[n]?"":`${t}/favicon.ico`}function Gi(e){const t=yn(e);t&&(mt[t]=!0)}function Ui(e){return wa(e)}function Hi(e){return Sa(e)}function Vi(e){return _a(e)}function Fi(e){return ka(e)}function Ki(e){return Ea(e)}function Xe(e){return Me[e]||null}function In(e,t){return`${e}:${t}`}function zi(e,t){return!!Rt[In(e,t)]}function Oe(e,t){if(!t||typeof t!="string")return null;if(t==="$")return e;if(!t.startsWith("$."))return null;let n=e;const o=t.slice(2).split(".");for(const i of o){if(n==null)return null;const d=i.match(/^(.*)\[\*\]$/);if(d){const v=d[1],_=v?n==null?void 0:n[v]:n;return Array.isArray(_)?_:[]}n=n==null?void 0:n[i]}return n}function ji(e){var o,i,d;const t=(o=Xe(e.id))==null?void 0:o.payload;return Oe(t,(d=(i=e.data)==null?void 0:i.mapping)==null?void 0:d.value)??"—"}function Wi(e){var o,i,d;const t=(o=Xe(e.id))==null?void 0:o.payload;return Oe(t,(d=(i=e.data)==null?void 0:i.mapping)==null?void 0:d.subtitle)??""}function qi(e){var o,i,d;const t=(o=Xe(e.id))==null?void 0:o.payload;return Oe(t,(d=(i=e.data)==null?void 0:i.mapping)==null?void 0:d.trend)??""}function Cr(e){var i,d;const t=(i=Xe(e.id))==null?void 0:i.payload,n=((d=e.data)==null?void 0:d.mapping)||{},o=Oe(t,n.items);return Array.isArray(o)?o.map(v=>{const _=Oe(v,n.item_title)??"-",H=Oe(v,n.item_value)??"-";return{title:_,value:H}}):[]}function Ji(e){var i,d,v;const t=(i=Xe(e.id))==null?void 0:i.payload,n=(v=(d=e.data)==null?void 0:d.mapping)==null?void 0:v.rows,o=Oe(t,n);return Array.isArray(o)?o:Array.isArray(t)?t:Array.isArray(t==null?void 0:t.items)?t.items:[]}function Kt(e){return e?e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/")?e:`/${e}`:""}function It(){for(const e of Dt.values())clearInterval(e);Dt.clear()}function et(){dt&&(clearTimeout(dt),dt=0),ft&&(clearTimeout(ft),ft=0),Je&&(Je.close(),Je=null)}function tt(e){return gt[e]||null}function Yi(e){return!!(e!=null&&e.ok&&e.latency_ms!=null&&e.latency_ms>=p)}function wn(e){if(!e)return"unknown";const t=String(e.level||"").toLowerCase();return["online","degraded","down","unknown","indirect_failure"].includes(t)?t:Yi(e)?"degraded":e.ok?"online":"down"}function Qi(e){const t=tt(e),n=wn(t);return n==="online"?"ok":n==="degraded"?"degraded":n==="down"||n==="indirect_failure"?"down":"unknown"}function Zi(e){const t=tt(e);if(!t)return"Проверка...";const n=wn(t);return n==="online"?t.latency_ms!=null?`Online • ${t.latency_ms} ms`:"Online":n==="degraded"?t.latency_ms!=null?`Degraded • ${t.latency_ms} ms`:t.status_code!=null?`Degraded • HTTP ${t.status_code}`:t.error?`Degraded • ${t.error}`:t.reason?`Degraded • ${String(t.reason).replaceAll("_"," ")}`:"Degraded":n==="indirect_failure"?"Indirect failure":n==="down"?t.error?`Offline • ${t.error}`:t.status_code!=null?`Offline • HTTP ${t.status_code}`:"Offline":"Unknown"}function Sn(e,t=[]){const n=new Map;for(const o of(e==null?void 0:e.items)||[]){const i=o&&typeof o=="object"?o:null,d=String((i==null?void 0:i.item_id)||"").trim();d&&(n.set(d,i),gt[d]=i)}for(const o of t){const i=String(o||"").trim();!i||n.has(i)||gt[i]||(gt[i]={item_id:i,ok:!1,checked_url:"",status_code:null,latency_ms:null,error:"healthcheck unavailable"})}}function $r(){const e=pa();if(!e)return!1;Je=e;const t=Qe.value,n=o=>{if(o!=null&&o.data)try{const i=JSON.parse(o.data);Sn(i,t)}catch{}};return e.addEventListener("snapshot",n),e.onmessage=n,e.onerror=()=>{Je===e&&(e.close(),Je=null,ie.value&&(ft=window.setTimeout(async()=>{ft=0,$r()||(await Ve(),kn())},u)))},!0}async function Ve(e=null){if(!Array.isArray(e)&&!ie.value)return;const t=Array.isArray(e)&&e.length?e:Qe.value,n=Array.from(new Set(t.map(o=>String(o||"").trim()).filter(Boolean)));if(n.length)try{const o=await fa(n);Sn(o,n)}catch{Sn({items:[]},n)}}async function _n(){et(),!$r()&&(await Ve(),kn())}function Xi(){let e=!1,t=!1;for(const n of Qe.value){const o=wn(tt(n));if(o==="down"||o==="indirect_failure"){e=!0;break}o==="degraded"&&(t=!0)}return e?c:t?l:a}function kn(){if(et(),!ie.value)return;const e=Xi();dt=window.setTimeout(async()=>{await Ve(),kn()},e)}async function zt(e){var i;const t=Gt.value.get(e);if(!t)return;const n=Kt((i=t.data)==null?void 0:i.endpoint);if(!n)return;Me[e]||(Me[e]={loading:!1,error:"",payload:null,lastUpdated:0});const o=Me[e];o.loading=!0,o.error="";try{o.payload=await Pe(n),o.lastUpdated=Date.now()}catch(d){o.error=(d==null?void 0:d.message)||"Ошибка загрузки виджета"}finally{o.loading=!1}}async function En(){var t,n;It();const e=[];for(const o of an.value){if(e.push(zt(o.id)),!Kt((t=o.data)==null?void 0:t.endpoint))continue;const i=Math.max(1,Number(((n=o.data)==null?void 0:n.refresh_sec)||0))*1e3,d=window.setInterval(()=>{zt(o.id)},i);Dt.set(o.id,d)}await Promise.all(e)}async function es(e,t){const n=In(e,t.id),o=Kt(t.endpoint);if(o){Rt[n]=!0;try{await Pe(o,{method:String(t.method||"GET").toUpperCase()}),await zt(e)}catch(i){Me[e]||(Me[e]={loading:!1,error:"",payload:null,lastUpdated:0}),Me[e].error=(i==null?void 0:i.message)||"Не удалось выполнить действие"}finally{Rt[n]=!1}}}async function Tr(){var e,t,n;se.value=!0,ae.value="",re.value="idle",be.value="",Er();try{const o=await ca();E.value=o,(!Q.value||!De.value.some(i=>i.id===Q.value))&&(Q.value=((e=De.value[0])==null?void 0:e.id)||""),bt(),rr((t=o==null?void 0:o.ui)==null?void 0:t.theme),or((n=o==null?void 0:o.ui)==null?void 0:n.grid),await En(),await _n(),ie.value||Ar()}catch(o){ae.value=(o==null?void 0:o.message)||"Не удалось загрузить dashboard-конфигурацию",E.value=null,It(),et()}finally{se.value=!1}}async function Pr(e){var o,i,d,v,_,H;const t=!!(((d=(i=(o=E.value)==null?void 0:o.security)==null?void 0:i.iframe)==null?void 0:d.default_sandbox)??!0),n=(v=e==null?void 0:e.iframe)==null?void 0:v.sandbox;Z.open=!0,Z.title=e.title,Z.src="",Z.error="",Z.loading=!0,Z.sandbox=n==null?t:!!n,Z.allow=Array.isArray((_=e==null?void 0:e.iframe)==null?void 0:_.allow)?e.iframe.allow.join("; "):"",Z.referrerPolicy=((H=e==null?void 0:e.iframe)==null?void 0:H.referrer_policy)||"";try{const oe=await da(e.id);Z.src=oe.src}catch(oe){Z.error=(oe==null?void 0:oe.message)||"Не удалось подготовить iframe"}finally{Z.loading=!1}}function ts(){Z.open=!1,Z.title="",Z.src="",Z.error="",Z.loading=!1,Z.sandbox=!1,Z.allow="",Z.referrerPolicy=""}function Lr(e){if(e.open==="same_tab"){window.location.assign(e.url);return}window.open(e.url,"_blank","noopener,noreferrer")}function ns(e){e!=null&&e.url&&window.open(e.url,"_blank","noopener,noreferrer")}function Cn(e){if(e.type==="iframe"){Pr(e);return}Lr(e)}function $n(e){return Xn.value.get(String(e||""))||""}async function Tn(e){var n;const t=String(e||"");if(t&&(n=navigator.clipboard)!=null&&n.writeText)try{await navigator.clipboard.writeText(t)}catch{}}async function xr(e){await Tn(e)}async function rs(e){const t=$n(e);t&&await Tn(t)}async function os(e){const t=$n(e);t&&await Tn(`ssh ${t}`)}async function is(e){e&&await Ve([e])}function ss(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?"—":t.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function as(e){const t=Number(e||0);return!Number.isFinite(t)||t<=0?"—":t<1e3?`${Math.round(t)} ms`:`${(t/1e3).toFixed(2)} s`}function ls(e){e&&(ct.host=e,ct.open=!0)}function Pn(){ct.open=!1,ct.host=null}function us(e){const t=(e==null?void 0:e.open_ports)||[];return t.length?t.map(n=>n!=null&&n.service?`${n.port} (${n.service})`:`${n.port}`).join(", "):"—"}function cs(e){return e?e.error?e.error:e.status_code==null?"—":`HTTP ${e.status_code}`:"—"}async function wt({silent:e=!1}={}){if(!Bt){Bt=!0,e||(on.value=!0);try{qe.value=await ma(),lt.value=""}catch(t){lt.value=(t==null?void 0:t.message)||"Не удалось загрузить состояние сканера LAN"}finally{Bt=!1,e||(on.value=!1)}}}function St(){pt&&(window.clearInterval(pt),pt=0)}function Ln(){St(),pt=window.setInterval(()=>{wt({silent:!0})},g)}function Ar(){et(),St(),It()}async function ds(){!E.value||se.value||(await En(),await _n(),cn.value&&(await wt({silent:!0}),Ln()))}async function fs(){if(!sn){sn=!0;try{ie.value?await ds():Ar()}finally{sn=!1}}}function Mr(){ie.value=document.visibilityState!=="hidden",fs()}async function ps(){var e;if(!At.value){At.value=!0;try{const t=await va();qe.value=(t==null?void 0:t.state)||qe.value,lt.value=t!=null&&t.accepted||(e=t==null?void 0:t.state)!=null&&e.queued?"":(t==null?void 0:t.message)||""}catch(t){lt.value=(t==null?void 0:t.message)||"Не удалось запустить сканирование LAN"}finally{At.value=!1,wt({silent:!0})}}}function gs(){var e,t;return((t=(e=document.documentElement)==null?void 0:e.dataset)==null?void 0:t.fxMode)||"full"}function ms(e){const t=document.documentElement;let n="high",o="1";e>=120?(n="low",o="0.42"):e>=70&&(n="medium",o="0.68"),t.dataset.motionBudget=n,t.style.setProperty("--motion-budget",o)}function vs(e){const t=gs();if(t==="off")return null;const n=JSON.parse(JSON.stringify(e));return n.fps_limit=t==="lite"?34:58,t!=="lite"||(n.particles.number.value=Math.max(24,Math.round(n.particles.number.value*.56)),n.particles.opacity.value=Number((n.particles.opacity.value*.72).toFixed(2)),n.particles.move.speed=Number((n.particles.move.speed*.74).toFixed(2)),n.particles.line_linked.opacity=Number((n.particles.line_linked.opacity*.56).toFixed(2)),n.particles.line_linked.distance=Math.max(80,Math.round(n.particles.line_linked.distance*.84)),n.retina_detect=!1),n}function xn(e){const t=document.getElementById(e);t&&(t.innerHTML="",delete t.dataset.particlesReady)}function hs(){xn(k),xn(S),xn(R)}async function bs(){Re&&(window.cancelAnimationFrame(Re),Re=0),Re=window.requestAnimationFrame(async()=>{Re=0,hs(),await An(),await _t()})}function Rr(){bs()}async function jt(e,t){const n=document.getElementById(e);if(!n)return;const o=vs(t);if(!o){n.innerHTML="",delete n.dataset.particlesReady;return}n.dataset.particlesReady==="1"||!await Ia()||!window.particlesJS||document.getElementById(e)&&n.dataset.particlesReady!=="1"&&(n.innerHTML="",window.particlesJS(e,o),n.dataset.particlesReady="1")}async function An(){await jt(k,F)}async function _t(){await Promise.all([jt(S,N),jt(R,N)])}let Dr=!1;return de(()=>{var e;return(e=Be.value)==null?void 0:e.id},async()=>{Dr?(ue.value="",ee.value="",Vt()):Dr=!0,bt(),Ve(),await Ge(),await _t()}),de(()=>{var e;return(e=nr.value)==null?void 0:e.id},async()=>{await Ge(),await _t()}),de(()=>Ut.value,e=>{ue.value&&!e.includes(ue.value)&&(ue.value="")},{deep:!0}),de(()=>Ye.value,()=>{bt(),Ve()},{deep:!0}),de(()=>vt.value.length,e=>{if(!e){ge.value=0;return}ge.value>=e&&(ge.value=e-1)}),de(()=>Nt.value.map(e=>e.value).join("|"),()=>{Nt.value.some(e=>e.value===ne.value)||(ne.value="all")}),de(()=>cn.value,e=>{if(e){ie.value&&(wt(),Ln());return}Pn(),St()}),de(()=>Qe.value.length,e=>{ms(e)},{immediate:!0}),de(()=>({activePageId:Q.value,treeFilter:ee.value,activeIndicatorViewId:ue.value,statsExpanded:le.value,editMode:P.value,serviceCardView:te.value,serviceGroupingMode:B.value,siteFilter:ne.value,sidebarView:K.value,settingsPanelOpen:Ue.open,selectedNode:{groupKey:w.groupKey,subgroupId:w.subgroupId,itemId:w.itemId},expandedGroups:{...ce}}),e=>{Ee(e)},{deep:!0}),it(async()=>{window.addEventListener("visibilitychange",Mr),window.addEventListener("oko:fx-mode-change",Rr),await An(),await Tr(),await Ge(),await _t()}),st(()=>{It(),et(),St(),Pn(),window.removeEventListener("visibilitychange",Mr),window.removeEventListener("oko:fx-mode-change",Rr),Re&&(window.cancelAnimationFrame(Re),Re=0),He&&(clearTimeout(He),He=0),delete document.documentElement.dataset.motionBudget,document.documentElement.style.removeProperty("--motion-budget"),$t=null}),$t={BRAND_ICON_BY_KEY:en,DEFAULT_ITEM_URL:I,EMBLEM_SRC:r,HEALTH_REFRESH_MS:a,HERO_CONTROLS_PARTICLES_ID:R,HERO_PARTICLES_CONFIG:N,HERO_TITLE_PARTICLES_ID:S,ICON_BY_KEY:tn,ICON_RULES:bo,LAN_PAGE_ID:h,LAN_SCAN_POLL_MS:g,LARGE_INDICATOR_TYPES:y,SIDEBAR_PARTICLES_CONFIG:F,SIDEBAR_PARTICLES_ID:k,actionBusy:Rt,actionKey:In,activeCommandPaletteEntry:er,activeIndicatorViewId:ue,activeIndicatorWidget:nr,activePage:Be,activePageGroupBlocks:Bo,activePageId:Q,activePageWidgetIds:Ut,addGroup:Ko,addItem:jo,addSubgroup:zo,allItemIds:qt,allSubgroupIds:nn,appTagline:ko,appTitle:_o,applyConfigMutation:ve,applyGrid:or,applyTheme:rr,authProfileOptions:Wn,buildDefaultItem:fn,buildItemFromEditorForm:cr,clampNumber:gn,clearDragState:Ze,clearItemFaviconFailures:Er,clearSelectedNode:Vt,cloneConfig:ir,closeIframeModal:ts,closeItemEditor:ar,closeLanHostModal:Pn,closeCommandPalette:Ft,closeSettingsPanel:hi,commandPaletteActiveIndex:ge,commandPaletteOpen:Mt,commandPaletteQuery:ut,commandPaletteResults:vt,config:E,configError:ae,copyItemIp:rs,copyItemSshShortcut:os,copyCommandPaletteEntryUrl:ki,copyUrl:xr,createBrandIcon:x,defaultItemEditorForm:q,dragState:L,editGroup:qo,editItem:Yo,editMode:P,editSubgroup:Jo,ensureAbsoluteUrl:dn,ensurePageGroupsReference:Zr,expandedGroups:ce,faviconOriginFromUrl:bn,filteredBlockGroups:$i,filteredTreeGroups:tr,findGroup:Ce,findSubgroup:ye,formatLanDuration:as,formatLanHttpStatus:cs,formatLanMoment:ss,fromToken:Io,groupById:un,groupOnlineItems:Oi,groupTotalItems:Di,healthClass:Qi,healthLabel:Zi,healthPollTimer:dt,healthState:tt,healthStates:gt,iframeModal:Z,indicatorPreviewEntries:ui,initHeroParticles:_t,initParticles:jt,initSidebarParticles:An,initWidgetPolling:En,isActionBusy:zi,isDirectGroupNode:Jt,isGroupExpanded:Ir,isGroupSelected:wr,isIconCardView:qn,isSidebarDetailed:ln,isSidebarHidden:Ot,isTileCardView:Jn,isCompactServiceCardView:Yn,isInlineGroupLayout:Ri,isItemSelected:Ci,isLanPage:cn,isLargeIndicator:ht,isSidebarIconActive:Uo,isSidebarIconOnly:$o,isSubgroupSelected:Sr,isWidgetBlock:dr,itemEditor:$,itemFaviconFailures:mt,itemFaviconKey:yn,itemFaviconSrc:Ni,itemIp:$n,itemSite:gi,lanCidrsLabel:Po,lanHostModal:ct,lanHosts:Qn,lanPortsLabel:us,lanScanActionBusy:At,lanScanError:lt,lanScanLoading:on,lanScanPollTimer:pt,lanScanRefreshInFlight:Bt,lanScanState:qe,loadConfig:Tr,loadingConfig:se,makeUniqueId:Ke,markItemFaviconFailed:Gi,moveGroup:Xr,moveCommandPaletteSelection:wi,moveItemBefore:to,moveItemToSubgroupEnd:no,moveSubgroup:eo,normalizeEndpoint:Kt,normalizeIconToken:yo,normalizeId:Pt,normalizeLayoutBlocks:Qr,normalizeStringList:pn,onGroupDragOver:ri,onGroupDragStart:ei,onGroupDrop:oi,onItemCardClick:Fo,onItemDragOver:ai,onItemDragStart:ni,onItemDrop:li,onSubgroupDragOver:ii,onSubgroupDragStart:ti,onSubgroupDrop:si,activateCommandPaletteEntry:br,activateCommandPaletteSelection:_i,openCommandPalette:vr,openSettingsPanel:hr,openCreateItemEditor:lr,openEditItemEditor:ur,openIframeItem:Pr,openIndicatorView:pr,openItem:Cn,openItemInNewTab:ns,openLanHostModal:ls,openLinkItem:Lr,pageHealthSummary:Ro,pages:De,persistConfig:sr,pickSemanticIcon:at,refreshHealth:Ve,recheckItem:is,refreshLanScanState:wt,refreshWidget:zt,removeGroup:Qo,removeItem:Xo,removeSubgroup:Zo,resetWidgetPolling:It,resolveBlockGroups:mn,resolveExpression:Oe,resolveGroupIcon:Hi,resolveItemIcon:Fi,resolvePageIcon:Ui,resolveSubgroupIcon:Vi,resolveWidgetIcon:Ki,resolveWidgets:fr,runLanScanNow:ps,runWidgetAction:es,saveError:be,saveStatus:re,saveStatusLabel:Lo,saveStatusTimer:He,setCommandPaletteActiveIndex:Ii,setCommandPaletteQuery:yi,setSiteFilter:mi,settingsPanel:Ue,sidebarViewToggleTitle:To,selectItemNode:vn,selectSidebarIconNode:Vo,selectSidebarIndicator:ci,selectSubgroupNode:yr,selectedNode:w,serviceCardView:te,siteFilter:ne,siteFilterOptions:Nt,serviceGroupingMode:B,serviceGroupingOptions:Co,servicePresentationOptions:Eo,sidebarIconNodeTitle:Ho,sidebarIconNodes:Mo,sidebarIndicatorSummary:Do,sidebarIndicators:Ht,sidebarView:K,startHealthPolling:_n,startLanScanPolling:Ln,statCardSubtitle:Wi,statCardTrend:qi,statCardValue:ji,statListEntries:Cr,statsExpanded:le,stopHealthPolling:et,stopLanScanPolling:St,subgroupById:Zn,subgroupTotalItems:Bi,submitItemEditor:Wo,syncTreeGroupsState:bt,tableRows:Ji,toggleCommandPalette:vi,toggleEditMode:Oo,toggleGroupNode:Ei,toggleSettingsPanel:bi,toggleServiceCardView:No,toggleSidebarView:Go,treeFilter:ee,treeGroups:Ye,visibleTreeItemIds:Qe,widgetById:Gt,widgetIntervals:Dt,widgetState:Xe,widgetStates:Me,widgets:an},$t}const Ta=["title"],Pa={key:0,class:"item-compact-body"},La=["src"],xa={class:"item-tile-head"},Aa=["src"],Ma={class:"item-tile-title"},Ra={class:"item-head"},Da={class:"item-title-row"},Ba=["src"],Oa={class:"item-type"},Na={class:"item-url"},Ga={class:"item-health"},Ua={key:0,class:"item-tags"},Ha={key:0,class:"tag-pill site-pill"},Va={class:"item-actions"},Fa={key:1,class:"item-ssh-shortcut"},Ka={__name:"ServiceItemCard",props:{groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0},item:{type:Object,required:!0}},setup(r){const a=r,l=Zt(a,"groupKey"),c=Zt(a,"subgroupId"),u=Zt(a,"item"),p=fe(),{isIconCardView:g,isTileCardView:h,isCompactServiceCardView:y,isItemSelected:I,onItemCardClick:k,itemFaviconSrc:S,markItemFaviconFailed:R,resolveItemIcon:F,healthClass:N,healthLabel:J,itemIp:T,itemSite:D,copyItemIp:W,copyItemSshShortcut:G,openItem:M,openItemInNewTab:xe,recheckItem:Ae,copyUrl:ke}=p,pe=C(()=>N(u.value.id)),Ee=C(()=>J(u.value.id)),q=C(()=>T(u.value.id)),E=C(()=>`ssh ${q.value}`),se=C(()=>D(u.value,l.value)),ae=U(!1),Q=U(!1);let ee=0,le=0;const ue=C(()=>({selected:!y.value&&I(u.value.id),compact:y.value,tile:h.value,[`status-${pe.value}`]:!0,"data-updated":Q.value}));function P(){ee&&clearTimeout(ee),ae.value=!1,window.requestAnimationFrame(()=>{ae.value=!0,ee=window.setTimeout(()=>{ae.value=!1,ee=0},900)})}function ie(){le&&clearTimeout(le),Q.value=!1,window.requestAnimationFrame(()=>{Q.value=!0,le=window.setTimeout(()=>{Q.value=!1,le=0},1250)})}return de([pe,Ee],([te,B],[ne,K])=>{ne===void 0&&K===void 0||((te!==ne||B!==K)&&ie(),B!==K&&P())}),st(()=>{ee&&(clearTimeout(ee),ee=0),le&&(clearTimeout(le),le=0)}),(te,B)=>{var ne;return f(),b("article",{class:j(["item-card",ue.value]),title:s(y)?u.value.title:void 0,onClick:B[9]||(B[9]=K=>s(k)(l.value,c.value,u.value))},[s(g)?(f(),b("div",Pa,[s(S)(u.value)?(f(),b("img",{key:0,src:s(S)(u.value),class:"service-favicon compact-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:B[0]||(B[0]=K=>s(R)(u.value))},null,40,La)):(f(),z($e(s(F)(u.value)),{key:1,class:"ui-icon item-icon compact-item-icon"})),m("span",{class:j(["health-dot compact-health-dot",pe.value])},null,2)])):s(h)?(f(),b(X,{key:1},[m("div",xa,[s(S)(u.value)?(f(),b("img",{key:0,src:s(S)(u.value),class:"service-favicon tile-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:B[1]||(B[1]=K=>s(R)(u.value))},null,40,Aa)):(f(),z($e(s(F)(u.value)),{key:1,class:"ui-icon item-icon tile-item-icon"})),m("span",{class:j(["health-dot tile-health-dot",pe.value])},null,2)]),m("p",Ma,O(u.value.title),1)],64)):(f(),b(X,{key:2},[m("div",Ra,[m("div",Da,[s(S)(u.value)?(f(),b("img",{key:0,src:s(S)(u.value),class:"service-favicon item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:B[2]||(B[2]=K=>s(R)(u.value))},null,40,Ba)):(f(),z($e(s(F)(u.value)),{key:1,class:"ui-icon item-icon"})),m("h4",null,O(u.value.title),1)]),m("span",Oa,O(u.value.type),1)]),m("p",Na,O(u.value.url),1),m("div",Ga,[m("span",{class:j(["health-dot",pe.value])},null,2),m("span",{class:j(["health-text",{"is-updating":ae.value}])},O(Ee.value),3)]),se.value||(ne=u.value.tags)!=null&&ne.length?(f(),b("div",Ua,[se.value?(f(),b("span",Ha,"site:"+O(se.value),1)):V("",!0),(f(!0),b(X,null,_e(u.value.tags,K=>(f(),b("span",{key:K,class:"tag-pill"},O(K),1))),128))])):V("",!0),m("div",Va,[A(Se,{title:u.value.type==="iframe"?"Открыть iframe":"Открыть","aria-label":u.value.type==="iframe"?"Открыть iframe":"Открыть",onClick:B[3]||(B[3]=Y(K=>s(M)(u.value),["stop"]))},{default:he(()=>[(f(),z($e(u.value.type==="iframe"?s(Fn):s(Kn)),{class:"ui-icon item-action-icon"}))]),_:1},8,["title","aria-label"]),A(Se,{title:"Открыть в новой вкладке","aria-label":"Открыть в новой вкладке",onClick:B[4]||(B[4]=Y(K=>s(xe)(u.value),["stop"]))},{default:he(()=>[A(s(Xs),{class:"ui-icon item-action-icon"})]),_:1}),A(Se,{title:"Recheck health","aria-label":"Recheck health",onClick:B[5]||(B[5]=Y(K=>s(Ae)(u.value.id),["stop"]))},{default:he(()=>[A(s(ea),{class:"ui-icon item-action-icon"})]),_:1}),q.value?(f(),z(Se,{key:0,title:"Копировать IP","aria-label":"Копировать IP",onClick:B[6]||(B[6]=Y(K=>s(W)(u.value.id),["stop"]))},{default:he(()=>[A(s(je),{class:"ui-icon item-action-icon"})]),_:1})):V("",!0),q.value?(f(),z(Se,{key:1,title:"Копировать SSH shortcut","aria-label":"Копировать SSH shortcut",onClick:B[7]||(B[7]=Y(K=>s(G)(u.value.id),["stop"]))},{default:he(()=>[A(s(co),{class:"ui-icon item-action-icon"})]),_:1})):V("",!0),A(Se,{title:"Копировать URL","aria-label":"Копировать URL",onClick:B[8]||(B[8]=Y(K=>s(ke)(u.value.url),["stop"]))},{default:he(()=>[A(s(ta),{class:"ui-icon item-action-icon"})]),_:1})]),q.value?(f(),b("p",Fa,[B[10]||(B[10]=ws(" SSH: ",-1)),m("code",null,O(E.value),1)])):V("",!0)],64))],10,Ta)}}},za={class:"virtual-item-grid"},ja=120,On=72,Wa={__name:"VirtualizedItemGrid",props:{items:{type:Array,required:!0},groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0}},setup(r){const l=Zt(r,"items"),c=fe(),{isIconCardView:u,isTileCardView:p}=c,g=U(null),h=U(On);let y=null;const I=C(()=>l.value.length>ja),k=C(()=>I.value&&h.value<l.value.length),S=C(()=>I.value?l.value.slice(0,h.value):l.value);function R(){h.value=Math.min(l.value.length,h.value+On)}function F(){h.value=On}function N(){y&&(y.disconnect(),!(!k.value||!g.value)&&y.observe(g.value))}return de(()=>l.value,async()=>{F(),await Ge(),N()},{deep:!0}),de(()=>k.value,async()=>{await Ge(),N()}),it(async()=>{y=new IntersectionObserver(J=>{for(const T of J)if(T.isIntersecting){R();break}},{root:null,rootMargin:"260px 0px",threshold:0}),await Ge(),N()}),st(()=>{y==null||y.disconnect(),y=null}),(J,T)=>(f(),b("div",za,[A(Ss,{name:"item-grid-transition",tag:"div",class:j(["item-grid",{"icon-card-grid":s(u),"tile-card-grid":s(p)}])},{default:he(()=>[(f(!0),b(X,null,_e(S.value,D=>(f(),z(Ka,{key:D.id,"group-key":D.__originGroupKey||r.groupKey,"subgroup-id":D.__originSubgroupId||r.subgroupId,item:D},null,8,["group-key","subgroup-id","item"]))),128))]),_:1},8,["class"]),k.value?(f(),b("div",{key:0,ref_key:"sentinelRef",ref:g,class:"item-grid-sentinel","aria-hidden":"true"},null,512)):V("",!0)]))}},qa={class:"group-header"},Ja={class:"group-title-row"},Ya={key:0,class:"subtitle"},Qa={class:"subgroup-title"},Za={__name:"ServiceGroupCard",props:{group:{type:Object,required:!0}},setup(r){const a=fe(),{isInlineGroupLayout:l,resolveGroupIcon:c,resolveSubgroupIcon:u}=a;return(p,g)=>(f(),b("article",{class:j(["panel group-panel",{"group-panel-inline":s(l)(r.group)}])},[m("header",qa,[m("div",Ja,[(f(),z($e(s(c)(r.group)),{class:"ui-icon group-icon"})),m("h2",null,O(r.group.title),1)]),r.group.description?(f(),b("p",Ya,O(r.group.description),1)):V("",!0)]),(f(!0),b(X,null,_e(r.group.subgroups,h=>(f(),b("section",{key:h.id,class:"subgroup"},[m("h3",Qa,[(f(),z($e(s(u)(h)),{class:"ui-icon subgroup-icon"})),m("span",null,O(h.title),1)]),A(Wa,{items:h.items,"group-key":r.group.key,"subgroup-id":h.id},null,8,["items","group-key","subgroup-id"])]))),128))],2))}},Xa={class:"groups-grid"},el={key:0,class:"panel group-panel group-empty"},tl={key:0,class:"panel group-panel group-empty"},nl={__name:"ServicesGroupsPanel",setup(r){const a=fe(),{activePage:l,activePageGroupBlocks:c,filteredBlockGroups:u}=a,p=U(null);let g=null;const h={duration:180,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};function y(){if(!(!g||!p.value))for(const I of p.value.querySelectorAll(".block-wrap"))I.dataset.offscreen="0",g.observe(I)}return de(()=>{var I;return[(I=l.value)==null?void 0:I.id,c.value.length]},async()=>{g&&(g.disconnect(),await Ge(),y())}),it(async()=>{g=new IntersectionObserver(I=>{for(const k of I)k.target.dataset.offscreen=k.isIntersecting?"0":"1"},{root:null,rootMargin:"140px 0px",threshold:.02}),await Ge(),y()}),st(()=>{g==null||g.disconnect(),g=null}),(I,k)=>(f(),b("section",{ref_key:"blocksRootRef",ref:p,class:"page-stack"},[(f(!0),b(X,null,_e(s(c),(S,R)=>(f(),b("section",{key:`${s(l).id}:${R}:groups`,class:"block-wrap"},[Vn((f(),b("section",Xa,[(f(!0),b(X,null,_e(s(u)(S.group_ids),F=>(f(),z(Za,{key:F.key,group:F},null,8,["group"]))),128)),s(u)(S.group_ids).length?V("",!0):(f(),b("article",el,[...k[0]||(k[0]=[m("h2",null,"Нет данных для выбранного узла",-1),m("p",{class:"subtitle"},"Выберите другую ветку в боковом дереве.",-1)])]))])),[[s(oo),h]])]))),128)),s(c).length?V("",!0):(f(),b("article",tl,[...k[1]||(k[1]=[m("h2",null,"Для этой страницы нет групп",-1),m("p",{class:"subtitle"},"Откройте нужный индикатор в аккордеоне слева.",-1)])]))],512))}},rl={key:0,class:"hero-logo-square","aria-hidden":"true"},ol=["src"],il=["title","aria-label","aria-selected","onClick"],sl={class:"hero-page-tab-label"},al={__name:"HeroPageTabs",setup(r){let a=!1;const l=fe(),{EMBLEM_SRC:c,isSidebarHidden:u,pages:p,activePage:g,activePageId:h,resolvePageIcon:y}=l,I=U(!a),k=C(()=>u.value);let S=0;return it(()=>{I.value&&(S=globalThis.setTimeout(()=>{I.value=!1,a=!0},700))}),st(()=>{S&&(globalThis.clearTimeout(S),S=0),I.value&&(a=!0)}),(R,F)=>(f(),b("nav",{class:j(["hero-page-tabs",{"hero-page-tabs--intro":I.value,"has-logo-tile":k.value}]),role:"tablist","aria-label":"Разделы"},[k.value?(f(),b("div",rl,[m("img",{src:s(c),alt:""},null,8,ol)])):V("",!0),(f(!0),b(X,null,_e(s(p),N=>{var J,T,D;return f(),b("button",{key:N.id,class:j(["hero-page-tab-btn",{active:((J=s(g))==null?void 0:J.id)===N.id,"hero-page-tab-btn--intro-active":I.value&&((T=s(g))==null?void 0:T.id)===N.id}]),type:"button",role:"tab",title:N.title,"aria-label":N.title,"aria-selected":((D=s(g))==null?void 0:D.id)===N.id,onClick:W=>h.value=N.id},[(f(),z($e(s(y)(N)),{class:"ui-icon hero-page-tab-icon"})),m("span",sl,O(N.title),1)],10,il)}),128))],2))}},ll={class:"hero-layout"},ul={class:"hero panel hero-title-panel"},cl={class:"hero-title-content"},dl={class:"hero-controls-content"},fl={key:0,id:"hero-controls-drawer",class:"hero-controls-drawer"},pl=["title","aria-label"],gl=["aria-expanded","title"],ml={key:0,class:"editor-error hero-editor-error"},ro="oko:hero-controls-open:v1",vl={__name:"ServicesHeroPanel",setup(r){const a=fe(),l=U(!1),{editMode:c,isSidebarDetailed:u,saveStatus:p,saveStatusLabel:g,saveError:h,sidebarViewToggleTitle:y,toggleEditMode:I,addGroup:k,openCommandPalette:S,openSettingsPanel:R,toggleSidebarView:F}=a;function N(){try{return window.localStorage||null}catch{return null}}return it(()=>{const J=N();if(!J)return;const T=J.getItem(ro);l.value=T==="1"}),de(()=>l.value,J=>{const T=N();T&&T.setItem(ro,J?"1":"0")}),(J,T)=>(f(),b("section",ll,[m("header",ul,[T[1]||(T[1]=m("div",{id:"hero-title-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),m("div",cl,[A(al)])]),m("aside",{class:j(["panel hero-control-panel service-hero-controls",{active:s(c)}])},[T[2]||(T[2]=m("div",{id:"hero-controls-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),m("div",dl,[m("div",{class:j(["hero-controls-accordion",{open:l.value}])},[A(_s,{name:"hero-controls-drawer-transition"},{default:he(()=>[l.value?(f(),b("div",fl,[A(Se,{"button-class":"hero-icon-btn hero-accordion-action editor-toggle",active:s(c),title:s(c)?"Выключить режим редактирования":"Включить режим редактирования","aria-label":s(c)?"Выключить режим редактирования":"Включить режим редактирования",onClick:s(I)},{default:he(()=>[A(s(zn),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),s(c)?(f(),z(Se,{key:0,"button-class":"hero-icon-btn hero-accordion-action",title:"Добавить группу","aria-label":"Добавить группу",onClick:s(k)},{default:he(()=>[A(s(jn),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"])):V("",!0),A(Se,{"button-class":"hero-icon-btn hero-accordion-action",title:"Быстрый поиск сервисов (Ctrl/Cmd+K)","aria-label":"Быстрый поиск сервисов",onClick:s(S)},{default:he(()=>[A(s(na),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"]),A(Se,{"button-class":"hero-icon-btn hero-accordion-action",title:"Панель настроек","aria-label":"Открыть панель настроек",onClick:s(R)},{default:he(()=>[A(s(ra),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"]),A(Se,{"button-class":"hero-icon-btn hero-accordion-action",active:!s(u),title:s(y),"aria-label":s(y),onClick:s(F)},{default:he(()=>[A(s(mo),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),s(c)?(f(),b("span",{key:1,class:j(["hero-save-indicator hero-accordion-status",s(p)]),role:"status",title:s(g),"aria-label":s(g)},[A(s(oa),{class:"ui-icon hero-save-icon"})],10,pl)):V("",!0)])):V("",!0)]),_:1}),m("button",{class:"hero-controls-trigger",type:"button","aria-expanded":l.value,"aria-controls":"hero-controls-drawer",title:l.value?"Скрыть панель действий":"Показать панель действий",onClick:T[0]||(T[0]=D=>l.value=!l.value)},[A(s(po),{class:"ui-icon hero-action-icon"}),A(s(ia),{class:j(["ui-icon hero-accordion-caret",{open:l.value}])},null,8,["class"])],8,gl)],2),s(c)&&s(h)?(f(),b("p",ml,O(s(h)),1)):V("",!0)])],2)]))}},hl={key:0,class:"panel status-panel"},bl={key:1,class:"panel status-panel error-state"},yl={class:"subtitle"},Il={key:3,class:"panel status-panel"},wl={__name:"DashboardMainView",setup(r){const a=ze(()=>we(()=>import("./IndicatorTabPanel-DibL6FeL.js"),__vite__mapDeps([0,1,2]))),l=ze(()=>we(()=>import("./LanPageView-DS-gFTee.js"),__vite__mapDeps([3,1,2]))),c=fe(),{activePage:u,activeIndicatorWidget:p,loadingConfig:g,configError:h,isLanPage:y,loadConfig:I}=c;return(k,S)=>{var R;return f(),b("main",{key:((R=s(u))==null?void 0:R.id)||"empty",class:j(["page",{"indicator-open":!!s(p),"page--lan":s(y)&&!s(p)}])},[s(g)?(f(),b("section",hl,[...S[1]||(S[1]=[m("h2",null,"Загрузка конфигурации...",-1),m("p",{class:"subtitle"},"Получаем dashboard-модель из backend.",-1)])])):s(h)?(f(),b("section",bl,[S[2]||(S[2]=m("h2",null,"Ошибка загрузки конфигурации",-1)),m("p",yl,O(s(h)),1),m("button",{class:"ghost",type:"button",onClick:S[0]||(S[0]=(...F)=>s(I)&&s(I)(...F))},"Повторить")])):s(u)?(f(),b(X,{key:2},[s(p)?(f(),z(s(a),{key:0})):(f(),b(X,{key:1},[s(y)?(f(),z(s(l),{key:0})):(f(),b(X,{key:1},[A(vl),A(nl)],64))],64))],64)):(f(),b("section",Il,[...S[3]||(S[3]=[m("h2",null,"Нет доступных страниц",-1),m("p",{class:"subtitle"},"Проверьте `layout.pages` в конфигурации панели.",-1)])]))],2)}}},Sl={class:"brand"},_l=["src"],kl={class:"brand-title"},El={class:"brand-subtitle"},Cl={__name:"SidebarHeaderTabs",setup(r){const a=fe(),{EMBLEM_SRC:l,appTitle:c,appTagline:u}=a;return(p,g)=>(f(),b("div",Sl,[m("img",{src:s(l),alt:"Oko"},null,8,_l),m("div",null,[m("p",kl,O(s(c)),1),m("p",El,O(s(u)),1)])]))}},$l={class:"sidebar-stats-accordion","aria-label":"Индикаторы"},Tl=["aria-expanded"],Pl={class:"sidebar-stats-toggle-values"},Ll={key:0,class:"sidebar-indicators"},xl=["onClick"],Al={class:"widget-head sidebar-indicator-head"},Ml={class:"widget-title"},Rl={class:"item-type"},Dl={key:0,class:"widget-error"},Bl={key:1,class:"widget-loading"},Ol={class:"widget-value sidebar-indicator-value"},Nl={class:"widget-subtitle"},Gl={key:0,class:"widget-trend"},Ul={key:0,class:"widget-list sidebar-list-preview"},Hl={key:1,class:"widget-empty"},Vl={class:"widget-subtitle"},Fl={key:5,class:"widget-empty"},Kl={key:6,class:"widget-actions sidebar-indicator-actions"},zl=["onClick"],jl=["disabled","onClick"],Wl={key:1,class:"widget-empty"},ql={__name:"SidebarIndicatorsAccordion",setup(r){const a=fe(),{statsExpanded:l,sidebarIndicatorSummary:c,sidebarIndicators:u,isLargeIndicator:p,activeIndicatorWidget:g,selectSidebarIndicator:h,resolveWidgetIcon:y,widgetState:I,statCardValue:k,statCardSubtitle:S,statCardTrend:R,indicatorPreviewEntries:F,tableRows:N,openIndicatorView:J,isActionBusy:T,runWidgetAction:D}=a;return(W,G)=>(f(),b("div",$l,[m("button",{class:"sidebar-stats-toggle",type:"button","aria-controls":"sidebar-stats-panel","aria-expanded":s(l),onClick:G[0]||(G[0]=M=>l.value=!s(l))},[G[1]||(G[1]=m("span",{class:"sidebar-stats-toggle-text"},"Индикаторы",-1)),m("span",Pl,O(s(c)),1),m("span",{class:j(["sidebar-stats-toggle-caret",{open:s(l)}])},"▴",2)],8,Tl),m("div",{id:"sidebar-stats-panel",class:j(["sidebar-stats-panel",{open:s(l)}])},[s(u).length?(f(),b("div",Ll,[(f(!0),b(X,null,_e(s(u),M=>{var xe,Ae,ke,pe,Ee;return f(),b("article",{key:M.id,class:j(["sidebar-indicator",{interactive:s(p)(M),active:((xe=s(g))==null?void 0:xe.id)===M.id}]),onClick:q=>s(h)(M)},[m("header",Al,[m("div",Ml,[(f(),z($e(s(y)(M)),{class:"ui-icon widget-icon"})),m("h3",null,O(M.title),1)]),m("span",Rl,O(M.type),1)]),(Ae=s(I)(M.id))!=null&&Ae.error?(f(),b("p",Dl,O((ke=s(I)(M.id))==null?void 0:ke.error),1)):(pe=s(I)(M.id))!=null&&pe.loading?(f(),b("p",Bl,"Обновление...")):M.type==="stat_card"?(f(),b(X,{key:2},[m("p",Ol,O(s(k)(M)),1),m("p",Nl,O(s(S)(M)),1),s(R)(M)?(f(),b("p",Gl,O(s(R)(M)),1)):V("",!0)],64)):M.type==="stat_list"?(f(),b(X,{key:3},[s(F)(M).length?(f(),b("ul",Ul,[(f(!0),b(X,null,_e(s(F)(M),q=>(f(),b("li",{key:q.title+q.value},[m("span",null,O(q.title),1),m("strong",null,O(q.value),1)]))),128))])):(f(),b("p",Hl,"Нет данных")),G[2]||(G[2]=m("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):M.type==="table"?(f(),b(X,{key:4},[m("p",Vl,"Строк: "+O(s(N)(M).length),1),G[3]||(G[3]=m("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):(f(),b("p",Fl,"Неподдерживаемый тип виджета")),(Ee=M.data.actions)!=null&&Ee.length||s(p)(M)?(f(),b("div",Kl,[s(p)(M)?(f(),b("button",{key:0,class:"ghost",type:"button",onClick:Y(q=>s(J)(M.id),["stop"])},"Открыть вкладку",8,zl)):V("",!0),(f(!0),b(X,null,_e(M.data.actions||[],q=>(f(),b("button",{key:q.id,class:"ghost",type:"button",disabled:s(T)(M.id,q.id),onClick:Y(E=>s(D)(M.id,q),["stop"])},O(q.title),9,jl))),128))])):V("",!0)],10,xl)}),128))])):(f(),b("p",Wl,"Для выбранной страницы индикаторы не настроены."))],2)]))}},Jl=["draggable"],Yl={class:"tree-node-row"},Ql={class:"tree-text"},Zl={class:"tree-meta"},Xl={key:0,class:"tree-inline-actions"},eu={__name:"SidebarTreeSubgroupNode",props:{group:{type:Object,required:!0},subgroup:{type:Object,required:!0}},setup(r){const a=fe(),{dragState:l,editMode:c,onSubgroupDragStart:u,clearDragState:p,onSubgroupDragOver:g,onSubgroupDrop:h,isSubgroupSelected:y,selectSubgroupNode:I,resolveSubgroupIcon:k,subgroupTotalItems:S,editSubgroup:R,addItem:F,removeSubgroup:N}=a;return(J,T)=>(f(),b("li",{class:j(["tree-subgroup-item",{dragging:s(l).type==="subgroup"&&s(l).subgroupId===r.subgroup.id}]),draggable:s(c),onDragstart:T[4]||(T[4]=Y(D=>s(u)(D,r.group.id,r.subgroup.id),["stop"])),onDragend:T[5]||(T[5]=Y((...D)=>s(p)&&s(p)(...D),["stop"])),onDragover:T[6]||(T[6]=Y(D=>s(g)(D,r.group.id,r.subgroup.id),["stop"])),onDrop:T[7]||(T[7]=Y(D=>s(h)(D,r.group.id,r.subgroup.id),["stop"]))},[m("div",Yl,[m("button",{class:j(["tree-node tree-subgroup",{active:s(y)(r.group.key,r.subgroup.id)}]),type:"button",onClick:T[0]||(T[0]=D=>s(I)(r.group.key,r.subgroup.id))},[(f(),z($e(s(k)(r.subgroup)),{class:"ui-icon tree-icon tree-sub-icon"})),m("span",Ql,O(r.subgroup.title),1),m("span",Zl,O(s(S)(r.subgroup)),1)],2),s(c)?(f(),b("div",Xl,[A(s(vo),{class:"ui-icon tree-grip"}),m("button",{class:"tree-mini-btn",type:"button",title:"Редактировать подгруппу",onClick:T[1]||(T[1]=Y(D=>s(R)(r.group.id,r.subgroup.id),["stop"]))},[A(s(zn),{class:"ui-icon"})]),m("button",{class:"tree-mini-btn",type:"button",title:"Добавить элемент",onClick:T[2]||(T[2]=Y(D=>s(F)(r.group.id,r.subgroup.id),["stop"]))},[A(s(jn),{class:"ui-icon"})]),m("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить подгруппу",onClick:T[3]||(T[3]=Y(D=>s(N)(r.group.id,r.subgroup.id),["stop"]))},[A(s(ho),{class:"ui-icon"})])])):V("",!0)])],42,Jl))}},tu=["draggable"],nu={class:"tree-node-row"},ru={class:"tree-text"},ou={class:"tree-meta"},iu={key:0,class:"tree-inline-actions"},su={class:"tree-subgroups"},au={__name:"SidebarTreeGroupNode",props:{group:{type:Object,required:!0}},setup(r){const a=fe(),{dragState:l,editMode:c,isDirectGroupNode:u,onGroupDragStart:p,clearDragState:g,onGroupDragOver:h,onGroupDrop:y,isGroupSelected:I,toggleGroupNode:k,isGroupExpanded:S,resolveGroupIcon:R,groupTotalItems:F,editGroup:N,addSubgroup:J,removeGroup:T}=a;return(D,W)=>(f(),b("li",{class:j(["tree-group-item",{dragging:s(l).type==="group"&&s(l).groupId===r.group.id&&s(u)(r.group)}]),draggable:s(c)&&s(u)(r.group),onDragstart:W[4]||(W[4]=Y(G=>s(p)(G,r.group),["stop"])),onDragend:W[5]||(W[5]=Y((...G)=>s(g)&&s(g)(...G),["stop"])),onDragover:W[6]||(W[6]=Y(G=>s(h)(G,r.group),["stop"])),onDrop:W[7]||(W[7]=Y(G=>s(y)(G,r.group),["stop"]))},[m("div",nu,[m("button",{class:j(["tree-node tree-group",{active:s(I)(r.group.key)}]),type:"button",onClick:W[0]||(W[0]=G=>s(k)(r.group.key))},[m("span",{class:j(["tree-caret",{open:s(S)(r.group.key)}])},"▾",2),(f(),z($e(s(R)(r.group)),{class:"ui-icon tree-icon"})),m("span",ru,O(r.group.title),1),m("span",ou,O(s(F)(r.group)),1)],2),s(c)&&s(u)(r.group)?(f(),b("div",iu,[A(s(vo),{class:"ui-icon tree-grip"}),m("button",{class:"tree-mini-btn",type:"button",title:"Редактировать группу",onClick:W[1]||(W[1]=Y(G=>s(N)(r.group.id),["stop"]))},[A(s(zn),{class:"ui-icon"})]),m("button",{class:"tree-mini-btn",type:"button",title:"Добавить подгруппу",onClick:W[2]||(W[2]=Y(G=>s(J)(r.group.id),["stop"]))},[A(s(jn),{class:"ui-icon"})]),m("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить группу",onClick:W[3]||(W[3]=Y(G=>s(T)(r.group.id),["stop"]))},[A(s(ho),{class:"ui-icon"})])])):V("",!0)]),Vn(m("ul",su,[(f(!0),b(X,null,_e(r.group.subgroups,G=>(f(),z(eu,{key:G.id,group:r.group,subgroup:G},null,8,["group","subgroup"]))),128))],512),[[ks,s(S)(r.group.key)]])],42,tu))}},lu={key:0,class:"sidebar-tree","aria-label":"Дерево сервисов"},uu={key:0,class:"tree-root"},cu={key:1,class:"tree-empty"},du={__name:"SidebarTreePanel",setup(r){const a=fe(),{treeGroups:l,filteredTreeGroups:c}=a,u={duration:160,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};return(p,g)=>s(l).length?(f(),b("section",lu,[s(c).length?Vn((f(),b("ul",uu,[(f(!0),b(X,null,_e(s(c),h=>(f(),z(au,{key:h.key,group:h},null,8,["group"]))),128))])),[[s(oo),u]]):(f(),b("p",cu,"По вашему запросу ничего не найдено."))])):V("",!0)}},fu={class:"sidebar"},pu={class:"sidebar-content"},gu={__name:"DashboardSidebarView",setup(r){const a=fe(),{isSidebarDetailed:l}=a;return(c,u)=>(f(),b("aside",fu,[u[0]||(u[0]=m("div",{id:"sidebar-particles",class:"sidebar-particles","aria-hidden":"true"},null,-1)),m("div",pu,[A(Cl),s(l)?(f(),z(du,{key:0})):V("",!0),s(l)?(f(),z(ql,{key:1})):V("",!0)])]))}},rt="http://127.0.0.1:8090";let We={desktop:!1,mode:"web",deploymentMode:"docker",appClientMode:null,apiBaseUrl:"",remoteBaseUrl:rt,embeddedRunning:!1},Yt=null,Lt=null;function wo(){return typeof window<"u"&&!!window.__TAURI_INTERNALS__}function Hn(r){const a=String(r||"").trim();return a?a.endsWith("/")?a.slice(0,-1):a:""}function mu(r){var l;if(r)return"app";const a=import.meta;return(l=a==null?void 0:a.env)!=null&&l.DEV?"dev":"docker"}function vu(r,a){return a?r==="embedded"?"thick":"thin":null}function Qt(r,a,l){if(!(!r||typeof r!="object")){if(a in r)return r[a];if(l in r)return r[l]}}function xt(r){const a=r,l=!!Qt(a,"desktop","desktop"),c=String((a==null?void 0:a.mode)||"web"),u={desktop:l,mode:c,deploymentMode:mu(l),appClientMode:vu(c,l),apiBaseUrl:Hn(Qt(a,"apiBaseUrl","api_base_url")),remoteBaseUrl:Hn(Qt(a,"remoteBaseUrl","remote_base_url"))||rt,embeddedRunning:!!Qt(a,"embeddedRunning","embedded_running")};return We=u,typeof window<"u"&&(window.__OKO_API_BASE__=u.apiBaseUrl||"",window.__OKO_DESKTOP_RUNTIME__=u,window.dispatchEvent(new CustomEvent("oko:api-base-change",{detail:{apiBaseUrl:u.apiBaseUrl}}))),u}function hu(r){typeof window>"u"||window.dispatchEvent(new CustomEvent("oko:desktop-action",{detail:{action:String(r||"")}}))}async function bu(){const[r,a]=await Promise.all([we(()=>import("./vendor-D1bzbGly.js").then(c=>c.J),[]),we(()=>import("./vendor-D1bzbGly.js").then(c=>c.K),[])]);Lt=r.invoke;const l=await Lt("desktop_get_runtime_profile");return xt(l),await a.listen("desktop://runtime-profile",c=>{xt(c.payload)}),await a.listen("desktop://action",c=>{hu(c.payload)}),We}function xu(){return{...We}}async function So(){return wo()?(Yt||(Yt=bu().catch(r=>(Yt=null,xt({desktop:!0,mode:"remote",apiBaseUrl:rt,remoteBaseUrl:rt,embeddedRunning:!1}),We))),Yt):(xt({desktop:!1,mode:"web",apiBaseUrl:"",remoteBaseUrl:rt,embeddedRunning:!1}),We)}async function Au(r){if(!Lt&&(!(await So()).desktop||!Lt))throw new Error("Desktop runtime bridge is not available");const a={mode:String((r==null?void 0:r.mode)||We.mode),remote_base_url:Hn((r==null?void 0:r.remoteBaseUrl)||We.remoteBaseUrl||rt)},l=await Lt("desktop_set_runtime_profile",a);return xt(l)}const yu={key:0,class:"desktop-window-drag-strip","data-tauri-drag-region":"","aria-hidden":"true"},Iu=["src"],wu={__name:"App",setup(r){const a=()=>we(()=>import("./LanHostModal-CP-e6s7H.js"),__vite__mapDeps([4,1,5,2])),l=()=>we(()=>import("./IframeModal-BkxdZbhd.js"),__vite__mapDeps([6,5,1,2])),c=()=>we(()=>import("./ItemEditorModal-CP_N9HVg.js"),__vite__mapDeps([7,1,5,2])),u=()=>we(()=>import("./DashboardSettingsModal-By-bge4g.js"),__vite__mapDeps([8,1,5,2])),p=()=>we(()=>import("./CommandPaletteModal-D6hucNtL.js"),__vite__mapDeps([9,1,5,2])),g=()=>we(()=>import("./IndicatorTabPanel-DibL6FeL.js"),__vite__mapDeps([0,1,2])),h=()=>we(()=>import("./LanPageView-DS-gFTee.js"),__vite__mapDeps([3,1,2])),y=ze(a),I=ze(l),k=ze(c),S=ze(u),R=ze(p),F=fe(),{EMBLEM_SRC:N,closeCommandPalette:J,closeSettingsPanel:T,commandPaletteOpen:D,iframeModal:W,isSidebarHidden:G,itemEditor:M,lanHostModal:xe,openSettingsPanel:Ae,settingsPanel:ke,toggleCommandPalette:pe}=F,Ee=U(!1),q=wo();let E=0,se=0,ae=0;function Q(){Promise.allSettled([a(),l(),c(),u(),p(),g(),h()])}function ee(){if("requestIdleCallback"in window){ae=window.requestIdleCallback(()=>{ae=0,Q()},{timeout:2e3});return}se=window.setTimeout(()=>{se=0,Q()},1400)}function le(P){if((P.metaKey||P.ctrlKey)&&!P.altKey&&!P.shiftKey&&P.key.toLowerCase()==="k"){P.preventDefault(),pe();return}if(P.key==="Escape"&&D.value){P.preventDefault(),J();return}P.key==="Escape"&&ke.open&&(P.preventDefault(),T())}function ue(P){var te;const ie=String(((te=P==null?void 0:P.detail)==null?void 0:te.action)||"");if(ie){if(ie==="open-search"){pe();return}ie==="open-settings"&&Ae()}}return it(()=>{E=globalThis.setTimeout(()=>{Ee.value=!0},1e3),window.addEventListener("keydown",le),window.addEventListener("oko:desktop-action",ue),ee()}),st(()=>{E&&(globalThis.clearTimeout(E),E=0),se&&(window.clearTimeout(se),se=0),ae&&"cancelIdleCallback"in window&&(window.cancelIdleCallback(ae),ae=0),window.removeEventListener("keydown",le),window.removeEventListener("oko:desktop-action",ue)}),(P,ie)=>(f(),b("div",{class:j(["shell",{"shell-motion-static":Ee.value,"shell-desktop":s(q)}])},[s(q)?(f(),b("div",yu)):V("",!0),m("img",{class:"center-emblem",src:s(N),alt:"","aria-hidden":"true"},null,8,Iu),m("div",{class:j(["app-shell",{"sidebar-hidden":s(G)}])},[s(G)?V("",!0):(f(),z(gu,{key:0})),A(wl)],2),s(xe).open?(f(),z(s(y),{key:1})):V("",!0),s(W).open?(f(),z(s(I),{key:2})):V("",!0),s(M).open?(f(),z(s(k),{key:3})):V("",!0),s(ke).open?(f(),z(s(S),{key:4})):V("",!0),s(D)?(f(),z(s(R),{key:5})):V("",!0)],2))}};async function Su(r){}function _u(){var c,u,p,g;if((u=(c=globalThis.matchMedia)==null?void 0:c.call(globalThis,"(prefers-reduced-motion: reduce)"))==null?void 0:u.matches)return"off";const a=Number(((p=globalThis.navigator)==null?void 0:p.hardwareConcurrency)||8),l=Number(((g=globalThis.navigator)==null?void 0:g.deviceMemory)||8);return a<=4||l<=4?"lite":"full"}function ku(r){const a=document.documentElement,l=a.dataset.fxMode||"";a.dataset.fxMode=r,r==="off"?a.style.setProperty("--glow-enabled","0"):r==="lite"?a.style.setProperty("--glow-enabled","0.58"):a.style.setProperty("--glow-enabled","1"),l&&l!==r&&window.dispatchEvent(new CustomEvent("oko:fx-mode-change",{detail:{mode:r,previousMode:l}}))}function Eu(){var l;const r=(l=globalThis.matchMedia)==null?void 0:l.call(globalThis,"(prefers-reduced-motion: reduce)"),a=()=>ku(_u());a(),r!=null&&r.addEventListener?r.addEventListener("change",a):r!=null&&r.addListener&&r.addListener(a)}Eu();Su();async function Cu(){await So(),Es(wu).use(Cs).mount("#app")}Cu();export{al as _,Se as a,Pu as f,xu as g,So as i,Lu as r,Au as s,fe as u};
