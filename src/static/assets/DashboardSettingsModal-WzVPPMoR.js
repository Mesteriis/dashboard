import{e as p,b as K,d as T,o as l,i as j,q as I,k as e,u as s,c as r,F as C,m as w,n as g,t as c,l as S,y as J,E as Q,p as u,g as W}from"./vendor-D1bzbGly.js";import{_ as X}from"./BaseModal-DEo4-NpV.js";import{u as Y,g as $,i as Z,s as ee}from"./index-D9Zi6sCu.js";import{ag as te,ah as _,ai as se,a8 as ae,aa as ne}from"./vendor-icons-BtRhSBC4.js";const ie={class:"settings-modal-header"},oe={class:"settings-modal-grid"},le={class:"settings-modal-section"},re={class:"settings-state-group"},de={class:"settings-state-switcher",role:"radiogroup","aria-label":"Режим отображения сервисов"},ue=["aria-pressed","onClick"],ce={class:"settings-state-group"},ve={class:"settings-state-switcher",role:"radiogroup","aria-label":"Группировка сервисов"},pe=["aria-pressed","disabled","onClick"],ge={key:0,class:"settings-state-hint"},me={class:"settings-state-group"},be={class:"settings-state-switcher wrap",role:"radiogroup","aria-label":"Фильтр по площадке"},ke=["aria-pressed","onClick"],_e={key:0,class:"settings-modal-section settings-modal-section-wide"},fe={class:"settings-state-group"},he={class:"settings-state-switcher",role:"radiogroup","aria-label":"Режим backend"},ye=["disabled","aria-pressed"],Ce=["disabled","aria-pressed"],we={class:"settings-state-group"},Se=["disabled"],Be={class:"settings-runtime-actions"},Re=["disabled"],De={class:"settings-nav-action-main"},Me={key:0,class:"settings-state-hint settings-state-error"},Pe={class:"settings-modal-section"},Ue={class:"settings-modal-actions"},$e={class:"settings-nav-action-main"},Ee={class:"settings-nav-action-main"},Fe={class:"settings-nav-action-main"},Ge={__name:"DashboardSettingsModal",setup(xe){const E=Y(),{closeSettingsPanel:m,editMode:F,isSidebarHidden:b,openCommandPalette:x,serviceCardView:f,serviceGroupingMode:h,serviceGroupingOptions:V,servicePresentationOptions:L,settingsPanel:O,siteFilter:B,siteFilterOptions:z,setSiteFilter:G,toggleEditMode:R,toggleSidebarView:D,loadConfig:N}=E,n=p($()),o=p(n.value.mode==="web"?"embedded":n.value.mode),v=p(n.value.remoteBaseUrl||"http://127.0.0.1:8090"),d=p(!1),k=p(""),M=W(()=>{if(!n.value.desktop)return!1;const i=String(v.value||"").trim();return o.value!==n.value.mode||i!==String(n.value.remoteBaseUrl||"").trim()});function y(){o.value=n.value.mode==="web"?"embedded":n.value.mode,v.value=n.value.remoteBaseUrl||"http://127.0.0.1:8090"}function A(i){b.value||(h.value=i)}function q(){m(),x()}async function H(){if(!(!n.value.desktop||!M.value||d.value)){d.value=!0,k.value="";try{const i=await ee({mode:o.value,remoteBaseUrl:v.value});n.value=i,y(),await N()}catch(i){k.value=(i==null?void 0:i.message)||"Не удалось применить desktop runtime"}finally{d.value=!1}}}K(async()=>{const i=await Z();n.value=i,y(),window.addEventListener("oko:api-base-change",P)}),T(()=>{window.removeEventListener("oko:api-base-change",P)});function P(){n.value=$(),y()}return(i,t)=>(l(),j(X,{open:s(O).open,"backdrop-class":"settings-modal-backdrop","modal-class":"settings-modal",onBackdrop:s(m)},{default:I(()=>[e("header",ie,[t[6]||(t[6]=e("div",null,[e("h3",null,"Настройки панели"),e("p",null,"Единая точка управления интерфейсом и режимами отображения.")],-1)),e("button",{class:"ghost",type:"button",onClick:t[0]||(t[0]=(...a)=>s(m)&&s(m)(...a))},"Закрыть")]),e("div",oe,[e("section",le,[t[10]||(t[10]=e("h4",null,"Отображение",-1)),e("div",re,[t[7]||(t[7]=e("p",{class:"settings-state-label"},"Вид",-1)),e("div",de,[(l(!0),r(C,null,w(s(L),a=>(l(),r("button",{key:`view:${a.value}`,class:g(["settings-state-btn",{active:s(f)===a.value}]),type:"button","aria-pressed":s(f)===a.value,onClick:U=>f.value=a.value},c(a.label),11,ue))),128))])]),e("div",ce,[t[8]||(t[8]=e("p",{class:"settings-state-label"},"Группировка",-1)),e("div",ve,[(l(!0),r(C,null,w(s(V),a=>(l(),r("button",{key:`grouping:${a.value}`,class:g(["settings-state-btn",{active:s(h)===a.value}]),type:"button","aria-pressed":s(h)===a.value,disabled:s(b),onClick:U=>A(a.value)},c(a.label),11,pe))),128))]),s(b)?(l(),r("p",ge,"Группировка недоступна при скрытом меню.")):S("",!0)]),e("div",me,[t[9]||(t[9]=e("p",{class:"settings-state-label"},"Site",-1)),e("div",be,[(l(!0),r(C,null,w(s(z),a=>(l(),r("button",{key:`site:${a.value}`,class:g(["settings-state-btn",{active:s(B)===a.value}]),type:"button","aria-pressed":s(B)===a.value,onClick:U=>s(G)(a.value)},c(a.label),11,ke))),128))])])]),n.value.desktop?(l(),r("section",_e,[t[13]||(t[13]=e("h4",null,"Desktop Runtime (macOS Apple Silicon)",-1)),e("div",fe,[t[11]||(t[11]=e("p",{class:"settings-state-label"},"Режим backend",-1)),e("div",he,[e("button",{class:g(["settings-state-btn",{active:o.value==="embedded"}]),type:"button",disabled:d.value,"aria-pressed":o.value==="embedded",onClick:t[1]||(t[1]=a=>o.value="embedded")}," Embedded (inside app) ",10,ye),e("button",{class:g(["settings-state-btn",{active:o.value==="remote"}]),type:"button",disabled:d.value,"aria-pressed":o.value==="remote",onClick:t[2]||(t[2]=a=>o.value="remote")}," Remote (external server) ",10,Ce)])]),e("div",we,[t[12]||(t[12]=e("p",{class:"settings-state-label"},"Remote URL",-1)),J(e("input",{"onUpdate:modelValue":t[3]||(t[3]=a=>v.value=a),class:"settings-runtime-input",type:"text",autocomplete:"off",spellcheck:"false",placeholder:"http://127.0.0.1:8090",disabled:d.value||o.value!=="remote"},null,8,Se),[[Q,v.value,void 0,{trim:!0}]])]),e("div",Be,[e("button",{class:"settings-nav-action",type:"button",disabled:d.value||!M.value,onClick:H},[e("span",De,[u(s(te),{class:"ui-icon settings-nav-action-icon"}),e("span",null,c(d.value?"Применяем...":"Применить runtime"),1)]),u(s(_),{class:"ui-icon settings-nav-action-caret"})],8,Re)]),k.value?(l(),r("p",Me,c(k.value),1)):S("",!0)])):S("",!0),e("section",Pe,[t[15]||(t[15]=e("h4",null,"Быстрые действия",-1)),e("div",Ue,[e("button",{class:"settings-nav-action",type:"button",onClick:t[4]||(t[4]=(...a)=>s(D)&&s(D)(...a))},[e("span",$e,[u(s(se),{class:"ui-icon settings-nav-action-icon"}),e("span",null,c(s(b)?"Показать меню":"Скрыть меню"),1)]),u(s(_),{class:"ui-icon settings-nav-action-caret"})]),e("button",{class:"settings-nav-action",type:"button",onClick:t[5]||(t[5]=(...a)=>s(R)&&s(R)(...a))},[e("span",Ee,[u(s(ae),{class:"ui-icon settings-nav-action-icon"}),e("span",null,c(s(F)?"Выключить edit mode":"Включить edit mode"),1)]),u(s(_),{class:"ui-icon settings-nav-action-caret"})]),e("button",{class:"settings-nav-action",type:"button",onClick:q},[e("span",Fe,[u(s(ne),{class:"ui-icon settings-nav-action-icon"}),t[14]||(t[14]=e("span",null,"Открыть поиск (Ctrl/Cmd+K)",-1))]),u(s(_),{class:"ui-icon settings-nav-action-caret"})])])])])]),_:1},8,["open","onBackdrop"]))}};export{Ge as default};
