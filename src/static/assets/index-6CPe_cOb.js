const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/IndicatorTabPanel-BMJZ32cG.js","assets/vendor-D7XMpWz6.js","assets/vendor-icons-FSyGL1Zq.js","assets/LanPageView-CeqSO7KF.js","assets/LanHostModal-CTyeP8mm.js","assets/BaseModal-CiiZpxOD.js","assets/IframeModal-C4wbCAAm.js","assets/ItemEditorModal-_mi_x26T.js","assets/DashboardSettingsModal-B3SdMY3C.js","assets/CommandPaletteModal-Do-LWHyc.js"])))=>i.map(i=>d[i]);
import{o as f,c as b,r as Gr,n as z,h as hr,w as ve,a as Me,b as Ye,d as Ve,e as B,f as C,g as Ie,u as i,i as U,j as _e,k as g,F as X,t as R,l as F,m as ye,p as P,q as se,s as Y,v as es,x as Bt,T as ts,y as $n,z as Nr,A as Vr,B as gn,C as Ge,D as ns,E as rs,M as os}from"./vendor-D7XMpWz6.js";import{s as Ir,a as wr,b as is,c as ss,d as Sr,e as as,f as mn,g as ls,h as _r,i as kr,j as $r,k as bt,l as us,m as Cr,n as cs,o as ds,p as Er,q as fs,r as ps,t as vn,H as It,N as Gt,S as Ne,F as Hr,C as Fr,u as Kr,T as wn,v as Ur,w as zr,D as Sn,x as gs,y as ms,W as vs,A as bs,E as ys,z as hs,M as Tr,P as Is,B as jr,G as Cn,L as En,I as ws,K as Ss,J as _s,O as Pr,Q as qr,R as Lr,U as _n,V as ks,X as $s,Y as Cs,Z as Es,_ as bn,$ as Wr,a0 as Ts,a1 as Jr,a2 as Ps,a3 as Ls,a4 as Yr,a5 as xs,a6 as As,a7 as Ms,a8 as Ds,a9 as Rs,aa as Os,ab as Tn,ac as Pn,ad as Bs,ae as Gs,af as Ns,ag as Vs,ah as Qr,ai as Zr}from"./vendor-icons-FSyGL1Zq.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))c(a);new MutationObserver(a=>{for(const p of a)if(p.type==="childList")for(const m of p.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&c(m)}).observe(document,{childList:!0,subtree:!0});function l(a){const p={};return a.integrity&&(p.integrity=a.integrity),a.referrerPolicy&&(p.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?p.credentials="include":a.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function c(a){if(a.ep)return;a.ep=!0;const p=l(a);fetch(a.href,p)}})();const Hs="modulepreload",Fs=function(r){return"/static/"+r},xr={},$e=function(u,l,c){let a=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),v=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));a=Promise.allSettled(l.map(I=>{if(I=Fs(I),I in xr)return;xr[I]=!0;const S=I.endsWith(".css"),_=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${I}"]${_}`))return;const w=document.createElement("link");if(w.rel=S?"stylesheet":Hs,S||(w.as="script"),w.crossOrigin="",w.href=I,v&&w.setAttribute("nonce",v),document.head.appendChild(w),S)return new Promise((T,x)=>{w.addEventListener("load",T),w.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${I}`)))})}))}function p(m){const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=m,window.dispatchEvent(v),!v.defaultPrevented)throw m}return a.then(m=>{for(const v of m||[])v.status==="rejected"&&p(v.reason);return u().catch(p)})},Ks=["type","title","aria-label","disabled"],Se={__name:"IconButton",props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"button"},title:{type:String,default:""},ariaLabel:{type:String,default:""},buttonClass:{type:String,default:""}},emits:["click"],setup(r){return(u,l)=>(f(),b("button",{class:z(["ghost icon-btn",[r.buttonClass,{active:r.active}]]),type:r.type,title:r.title,"aria-label":r.ariaLabel||r.title,disabled:r.disabled,onClick:l[0]||(l[0]=c=>u.$emit("click",c))},[Gr(u.$slots,"default")],10,Ks))}},Us="X-Dashboard-Token";function zs(){var l;if(typeof window>"u")return"";const r=((l=window.localStorage)==null?void 0:l.getItem("dashboard_admin_token"))||"";if(String(r).trim())return String(r).trim();const u=window.__DASHBOARD_ADMIN_TOKEN__||"";return String(u).trim()}function js(r,u,l){const c=u&&typeof r=="object"&&r!==null?r.detail:null;let a=`Request failed: ${l}`;return Array.isArray(c)?a=c.map(p=>typeof p=="object"&&p!==null&&"message"in p?String(p.message||""):JSON.stringify(p)).join("; "):typeof c=="string"&&c?a=c:typeof r=="string"&&r&&(a=r),a}async function De(r,u={}){const{requireAdminToken:l=!1,headers:c={},...a}=u,p={};if(c instanceof Headers)c.forEach((w,T)=>{p[T]=w});else if(Array.isArray(c))for(const[w,T]of c)p[w]=String(T);else Object.assign(p,c);const m={Accept:"application/json",...p};if(l){const w=zs();w&&(m[Us]=w)}const v=await fetch(r,{credentials:"same-origin",headers:m,...a}),S=(v.headers.get("content-type")||"").includes("application/json"),_=S?await v.json():await v.text();if(!v.ok){const T=new Error(js(_,S,v.status));throw T.status=v.status,T.body=_,T}return _}const Qe="/api/v1/dashboard";function qs(){return De(`${Qe}/config`)}function Ws(r){return De(`${Qe}/iframe/${encodeURIComponent(r)}/source`,{requireAdminToken:!0})}function Js(r=[]){const u=new URLSearchParams;for(const c of r)u.append("item_id",c);const l=u.toString();return De(`${Qe}/health${l?`?${l}`:""}`)}function Ys(r){return De(`${Qe}/config`,{requireAdminToken:!0,method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}function Qs(){return De(`${Qe}/lan/state`)}function Zs(){return De(`${Qe}/lan/run`,{requireAdminToken:!0,method:"POST"})}const yn="oko-particles-js",Xs="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js",ea=7e3;let yt=null;function kn(){return typeof window.particlesJS=="function"}function ta(r){return new Promise(u=>{let l=!1;const c=p=>{l||(l=!0,u(p))},a=window.setTimeout(()=>{c(kn())},ea);r.addEventListener("load",()=>{window.clearTimeout(a),c(kn())},{once:!0}),r.addEventListener("error",()=>{window.clearTimeout(a),c(!1)},{once:!0})})}async function na(){return typeof window>"u"||typeof document>"u"?!1:kn()?!0:yt||(yt=(async()=>{let r=document.getElementById(yn)instanceof HTMLScriptElement?document.getElementById(yn):null;r||(r=document.createElement("script"),r.id=yn,r.src=Xs,r.async=!0,r.defer=!0,document.head.appendChild(r));const u=await ta(r);return u||(yt=null),u})(),yt)}function A(r){const u=`#${r.hex}`;return(l,{attrs:c})=>hr("svg",{...c,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",role:"img","aria-hidden":"true",style:c.style?[c.style,{color:u}]:{color:u}},[hr("path",{d:r.path})])}const Nt={homeassistant:A(vn),"home-assistant":A(vn),ha:A(vn),openwrt:A(ps),adguard:A(fs),proxmox:A(Er),pve:A(Er),grafana:A(ds),gitea:A(cs),jellyfin:A(Cr),jellyseerr:A(Cr),sonarr:A(bt),radarr:A(us),lidarr:A(bt),readarr:A(bt),bazarr:A(bt),prowlarr:A(bt),qbittorrent:A($r),qb:A($r),postgres:A(kr),postgresql:A(kr),docker:A(_r),dockge:A(_r),cockpit:A(ls),npm:A(mn),nginxproxymanager:A(mn),"nginx-proxy-manager":A(mn),nginx:A(as),openai:A(Sr),ai:A(Sr),portainer:A(ss),ytsync:A(wr),youtube:A(is),youtubeshorts:A(wr),termius:A(Ir),termix:A(Ir)},Vt={home:It,house:It,дом:It,dom:It,route:Ps,net:Gt,network:Gt,сеть:Gt,dashboard:Jr,infra:Ne,infrastructure:Ne,инфраструктура:Ne,server:Ne,core:Ts,ops:Wr,media:bn,медиа:bn,tv:bn,iot:Fr,cloud:Es,wifi:Cs,monitor:$s,cockpit:ks,proxmox:Ne,grafana:Kr,gitea:_n,git:_n,jellyfin:Hr,navidrome:Tr,tunnel:Lr,tunnels:Lr,stats:qr,services:Pr,service:Pr,health:Ur,alerts:wn,alert:wn,security:zr,auth:_s,key:Ss,db:Sn,database:Sn,storage:ws,link:En,iframe:Cn,terminal:jr,package:Is,music:Tr,camera:hs,eye:ys,observability:bs,workflow:vs,settings:ms,spark:gs},Xr=[{re:/\b(home|house|dom|дом)\b/,icon:It},{re:/\b(net|network|route|vpn|edge|сеть|маршрут|туннел)\b/,icon:Gt},{re:/\b(infra|server|cluster|pve|проксмокс|инфраструктур)\b/,icon:Ne},{re:/\b(media|tv|video|stream|jellyfin|медиа)\b/,icon:Hr},{re:/\b(iot|sensor|home-assistant|умн|дом)\b/,icon:Fr},{re:/\b(stat|metric|chart|grafana|аналит|monitor)\b/,icon:Kr},{re:/\b(alert|error|warn|critical|ошиб|авар)\b/,icon:wn},{re:/\b(health|status|pulse|heart|состояни)\b/,icon:Ur},{re:/\b(auth|token|secret|lock|ключ|безопас)\b/,icon:zr},{re:/\b(db|database|postgres|mysql|redis)\b/,icon:Sn}],Je={page:Jr,group:Yr,subgroup:Ls,itemLink:En,itemIframe:Cn,widget:qr};function eo(r){return String(r||"").toLowerCase().replace(/[^a-z0-9а-яё._-]+/gi," ").split(/[\s._-]+/).filter(Boolean)}function to(r){if(Nt[r])return Nt[r];for(const[u,l]of Object.entries(Nt))if(r.includes(u))return l;if(Vt[r])return Vt[r];for(const[u,l]of Object.entries(Vt))if(r.includes(u))return l;return null}function Ze(r,u){for(const c of r)for(const a of eo(c)){const p=to(a);if(p)return p}const l=r.map(c=>String(c||"").toLowerCase()).filter(Boolean).join(" ");for(const c of Xr)if(c.re.test(l))return c.icon;return u}function ra(r){return Ze([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],Je.page)}function oa(r){return Ze([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.description],Je.group)}function ia(r){return Ze([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],Je.subgroup)}function sa(r){return Ze([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,r==null?void 0:r.url,...(r==null?void 0:r.tags)||[]],(r==null?void 0:r.type)==="iframe"?Je.itemIframe:Je.itemLink)}function aa(r){var u;return Ze([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,(u=r==null?void 0:r.data)==null?void 0:u.endpoint],Je.widget)}function wt(r,u="node"){return String(r||"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")||u}function Be(r,u){const l=wt(r,"node");let c=l,a=2;for(;u.has(c);)c=`${l}-${a}`,a+=1;return c}function Ht(r){const u=new Set;for(const l of r.groups||[])for(const c of l.subgroups||[])u.add(c.id);return u}function Rt(r){const u=new Set;for(const l of r.groups||[])for(const c of l.subgroups||[])for(const a of c.items||[])u.add(a.id);return u}function we(r,u){return(r.groups||[]).find(l=>l.id===u)||null}function be(r,u,l){const c=we(r,u);return c&&(c.subgroups||[]).find(a=>a.id===l)||null}function Ot(r){return String((r==null?void 0:r.key)||"").startsWith("group:")}function Ar(r){var a,p;const u=new Set((r.groups||[]).map(m=>m.id)),l=Ht(r),c=new Set([...u,...l]);for(const m of((a=r.layout)==null?void 0:a.pages)||[]){const v=[];for(const I of m.blocks||[]){if(I.type==="groups"){I.group_ids=(I.group_ids||[]).filter(S=>c.has(S)),I.group_ids.length&&v.push(I);continue}(I.widgets||[]).length&&v.push(I)}!v.length&&((p=r.groups)!=null&&p.length)&&v.push({type:"groups",group_ids:[r.groups[0].id]}),m.blocks=v}}function Mr(r,u,l){var m;const c=((m=r.layout)==null?void 0:m.pages)||[];if(!c.length)return;const a=c.find(v=>v.id===u)||c[0];let p=a.blocks.find(v=>v.type==="groups");if(!p){p={type:"groups",group_ids:[l]},a.blocks.push(p);return}p.group_ids.includes(l)||p.group_ids.push(l)}function Dr(r,u,l){const c=r.groups||[],a=c.findIndex(I=>I.id===u),p=c.findIndex(I=>I.id===l);if(a<0||p<0||a===p)return!1;const[m]=c.splice(a,1),v=a<p?p-1:p;return c.splice(v,0,m),!0}function Rr(r,u,l,c,a){const p=we(r,u),m=we(r,c);if(!p||!m)return!1;const v=(p.subgroups||[]).findIndex(_=>_.id===l),I=(m.subgroups||[]).findIndex(_=>_.id===a);if(v<0||I<0)return!1;if(u!==c&&p.subgroups.length<=1)throw new Error("В исходной группе должна остаться минимум одна подгруппа.");const[S]=p.subgroups.splice(v,1);if(u===c){const _=v<I?I-1:I;return p.subgroups.splice(_,0,S),!0}return m.subgroups.splice(I,0,S),!0}function Or(r,u,l,c,a,p,m){const v=be(r,u,l),I=be(r,a,p);if(!v||!I)return!1;const S=(v.items||[]).findIndex(T=>T.id===c),_=(I.items||[]).findIndex(T=>T.id===m);if(S<0||_<0)return!1;if(l!==p&&v.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[w]=v.items.splice(S,1);if(l===p){const T=S<_?_-1:_;return v.items.splice(T,0,w),!0}return I.items.splice(_,0,w),!0}function Br(r,u,l,c,a,p){const m=be(r,u,l),v=be(r,a,p);if(!m||!v)return!1;const I=(m.items||[]).findIndex(_=>_.id===c);if(I<0)return!1;if(l!==p&&m.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[S]=m.items.splice(I,1);return v.items.push(S),!0}function la(r){const u=String(r||"").trim();if(!u)throw new Error("URL не может быть пустым");const l=/^https?:\/\//i.test(u)?u:`https://${u}`;let c;try{c=new URL(l)}catch{throw new Error(`Некорректный URL: ${u}`)}if(!["http:","https:"].includes(c.protocol))throw new Error(`Разрешены только http/https URL: ${u}`);return c.toString()}function ua(r){const u=String(r||"").trim();if(!u)return"";const l=/^https?:\/\//i.test(u)?u:`https://${u}`;try{const c=new URL(l);return["http:","https:"].includes(c.protocol)?c.origin:""}catch{return""}}let ht=null;function le(){if(ht)return ht;const r="/static/img/emblem-mark.png",u=3e4,l=16e3,c=9e3,a=700,p=1e4,m="lan",v=new Set(["stat_list","table"]),I="https://example.com",S="sidebar-particles",_="hero-title-particles",w="hero-controls-particles",T={fps_limit:58,particles:{number:{value:88,density:{enable:!0,value_area:700}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.36,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:120,color:"#2dd4bf",opacity:.24,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},x={fps_limit:58,particles:{number:{value:92,density:{enable:!0,value_area:720}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.4,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:132,color:"#2dd4bf",opacity:.26,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},N=Object.freeze([{value:"detailed",label:"Карточки"},{value:"tile",label:"Плитка"},{value:"icon",label:"Значки"}]),ee=Object.freeze([{value:"groups",label:"Только группы"},{value:"tags_in_groups",label:"Группы + теги"},{value:"tags",label:"Только теги"},{value:"flat",label:"Без групп (плитка)"}]),M=["detailed","hidden"],G=18,j=10;function D(){return{id:"",title:"",type:"link",url:I,icon:"",siteInput:"",tagsInput:"",open:"new_tab",healthcheckEnabled:!1,healthcheckUrl:"",healthcheckIntervalSec:30,healthcheckTimeoutMs:1500,iframeSandboxMode:"default",iframeAllowInput:"",iframeReferrerPolicy:"",authProfile:""}}const y=B(null),pe=B(!0),q=B(""),W=B(""),re=B(""),ge=B(!1),V=B(""),O=B(!1),ue=B(typeof document>"u"?!0:document.visibilityState!=="hidden"),ie=B("detailed"),ce=B("groups"),K=B("all"),te=B("detailed"),ne=B("idle"),ae=B(""),Ce=B(null),He=B(!1),H=B(!1),he=B(""),Q=B(!1),Xe=B(""),de=B(0),et=Ie({open:!1}),tt=Ie({open:!1,host:null}),Ee=Ie({}),St=Ie({}),_t=new Map;let nt=0,Re=0,rt=0,kt=!1,Ft=!1,Te=0;const $=Ie({groupKey:"",subgroupId:"",itemId:""}),me=Ie({}),ot=Ie({}),L=Ie({type:"",groupId:"",subgroupId:"",itemId:""}),it=Ie({}),Z=Ie({open:!1,title:"",src:"",allow:"",sandbox:!1,referrerPolicy:"",loading:!1,error:""}),E=Ie({open:!1,mode:"create",groupId:"",subgroupId:"",originalItemId:"",submitting:!1,error:"",form:D()}),Pe=C(()=>{var t,n;if(!y.value)return[];const e=((n=(t=y.value)==null?void 0:t.layout)==null?void 0:n.pages)||[];return e.some(o=>o.id===m)?e:[...e,{id:m,title:"LAN",icon:"network",blocks:[]}]}),Kt=C(()=>{var e;return((e=y.value)==null?void 0:e.widgets)||[]}),Ln=C(()=>{var e,t;return((t=(e=y.value)==null?void 0:e.security)==null?void 0:t.auth_profiles)||[]}),no=C(()=>{var e,t;return((t=(e=y.value)==null?void 0:e.app)==null?void 0:t.title)||"Oko"}),ro=C(()=>{var e,t;return((t=(e=y.value)==null?void 0:e.app)==null?void 0:t.tagline)||"Your Infrastructure in Sight"}),oo=C(()=>N),io=C(()=>ee),xn=C(()=>ie.value==="icon"),An=C(()=>ie.value==="tile"),Mn=C(()=>xn.value||An.value),Ut=C(()=>te.value!=="hidden"),$t=C(()=>te.value==="hidden"),so=C(()=>!1),ao=C(()=>Ut.value?"Режим меню: полное. Нажмите, чтобы скрыть меню":"Режим меню: скрыто. Нажмите, чтобы вернуть полное меню"),Dn=C(()=>{var e,t;return((t=(e=Ce.value)==null?void 0:e.result)==null?void 0:t.hosts)||[]}),lo=C(()=>{var t,n;const e=((n=(t=Ce.value)==null?void 0:t.result)==null?void 0:n.scanned_cidrs)||[];return e.length?e.join(", "):"нет данных"}),uo=C(()=>ne.value==="saving"?"Сохранение...":ne.value==="saved"?"Сохранено":ne.value==="error"?"Ошибка сохранения":O.value?"Готово":"Сохранение выключено"),Ct=C(()=>{var n;const e=new Map;for(const o of((n=y.value)==null?void 0:n.groups)||[])for(const s of o.subgroups||[])for(const d of s.items||[]){const h=dt(d,o);if(!h)continue;const k=h.toLowerCase();e.has(k)||e.set(k,h)}const t=Array.from(e.entries()).sort((o,s)=>o[1].localeCompare(s[1],"ru",{sensitivity:"base"}));return[{value:"all",label:"Все sites"},...t.map(([o,s])=>({value:o,label:s}))]}),Et=C(()=>{const e=new Map;for(const t of Kt.value)e.set(t.id,t);return e}),zt=C(()=>{var t;const e=new Map;for(const n of((t=y.value)==null?void 0:t.groups)||[])e.set(n.id,n);return e}),Rn=C(()=>{var t;const e=new Map;for(const n of((t=y.value)==null?void 0:t.groups)||[])for(const o of n.subgroups||[])e.set(o.id,{group:n,subgroup:o});return e}),co=C(()=>{const e=new Map;for(const t of Pe.value)for(const n of t.blocks||[])if((n==null?void 0:n.type)==="groups")for(const o of n.group_ids||[])e.has(o)||e.set(o,t.id);return e}),On=C(()=>{const e=new Map;for(const t of Dn.value||[]){const n=String((t==null?void 0:t.ip)||"").trim();if(n)for(const o of(t==null?void 0:t.dashboard_items)||[]){const s=String((o==null?void 0:o.id)||"").trim();s&&!e.has(s)&&e.set(s,n)}}return e}),fo=C(()=>{var n;const e=[],t=co.value;e.push({id:"action:open-settings-panel",type:"action",action:"open_settings_panel",item:null,title:"Открыть панель настроек",titleLower:"открыть панель настроек",host:"",ip:"",site:"",tagsLower:[],groupId:"",groupKey:"",groupTitle:"Команда",subgroupId:"",subgroupTitle:"Интерфейс",pageId:"",searchBlob:"открыть панель настроек settings ui интерфейс control panel параметры фильтры"});for(const o of((n=y.value)==null?void 0:n.groups)||[])for(const s of o.subgroups||[])for(const d of s.items||[]){const h=zo(d==null?void 0:d.url),k=On.value.get(d.id)||"",J=(d.tags||[]).map(ke=>String(ke||"").trim()).filter(Boolean),oe=dt(d,o);if(K.value!=="all"&&oe.toLowerCase()!==K.value)continue;const Oe=t.get(o.id)||t.get(s.id)||"",Ae=String(d.title||"").trim(),We=[Ae,String(d.id||""),String(d.url||""),h,k,oe,String(o.title||""),String(s.title||""),...J].join(" ").toLowerCase();e.push({id:d.id,type:"item",action:"",item:d,title:Ae,titleLower:Ae.toLowerCase(),host:h.toLowerCase(),ip:k.toLowerCase(),site:oe.toLowerCase(),tagsLower:J.map(ke=>ke.toLowerCase()),groupId:o.id,groupKey:`group:${o.id}`,groupTitle:String(o.title||""),subgroupId:s.id,subgroupTitle:String(s.title||""),pageId:Oe,searchBlob:We})}return e}),st=C(()=>{const e=String(Xe.value||"").trim().toLowerCase(),t=fo.value;if(!e){const s=t.filter(h=>h.type==="action"),d=t.filter(h=>h.type!=="action").slice().sort((h,k)=>h.title.localeCompare(k.title,"ru",{sensitivity:"base"}));return[...s,...d].slice(0,j)}const n=e.split(/\s+/).filter(Boolean),o=[];for(const s of t){let d=0,h=!0;for(const k of n){if(!s.searchBlob.includes(k)){h=!1;break}s.titleLower.startsWith(k)?d+=12:s.titleLower.includes(k)&&(d+=8),s.host.startsWith(k)?d+=7:s.host.includes(k)&&(d+=4),s.ip===k?d+=14:s.ip.includes(k)&&(d+=6),s.site&&s.site.includes(k)&&(d+=5),s.tagsLower.some(J=>J.includes(k))&&(d+=3)}h&&o.push({entry:s,score:d})}return o.sort((s,d)=>d.score!==s.score?d.score-s.score:s.entry.title.localeCompare(d.entry.title,"ru",{sensitivity:"base"})),o.slice(0,G).map(s=>s.entry)}),Bn=C(()=>st.value[de.value]||null),Le=C(()=>Pe.value.find(e=>e.id===W.value)||Pe.value[0]||null),jt=C(()=>{var e;return((e=Le.value)==null?void 0:e.id)===m}),Fe=C(()=>{if(!Le.value)return[];const e=[];for(const t of Le.value.blocks||[])(t==null?void 0:t.type)==="groups"&&e.push(...t.group_ids||[]);return Qt(e)}),Gn=C(()=>{const e=Zn(Fe.value),t=re.value.trim().toLowerCase();return t?e.map(n=>{if(String(n.title||"").toLowerCase().includes(t)||String(n.description||"").toLowerCase().includes(t))return{...n,subgroups:n.subgroups||[]};const s=(n.subgroups||[]).map(d=>{if(String(d.title||"").toLowerCase().includes(t))return{...d,items:d.items||[]};const k=(d.items||[]).filter(J=>{const oe=String(J.title||"").toLowerCase().includes(t),Oe=String(J.url||"").toLowerCase().includes(t),Ae=(J.tags||[]).some(ke=>String(ke).toLowerCase().includes(t)),We=dt(J,n).toLowerCase().includes(t);return oe||Oe||Ae||We});return k.length?{...d,items:k}:null}).filter(Boolean);return s.length?{...n,subgroups:s}:null}).filter(Boolean):e}),po=C(()=>{const e=[];for(const t of Gn.value){e.push({key:`group:${t.key}`,type:"group",groupKey:t.key,group:t});for(const n of t.subgroups||[])e.push({key:`subgroup:${t.key}:${n.id}`,type:"subgroup",groupKey:t.key,subgroupId:n.id,subgroup:n})}return e}),at=C(()=>{const e=[];for(const t of Fe.value)for(const n of t.subgroups||[])for(const o of n.items||[])e.push(o.id);return e}),go=C(()=>{var n;const e=at.value;let t=0;for(const o of e)(n=je(o))!=null&&n.ok&&(t+=1);return{online:t,total:e.length}}),Tt=C(()=>{if(!Le.value)return[];const e=[];for(const t of Le.value.blocks||[])Wn(t)&&e.push(...t.widgets||[]);return Array.from(new Set(e))}),Pt=C(()=>Jn(Tt.value)),mo=C(()=>{const e=Pt.value.length;if(!e)return"нет данных";const t=Pt.value.filter(n=>lt(n)).length;return`${e} · больших ${t}`}),vo=C(()=>{var e;return(((e=Le.value)==null?void 0:e.blocks)||[]).filter(t=>(t==null?void 0:t.type)==="groups")}),Nn=C(()=>{const e=Et.value.get(V.value);return!e||!lt(e)?null:Tt.value.includes(e.id)?e:null});function Vn(e){if(!e)return;const t=document.documentElement;e.accent&&(t.style.setProperty("--accent",e.accent),t.style.setProperty("--accent-soft",e.accent)),e.background&&t.style.setProperty("--bg",e.background),e.border&&t.style.setProperty("--border",e.border),e.card&&(t.style.setProperty("--surface",e.card),t.style.setProperty("--surface-strong",e.card)),t.style.setProperty("--glow-enabled",e.glow===!1?"0":"1")}function Hn(e){if(!e)return;const t=document.documentElement;e.gap!=null&&t.style.setProperty("--grid-gap",`${Number(e.gap)}px`),e.card_radius!=null&&t.style.setProperty("--card-radius",`${Number(e.card_radius)}px`),e.columns!=null&&t.style.setProperty("--layout-columns",String(Number(e.columns)))}function bo(){O.value=!O.value,ae.value="",O.value||Ke()}function yo(){if(ie.value==="detailed"){ie.value="tile";return}if(ie.value==="tile"){ie.value="icon";return}ie.value="detailed"}function ho(){te.value!=="detailed"&&te.value!=="hidden"&&(te.value="detailed");const e=M.indexOf(te.value),n=((e>=0?e:0)+1)%M.length;te.value=M[n],Ut.value||(re.value="",ct()),$t.value&&(ce.value="flat")}function Io(e){return e?e.type==="group"?or(e.groupKey):e.type==="subgroup"?ir(e.groupKey,e.subgroupId):!1:!1}function wo(e){var t,n;return e?e.type==="group"?`Группа: ${((t=e.group)==null?void 0:t.title)||""}`:e.type==="subgroup"?`Подгруппа: ${((n=e.subgroup)==null?void 0:n.title)||""}`:"":""}function So(e){if(e){if(e.type==="group"){me[e.groupKey]=!0,$.groupKey=e.groupKey,$.subgroupId="",$.itemId="";return}e.type==="subgroup"&&nr(e.groupKey,e.subgroupId)}}function _o(e,t,n){if(!Mn.value)return;const o=(n==null?void 0:n.__originGroupKey)||e,s=(n==null?void 0:n.__originSubgroupId)||t;Zt(o,s,n.id),an(n)}function Fn(e){return JSON.parse(JSON.stringify(e))}function qt(e){return la(e)}async function Kn(){var e;if(y.value){ne.value="saving",ae.value="";try{const t=await Ys(y.value);y.value=t.config,(!W.value||!Pe.value.some(n=>n.id===W.value))&&(W.value=((e=Pe.value[0])==null?void 0:e.id)||""),ne.value="saved",Re&&clearTimeout(Re),Re=window.setTimeout(()=>{ne.value==="saved"&&(ne.value="idle")},1400)}catch(t){throw ne.value="error",ae.value=(t==null?void 0:t.message)||"Ошибка сохранения YAML",t}}}async function fe(e){if(!y.value)return!1;const t=Fn(y.value);try{return e(y.value)===!1?!1:(Ar(y.value),ut(),await Kn(),!0)}catch(n){return y.value=t,ne.value="error",ae.value=(n==null?void 0:n.message)||"Не удалось применить изменения",!1}}function Wt(e,t){return{id:e,type:"link",title:t,url:I,icon:null,site:null,tags:[],open:"new_tab"}}async function ko(){if(!O.value||!y.value)return;const e=window.prompt("Название новой группы","Новая группа");if(e==null)return;const t=e.trim();t&&await fe(n=>{const o=new Set((n.groups||[]).map(oe=>oe.id)),s=Ht(n),d=Rt(n),h=Be(t,o),k=Be(`${h}-core`,s),J=Be(`${h}-service`,d);n.groups.push({id:h,title:t,icon:"folder",description:"",layout:"auto",subgroups:[{id:k,title:"Core",items:[Wt(J,"Новый сервис")]}]}),Mr(n,W.value,h),me[`group:${h}`]=!0,$.groupKey=`group:${h}`,$.subgroupId=k,$.itemId=J})}async function $o(e){if(!O.value||!y.value)return;const t=window.prompt("Название подгруппы","Новая подгруппа");if(t==null)return;const n=t.trim();n&&await fe(o=>{const s=we(o,e);if(!s)throw new Error(`Группа '${e}' не найдена`);const d=Ht(o),h=Rt(o),k=Be(`${e}-${n}`,d),J=Be(`${k}-service`,h);s.subgroups.push({id:k,title:n,items:[Wt(J,"Новый сервис")]}),me[`group:${e}`]=!0,$.groupKey=`group:${e}`,$.subgroupId=k,$.itemId=J})}async function Co(e,t){!O.value||!y.value||zn(e,t)}function Jt(e){return String(e||"").split(",").map(t=>t.trim()).filter(Boolean)}function Yt(e,t,n,o){const s=Number(e);if(!Number.isFinite(s))return t;const d=Math.trunc(s);return Math.min(o,Math.max(n,d))}function Un(e=!1){E.submitting&&!e||(E.open=!1,E.mode="create",E.groupId="",E.subgroupId="",E.originalItemId="",E.error="",E.submitting=!1,E.form=D())}function zn(e,t){if(!be(y.value,e,t)){ne.value="error",ae.value=`Подгруппа '${t}' не найдена`;return}E.open=!0,E.mode="create",E.groupId=e,E.subgroupId=t,E.originalItemId="",E.error="",E.submitting=!1,E.form=D()}function jn(e,t,n){var d,h,k;const o=be(y.value,e,t),s=((o==null?void 0:o.items)||[]).find(J=>J.id===n);if(!o||!s){ne.value="error",ae.value=`Элемент '${n}' не найден`;return}E.open=!0,E.mode="edit",E.groupId=e,E.subgroupId=t,E.originalItemId=n,E.error="",E.submitting=!1,E.form={id:s.id,title:s.title,type:s.type,url:String(s.url||I),icon:s.icon||"",siteInput:String(s.site||""),tagsInput:(s.tags||[]).join(", "),open:s.open||"new_tab",healthcheckEnabled:!!(s.type==="link"&&s.healthcheck),healthcheckUrl:s.type==="link"&&s.healthcheck?String(s.healthcheck.url):String(s.url||I),healthcheckIntervalSec:s.type==="link"&&s.healthcheck?Number(s.healthcheck.interval_sec||30):30,healthcheckTimeoutMs:s.type==="link"&&s.healthcheck?Number(s.healthcheck.timeout_ms||1500):1500,iframeSandboxMode:s.type==="iframe"?((d=s.iframe)==null?void 0:d.sandbox)==null?"default":s.iframe.sandbox?"enabled":"disabled":"default",iframeAllowInput:s.type==="iframe"?(((h=s.iframe)==null?void 0:h.allow)||[]).join(", "):"",iframeReferrerPolicy:s.type==="iframe"&&((k=s.iframe)==null?void 0:k.referrer_policy)||"",authProfile:s.type==="iframe"&&s.auth_profile||""}}function qn(e){const t=E.form,n=String(t.title||"").trim();if(!n)throw new Error("Название сервиса обязательно");const o=String(t.type||"").trim().toLowerCase();if(!["link","iframe"].includes(o))throw new Error("Тип сервиса должен быть 'link' или 'iframe'");const s=String(t.open||"new_tab");if(!["new_tab","same_tab"].includes(s))throw new Error("Параметр open должен быть 'new_tab' или 'same_tab'");const d=qt(t.url||I),h=Rt(e);E.mode==="edit"&&h.delete(E.originalItemId);const k=String(t.id||"").trim(),J=`${E.subgroupId}-${n}`,oe=wt(k||J,"service"),Oe=k?oe:Be(oe,h);if(k&&h.has(Oe))throw new Error(`ID '${Oe}' уже существует`);const Ae={id:Oe,type:o,title:n,url:d,icon:String(t.icon||"").trim()||null,site:String(t.siteInput||"").trim()||null,tags:Jt(t.tagsInput),open:s};if(o==="link"){const Dt={...Ae};if(t.healthcheckEnabled){const Xi=qt(t.healthcheckUrl||d);Dt.healthcheck={type:"http",url:Xi,interval_sec:Yt(t.healthcheckIntervalSec,30,1,3600),timeout_ms:Yt(t.healthcheckTimeoutMs,1500,100,12e4)}}return Dt}const We=String(t.iframeSandboxMode||"default");let ke=null;We==="enabled"&&(ke=!0),We==="disabled"&&(ke=!1);const vt=String(t.authProfile||"").trim();if(vt&&!Ln.value.some(Dt=>Dt.id===vt))throw new Error(`Auth profile '${vt}' не найден`);const yr={...Ae,iframe:{sandbox:ke,allow:Jt(t.iframeAllowInput),referrer_policy:String(t.iframeReferrerPolicy||"").trim()||null}};return vt&&(yr.auth_profile=vt),yr}async function Eo(){if(!E.open||E.submitting||!y.value)return;E.submitting=!0,E.error="";const e=await fe(t=>{const n=be(t,E.groupId,E.subgroupId);if(!n)throw new Error(`Подгруппа '${E.subgroupId}' не найдена`);const o=qn(t);if(E.mode==="create")return n.items.push(o),$.groupKey=`group:${E.groupId}`,$.subgroupId=E.subgroupId,$.itemId=o.id,!0;const s=(n.items||[]).findIndex(d=>d.id===E.originalItemId);if(s<0)throw new Error(`Элемент '${E.originalItemId}' не найден`);return n.items.splice(s,1,o),$.groupKey=`group:${E.groupId}`,$.subgroupId=E.subgroupId,($.itemId===E.originalItemId||!$.itemId)&&($.itemId=o.id),!0});E.submitting=!1,e?Un(!0):E.error=ae.value||"Не удалось сохранить сервис"}async function To(e){if(!O.value||!y.value)return;const t=we(y.value,e);if(!t)return;const n=window.prompt("Название группы",t.title);if(n==null)return;const o=window.prompt("Описание группы",t.description||"");if(o==null)return;const s=window.prompt("Режим группы (auto | full | inline)",t.layout||"auto");s!=null&&await fe(d=>{const h=we(d,e);if(!h)throw new Error(`Группа '${e}' не найдена`);const k=String(s||"").trim().toLowerCase()||"auto";if(!["auto","full","inline"].includes(k))throw new Error("Режим группы должен быть 'auto', 'full' или 'inline'");h.title=n.trim()||h.title,h.description=o.trim(),h.layout=k})}async function Po(e,t){if(!O.value||!y.value)return;const n=be(y.value,e,t);if(!n)return;const o=window.prompt("Название подгруппы",n.title);o!=null&&await fe(s=>{const d=be(s,e,t);if(!d)throw new Error(`Подгруппа '${t}' не найдена`);d.title=o.trim()||d.title})}async function Lo(e,t,n){!O.value||!y.value||jn(e,t,n)}async function xo(e){if(!O.value||!y.value)return;const t=we(y.value,e);if(t){if(y.value.groups.length<=1){ne.value="error",ae.value="Нельзя удалить последнюю группу.";return}window.confirm(`Удалить группу "${t.title}"?`)&&await fe(n=>{const o=(n.groups||[]).findIndex(s=>s.id===e);if(o<0)return!1;n.groups.splice(o,1),$.groupKey="",$.subgroupId="",$.itemId=""})}}async function Ao(e,t){if(!O.value||!y.value)return;const n=we(y.value,e),o=((n==null?void 0:n.subgroups)||[]).find(s=>s.id===t);if(!(!n||!o)){if(n.subgroups.length<=1){ne.value="error",ae.value="В группе должна остаться хотя бы одна подгруппа.";return}window.confirm(`Удалить подгруппу "${o.title}"?`)&&await fe(s=>{const d=we(s,e);if(!d)return!1;const h=(d.subgroups||[]).findIndex(k=>k.id===t);if(h<0)return!1;d.subgroups.splice(h,1),$.subgroupId="",$.itemId=""})}}async function Mo(e,t,n){if(!O.value||!y.value)return;const o=be(y.value,e,t),s=((o==null?void 0:o.items)||[]).find(d=>d.id===n);if(!(!o||!s)){if(o.items.length<=1){ne.value="error",ae.value="В подгруппе должен остаться хотя бы один элемент.";return}window.confirm(`Удалить сервис "${s.title}"?`)&&await fe(d=>{const h=be(d,e,t);if(!h)return!1;const k=(h.items||[]).findIndex(J=>J.id===n);if(k<0)return!1;h.items.splice(k,1),$.itemId===n&&($.itemId="")})}}function Ke(){L.type="",L.groupId="",L.subgroupId="",L.itemId=""}function Do(e,t){if(!O.value||!Ot(t))return;const n=t.id;L.type="group",L.groupId=n,L.subgroupId="",L.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`group:${n}`))}function Ro(e,t,n){O.value&&(L.type="subgroup",L.groupId=t,L.subgroupId=n,L.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`subgroup:${n}`)))}function Oo(e,t,n,o){O.value&&(L.type="item",L.groupId=t,L.subgroupId=n,L.itemId=o,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`item:${o}`)))}function Bo(e,t){if(!O.value||!Ot(t))return;const n=t.id;L.type==="group"&&L.groupId!==n&&e.preventDefault()}async function Go(e,t){if(!O.value||!Ot(t))return;const n=t.id;if(L.type!=="group"||!L.groupId||L.groupId===n)return;e.preventDefault();const o=L.groupId;Ke(),await fe(s=>Dr(s,o,n))}function No(e,t,n){if(O.value){if(L.type==="subgroup"){if(L.subgroupId===n)return;e.preventDefault();return}L.type==="item"&&e.preventDefault()}}async function Vo(e,t,n){if(O.value){if(L.type==="subgroup"){e.preventDefault();const o=L.groupId,s=L.subgroupId;Ke(),await fe(d=>Rr(d,o,s,t,n));return}if(L.type==="item"){e.preventDefault();const o=L.groupId,s=L.subgroupId,d=L.itemId;Ke(),await fe(h=>Br(h,o,s,d,t,n))}}}function Ho(e,t,n,o){O.value&&L.type==="item"&&L.itemId!==o&&e.preventDefault()}async function Fo(e,t,n,o){if(!O.value||L.type!=="item"||!L.itemId||L.itemId===o)return;e.preventDefault();const s=L.groupId,d=L.subgroupId,h=L.itemId;Ke(),await fe(k=>Or(k,s,d,h,t,n,o))}function Wn(e){return(e==null?void 0:e.type)==="widget_row"||(e==null?void 0:e.type)==="widget_grid"}function Jn(e=[]){return e.map(t=>Et.value.get(t)).filter(Boolean)}function lt(e){return v.has(String((e==null?void 0:e.type)||""))}function Ko(e){return ur(e).slice(0,2)}function Yn(e){const t=Pt.value.find(n=>n.id===e);!t||!lt(t)||(V.value=t.id)}function Uo(e){lt(e)&&Yn(e.id)}function Qt(e=[]){const t=[];for(const n of e){const o=zt.value.get(n);if(o){t.push({key:`group:${o.id}`,id:o.id,title:o.title,icon:o.icon||null,description:o.description||"",layout:o.layout||"auto",subgroups:o.subgroups||[]});continue}const s=Rn.value.get(n);s&&t.push({key:`subgroup:${s.subgroup.id}`,id:s.group.id,title:s.group.title,icon:s.group.icon||null,description:s.group.description||"",layout:s.group.layout||"auto",subgroups:[s.subgroup]})}return t}function ut(){const e=new Set(Fe.value.map(t=>t.key));for(const t of Object.keys(me))e.has(t)||delete me[t];for(const t of Fe.value)me[t.key]==null&&(me[t.key]=!0);$.groupKey&&!e.has($.groupKey)&&ct()}function ct(){$.groupKey="",$.subgroupId="",$.itemId=""}function zo(e){try{return new URL(String(e||"")).hostname||""}catch{return""}}function jo(e,t,n){const o=String((e==null?void 0:e.site)||"").trim();if(o)return o;const s=String((t==null?void 0:t.site)||"").trim();if(s)return s;const d=(n||[]).find(h=>String(h||"").toLowerCase().startsWith("site:"));return d?String(d).slice(5).trim():""}function Qn(e){return((e==null?void 0:e.tags)||[]).map(t=>String(t||"").trim()).filter(Boolean)}function qo(e){const t=String(e||"");return t.startsWith("group:")&&zt.value.get(t.slice(6))||null}function dt(e,t=null){return jo(e,t,Qn(e))}function Wo(e,t=""){const n=qo((e==null?void 0:e.__originGroupKey)||t);return dt(e,n)}function Zn(e=[]){return K.value==="all"?e:e.map(t=>{const n=(t.subgroups||[]).map(o=>({...o,items:(o.items||[]).filter(s=>dt(s,t).toLowerCase()===K.value)})).filter(o=>o.items.length>0);return n.length?{...t,subgroups:n}:null}).filter(Boolean)}function Jo(e){const t=String(e||"all").trim().toLowerCase(),n=new Set(Ct.value.map(o=>o.value));K.value=n.has(t)?t:"all"}function Xn(){Xe.value="",de.value=0,Q.value=!0}function Lt(){Q.value=!1,Xe.value="",de.value=0}function Yo(){if(Q.value){Lt();return}Xn()}function er(){et.open=!0}function Qo(){et.open=!1}function Zo(){et.open=!et.open}function Xo(e){Xe.value=String(e||""),de.value=0}function ei(e){const t=st.value.length-1;if(t<0){de.value=0;return}de.value=Math.min(Math.max(e,0),t)}function ti(e){const t=st.value.length;if(!t){de.value=0;return}const o=(de.value+e+t)%t;de.value=o}function ni(e){e&&(e.pageId&&(W.value=e.pageId),Zt(e.groupKey,e.subgroupId,e.item.id))}function tr(e){if(e){if(e.type==="action"&&e.action==="open_settings_panel"){Lt(),er();return}ni(e),an(e.item),Lt()}}function ri(){tr(Bn.value)}async function oi(e){var t;(e==null?void 0:e.type)!=="item"||!((t=e==null?void 0:e.item)!=null&&t.url)||await gr(e.item.url)}function ii(e){me[e]=!rr(e),$.groupKey=e,$.subgroupId="",$.itemId=""}function nr(e,t){me[e]=!0,$.groupKey=e,$.subgroupId=t,$.itemId=""}function Zt(e,t,n){me[e]=!0,$.groupKey=e,$.subgroupId=t,$.itemId=n}function rr(e){return!!me[e]}function or(e){return $.groupKey===e&&!$.subgroupId&&!$.itemId}function ir(e,t){return $.groupKey===e&&$.subgroupId===t&&!$.itemId}function si(e){return $.itemId===e}function ai(e=[]){const t=Qt(e),n=Zn(t),o=$t.value?n:ci(n),s=pi(o),d=s.length;return s.map(h=>({...h,__visibleCount:d}))}function li(){return!!($.groupKey||$.subgroupId||$.itemId)}function ui(e){return String(e||"").trim()||"Без тега"}function sr(e){const t=new Set(Qn(e).map(n=>ui(n)).filter(Boolean));return t.size||t.add("Без тега"),Array.from(t)}function Xt(e,t,n){return{...e,__originGroupKey:t,__originSubgroupId:n}}function ci(e=[]){return li()?e.map(t=>{if($.groupKey&&t.key!==$.groupKey)return null;let n=t.subgroups||[];return $.subgroupId&&(n=n.filter(o=>o.id===$.subgroupId)),$.itemId&&(n=n.map(o=>({...o,items:(o.items||[]).filter(s=>s.id===$.itemId)})).filter(o=>o.items.length>0)),n.length?{...t,subgroups:n}:null}).filter(Boolean):e}function di(e=[]){return e.map(t=>{const n=new Map;for(const d of t.subgroups||[])for(const h of d.items||[])for(const k of sr(h))n.has(k)||n.set(k,[]),n.get(k).push(Xt(h,t.key,d.id));const s=Array.from(n.entries()).sort(([d],[h])=>d.localeCompare(h,"ru",{sensitivity:"base"})).map(([d,h])=>({id:`tag-${wt(`${t.id}-${d}`,"tag")}`,title:`#${d}`,icon:"tag",items:h}));return s.length?{...t,subgroups:s}:null}).filter(Boolean)}function fi(e=[]){const t=new Map;for(const o of e)for(const s of o.subgroups||[])for(const d of s.items||[])for(const h of sr(d))t.has(h)||t.set(h,[]),t.get(h).push(Xt(d,o.key,s.id));return Array.from(t.entries()).sort(([o],[s])=>o.localeCompare(s,"ru",{sensitivity:"base"})).map(([o,s])=>{const d=wt(o,"tag");return{key:`tags:${d}`,id:`tags-${d}`,title:`#${o}`,icon:"tag",description:"Сервисы, сгруппированные только по тегам.",layout:"inline",subgroups:[{id:`tags-${d}-items`,title:"Сервисы",items:s}]}})}function ar(e=[]){const t=[];for(const n of e)for(const o of n.subgroups||[])for(const s of o.items||[])t.push(Xt(s,n.key,o.id));return t.length?[{key:"flat:all",id:"flat-all",title:"Все сервисы",icon:"layout-grid",description:"Плоское отображение без группировки.",layout:"full",subgroups:[{id:"flat-all-items",title:"Плитка",items:t}]}]:[]}function pi(e=[]){return $t.value?ar(e):ce.value==="tags_in_groups"?di(e):ce.value==="tags"?fi(e):ce.value==="flat"?ar(e):e}function gi(e){const t=String((e==null?void 0:e.layout)||"auto").toLowerCase();return t==="inline"?!0:t==="full"?!1:Number((e==null?void 0:e.__visibleCount)||0)>1}function mi(e){return(e.subgroups||[]).reduce((t,n)=>t+(n.items||[]).length,0)}function vi(e){return((e==null?void 0:e.items)||[]).length}function bi(e){var n;let t=0;for(const o of e.subgroups||[])for(const s of o.items||[])(n=je(s.id))!=null&&n.ok&&(t+=1);return t}function lr(){for(const e of Object.keys(it))delete it[e]}function en(e){return ua(e)}function tn(e){const t=en(e==null?void 0:e.url);return t?`${String((e==null?void 0:e.id)||"")}|${t}`:""}function yi(e){const t=en(e==null?void 0:e.url);if(!t)return"";const n=tn(e);return n&&it[n]?"":`${t}/favicon.ico`}function hi(e){const t=tn(e);t&&(it[t]=!0)}function Ii(e){return ra(e)}function wi(e){return oa(e)}function Si(e){return ia(e)}function _i(e){return sa(e)}function ki(e){return aa(e)}function Ue(e){return Ee[e]||null}function nn(e,t){return`${e}:${t}`}function $i(e,t){return!!St[nn(e,t)]}function xe(e,t){if(!t||typeof t!="string")return null;if(t==="$")return e;if(!t.startsWith("$."))return null;let n=e;const o=t.slice(2).split(".");for(const s of o){if(n==null)return null;const d=s.match(/^(.*)\[\*\]$/);if(d){const h=d[1],k=h?n==null?void 0:n[h]:n;return Array.isArray(k)?k:[]}n=n==null?void 0:n[s]}return n}function Ci(e){var o,s,d;const t=(o=Ue(e.id))==null?void 0:o.payload;return xe(t,(d=(s=e.data)==null?void 0:s.mapping)==null?void 0:d.value)??"—"}function Ei(e){var o,s,d;const t=(o=Ue(e.id))==null?void 0:o.payload;return xe(t,(d=(s=e.data)==null?void 0:s.mapping)==null?void 0:d.subtitle)??""}function Ti(e){var o,s,d;const t=(o=Ue(e.id))==null?void 0:o.payload;return xe(t,(d=(s=e.data)==null?void 0:s.mapping)==null?void 0:d.trend)??""}function ur(e){var s,d;const t=(s=Ue(e.id))==null?void 0:s.payload,n=((d=e.data)==null?void 0:d.mapping)||{},o=xe(t,n.items);return Array.isArray(o)?o.map(h=>{const k=xe(h,n.item_title)??"-",J=xe(h,n.item_value)??"-";return{title:k,value:J}}):[]}function Pi(e){var s,d,h;const t=(s=Ue(e.id))==null?void 0:s.payload,n=(h=(d=e.data)==null?void 0:d.mapping)==null?void 0:h.rows,o=xe(t,n);return Array.isArray(o)?o:Array.isArray(t)?t:Array.isArray(t==null?void 0:t.items)?t.items:[]}function xt(e){return e?e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/")?e:`/${e}`:""}function ft(){for(const e of _t.values())clearInterval(e);_t.clear()}function ze(){nt&&(clearTimeout(nt),nt=0)}function je(e){return ot[e]||null}function Li(e){return!!(e!=null&&e.ok&&e.latency_ms!=null&&e.latency_ms>=a)}function rn(e){if(!e)return"unknown";const t=String(e.level||"").toLowerCase();return["online","degraded","down","unknown","indirect_failure"].includes(t)?t:Li(e)?"degraded":e.ok?"online":"down"}function xi(e){const t=je(e),n=rn(t);return n==="online"?"ok":n==="degraded"?"degraded":n==="down"||n==="indirect_failure"?"down":"unknown"}function Ai(e){const t=je(e);if(!t)return"Проверка...";const n=rn(t);return n==="online"?t.latency_ms!=null?`Online • ${t.latency_ms} ms`:"Online":n==="degraded"?t.latency_ms!=null?`Degraded • ${t.latency_ms} ms`:t.status_code!=null?`Degraded • HTTP ${t.status_code}`:t.error?`Degraded • ${t.error}`:t.reason?`Degraded • ${String(t.reason).replaceAll("_"," ")}`:"Degraded":n==="indirect_failure"?"Indirect failure":n==="down"?t.error?`Offline • ${t.error}`:t.status_code!=null?`Offline • HTTP ${t.status_code}`:"Offline":"Unknown"}async function qe(e=null){if(!Array.isArray(e)&&!ue.value)return;const t=Array.isArray(e)&&e.length?e:at.value,n=Array.from(new Set(t.map(o=>String(o||"").trim()).filter(Boolean)));if(n.length)try{const o=await Js(n);for(const s of o.items||[])ot[s.item_id]=s}catch{for(const o of n)ot[o]||(ot[o]={item_id:o,ok:!1,checked_url:"",status_code:null,latency_ms:null,error:"healthcheck unavailable"})}}async function on(){ze(),await qe(),cr()}function Mi(){let e=!1,t=!1;for(const n of at.value){const o=rn(je(n));if(o==="down"||o==="indirect_failure"){e=!0;break}o==="degraded"&&(t=!0)}return e?c:t?l:u}function cr(){if(ze(),!ue.value)return;const e=Mi();nt=window.setTimeout(async()=>{await qe(),cr()},e)}async function At(e){var s;const t=Et.value.get(e);if(!t)return;const n=xt((s=t.data)==null?void 0:s.endpoint);if(!n)return;Ee[e]||(Ee[e]={loading:!1,error:"",payload:null,lastUpdated:0});const o=Ee[e];o.loading=!0,o.error="";try{o.payload=await De(n),o.lastUpdated=Date.now()}catch(d){o.error=(d==null?void 0:d.message)||"Ошибка загрузки виджета"}finally{o.loading=!1}}async function sn(){var t,n;ft();const e=[];for(const o of Kt.value){if(e.push(At(o.id)),!xt((t=o.data)==null?void 0:t.endpoint))continue;const s=Math.max(1,Number(((n=o.data)==null?void 0:n.refresh_sec)||0))*1e3,d=window.setInterval(()=>{At(o.id)},s);_t.set(o.id,d)}await Promise.all(e)}async function Di(e,t){const n=nn(e,t.id),o=xt(t.endpoint);if(o){St[n]=!0;try{await De(o,{method:String(t.method||"GET").toUpperCase()}),await At(e)}catch(s){Ee[e]||(Ee[e]={loading:!1,error:"",payload:null,lastUpdated:0}),Ee[e].error=(s==null?void 0:s.message)||"Не удалось выполнить действие"}finally{St[n]=!1}}}async function dr(){var e,t,n;pe.value=!0,q.value="",ne.value="idle",ae.value="",lr();try{const o=await qs();y.value=o,(!W.value||!Pe.value.some(s=>s.id===W.value))&&(W.value=((e=Pe.value[0])==null?void 0:e.id)||""),ct(),ut(),Vn((t=o==null?void 0:o.ui)==null?void 0:t.theme),Hn((n=o==null?void 0:o.ui)==null?void 0:n.grid),await sn(),await on(),ue.value||mr()}catch(o){q.value=(o==null?void 0:o.message)||"Не удалось загрузить dashboard-конфигурацию",y.value=null,ft(),ze()}finally{pe.value=!1}}async function fr(e){var o,s,d,h,k,J;const t=!!(((d=(s=(o=y.value)==null?void 0:o.security)==null?void 0:s.iframe)==null?void 0:d.default_sandbox)??!0),n=(h=e==null?void 0:e.iframe)==null?void 0:h.sandbox;Z.open=!0,Z.title=e.title,Z.src="",Z.error="",Z.loading=!0,Z.sandbox=n==null?t:!!n,Z.allow=Array.isArray((k=e==null?void 0:e.iframe)==null?void 0:k.allow)?e.iframe.allow.join("; "):"",Z.referrerPolicy=((J=e==null?void 0:e.iframe)==null?void 0:J.referrer_policy)||"";try{const oe=await Ws(e.id);Z.src=oe.src}catch(oe){Z.error=(oe==null?void 0:oe.message)||"Не удалось подготовить iframe"}finally{Z.loading=!1}}function Ri(){Z.open=!1,Z.title="",Z.src="",Z.error="",Z.loading=!1,Z.sandbox=!1,Z.allow="",Z.referrerPolicy=""}function pr(e){if(e.open==="same_tab"){window.location.assign(e.url);return}window.open(e.url,"_blank","noopener,noreferrer")}function Oi(e){e!=null&&e.url&&window.open(e.url,"_blank","noopener,noreferrer")}function an(e){if(e.type==="iframe"){fr(e);return}pr(e)}function ln(e){return On.value.get(String(e||""))||""}async function un(e){var n;const t=String(e||"");if(t&&(n=navigator.clipboard)!=null&&n.writeText)try{await navigator.clipboard.writeText(t)}catch{}}async function gr(e){await un(e)}async function Bi(e){const t=ln(e);t&&await un(t)}async function Gi(e){const t=ln(e);t&&await un(`ssh ${t}`)}async function Ni(e){e&&await qe([e])}function Vi(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?"—":t.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function Hi(e){const t=Number(e||0);return!Number.isFinite(t)||t<=0?"—":t<1e3?`${Math.round(t)} ms`:`${(t/1e3).toFixed(2)} s`}function Fi(e){e&&(tt.host=e,tt.open=!0)}function cn(){tt.open=!1,tt.host=null}function Ki(e){const t=(e==null?void 0:e.open_ports)||[];return t.length?t.map(n=>n!=null&&n.service?`${n.port} (${n.service})`:`${n.port}`).join(", "):"—"}function Ui(e){return e?e.error?e.error:e.status_code==null?"—":`HTTP ${e.status_code}`:"—"}async function pt({silent:e=!1}={}){if(!kt){kt=!0,e||(He.value=!0);try{Ce.value=await Qs(),he.value=""}catch(t){he.value=(t==null?void 0:t.message)||"Не удалось загрузить состояние сканера LAN"}finally{kt=!1,e||(He.value=!1)}}}function gt(){rt&&(window.clearInterval(rt),rt=0)}function dn(){gt(),rt=window.setInterval(()=>{pt({silent:!0})},p)}function mr(){ze(),gt(),ft()}async function zi(){!y.value||pe.value||(await sn(),await on(),jt.value&&(await pt({silent:!0}),dn()))}async function ji(){if(!Ft){Ft=!0;try{ue.value?await zi():mr()}finally{Ft=!1}}}function vr(){ue.value=document.visibilityState!=="hidden",ji()}async function qi(){var e;if(!H.value){H.value=!0;try{const t=await Zs();Ce.value=(t==null?void 0:t.state)||Ce.value,he.value=t!=null&&t.accepted||(e=t==null?void 0:t.state)!=null&&e.queued?"":(t==null?void 0:t.message)||""}catch(t){he.value=(t==null?void 0:t.message)||"Не удалось запустить сканирование LAN"}finally{H.value=!1,pt({silent:!0})}}}function Wi(){var e,t;return((t=(e=document.documentElement)==null?void 0:e.dataset)==null?void 0:t.fxMode)||"full"}function Ji(e){const t=document.documentElement;let n="high",o="1";e>=120?(n="low",o="0.42"):e>=70&&(n="medium",o="0.68"),t.dataset.motionBudget=n,t.style.setProperty("--motion-budget",o)}function Yi(e){const t=Wi();if(t==="off")return null;const n=JSON.parse(JSON.stringify(e));return n.fps_limit=t==="lite"?34:58,t!=="lite"||(n.particles.number.value=Math.max(24,Math.round(n.particles.number.value*.56)),n.particles.opacity.value=Number((n.particles.opacity.value*.72).toFixed(2)),n.particles.move.speed=Number((n.particles.move.speed*.74).toFixed(2)),n.particles.line_linked.opacity=Number((n.particles.line_linked.opacity*.56).toFixed(2)),n.particles.line_linked.distance=Math.max(80,Math.round(n.particles.line_linked.distance*.84)),n.retina_detect=!1),n}function fn(e){const t=document.getElementById(e);t&&(t.innerHTML="",delete t.dataset.particlesReady)}function Qi(){fn(S),fn(_),fn(w)}async function Zi(){Te&&(window.cancelAnimationFrame(Te),Te=0),Te=window.requestAnimationFrame(async()=>{Te=0,Qi(),await pn(),await mt()})}function br(){Zi()}async function Mt(e,t){const n=document.getElementById(e);if(!n)return;const o=Yi(t);if(!o){n.innerHTML="",delete n.dataset.particlesReady;return}n.dataset.particlesReady==="1"||!await na()||!window.particlesJS||document.getElementById(e)&&n.dataset.particlesReady!=="1"&&(n.innerHTML="",window.particlesJS(e,o),n.dataset.particlesReady="1")}async function pn(){await Mt(S,T)}async function mt(){await Promise.all([Mt(_,x),Mt(w,x)])}return ve(()=>{var e;return(e=Le.value)==null?void 0:e.id},async()=>{V.value="",re.value="",ct(),ut(),qe(),await Me(),await mt()}),ve(()=>{var e;return(e=Nn.value)==null?void 0:e.id},async()=>{await Me(),await mt()}),ve(()=>Tt.value,e=>{V.value&&!e.includes(V.value)&&(V.value="")},{deep:!0}),ve(()=>Fe.value,()=>{ut(),qe()},{deep:!0}),ve(()=>st.value.length,e=>{if(!e){de.value=0;return}de.value>=e&&(de.value=e-1)}),ve(()=>Ct.value.map(e=>e.value).join("|"),()=>{Ct.value.some(e=>e.value===K.value)||(K.value="all")}),ve(()=>jt.value,e=>{if(e){ue.value&&(pt(),dn());return}cn(),gt()}),ve(()=>at.value.length,e=>{Ji(e)},{immediate:!0}),Ye(async()=>{window.addEventListener("visibilitychange",vr),window.addEventListener("oko:fx-mode-change",br),await pn(),await dr(),await Me(),await mt()}),Ve(()=>{ft(),ze(),gt(),cn(),window.removeEventListener("visibilitychange",vr),window.removeEventListener("oko:fx-mode-change",br),Te&&(window.cancelAnimationFrame(Te),Te=0),Re&&(clearTimeout(Re),Re=0),delete document.documentElement.dataset.motionBudget,document.documentElement.style.removeProperty("--motion-budget"),ht=null}),ht={BRAND_ICON_BY_KEY:Nt,DEFAULT_ITEM_URL:I,EMBLEM_SRC:r,HEALTH_REFRESH_MS:u,HERO_CONTROLS_PARTICLES_ID:w,HERO_PARTICLES_CONFIG:x,HERO_TITLE_PARTICLES_ID:_,ICON_BY_KEY:Vt,ICON_RULES:Xr,LAN_PAGE_ID:m,LAN_SCAN_POLL_MS:p,LARGE_INDICATOR_TYPES:v,SIDEBAR_PARTICLES_CONFIG:T,SIDEBAR_PARTICLES_ID:S,actionBusy:St,actionKey:nn,activeCommandPaletteEntry:Bn,activeIndicatorViewId:V,activeIndicatorWidget:Nn,activePage:Le,activePageGroupBlocks:vo,activePageId:W,activePageWidgetIds:Tt,addGroup:ko,addItem:Co,addSubgroup:$o,allItemIds:Rt,allSubgroupIds:Ht,appTagline:ro,appTitle:no,applyConfigMutation:fe,applyGrid:Hn,applyTheme:Vn,authProfileOptions:Ln,buildDefaultItem:Wt,buildItemFromEditorForm:qn,clampNumber:Yt,clearDragState:Ke,clearItemFaviconFailures:lr,clearSelectedNode:ct,cloneConfig:Fn,closeIframeModal:Ri,closeItemEditor:Un,closeLanHostModal:cn,closeCommandPalette:Lt,closeSettingsPanel:Qo,commandPaletteActiveIndex:de,commandPaletteOpen:Q,commandPaletteQuery:Xe,commandPaletteResults:st,config:y,configError:q,copyItemIp:Bi,copyItemSshShortcut:Gi,copyCommandPaletteEntryUrl:oi,copyUrl:gr,createBrandIcon:A,defaultItemEditorForm:D,dragState:L,editGroup:To,editItem:Lo,editMode:O,editSubgroup:Po,ensureAbsoluteUrl:qt,ensurePageGroupsReference:Mr,expandedGroups:me,faviconOriginFromUrl:en,filteredBlockGroups:ai,filteredTreeGroups:Gn,findGroup:we,findSubgroup:be,formatLanDuration:Hi,formatLanHttpStatus:Ui,formatLanMoment:Vi,fromToken:to,groupById:zt,groupOnlineItems:bi,groupTotalItems:mi,healthClass:xi,healthLabel:Ai,healthPollTimer:nt,healthState:je,healthStates:ot,iframeModal:Z,indicatorPreviewEntries:Ko,initHeroParticles:mt,initParticles:Mt,initSidebarParticles:pn,initWidgetPolling:sn,isActionBusy:$i,isDirectGroupNode:Ot,isGroupExpanded:rr,isGroupSelected:or,isIconCardView:xn,isSidebarDetailed:Ut,isSidebarHidden:$t,isTileCardView:An,isCompactServiceCardView:Mn,isInlineGroupLayout:gi,isItemSelected:si,isLanPage:jt,isLargeIndicator:lt,isSidebarIconActive:Io,isSidebarIconOnly:so,isSubgroupSelected:ir,isWidgetBlock:Wn,itemEditor:E,itemFaviconFailures:it,itemFaviconKey:tn,itemFaviconSrc:yi,itemIp:ln,itemSite:Wo,lanCidrsLabel:lo,lanHostModal:tt,lanHosts:Dn,lanPortsLabel:Ki,lanScanActionBusy:H,lanScanError:he,lanScanLoading:He,lanScanPollTimer:rt,lanScanRefreshInFlight:kt,lanScanState:Ce,loadConfig:dr,loadingConfig:pe,makeUniqueId:Be,markItemFaviconFailed:hi,moveGroup:Dr,moveCommandPaletteSelection:ti,moveItemBefore:Or,moveItemToSubgroupEnd:Br,moveSubgroup:Rr,normalizeEndpoint:xt,normalizeIconToken:eo,normalizeId:wt,normalizeLayoutBlocks:Ar,normalizeStringList:Jt,onGroupDragOver:Bo,onGroupDragStart:Do,onGroupDrop:Go,onItemCardClick:_o,onItemDragOver:Ho,onItemDragStart:Oo,onItemDrop:Fo,onSubgroupDragOver:No,onSubgroupDragStart:Ro,onSubgroupDrop:Vo,activateCommandPaletteEntry:tr,activateCommandPaletteSelection:ri,openCommandPalette:Xn,openSettingsPanel:er,openCreateItemEditor:zn,openEditItemEditor:jn,openIframeItem:fr,openIndicatorView:Yn,openItem:an,openItemInNewTab:Oi,openLanHostModal:Fi,openLinkItem:pr,pageHealthSummary:go,pages:Pe,persistConfig:Kn,pickSemanticIcon:Ze,refreshHealth:qe,recheckItem:Ni,refreshLanScanState:pt,refreshWidget:At,removeGroup:xo,removeItem:Mo,removeSubgroup:Ao,resetWidgetPolling:ft,resolveBlockGroups:Qt,resolveExpression:xe,resolveGroupIcon:wi,resolveItemIcon:_i,resolvePageIcon:Ii,resolveSubgroupIcon:Si,resolveWidgetIcon:ki,resolveWidgets:Jn,runLanScanNow:qi,runWidgetAction:Di,saveError:ae,saveStatus:ne,saveStatusLabel:uo,saveStatusTimer:Re,setCommandPaletteActiveIndex:ei,setCommandPaletteQuery:Xo,setSiteFilter:Jo,settingsPanel:et,sidebarViewToggleTitle:ao,selectItemNode:Zt,selectSidebarIconNode:So,selectSidebarIndicator:Uo,selectSubgroupNode:nr,selectedNode:$,serviceCardView:ie,siteFilter:K,siteFilterOptions:Ct,serviceGroupingMode:ce,serviceGroupingOptions:io,servicePresentationOptions:oo,sidebarIconNodeTitle:wo,sidebarIconNodes:po,sidebarIndicatorSummary:mo,sidebarIndicators:Pt,sidebarView:te,startHealthPolling:on,startLanScanPolling:dn,statCardSubtitle:Ei,statCardTrend:Ti,statCardValue:Ci,statListEntries:ur,statsExpanded:ge,stopHealthPolling:ze,stopLanScanPolling:gt,subgroupById:Rn,subgroupTotalItems:vi,submitItemEditor:Eo,syncTreeGroupsState:ut,tableRows:Pi,toggleCommandPalette:Yo,toggleEditMode:bo,toggleGroupNode:ii,toggleSettingsPanel:Zo,toggleServiceCardView:yo,toggleSidebarView:ho,treeFilter:re,treeGroups:Fe,visibleTreeItemIds:at,widgetById:Et,widgetIntervals:_t,widgetState:Ue,widgetStates:Ee,widgets:Kt},ht}const ca=["title"],da={key:0,class:"item-compact-body"},fa=["src"],pa={class:"item-tile-head"},ga=["src"],ma={class:"item-tile-title"},va={class:"item-head"},ba={class:"item-title-row"},ya=["src"],ha={class:"item-type"},Ia={class:"item-url"},wa={class:"item-health"},Sa={key:0,class:"item-tags"},_a={key:0,class:"tag-pill site-pill"},ka={class:"item-actions"},$a={key:1,class:"item-ssh-shortcut"},Ca={__name:"ServiceItemCard",props:{groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0},item:{type:Object,required:!0}},setup(r){const u=r,l=Bt(u,"groupKey"),c=Bt(u,"subgroupId"),a=Bt(u,"item"),p=le(),{isIconCardView:m,isTileCardView:v,isCompactServiceCardView:I,isItemSelected:S,onItemCardClick:_,itemFaviconSrc:w,markItemFaviconFailed:T,resolveItemIcon:x,healthClass:N,healthLabel:ee,itemIp:M,itemSite:G,copyItemIp:j,copyItemSshShortcut:D,openItem:y,openItemInNewTab:pe,recheckItem:q,copyUrl:W}=p,re=C(()=>N(a.value.id)),ge=C(()=>ee(a.value.id)),V=C(()=>M(a.value.id)),O=C(()=>`ssh ${V.value}`),ue=C(()=>G(a.value,l.value)),ie=B(!1),ce=B(!1);let K=0,te=0;const ne=C(()=>({selected:!I.value&&S(a.value.id),compact:I.value,tile:v.value,[`status-${re.value}`]:!0,"data-updated":ce.value}));function ae(){K&&clearTimeout(K),ie.value=!1,window.requestAnimationFrame(()=>{ie.value=!0,K=window.setTimeout(()=>{ie.value=!1,K=0},900)})}function Ce(){te&&clearTimeout(te),ce.value=!1,window.requestAnimationFrame(()=>{ce.value=!0,te=window.setTimeout(()=>{ce.value=!1,te=0},1250)})}return ve([re,ge],([He,H],[he,Q])=>{he===void 0&&Q===void 0||((He!==he||H!==Q)&&Ce(),H!==Q&&ae())}),Ve(()=>{K&&(clearTimeout(K),K=0),te&&(clearTimeout(te),te=0)}),(He,H)=>{var he;return f(),b("article",{class:z(["item-card",ne.value]),title:i(I)?a.value.title:void 0,onClick:H[9]||(H[9]=Q=>i(_)(l.value,c.value,a.value))},[i(m)?(f(),b("div",da,[i(w)(a.value)?(f(),b("img",{key:0,src:i(w)(a.value),class:"service-favicon compact-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:H[0]||(H[0]=Q=>i(T)(a.value))},null,40,fa)):(f(),U(_e(i(x)(a.value)),{key:1,class:"ui-icon item-icon compact-item-icon"})),g("span",{class:z(["health-dot compact-health-dot",re.value])},null,2)])):i(v)?(f(),b(X,{key:1},[g("div",pa,[i(w)(a.value)?(f(),b("img",{key:0,src:i(w)(a.value),class:"service-favicon tile-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:H[1]||(H[1]=Q=>i(T)(a.value))},null,40,ga)):(f(),U(_e(i(x)(a.value)),{key:1,class:"ui-icon item-icon tile-item-icon"})),g("span",{class:z(["health-dot tile-health-dot",re.value])},null,2)]),g("p",ma,R(a.value.title),1)],64)):(f(),b(X,{key:2},[g("div",va,[g("div",ba,[i(w)(a.value)?(f(),b("img",{key:0,src:i(w)(a.value),class:"service-favicon item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:H[2]||(H[2]=Q=>i(T)(a.value))},null,40,ya)):(f(),U(_e(i(x)(a.value)),{key:1,class:"ui-icon item-icon"})),g("h4",null,R(a.value.title),1)]),g("span",ha,R(a.value.type),1)]),g("p",Ia,R(a.value.url),1),g("div",wa,[g("span",{class:z(["health-dot",re.value])},null,2),g("span",{class:z(["health-text",{"is-updating":ie.value}])},R(ge.value),3)]),ue.value||(he=a.value.tags)!=null&&he.length?(f(),b("div",Sa,[ue.value?(f(),b("span",_a,"site:"+R(ue.value),1)):F("",!0),(f(!0),b(X,null,ye(a.value.tags,Q=>(f(),b("span",{key:Q,class:"tag-pill"},R(Q),1))),128))])):F("",!0),g("div",ka,[P(Se,{title:a.value.type==="iframe"?"Открыть iframe":"Открыть","aria-label":a.value.type==="iframe"?"Открыть iframe":"Открыть",onClick:H[3]||(H[3]=Y(Q=>i(y)(a.value),["stop"]))},{default:se(()=>[(f(),U(_e(a.value.type==="iframe"?i(Cn):i(En)),{class:"ui-icon item-action-icon"}))]),_:1},8,["title","aria-label"]),P(Se,{title:"Открыть в новой вкладке","aria-label":"Открыть в новой вкладке",onClick:H[4]||(H[4]=Y(Q=>i(pe)(a.value),["stop"]))},{default:se(()=>[P(i(xs),{class:"ui-icon item-action-icon"})]),_:1}),P(Se,{title:"Recheck health","aria-label":"Recheck health",onClick:H[5]||(H[5]=Y(Q=>i(q)(a.value.id),["stop"]))},{default:se(()=>[P(i(As),{class:"ui-icon item-action-icon"})]),_:1}),V.value?(f(),U(Se,{key:0,title:"Копировать IP","aria-label":"Копировать IP",onClick:H[6]||(H[6]=Y(Q=>i(j)(a.value.id),["stop"]))},{default:se(()=>[P(i(Ne),{class:"ui-icon item-action-icon"})]),_:1})):F("",!0),V.value?(f(),U(Se,{key:1,title:"Копировать SSH shortcut","aria-label":"Копировать SSH shortcut",onClick:H[7]||(H[7]=Y(Q=>i(D)(a.value.id),["stop"]))},{default:se(()=>[P(i(jr),{class:"ui-icon item-action-icon"})]),_:1})):F("",!0),P(Se,{title:"Копировать URL","aria-label":"Копировать URL",onClick:H[8]||(H[8]=Y(Q=>i(W)(a.value.url),["stop"]))},{default:se(()=>[P(i(Ms),{class:"ui-icon item-action-icon"})]),_:1})]),V.value?(f(),b("p",$a,[H[10]||(H[10]=es(" SSH: ",-1)),g("code",null,R(O.value),1)])):F("",!0)],64))],10,ca)}}},Ea={class:"virtual-item-grid"},Ta=120,hn=72,Pa={__name:"VirtualizedItemGrid",props:{items:{type:Array,required:!0},groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0}},setup(r){const l=Bt(r,"items"),c=le(),{isIconCardView:a,isTileCardView:p}=c,m=B(null),v=B(hn);let I=null;const S=C(()=>l.value.length>Ta),_=C(()=>S.value&&v.value<l.value.length),w=C(()=>S.value?l.value.slice(0,v.value):l.value);function T(){v.value=Math.min(l.value.length,v.value+hn)}function x(){v.value=hn}function N(){I&&(I.disconnect(),!(!_.value||!m.value)&&I.observe(m.value))}return ve(()=>l.value,async()=>{x(),await Me(),N()},{deep:!0}),ve(()=>_.value,async()=>{await Me(),N()}),Ye(async()=>{I=new IntersectionObserver(ee=>{for(const M of ee)if(M.isIntersecting){T();break}},{root:null,rootMargin:"260px 0px",threshold:0}),await Me(),N()}),Ve(()=>{I==null||I.disconnect(),I=null}),(ee,M)=>(f(),b("div",Ea,[P(ts,{name:"item-grid-transition",tag:"div",class:z(["item-grid",{"icon-card-grid":i(a),"tile-card-grid":i(p)}])},{default:se(()=>[(f(!0),b(X,null,ye(w.value,G=>(f(),U(Ca,{key:G.id,"group-key":G.__originGroupKey||r.groupKey,"subgroup-id":G.__originSubgroupId||r.subgroupId,item:G},null,8,["group-key","subgroup-id","item"]))),128))]),_:1},8,["class"]),_.value?(f(),b("div",{key:0,ref_key:"sentinelRef",ref:m,class:"item-grid-sentinel","aria-hidden":"true"},null,512)):F("",!0)]))}},La={class:"group-header"},xa={class:"group-title-row"},Aa={key:0,class:"subtitle"},Ma={class:"subgroup-title"},Da={__name:"ServiceGroupCard",props:{group:{type:Object,required:!0}},setup(r){const u=le(),{isInlineGroupLayout:l,resolveGroupIcon:c,resolveSubgroupIcon:a}=u;return(p,m)=>(f(),b("article",{class:z(["panel group-panel",{"group-panel-inline":i(l)(r.group)}])},[g("header",La,[g("div",xa,[(f(),U(_e(i(c)(r.group)),{class:"ui-icon group-icon"})),g("h2",null,R(r.group.title),1)]),r.group.description?(f(),b("p",Aa,R(r.group.description),1)):F("",!0)]),(f(!0),b(X,null,ye(r.group.subgroups,v=>(f(),b("section",{key:v.id,class:"subgroup"},[g("h3",Ma,[(f(),U(_e(i(a)(v)),{class:"ui-icon subgroup-icon"})),g("span",null,R(v.title),1)]),P(Pa,{items:v.items,"group-key":r.group.key,"subgroup-id":v.id},null,8,["items","group-key","subgroup-id"])]))),128))],2))}},Ra={class:"groups-grid"},Oa={key:0,class:"panel group-panel group-empty"},Ba={key:0,class:"panel group-panel group-empty"},Ga={__name:"ServicesGroupsPanel",setup(r){const u=le(),{activePage:l,activePageGroupBlocks:c,filteredBlockGroups:a}=u,p=B(null);let m=null;const v={duration:180,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};function I(){if(!(!m||!p.value))for(const S of p.value.querySelectorAll(".block-wrap"))S.dataset.offscreen="0",m.observe(S)}return ve(()=>{var S;return[(S=l.value)==null?void 0:S.id,c.value.length]},async()=>{m&&(m.disconnect(),await Me(),I())}),Ye(async()=>{m=new IntersectionObserver(S=>{for(const _ of S)_.target.dataset.offscreen=_.isIntersecting?"0":"1"},{root:null,rootMargin:"140px 0px",threshold:.02}),await Me(),I()}),Ve(()=>{m==null||m.disconnect(),m=null}),(S,_)=>(f(),b("section",{ref_key:"blocksRootRef",ref:p,class:"page-stack"},[(f(!0),b(X,null,ye(i(c),(w,T)=>(f(),b("section",{key:`${i(l).id}:${T}:groups`,class:"block-wrap"},[$n((f(),b("section",Ra,[(f(!0),b(X,null,ye(i(a)(w.group_ids),x=>(f(),U(Da,{key:x.key,group:x},null,8,["group"]))),128)),i(a)(w.group_ids).length?F("",!0):(f(),b("article",Oa,[..._[0]||(_[0]=[g("h2",null,"Нет данных для выбранного узла",-1),g("p",{class:"subtitle"},"Выберите другую ветку в боковом дереве.",-1)])]))])),[[i(Nr),v]])]))),128)),i(c).length?F("",!0):(f(),b("article",Ba,[..._[1]||(_[1]=[g("h2",null,"Для этой страницы нет групп",-1),g("p",{class:"subtitle"},"Откройте нужный индикатор в аккордеоне слева.",-1)])]))],512))}},Na=["aria-label","aria-expanded","disabled"],Va={class:"hero-dropdown-label"},Ha={class:"hero-dropdown-value"},Fa=["aria-label"],Ka=["aria-selected"],Ua=["onClick"],In={__name:"HeroDropdown",props:{modelValue:{type:String,default:""},label:{type:String,default:""},ariaLabel:{type:String,default:""},options:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(r,{emit:u}){const l=r,c=u,a=B(!1),p=B(null),m=C(()=>{var T;const w=l.options.find(x=>x.value===l.modelValue);return w?w.label:((T=l.options[0])==null?void 0:T.label)||""});function v(){l.disabled||(a.value=!a.value)}function I(w){c("update:modelValue",w),a.value=!1}function S(w){a.value&&p.value&&!p.value.contains(w.target)&&(a.value=!1)}function _(w){w.key==="Escape"&&(a.value=!1)}return Ye(()=>{window.addEventListener("pointerdown",S),window.addEventListener("keydown",_)}),Ve(()=>{window.removeEventListener("pointerdown",S),window.removeEventListener("keydown",_)}),(w,T)=>(f(),b("div",{ref_key:"rootRef",ref:p,class:"hero-dropdown"},[g("button",{class:"hero-dropdown-trigger",type:"button","aria-label":r.ariaLabel||r.label,"aria-haspopup":"listbox","aria-expanded":a.value,disabled:r.disabled,onClick:v},[Gr(w.$slots,"prefix",{},()=>[g("span",Va,R(r.label),1)]),g("span",Ha,R(m.value),1),P(i(Ds),{class:z(["ui-icon hero-dropdown-caret",{open:a.value}])},null,8,["class"])],8,Na),P(Vr,{name:"hero-dropdown-menu-transition"},{default:se(()=>[a.value?(f(),b("ul",{key:0,class:"hero-dropdown-menu",role:"listbox","aria-label":r.ariaLabel||r.label},[(f(!0),b(X,null,ye(r.options,x=>(f(),b("li",{key:x.value,role:"option","aria-selected":r.modelValue===x.value},[g("button",{class:z(["hero-dropdown-option",{active:r.modelValue===x.value}]),type:"button",onClick:N=>I(x.value)},[g("span",null,R(x.label),1),r.modelValue===x.value?(f(),U(i(Rs),{key:0,class:"ui-icon hero-dropdown-check"})):F("",!0)],10,Ua)],8,Ka))),128))],8,Fa)):F("",!0)]),_:1})],512))}},za={key:0,class:"hero-logo-square","aria-hidden":"true"},ja=["src"],qa=["title","aria-label","aria-selected","onClick"],Wa={class:"hero-page-tab-label"},Ja={__name:"HeroPageTabs",setup(r){let u=!1;const l=le(),{EMBLEM_SRC:c,isSidebarHidden:a,pages:p,activePage:m,activePageId:v,resolvePageIcon:I}=l,S=B(!u),_=C(()=>a.value);let w=0;return Ye(()=>{S.value&&(w=globalThis.setTimeout(()=>{S.value=!1,u=!0},700))}),Ve(()=>{w&&(globalThis.clearTimeout(w),w=0),S.value&&(u=!0)}),(T,x)=>(f(),b("nav",{class:z(["hero-page-tabs",{"hero-page-tabs--intro":S.value,"has-logo-tile":_.value}]),role:"tablist","aria-label":"Разделы"},[_.value?(f(),b("div",za,[g("img",{src:i(c),alt:""},null,8,ja)])):F("",!0),(f(!0),b(X,null,ye(i(p),N=>{var ee,M,G;return f(),b("button",{key:N.id,class:z(["hero-page-tab-btn",{active:((ee=i(m))==null?void 0:ee.id)===N.id,"hero-page-tab-btn--intro-active":S.value&&((M=i(m))==null?void 0:M.id)===N.id}]),type:"button",role:"tab",title:N.title,"aria-label":N.title,"aria-selected":((G=i(m))==null?void 0:G.id)===N.id,onClick:j=>v.value=N.id},[(f(),U(_e(i(I)(N)),{class:"ui-icon hero-page-tab-icon"})),g("span",Wa,R(N.title),1)],10,qa)}),128))],2))}},Ya={class:"hero-layout"},Qa={class:"hero panel hero-title-panel"},Za={class:"hero-title-content"},Xa={class:"hero-controls-content"},el={key:0,id:"hero-controls-drawer",class:"hero-controls-drawer"},tl={class:"hero-display-controls"},nl=["title","aria-label"],rl=["aria-expanded","title"],ol={key:0,class:"editor-error hero-editor-error"},il={__name:"ServicesHeroPanel",setup(r){const u=le(),l=B(!1),{editMode:c,isSidebarDetailed:a,isSidebarHidden:p,saveStatus:m,saveStatusLabel:v,saveError:I,sidebarViewToggleTitle:S,serviceCardView:_,serviceGroupingMode:w,serviceGroupingOptions:T,servicePresentationOptions:x,siteFilter:N,siteFilterOptions:ee,toggleEditMode:M,addGroup:G,openCommandPalette:j,openSettingsPanel:D,toggleSidebarView:y}=u;return(pe,q)=>(f(),b("section",Ya,[g("header",Qa,[q[5]||(q[5]=g("div",{id:"hero-title-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),g("div",Za,[P(Ja)])]),g("aside",{class:z(["panel hero-control-panel service-hero-controls",{active:i(c)}])},[q[6]||(q[6]=g("div",{id:"hero-controls-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),g("div",Xa,[g("button",{class:"hero-settings-secret-btn",type:"button",title:"Панель настроек","aria-label":"Открыть панель настроек",onClick:q[0]||(q[0]=(...W)=>i(D)&&i(D)(...W))},[P(i(Os),{class:"ui-icon hero-action-icon"})]),g("div",{class:z(["hero-controls-accordion",{open:l.value}])},[P(Vr,{name:"hero-controls-drawer-transition"},{default:se(()=>[l.value?(f(),b("div",el,[P(Se,{"button-class":"hero-icon-btn hero-accordion-action editor-toggle",active:i(c),title:i(c)?"Выключить режим редактирования":"Включить режим редактирования","aria-label":i(c)?"Выключить режим редактирования":"Включить режим редактирования",onClick:i(M)},{default:se(()=>[P(i(Tn),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),i(c)?(f(),U(Se,{key:0,"button-class":"hero-icon-btn hero-accordion-action",title:"Добавить группу","aria-label":"Добавить группу",onClick:i(G)},{default:se(()=>[P(i(Pn),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"])):F("",!0),g("div",tl,[P(In,{modelValue:i(_),"onUpdate:modelValue":q[1]||(q[1]=W=>gn(_)?_.value=W:null),label:"Вид","aria-label":"Режим отображения сервисов",options:i(x)},null,8,["modelValue","options"]),P(In,{modelValue:i(w),"onUpdate:modelValue":q[2]||(q[2]=W=>gn(w)?w.value=W:null),label:"","aria-label":"Группировка сервисов",options:i(T),disabled:i(p)},{prefix:se(()=>[P(i(_n),{class:"ui-icon hero-dropdown-prefix-icon","aria-hidden":"true"})]),_:1},8,["modelValue","options","disabled"]),P(In,{modelValue:i(N),"onUpdate:modelValue":q[3]||(q[3]=W=>gn(N)?N.value=W:null),label:"Site","aria-label":"Фильтр по площадке",options:i(ee)},{prefix:se(()=>[P(i(Bs),{class:"ui-icon hero-dropdown-prefix-icon","aria-hidden":"true"})]),_:1},8,["modelValue","options"])]),P(Se,{"button-class":"hero-icon-btn hero-accordion-action",title:"Быстрый поиск сервисов (Ctrl/Cmd+K)","aria-label":"Быстрый поиск сервисов",onClick:i(j)},{default:se(()=>[P(i(Gs),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"]),P(Se,{"button-class":"hero-icon-btn hero-accordion-action",active:!i(a),title:i(S),"aria-label":i(S),onClick:i(y)},{default:se(()=>[P(i(Yr),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),i(c)?(f(),b("span",{key:1,class:z(["hero-save-indicator hero-accordion-status",i(m)]),role:"status",title:i(v),"aria-label":i(v)},[P(i(Ns),{class:"ui-icon hero-save-icon"})],10,nl)):F("",!0)])):F("",!0)]),_:1}),g("button",{class:"hero-controls-trigger",type:"button","aria-expanded":l.value,"aria-controls":"hero-controls-drawer",title:l.value?"Скрыть панель действий":"Показать панель действий",onClick:q[4]||(q[4]=W=>l.value=!l.value)},[P(i(Wr),{class:"ui-icon hero-action-icon"}),P(i(Vs),{class:z(["ui-icon hero-accordion-caret",{open:l.value}])},null,8,["class"])],8,rl)],2),i(c)&&i(I)?(f(),b("p",ol,R(i(I)),1)):F("",!0)])],2)]))}},sl={key:0,class:"panel status-panel"},al={key:1,class:"panel status-panel error-state"},ll={class:"subtitle"},ul={key:3,class:"panel status-panel"},cl={__name:"DashboardMainView",setup(r){const u=Ge(()=>$e(()=>import("./IndicatorTabPanel-BMJZ32cG.js"),__vite__mapDeps([0,1,2]))),l=Ge(()=>$e(()=>import("./LanPageView-CeqSO7KF.js"),__vite__mapDeps([3,1,2]))),c=le(),{activePage:a,activeIndicatorWidget:p,loadingConfig:m,configError:v,isLanPage:I,loadConfig:S}=c;return(_,w)=>{var T;return f(),b("main",{key:((T=i(a))==null?void 0:T.id)||"empty",class:z(["page",{"indicator-open":!!i(p),"page--lan":i(I)&&!i(p)}])},[i(m)?(f(),b("section",sl,[...w[1]||(w[1]=[g("h2",null,"Загрузка конфигурации...",-1),g("p",{class:"subtitle"},"Получаем dashboard-модель из backend.",-1)])])):i(v)?(f(),b("section",al,[w[2]||(w[2]=g("h2",null,"Ошибка загрузки конфигурации",-1)),g("p",ll,R(i(v)),1),g("button",{class:"ghost",type:"button",onClick:w[0]||(w[0]=(...x)=>i(S)&&i(S)(...x))},"Повторить")])):i(a)?(f(),b(X,{key:2},[i(p)?(f(),U(i(u),{key:0})):(f(),b(X,{key:1},[i(I)?(f(),U(i(l),{key:0})):(f(),b(X,{key:1},[P(il),P(Ga)],64))],64))],64)):(f(),b("section",ul,[...w[3]||(w[3]=[g("h2",null,"Нет доступных страниц",-1),g("p",{class:"subtitle"},"Проверьте `layout.pages` в `dashboard.yaml`.",-1)])]))],2)}}},dl={class:"brand"},fl=["src"],pl={class:"brand-title"},gl={class:"brand-subtitle"},ml={__name:"SidebarHeaderTabs",setup(r){const u=le(),{EMBLEM_SRC:l,appTitle:c,appTagline:a}=u;return(p,m)=>(f(),b("div",dl,[g("img",{src:i(l),alt:"Oko"},null,8,fl),g("div",null,[g("p",pl,R(i(c)),1),g("p",gl,R(i(a)),1)])]))}},vl={class:"sidebar-stats-accordion","aria-label":"Индикаторы"},bl=["aria-expanded"],yl={class:"sidebar-stats-toggle-values"},hl={key:0,class:"sidebar-indicators"},Il=["onClick"],wl={class:"widget-head sidebar-indicator-head"},Sl={class:"widget-title"},_l={class:"item-type"},kl={key:0,class:"widget-error"},$l={key:1,class:"widget-loading"},Cl={class:"widget-value sidebar-indicator-value"},El={class:"widget-subtitle"},Tl={key:0,class:"widget-trend"},Pl={key:0,class:"widget-list sidebar-list-preview"},Ll={key:1,class:"widget-empty"},xl={class:"widget-subtitle"},Al={key:5,class:"widget-empty"},Ml={key:6,class:"widget-actions sidebar-indicator-actions"},Dl=["onClick"],Rl=["disabled","onClick"],Ol={key:1,class:"widget-empty"},Bl={__name:"SidebarIndicatorsAccordion",setup(r){const u=le(),{statsExpanded:l,sidebarIndicatorSummary:c,sidebarIndicators:a,isLargeIndicator:p,activeIndicatorWidget:m,selectSidebarIndicator:v,resolveWidgetIcon:I,widgetState:S,statCardValue:_,statCardSubtitle:w,statCardTrend:T,indicatorPreviewEntries:x,tableRows:N,openIndicatorView:ee,isActionBusy:M,runWidgetAction:G}=u;return(j,D)=>(f(),b("div",vl,[g("button",{class:"sidebar-stats-toggle",type:"button","aria-controls":"sidebar-stats-panel","aria-expanded":i(l),onClick:D[0]||(D[0]=y=>l.value=!i(l))},[D[1]||(D[1]=g("span",{class:"sidebar-stats-toggle-text"},"Индикаторы",-1)),g("span",yl,R(i(c)),1),g("span",{class:z(["sidebar-stats-toggle-caret",{open:i(l)}])},"▴",2)],8,bl),g("div",{id:"sidebar-stats-panel",class:z(["sidebar-stats-panel",{open:i(l)}])},[i(a).length?(f(),b("div",hl,[(f(!0),b(X,null,ye(i(a),y=>{var pe,q,W,re,ge;return f(),b("article",{key:y.id,class:z(["sidebar-indicator",{interactive:i(p)(y),active:((pe=i(m))==null?void 0:pe.id)===y.id}]),onClick:V=>i(v)(y)},[g("header",wl,[g("div",Sl,[(f(),U(_e(i(I)(y)),{class:"ui-icon widget-icon"})),g("h3",null,R(y.title),1)]),g("span",_l,R(y.type),1)]),(q=i(S)(y.id))!=null&&q.error?(f(),b("p",kl,R((W=i(S)(y.id))==null?void 0:W.error),1)):(re=i(S)(y.id))!=null&&re.loading?(f(),b("p",$l,"Обновление...")):y.type==="stat_card"?(f(),b(X,{key:2},[g("p",Cl,R(i(_)(y)),1),g("p",El,R(i(w)(y)),1),i(T)(y)?(f(),b("p",Tl,R(i(T)(y)),1)):F("",!0)],64)):y.type==="stat_list"?(f(),b(X,{key:3},[i(x)(y).length?(f(),b("ul",Pl,[(f(!0),b(X,null,ye(i(x)(y),V=>(f(),b("li",{key:V.title+V.value},[g("span",null,R(V.title),1),g("strong",null,R(V.value),1)]))),128))])):(f(),b("p",Ll,"Нет данных")),D[2]||(D[2]=g("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):y.type==="table"?(f(),b(X,{key:4},[g("p",xl,"Строк: "+R(i(N)(y).length),1),D[3]||(D[3]=g("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):(f(),b("p",Al,"Неподдерживаемый тип виджета")),(ge=y.data.actions)!=null&&ge.length||i(p)(y)?(f(),b("div",Ml,[i(p)(y)?(f(),b("button",{key:0,class:"ghost",type:"button",onClick:Y(V=>i(ee)(y.id),["stop"])},"Открыть вкладку",8,Dl)):F("",!0),(f(!0),b(X,null,ye(y.data.actions||[],V=>(f(),b("button",{key:V.id,class:"ghost",type:"button",disabled:i(M)(y.id,V.id),onClick:Y(O=>i(G)(y.id,V),["stop"])},R(V.title),9,Rl))),128))])):F("",!0)],10,Il)}),128))])):(f(),b("p",Ol,"Для выбранной страницы индикаторы не настроены."))],2)]))}},Gl=["draggable"],Nl={class:"tree-node-row"},Vl={class:"tree-text"},Hl={class:"tree-meta"},Fl={key:0,class:"tree-inline-actions"},Kl={__name:"SidebarTreeSubgroupNode",props:{group:{type:Object,required:!0},subgroup:{type:Object,required:!0}},setup(r){const u=le(),{dragState:l,editMode:c,onSubgroupDragStart:a,clearDragState:p,onSubgroupDragOver:m,onSubgroupDrop:v,isSubgroupSelected:I,selectSubgroupNode:S,resolveSubgroupIcon:_,subgroupTotalItems:w,editSubgroup:T,addItem:x,removeSubgroup:N}=u;return(ee,M)=>(f(),b("li",{class:z(["tree-subgroup-item",{dragging:i(l).type==="subgroup"&&i(l).subgroupId===r.subgroup.id}]),draggable:i(c),onDragstart:M[4]||(M[4]=Y(G=>i(a)(G,r.group.id,r.subgroup.id),["stop"])),onDragend:M[5]||(M[5]=Y((...G)=>i(p)&&i(p)(...G),["stop"])),onDragover:M[6]||(M[6]=Y(G=>i(m)(G,r.group.id,r.subgroup.id),["stop"])),onDrop:M[7]||(M[7]=Y(G=>i(v)(G,r.group.id,r.subgroup.id),["stop"]))},[g("div",Nl,[g("button",{class:z(["tree-node tree-subgroup",{active:i(I)(r.group.key,r.subgroup.id)}]),type:"button",onClick:M[0]||(M[0]=G=>i(S)(r.group.key,r.subgroup.id))},[(f(),U(_e(i(_)(r.subgroup)),{class:"ui-icon tree-icon tree-sub-icon"})),g("span",Vl,R(r.subgroup.title),1),g("span",Hl,R(i(w)(r.subgroup)),1)],2),i(c)?(f(),b("div",Fl,[P(i(Qr),{class:"ui-icon tree-grip"}),g("button",{class:"tree-mini-btn",type:"button",title:"Редактировать подгруппу",onClick:M[1]||(M[1]=Y(G=>i(T)(r.group.id,r.subgroup.id),["stop"]))},[P(i(Tn),{class:"ui-icon"})]),g("button",{class:"tree-mini-btn",type:"button",title:"Добавить элемент",onClick:M[2]||(M[2]=Y(G=>i(x)(r.group.id,r.subgroup.id),["stop"]))},[P(i(Pn),{class:"ui-icon"})]),g("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить подгруппу",onClick:M[3]||(M[3]=Y(G=>i(N)(r.group.id,r.subgroup.id),["stop"]))},[P(i(Zr),{class:"ui-icon"})])])):F("",!0)])],42,Gl))}},Ul=["draggable"],zl={class:"tree-node-row"},jl={class:"tree-text"},ql={class:"tree-meta"},Wl={key:0,class:"tree-inline-actions"},Jl={class:"tree-subgroups"},Yl={__name:"SidebarTreeGroupNode",props:{group:{type:Object,required:!0}},setup(r){const u=le(),{dragState:l,editMode:c,isDirectGroupNode:a,onGroupDragStart:p,clearDragState:m,onGroupDragOver:v,onGroupDrop:I,isGroupSelected:S,toggleGroupNode:_,isGroupExpanded:w,resolveGroupIcon:T,groupTotalItems:x,editGroup:N,addSubgroup:ee,removeGroup:M}=u;return(G,j)=>(f(),b("li",{class:z(["tree-group-item",{dragging:i(l).type==="group"&&i(l).groupId===r.group.id&&i(a)(r.group)}]),draggable:i(c)&&i(a)(r.group),onDragstart:j[4]||(j[4]=Y(D=>i(p)(D,r.group),["stop"])),onDragend:j[5]||(j[5]=Y((...D)=>i(m)&&i(m)(...D),["stop"])),onDragover:j[6]||(j[6]=Y(D=>i(v)(D,r.group),["stop"])),onDrop:j[7]||(j[7]=Y(D=>i(I)(D,r.group),["stop"]))},[g("div",zl,[g("button",{class:z(["tree-node tree-group",{active:i(S)(r.group.key)}]),type:"button",onClick:j[0]||(j[0]=D=>i(_)(r.group.key))},[g("span",{class:z(["tree-caret",{open:i(w)(r.group.key)}])},"▾",2),(f(),U(_e(i(T)(r.group)),{class:"ui-icon tree-icon"})),g("span",jl,R(r.group.title),1),g("span",ql,R(i(x)(r.group)),1)],2),i(c)&&i(a)(r.group)?(f(),b("div",Wl,[P(i(Qr),{class:"ui-icon tree-grip"}),g("button",{class:"tree-mini-btn",type:"button",title:"Редактировать группу",onClick:j[1]||(j[1]=Y(D=>i(N)(r.group.id),["stop"]))},[P(i(Tn),{class:"ui-icon"})]),g("button",{class:"tree-mini-btn",type:"button",title:"Добавить подгруппу",onClick:j[2]||(j[2]=Y(D=>i(ee)(r.group.id),["stop"]))},[P(i(Pn),{class:"ui-icon"})]),g("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить группу",onClick:j[3]||(j[3]=Y(D=>i(M)(r.group.id),["stop"]))},[P(i(Zr),{class:"ui-icon"})])])):F("",!0)]),$n(g("ul",Jl,[(f(!0),b(X,null,ye(r.group.subgroups,D=>(f(),U(Kl,{key:D.id,group:r.group,subgroup:D},null,8,["group","subgroup"]))),128))],512),[[ns,i(w)(r.group.key)]])],42,Ul))}},Ql={key:0,class:"sidebar-tree","aria-label":"Дерево сервисов"},Zl={key:0,class:"tree-root"},Xl={key:1,class:"tree-empty"},eu={__name:"SidebarTreePanel",setup(r){const u=le(),{treeGroups:l,filteredTreeGroups:c}=u,a={duration:160,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};return(p,m)=>i(l).length?(f(),b("section",Ql,[i(c).length?$n((f(),b("ul",Zl,[(f(!0),b(X,null,ye(i(c),v=>(f(),U(Yl,{key:v.key,group:v},null,8,["group"]))),128))])),[[i(Nr),a]]):(f(),b("p",Xl,"По вашему запросу ничего не найдено."))])):F("",!0)}},tu={class:"sidebar"},nu={class:"sidebar-content"},ru={__name:"DashboardSidebarView",setup(r){const u=le(),{isSidebarDetailed:l}=u;return(c,a)=>(f(),b("aside",tu,[a[0]||(a[0]=g("div",{id:"sidebar-particles",class:"sidebar-particles","aria-hidden":"true"},null,-1)),g("div",nu,[P(ml),i(l)?(f(),U(eu,{key:0})):F("",!0),i(l)?(f(),U(Bl,{key:1})):F("",!0)])]))}},ou=["src"],iu={__name:"App",setup(r){const u=()=>$e(()=>import("./LanHostModal-CTyeP8mm.js"),__vite__mapDeps([4,1,5,2])),l=()=>$e(()=>import("./IframeModal-C4wbCAAm.js"),__vite__mapDeps([6,5,1,2])),c=()=>$e(()=>import("./ItemEditorModal-_mi_x26T.js"),__vite__mapDeps([7,1,5,2])),a=()=>$e(()=>import("./DashboardSettingsModal-B3SdMY3C.js"),__vite__mapDeps([8,5,1,2])),p=()=>$e(()=>import("./CommandPaletteModal-Do-LWHyc.js"),__vite__mapDeps([9,1,5,2])),m=()=>$e(()=>import("./IndicatorTabPanel-BMJZ32cG.js"),__vite__mapDeps([0,1,2])),v=()=>$e(()=>import("./LanPageView-CeqSO7KF.js"),__vite__mapDeps([3,1,2])),I=Ge(u),S=Ge(l),_=Ge(c),w=Ge(a),T=Ge(p),x=le(),{EMBLEM_SRC:N,closeCommandPalette:ee,closeSettingsPanel:M,commandPaletteOpen:G,iframeModal:j,isSidebarHidden:D,itemEditor:y,lanHostModal:pe,settingsPanel:q,toggleCommandPalette:W}=x,re=B(!1);let ge=0,V=0,O=0;function ue(){Promise.allSettled([u(),l(),c(),a(),p(),m(),v()])}function ie(){if("requestIdleCallback"in window){O=window.requestIdleCallback(()=>{O=0,ue()},{timeout:2e3});return}V=window.setTimeout(()=>{V=0,ue()},1400)}function ce(K){if((K.metaKey||K.ctrlKey)&&!K.altKey&&!K.shiftKey&&K.key.toLowerCase()==="k"){K.preventDefault(),W();return}if(K.key==="Escape"&&G.value){K.preventDefault(),ee();return}K.key==="Escape"&&q.open&&(K.preventDefault(),M())}return Ye(()=>{ge=globalThis.setTimeout(()=>{re.value=!0},1e3),window.addEventListener("keydown",ce),ie()}),Ve(()=>{ge&&(globalThis.clearTimeout(ge),ge=0),V&&(window.clearTimeout(V),V=0),O&&"cancelIdleCallback"in window&&(window.cancelIdleCallback(O),O=0),window.removeEventListener("keydown",ce)}),(K,te)=>(f(),b("div",{class:z(["shell",{"shell-motion-static":re.value}])},[g("img",{class:"center-emblem",src:i(N),alt:"","aria-hidden":"true"},null,8,ou),g("div",{class:z(["app-shell",{"sidebar-hidden":i(D)}])},[i(D)?F("",!0):(f(),U(ru,{key:0})),P(cl)],2),i(pe).open?(f(),U(i(I),{key:0})):F("",!0),i(j).open?(f(),U(i(S),{key:1})):F("",!0),i(y).open?(f(),U(i(_),{key:2})):F("",!0),i(q).open?(f(),U(i(w),{key:3})):F("",!0),i(G)?(f(),U(i(T),{key:4})):F("",!0)],2))}};async function su(r){}function au(){var c,a,p,m;if((a=(c=globalThis.matchMedia)==null?void 0:c.call(globalThis,"(prefers-reduced-motion: reduce)"))==null?void 0:a.matches)return"off";const u=Number(((p=globalThis.navigator)==null?void 0:p.hardwareConcurrency)||8),l=Number(((m=globalThis.navigator)==null?void 0:m.deviceMemory)||8);return u<=4||l<=4?"lite":"full"}function lu(r){const u=document.documentElement,l=u.dataset.fxMode||"";u.dataset.fxMode=r,r==="off"?u.style.setProperty("--glow-enabled","0"):r==="lite"?u.style.setProperty("--glow-enabled","0.58"):u.style.setProperty("--glow-enabled","1"),l&&l!==r&&window.dispatchEvent(new CustomEvent("oko:fx-mode-change",{detail:{mode:r,previousMode:l}}))}function uu(){var l;const r=(l=globalThis.matchMedia)==null?void 0:l.call(globalThis,"(prefers-reduced-motion: reduce)"),u=()=>lu(au());u(),r!=null&&r.addEventListener?r.addEventListener("change",u):r!=null&&r.addListener&&r.addListener(u)}uu();su();rs(iu).use(os).mount("#app");export{In as _,Ja as a,Se as b,le as u};
