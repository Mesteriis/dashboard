const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/IndicatorTabPanel-CFw2TNfg.js","assets/vendor-D1bzbGly.js","assets/vendor-icons-BtRhSBC4.js","assets/LanPageView-DQnpOuUY.js","assets/LanHostModal-Ct00IqDy.js","assets/BaseModal-DEo4-NpV.js","assets/IframeModal-DC9UTip8.js","assets/ItemEditorModal-CJSmesRy.js","assets/DashboardSettingsModal-B8escnY1.js","assets/CommandPaletteModal-ehn6US3D.js"])))=>i.map(i=>d[i]);
import{o as f,c as y,r as ds,n as q,h as Pr,w as le,a as Re,b as et,d as tt,e as N,f as ye,g as C,u as s,i as z,j as ke,k as v,F as ne,t as G,l as K,m as we,p as A,q as ge,s as X,v as fs,x as qt,T as ps,y as Mn,z as Yr,A as gs,B as Ve,C as ms,D as vs,M as bs}from"./vendor-D1bzbGly.js";import{s as Lr,a as Ar,b as ys,c as hs,d as xr,e as Is,f as En,g as ws,h as Dr,i as Mr,j as Rr,k as wt,l as _s,m as Br,n as Ss,o as ks,p as Or,q as Es,r as Cs,t as Cn,H as kt,N as Wt,S as He,F as Qr,C as Zr,u as Xr,T as Ln,v as eo,w as to,D as An,x as Ts,y as $s,W as Ps,A as Ls,E as As,z as xs,M as Gr,P as Ds,B as no,G as Rn,L as Bn,I as Ms,K as Rs,J as Bs,O as Nr,Q as ro,R as Ur,U as Vr,V as Os,X as Gs,Y as Ns,Z as Us,_ as Tn,$ as oo,a0 as Vs,a1 as io,a2 as Hs,a3 as Fs,a4 as so,a5 as Ks,a6 as zs,a7 as js,a8 as On,a9 as Gn,aa as qs,ab as Ws,ac as Js,ad as Ys,ae as ao,af as lo}from"./vendor-icons-BtRhSBC4.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))c(u);new MutationObserver(u=>{for(const p of u)if(p.type==="childList")for(const g of p.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&c(g)}).observe(document,{childList:!0,subtree:!0});function l(u){const p={};return u.integrity&&(p.integrity=u.integrity),u.referrerPolicy&&(p.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?p.credentials="include":u.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function c(u){if(u.ep)return;u.ep=!0;const p=l(u);fetch(u.href,p)}})();const Qs="modulepreload",Zs=function(r){return"/static/"+r},Hr={},he=function(a,l,c){let u=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),m=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));u=Promise.allSettled(l.map(h=>{if(h=Zs(h),h in Hr)return;Hr[h]=!0;const S=h.endsWith(".css"),k=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${k}`))return;const w=document.createElement("link");if(w.rel=S?"stylesheet":Qs,S||(w.as="script"),w.crossOrigin="",w.href=h,m&&w.setAttribute("nonce",m),document.head.appendChild(w),S)return new Promise(($,F)=>{w.addEventListener("load",$),w.addEventListener("error",()=>F(new Error(`Unable to preload CSS for ${h}`)))})}))}function p(g){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=g,window.dispatchEvent(m),!m.defaultPrevented)throw g}return u.then(g=>{for(const m of g||[])m.status==="rejected"&&p(m.reason);return a().catch(p)})},Xs=["type","title","aria-label","disabled"],Ie={__name:"IconButton",props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"button"},title:{type:String,default:""},ariaLabel:{type:String,default:""},buttonClass:{type:String,default:""}},emits:["click"],setup(r){return(a,l)=>(f(),y("button",{class:q(["ghost icon-btn",[r.buttonClass,{active:r.active}]]),type:r.type,title:r.title,"aria-label":r.ariaLabel||r.title,disabled:r.disabled,onClick:l[0]||(l[0]=c=>a.$emit("click",c))},[ds(a.$slots,"default")],10,Xs))}},ea="X-Dashboard-Token";function ta(){var l;if(typeof window>"u")return"";const r=((l=window.localStorage)==null?void 0:l.getItem("dashboard_admin_token"))||"";if(String(r).trim())return String(r).trim();const a=window.__DASHBOARD_ADMIN_TOKEN__||"";return String(a).trim()}function na(r){const a=String(r||"");if(!a||/^https?:\/\//i.test(a))return a;const l=typeof window>"u"?"":String(window.__OKO_API_BASE__||"").trim();if(!l)return a;const c=l.endsWith("/")?l.slice(0,-1):l,u=a.startsWith("/")?a:`/${a}`;return`${c}${u}`}function ra(r,a,l){const c=a&&typeof r=="object"&&r!==null?r.detail:null;let u=`Request failed: ${l}`;return Array.isArray(c)?u=c.map(p=>typeof p=="object"&&p!==null&&"message"in p?String(p.message||""):JSON.stringify(p)).join("; "):typeof c=="string"&&c?u=c:typeof r=="string"&&r&&(u=r),u}async function Be(r,a={}){const{requireAdminToken:l=!1,headers:c={},...u}=a,p={};if(c instanceof Headers)c.forEach((w,$)=>{p[$]=w});else if(Array.isArray(c))for(const[w,$]of c)p[w]=String($);else Object.assign(p,c);const g={Accept:"application/json",...p};if(l){const w=ta();w&&(g[ea]=w)}const m=await fetch(na(r),{credentials:"same-origin",headers:g,...u}),S=(m.headers.get("content-type")||"").includes("application/json"),k=S?await m.json():await m.text();if(!m.ok){const $=new Error(ra(k,S,m.status));throw $.status=m.status,$.body=k,$}return k}const nt="/api/v1/dashboard";function oa(){return Be(`${nt}/config`)}function ia(r){return Be(`${nt}/iframe/${encodeURIComponent(r)}/source`,{requireAdminToken:!0})}function sa(r=[]){const a=new URLSearchParams;for(const c of r)a.append("item_id",c);const l=a.toString();return Be(`${nt}/health${l?`?${l}`:""}`)}function aa(r){return Be(`${nt}/config`,{requireAdminToken:!0,method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}function la(){return Be(`${nt}/lan/state`)}function ua(){return Be(`${nt}/lan/run`,{requireAdminToken:!0,method:"POST"})}const $n="oko-particles-js",ca="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js",da=7e3;let _t=null;function xn(){return typeof window.particlesJS=="function"}function fa(r){return new Promise(a=>{let l=!1;const c=p=>{l||(l=!0,a(p))},u=window.setTimeout(()=>{c(xn())},da);r.addEventListener("load",()=>{window.clearTimeout(u),c(xn())},{once:!0}),r.addEventListener("error",()=>{window.clearTimeout(u),c(!1)},{once:!0})})}async function pa(){return typeof window>"u"||typeof document>"u"?!1:xn()?!0:_t||(_t=(async()=>{let r=document.getElementById($n)instanceof HTMLScriptElement?document.getElementById($n):null;r||(r=document.createElement("script"),r.id=$n,r.src=ca,r.async=!0,r.defer=!0,document.head.appendChild(r));const a=await fa(r);return a||(_t=null),a})(),_t)}function L(r){const a=`#${r.hex}`;return(l,{attrs:c})=>Pr("svg",{...c,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",role:"img","aria-hidden":"true",style:c.style?[c.style,{color:a}]:{color:a}},[Pr("path",{d:r.path})])}const Jt={homeassistant:L(Cn),"home-assistant":L(Cn),ha:L(Cn),openwrt:L(Cs),adguard:L(Es),proxmox:L(Or),pve:L(Or),grafana:L(ks),gitea:L(Ss),jellyfin:L(Br),jellyseerr:L(Br),sonarr:L(wt),radarr:L(_s),lidarr:L(wt),readarr:L(wt),bazarr:L(wt),prowlarr:L(wt),qbittorrent:L(Rr),qb:L(Rr),postgres:L(Mr),postgresql:L(Mr),docker:L(Dr),dockge:L(Dr),cockpit:L(ws),npm:L(En),nginxproxymanager:L(En),"nginx-proxy-manager":L(En),nginx:L(Is),openai:L(xr),ai:L(xr),portainer:L(hs),ytsync:L(Ar),youtube:L(ys),youtubeshorts:L(Ar),termius:L(Lr),termix:L(Lr)},Yt={home:kt,house:kt,дом:kt,dom:kt,route:Hs,net:Wt,network:Wt,сеть:Wt,dashboard:io,infra:He,infrastructure:He,инфраструктура:He,server:He,core:Vs,ops:oo,media:Tn,медиа:Tn,tv:Tn,iot:Zr,cloud:Us,wifi:Ns,monitor:Gs,cockpit:Os,proxmox:He,grafana:Xr,gitea:Vr,git:Vr,jellyfin:Qr,navidrome:Gr,tunnel:Ur,tunnels:Ur,stats:ro,services:Nr,service:Nr,health:eo,alerts:Ln,alert:Ln,security:to,auth:Bs,key:Rs,db:An,database:An,storage:Ms,link:Bn,iframe:Rn,terminal:no,package:Ds,music:Gr,camera:xs,eye:As,observability:Ls,workflow:Ps,settings:$s,spark:Ts},uo=[{re:/\b(home|house|dom|дом)\b/,icon:kt},{re:/\b(net|network|route|vpn|edge|сеть|маршрут|туннел)\b/,icon:Wt},{re:/\b(infra|server|cluster|pve|проксмокс|инфраструктур)\b/,icon:He},{re:/\b(media|tv|video|stream|jellyfin|медиа)\b/,icon:Qr},{re:/\b(iot|sensor|home-assistant|умн|дом)\b/,icon:Zr},{re:/\b(stat|metric|chart|grafana|аналит|monitor)\b/,icon:Xr},{re:/\b(alert|error|warn|critical|ошиб|авар)\b/,icon:Ln},{re:/\b(health|status|pulse|heart|состояни)\b/,icon:eo},{re:/\b(auth|token|secret|lock|ключ|безопас)\b/,icon:to},{re:/\b(db|database|postgres|mysql|redis)\b/,icon:An}],Xe={page:io,group:so,subgroup:Fs,itemLink:Bn,itemIframe:Rn,widget:ro};function co(r){return String(r||"").toLowerCase().replace(/[^a-z0-9а-яё._-]+/gi," ").split(/[\s._-]+/).filter(Boolean)}function fo(r){if(Jt[r])return Jt[r];for(const[a,l]of Object.entries(Jt))if(r.includes(a))return l;if(Yt[r])return Yt[r];for(const[a,l]of Object.entries(Yt))if(r.includes(a))return l;return null}function rt(r,a){for(const c of r)for(const u of co(c)){const p=fo(u);if(p)return p}const l=r.map(c=>String(c||"").toLowerCase()).filter(Boolean).join(" ");for(const c of uo)if(c.re.test(l))return c.icon;return a}function ga(r){return rt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],Xe.page)}function ma(r){return rt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.description],Xe.group)}function va(r){return rt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],Xe.subgroup)}function ba(r){return rt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,r==null?void 0:r.url,...(r==null?void 0:r.tags)||[]],(r==null?void 0:r.type)==="iframe"?Xe.itemIframe:Xe.itemLink)}function ya(r){var a;return rt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,(a=r==null?void 0:r.data)==null?void 0:a.endpoint],Xe.widget)}function Et(r,a="node"){return String(r||"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")||a}function Ue(r,a){const l=Et(r,"node");let c=l,u=2;for(;a.has(c);)c=`${l}-${u}`,u+=1;return c}function Qt(r){const a=new Set;for(const l of r.groups||[])for(const c of l.subgroups||[])a.add(c.id);return a}function Kt(r){const a=new Set;for(const l of r.groups||[])for(const c of l.subgroups||[])for(const u of c.items||[])a.add(u.id);return a}function Se(r,a){return(r.groups||[]).find(l=>l.id===a)||null}function be(r,a,l){const c=Se(r,a);return c&&(c.subgroups||[]).find(u=>u.id===l)||null}function zt(r){return String((r==null?void 0:r.key)||"").startsWith("group:")}function Fr(r){var u,p;const a=new Set((r.groups||[]).map(g=>g.id)),l=Qt(r),c=new Set([...a,...l]);for(const g of((u=r.layout)==null?void 0:u.pages)||[]){const m=[];for(const h of g.blocks||[]){if(h.type==="groups"){h.group_ids=(h.group_ids||[]).filter(S=>c.has(S)),h.group_ids.length&&m.push(h);continue}(h.widgets||[]).length&&m.push(h)}!m.length&&((p=r.groups)!=null&&p.length)&&m.push({type:"groups",group_ids:[r.groups[0].id]}),g.blocks=m}}function Kr(r,a,l){var g;const c=((g=r.layout)==null?void 0:g.pages)||[];if(!c.length)return;const u=c.find(m=>m.id===a)||c[0];let p=u.blocks.find(m=>m.type==="groups");if(!p){p={type:"groups",group_ids:[l]},u.blocks.push(p);return}p.group_ids.includes(l)||p.group_ids.push(l)}function zr(r,a,l){const c=r.groups||[],u=c.findIndex(h=>h.id===a),p=c.findIndex(h=>h.id===l);if(u<0||p<0||u===p)return!1;const[g]=c.splice(u,1),m=u<p?p-1:p;return c.splice(m,0,g),!0}function jr(r,a,l,c,u){const p=Se(r,a),g=Se(r,c);if(!p||!g)return!1;const m=(p.subgroups||[]).findIndex(k=>k.id===l),h=(g.subgroups||[]).findIndex(k=>k.id===u);if(m<0||h<0)return!1;if(a!==c&&p.subgroups.length<=1)throw new Error("В исходной группе должна остаться минимум одна подгруппа.");const[S]=p.subgroups.splice(m,1);if(a===c){const k=m<h?h-1:h;return p.subgroups.splice(k,0,S),!0}return g.subgroups.splice(h,0,S),!0}function qr(r,a,l,c,u,p,g){const m=be(r,a,l),h=be(r,u,p);if(!m||!h)return!1;const S=(m.items||[]).findIndex($=>$.id===c),k=(h.items||[]).findIndex($=>$.id===g);if(S<0||k<0)return!1;if(l!==p&&m.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[w]=m.items.splice(S,1);if(l===p){const $=S<k?k-1:k;return m.items.splice($,0,w),!0}return h.items.splice(k,0,w),!0}function Wr(r,a,l,c,u,p){const g=be(r,a,l),m=be(r,u,p);if(!g||!m)return!1;const h=(g.items||[]).findIndex(k=>k.id===c);if(h<0)return!1;if(l!==p&&g.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[S]=g.items.splice(h,1);return m.items.push(S),!0}function ha(r){const a=String(r||"").trim();if(!a)throw new Error("URL не может быть пустым");const l=/^https?:\/\//i.test(a)?a:`https://${a}`;let c;try{c=new URL(l)}catch{throw new Error(`Некорректный URL: ${a}`)}if(!["http:","https:"].includes(c.protocol))throw new Error(`Разрешены только http/https URL: ${a}`);return c.toString()}function Ia(r){const a=String(r||"").trim();if(!a)return"";const l=/^https?:\/\//i.test(a)?a:`https://${a}`;try{const c=new URL(l);return["http:","https:"].includes(c.protocol)?c.origin:""}catch{return""}}let St=null;function ue(){if(St)return St;const r="/static/img/emblem-mark.png",a=3e4,l=16e3,c=9e3,u=700,p=1e4,g="lan",m=new Set(["stat_list","table"]),h="https://example.com",S="sidebar-particles",k="hero-title-particles",w="hero-controls-particles",$={fps_limit:58,particles:{number:{value:88,density:{enable:!0,value_area:700}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.36,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:120,color:"#2dd4bf",opacity:.24,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},F={fps_limit:58,particles:{number:{value:92,density:{enable:!0,value_area:720}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.4,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:132,color:"#2dd4bf",opacity:.26,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},B=Object.freeze([{value:"detailed",label:"Карточки"},{value:"tile",label:"Плитка"},{value:"icon",label:"Значки"}]),W=Object.freeze([{value:"groups",label:"Только группы"},{value:"tags_in_groups",label:"Группы + теги"},{value:"tags",label:"Только теги"},{value:"flat",label:"Без групп (плитка)"}]),x=["detailed","hidden"],U=18,J=10,O="oko:dashboard-ui-state:v1",R=new Set(B.map(e=>e.value)),Te=new Set(W.map(e=>e.value));function $e(){if(typeof window>"u"||!window.localStorage)return null;try{const e=window.localStorage.getItem(O);if(!e)return null;const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}function Ee(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(O,JSON.stringify(e))}catch{}}function oe(){return{id:"",title:"",type:"link",url:h,icon:"",siteInput:"",tagsInput:"",open:"new_tab",healthcheckEnabled:!1,healthcheckUrl:"",healthcheckIntervalSec:30,healthcheckTimeoutMs:1500,iframeSandboxMode:"default",iframeAllowInput:"",iframeReferrerPolicy:"",authProfile:""}}const E=N(null),j=N(!0),me=N(""),Q=N(""),se=N(""),_e=N(!1),ee=N(""),D=N(!1),Y=N(typeof document>"u"?!0:document.visibilityState!=="hidden"),re=N("detailed"),ve=N("groups"),ce=N("all"),M=N("detailed"),Z=N("idle"),V=N(""),Ke=N(null),Zt=N(!1),$t=N(!1),ot=N(""),Pt=N(!1),it=N(""),de=N(0),Oe=ye({open:!1}),st=ye({open:!1,host:null}),Pe=ye({}),Lt=ye({}),At=new Map;let at=0,Ge=0,lt=0,xt=!1,Xt=!1,Le=0;const I=ye({groupKey:"",subgroupId:"",itemId:""}),ae=ye({}),ut=ye({}),P=ye({type:"",groupId:"",subgroupId:"",itemId:""}),ct=ye({}),fe=$e();if(fe){const e=String(fe.serviceCardView||"");R.has(e)&&(re.value=e);const t=String(fe.serviceGroupingMode||"");Te.has(t)&&(ve.value=t);const n=String(fe.sidebarView||"");x.includes(n)&&(M.value=n);const o=String(fe.siteFilter||"").trim().toLowerCase();ce.value=o||"all",Q.value=String(fe.activePageId||""),se.value=String(fe.treeFilter||""),ee.value=String(fe.activeIndicatorViewId||""),_e.value=!!fe.statsExpanded,D.value=!!fe.editMode,Oe.open=!!fe.settingsPanelOpen;const i=fe.selectedNode;i&&typeof i=="object"&&(I.groupKey=String(i.groupKey||""),I.subgroupId=String(i.subgroupId||""),I.itemId=String(i.itemId||""));const d=fe.expandedGroups;if(d&&typeof d=="object")for(const[b,_]of Object.entries(d)){const H=String(b||"");H&&(ae[H]=!!_)}}const te=ye({open:!1,title:"",src:"",allow:"",sandbox:!1,referrerPolicy:"",loading:!1,error:""}),T=ye({open:!1,mode:"create",groupId:"",subgroupId:"",originalItemId:"",submitting:!1,error:"",form:oe()}),Ae=C(()=>{var t,n;if(!E.value)return[];const e=((n=(t=E.value)==null?void 0:t.layout)==null?void 0:n.pages)||[];return e.some(o=>o.id===g)?e:[...e,{id:g,title:"LAN",icon:"network",blocks:[]}]}),en=C(()=>{var e;return((e=E.value)==null?void 0:e.widgets)||[]}),Nn=C(()=>{var e,t;return((t=(e=E.value)==null?void 0:e.security)==null?void 0:t.auth_profiles)||[]}),go=C(()=>{var e,t;return((t=(e=E.value)==null?void 0:e.app)==null?void 0:t.title)||"Oko"}),mo=C(()=>{var e,t;return((t=(e=E.value)==null?void 0:e.app)==null?void 0:t.tagline)||"Your Infrastructure in Sight"}),vo=C(()=>B),bo=C(()=>W),Un=C(()=>re.value==="icon"),Vn=C(()=>re.value==="tile"),Hn=C(()=>Un.value||Vn.value),tn=C(()=>M.value!=="hidden"),Dt=C(()=>M.value==="hidden"),yo=C(()=>!1),ho=C(()=>tn.value?"Режим меню: полное. Нажмите, чтобы скрыть меню":"Режим меню: скрыто. Нажмите, чтобы вернуть полное меню"),Fn=C(()=>{var e,t;return((t=(e=Ke.value)==null?void 0:e.result)==null?void 0:t.hosts)||[]}),Io=C(()=>{var t,n;const e=((n=(t=Ke.value)==null?void 0:t.result)==null?void 0:n.scanned_cidrs)||[];return e.length?e.join(", "):"нет данных"}),wo=C(()=>Z.value==="saving"?"Сохранение...":Z.value==="saved"?"Сохранено":Z.value==="error"?"Ошибка сохранения":D.value?"Готово":"Сохранение выключено"),Mt=C(()=>{var n;const e=new Map;for(const o of((n=E.value)==null?void 0:n.groups)||[])for(const i of o.subgroups||[])for(const d of i.items||[]){const b=mt(d,o);if(!b)continue;const _=b.toLowerCase();e.has(_)||e.set(_,b)}const t=Array.from(e.entries()).sort((o,i)=>o[1].localeCompare(i[1],"ru",{sensitivity:"base"}));return[{value:"all",label:"Все sites"},...t.map(([o,i])=>({value:o,label:i}))]}),Rt=C(()=>{const e=new Map;for(const t of en.value)e.set(t.id,t);return e}),nn=C(()=>{var t;const e=new Map;for(const n of((t=E.value)==null?void 0:t.groups)||[])e.set(n.id,n);return e}),Kn=C(()=>{var t;const e=new Map;for(const n of((t=E.value)==null?void 0:t.groups)||[])for(const o of n.subgroups||[])e.set(o.id,{group:n,subgroup:o});return e}),_o=C(()=>{const e=new Map;for(const t of Ae.value)for(const n of t.blocks||[])if((n==null?void 0:n.type)==="groups")for(const o of n.group_ids||[])e.has(o)||e.set(o,t.id);return e}),zn=C(()=>{const e=new Map;for(const t of Fn.value||[]){const n=String((t==null?void 0:t.ip)||"").trim();if(n)for(const o of(t==null?void 0:t.dashboard_items)||[]){const i=String((o==null?void 0:o.id)||"").trim();i&&!e.has(i)&&e.set(i,n)}}return e}),So=C(()=>{var n;const e=[],t=_o.value;e.push({id:"action:open-settings-panel",type:"action",action:"open_settings_panel",item:null,title:"Открыть панель настроек",titleLower:"открыть панель настроек",host:"",ip:"",site:"",tagsLower:[],groupId:"",groupKey:"",groupTitle:"Команда",subgroupId:"",subgroupTitle:"Интерфейс",pageId:"",searchBlob:"открыть панель настроек settings ui интерфейс control panel параметры фильтры"});for(const o of((n=E.value)==null?void 0:n.groups)||[])for(const i of o.subgroups||[])for(const d of i.items||[]){const b=ni(d==null?void 0:d.url),_=zn.value.get(d.id)||"",H=(d.tags||[]).map(Ce=>String(Ce||"").trim()).filter(Boolean),ie=mt(d,o);if(ce.value!=="all"&&ie.toLowerCase()!==ce.value)continue;const Ne=t.get(o.id)||t.get(i.id)||"",Me=String(d.title||"").trim(),Qe=[Me,String(d.id||""),String(d.url||""),b,_,ie,String(o.title||""),String(i.title||""),...H].join(" ").toLowerCase();e.push({id:d.id,type:"item",action:"",item:d,title:Me,titleLower:Me.toLowerCase(),host:b.toLowerCase(),ip:_.toLowerCase(),site:ie.toLowerCase(),tagsLower:H.map(Ce=>Ce.toLowerCase()),groupId:o.id,groupKey:`group:${o.id}`,groupTitle:String(o.title||""),subgroupId:i.id,subgroupTitle:String(i.title||""),pageId:Ne,searchBlob:Qe})}return e}),dt=C(()=>{const e=String(it.value||"").trim().toLowerCase(),t=So.value;if(!e){const i=t.filter(b=>b.type==="action"),d=t.filter(b=>b.type!=="action").slice().sort((b,_)=>b.title.localeCompare(_.title,"ru",{sensitivity:"base"}));return[...i,...d].slice(0,J)}const n=e.split(/\s+/).filter(Boolean),o=[];for(const i of t){let d=0,b=!0;for(const _ of n){if(!i.searchBlob.includes(_)){b=!1;break}i.titleLower.startsWith(_)?d+=12:i.titleLower.includes(_)&&(d+=8),i.host.startsWith(_)?d+=7:i.host.includes(_)&&(d+=4),i.ip===_?d+=14:i.ip.includes(_)&&(d+=6),i.site&&i.site.includes(_)&&(d+=5),i.tagsLower.some(H=>H.includes(_))&&(d+=3)}b&&o.push({entry:i,score:d})}return o.sort((i,d)=>d.score!==i.score?d.score-i.score:i.entry.title.localeCompare(d.entry.title,"ru",{sensitivity:"base"})),o.slice(0,U).map(i=>i.entry)}),jn=C(()=>dt.value[de.value]||null),xe=C(()=>Ae.value.find(e=>e.id===Q.value)||Ae.value[0]||null),rn=C(()=>{var e;return((e=xe.value)==null?void 0:e.id)===g}),ze=C(()=>{if(!xe.value)return[];const e=[];for(const t of xe.value.blocks||[])(t==null?void 0:t.type)==="groups"&&e.push(...t.group_ids||[]);return un(e)}),qn=C(()=>{const e=ar(ze.value),t=se.value.trim().toLowerCase();return t?e.map(n=>{if(String(n.title||"").toLowerCase().includes(t)||String(n.description||"").toLowerCase().includes(t))return{...n,subgroups:n.subgroups||[]};const i=(n.subgroups||[]).map(d=>{if(String(d.title||"").toLowerCase().includes(t))return{...d,items:d.items||[]};const _=(d.items||[]).filter(H=>{const ie=String(H.title||"").toLowerCase().includes(t),Ne=String(H.url||"").toLowerCase().includes(t),Me=(H.tags||[]).some(Ce=>String(Ce).toLowerCase().includes(t)),Qe=mt(H,n).toLowerCase().includes(t);return ie||Ne||Me||Qe});return _.length?{...d,items:_}:null}).filter(Boolean);return i.length?{...n,subgroups:i}:null}).filter(Boolean):e}),ko=C(()=>{const e=[];for(const t of qn.value){e.push({key:`group:${t.key}`,type:"group",groupKey:t.key,group:t});for(const n of t.subgroups||[])e.push({key:`subgroup:${t.key}:${n.id}`,type:"subgroup",groupKey:t.key,subgroupId:n.id,subgroup:n})}return e}),ft=C(()=>{const e=[];for(const t of ze.value)for(const n of t.subgroups||[])for(const o of n.items||[])e.push(o.id);return e}),Eo=C(()=>{var n;const e=ft.value;let t=0;for(const o of e)(n=Je(o))!=null&&n.ok&&(t+=1);return{online:t,total:e.length}}),Bt=C(()=>{if(!xe.value)return[];const e=[];for(const t of xe.value.blocks||[])rr(t)&&e.push(...t.widgets||[]);return Array.from(new Set(e))}),Ot=C(()=>or(Bt.value)),Co=C(()=>{const e=Ot.value.length;if(!e)return"нет данных";const t=Ot.value.filter(n=>pt(n)).length;return`${e} · больших ${t}`}),To=C(()=>{var e;return(((e=xe.value)==null?void 0:e.blocks)||[]).filter(t=>(t==null?void 0:t.type)==="groups")}),Wn=C(()=>{const e=Rt.value.get(ee.value);return!e||!pt(e)?null:Bt.value.includes(e.id)?e:null});function Jn(e){if(!e)return;const t=document.documentElement;e.accent&&(t.style.setProperty("--accent",e.accent),t.style.setProperty("--accent-soft",e.accent)),e.background&&t.style.setProperty("--bg",e.background),e.border&&t.style.setProperty("--border",e.border),e.card&&(t.style.setProperty("--surface",e.card),t.style.setProperty("--surface-strong",e.card)),t.style.setProperty("--glow-enabled",e.glow===!1?"0":"1")}function Yn(e){if(!e)return;const t=document.documentElement;e.gap!=null&&t.style.setProperty("--grid-gap",`${Number(e.gap)}px`),e.card_radius!=null&&t.style.setProperty("--card-radius",`${Number(e.card_radius)}px`),e.columns!=null&&t.style.setProperty("--layout-columns",String(Number(e.columns)))}function $o(){D.value=!D.value,V.value="",D.value||je()}function Po(){if(re.value==="detailed"){re.value="tile";return}if(re.value==="tile"){re.value="icon";return}re.value="detailed"}function Lo(){M.value!=="detailed"&&M.value!=="hidden"&&(M.value="detailed");const e=x.indexOf(M.value),n=((e>=0?e:0)+1)%x.length;M.value=x[n],tn.value||(se.value="",Gt()),Dt.value&&(ve.value="flat")}function Ao(e){return e?e.type==="group"?pr(e.groupKey):e.type==="subgroup"?gr(e.groupKey,e.subgroupId):!1:!1}function xo(e){var t,n;return e?e.type==="group"?`Группа: ${((t=e.group)==null?void 0:t.title)||""}`:e.type==="subgroup"?`Подгруппа: ${((n=e.subgroup)==null?void 0:n.title)||""}`:"":""}function Do(e){if(e){if(e.type==="group"){ae[e.groupKey]=!0,I.groupKey=e.groupKey,I.subgroupId="",I.itemId="";return}e.type==="subgroup"&&dr(e.groupKey,e.subgroupId)}}function Mo(e,t,n){if(!Hn.value)return;const o=(n==null?void 0:n.__originGroupKey)||e,i=(n==null?void 0:n.__originSubgroupId)||t;cn(o,i,n.id),yn(n)}function Qn(e){return JSON.parse(JSON.stringify(e))}function on(e){return ha(e)}async function Zn(){var e;if(E.value){Z.value="saving",V.value="";try{const t=await aa(E.value);E.value=t.config,(!Q.value||!Ae.value.some(n=>n.id===Q.value))&&(Q.value=((e=Ae.value[0])==null?void 0:e.id)||""),Z.value="saved",Ge&&clearTimeout(Ge),Ge=window.setTimeout(()=>{Z.value==="saved"&&(Z.value="idle")},1400)}catch(t){throw Z.value="error",V.value=(t==null?void 0:t.message)||"Ошибка сохранения YAML",t}}}async function pe(e){if(!E.value)return!1;const t=Qn(E.value);try{return e(E.value)===!1?!1:(Fr(E.value),gt(),await Zn(),!0)}catch(n){return E.value=t,Z.value="error",V.value=(n==null?void 0:n.message)||"Не удалось применить изменения",!1}}function sn(e,t){return{id:e,type:"link",title:t,url:h,icon:null,site:null,tags:[],open:"new_tab"}}async function Ro(){if(!D.value||!E.value)return;const e=window.prompt("Название новой группы","Новая группа");if(e==null)return;const t=e.trim();t&&await pe(n=>{const o=new Set((n.groups||[]).map(ie=>ie.id)),i=Qt(n),d=Kt(n),b=Ue(t,o),_=Ue(`${b}-core`,i),H=Ue(`${b}-service`,d);n.groups.push({id:b,title:t,icon:"folder",description:"",layout:"auto",subgroups:[{id:_,title:"Core",items:[sn(H,"Новый сервис")]}]}),Kr(n,Q.value,b),ae[`group:${b}`]=!0,I.groupKey=`group:${b}`,I.subgroupId=_,I.itemId=H})}async function Bo(e){if(!D.value||!E.value)return;const t=window.prompt("Название подгруппы","Новая подгруппа");if(t==null)return;const n=t.trim();n&&await pe(o=>{const i=Se(o,e);if(!i)throw new Error(`Группа '${e}' не найдена`);const d=Qt(o),b=Kt(o),_=Ue(`${e}-${n}`,d),H=Ue(`${_}-service`,b);i.subgroups.push({id:_,title:n,items:[sn(H,"Новый сервис")]}),ae[`group:${e}`]=!0,I.groupKey=`group:${e}`,I.subgroupId=_,I.itemId=H})}async function Oo(e,t){!D.value||!E.value||er(e,t)}function an(e){return String(e||"").split(",").map(t=>t.trim()).filter(Boolean)}function ln(e,t,n,o){const i=Number(e);if(!Number.isFinite(i))return t;const d=Math.trunc(i);return Math.min(o,Math.max(n,d))}function Xn(e=!1){T.submitting&&!e||(T.open=!1,T.mode="create",T.groupId="",T.subgroupId="",T.originalItemId="",T.error="",T.submitting=!1,T.form=oe())}function er(e,t){if(!be(E.value,e,t)){Z.value="error",V.value=`Подгруппа '${t}' не найдена`;return}T.open=!0,T.mode="create",T.groupId=e,T.subgroupId=t,T.originalItemId="",T.error="",T.submitting=!1,T.form=oe()}function tr(e,t,n){var d,b,_;const o=be(E.value,e,t),i=((o==null?void 0:o.items)||[]).find(H=>H.id===n);if(!o||!i){Z.value="error",V.value=`Элемент '${n}' не найден`;return}T.open=!0,T.mode="edit",T.groupId=e,T.subgroupId=t,T.originalItemId=n,T.error="",T.submitting=!1,T.form={id:i.id,title:i.title,type:i.type,url:String(i.url||h),icon:i.icon||"",siteInput:String(i.site||""),tagsInput:(i.tags||[]).join(", "),open:i.open||"new_tab",healthcheckEnabled:!!(i.type==="link"&&i.healthcheck),healthcheckUrl:i.type==="link"&&i.healthcheck?String(i.healthcheck.url):String(i.url||h),healthcheckIntervalSec:i.type==="link"&&i.healthcheck?Number(i.healthcheck.interval_sec||30):30,healthcheckTimeoutMs:i.type==="link"&&i.healthcheck?Number(i.healthcheck.timeout_ms||1500):1500,iframeSandboxMode:i.type==="iframe"?((d=i.iframe)==null?void 0:d.sandbox)==null?"default":i.iframe.sandbox?"enabled":"disabled":"default",iframeAllowInput:i.type==="iframe"?(((b=i.iframe)==null?void 0:b.allow)||[]).join(", "):"",iframeReferrerPolicy:i.type==="iframe"&&((_=i.iframe)==null?void 0:_.referrer_policy)||"",authProfile:i.type==="iframe"&&i.auth_profile||""}}function nr(e){const t=T.form,n=String(t.title||"").trim();if(!n)throw new Error("Название сервиса обязательно");const o=String(t.type||"").trim().toLowerCase();if(!["link","iframe"].includes(o))throw new Error("Тип сервиса должен быть 'link' или 'iframe'");const i=String(t.open||"new_tab");if(!["new_tab","same_tab"].includes(i))throw new Error("Параметр open должен быть 'new_tab' или 'same_tab'");const d=on(t.url||h),b=Kt(e);T.mode==="edit"&&b.delete(T.originalItemId);const _=String(t.id||"").trim(),H=`${T.subgroupId}-${n}`,ie=Et(_||H,"service"),Ne=_?ie:Ue(ie,b);if(_&&b.has(Ne))throw new Error(`ID '${Ne}' уже существует`);const Me={id:Ne,type:o,title:n,url:d,icon:String(t.icon||"").trim()||null,site:String(t.siteInput||"").trim()||null,tags:an(t.tagsInput),open:i};if(o==="link"){const Ft={...Me};if(t.healthcheckEnabled){const cs=on(t.healthcheckUrl||d);Ft.healthcheck={type:"http",url:cs,interval_sec:ln(t.healthcheckIntervalSec,30,1,3600),timeout_ms:ln(t.healthcheckTimeoutMs,1500,100,12e4)}}return Ft}const Qe=String(t.iframeSandboxMode||"default");let Ce=null;Qe==="enabled"&&(Ce=!0),Qe==="disabled"&&(Ce=!1);const It=String(t.authProfile||"").trim();if(It&&!Nn.value.some(Ft=>Ft.id===It))throw new Error(`Auth profile '${It}' не найден`);const $r={...Me,iframe:{sandbox:Ce,allow:an(t.iframeAllowInput),referrer_policy:String(t.iframeReferrerPolicy||"").trim()||null}};return It&&($r.auth_profile=It),$r}async function Go(){if(!T.open||T.submitting||!E.value)return;T.submitting=!0,T.error="";const e=await pe(t=>{const n=be(t,T.groupId,T.subgroupId);if(!n)throw new Error(`Подгруппа '${T.subgroupId}' не найдена`);const o=nr(t);if(T.mode==="create")return n.items.push(o),I.groupKey=`group:${T.groupId}`,I.subgroupId=T.subgroupId,I.itemId=o.id,!0;const i=(n.items||[]).findIndex(d=>d.id===T.originalItemId);if(i<0)throw new Error(`Элемент '${T.originalItemId}' не найден`);return n.items.splice(i,1,o),I.groupKey=`group:${T.groupId}`,I.subgroupId=T.subgroupId,(I.itemId===T.originalItemId||!I.itemId)&&(I.itemId=o.id),!0});T.submitting=!1,e?Xn(!0):T.error=V.value||"Не удалось сохранить сервис"}async function No(e){if(!D.value||!E.value)return;const t=Se(E.value,e);if(!t)return;const n=window.prompt("Название группы",t.title);if(n==null)return;const o=window.prompt("Описание группы",t.description||"");if(o==null)return;const i=window.prompt("Режим группы (auto | full | inline)",t.layout||"auto");i!=null&&await pe(d=>{const b=Se(d,e);if(!b)throw new Error(`Группа '${e}' не найдена`);const _=String(i||"").trim().toLowerCase()||"auto";if(!["auto","full","inline"].includes(_))throw new Error("Режим группы должен быть 'auto', 'full' или 'inline'");b.title=n.trim()||b.title,b.description=o.trim(),b.layout=_})}async function Uo(e,t){if(!D.value||!E.value)return;const n=be(E.value,e,t);if(!n)return;const o=window.prompt("Название подгруппы",n.title);o!=null&&await pe(i=>{const d=be(i,e,t);if(!d)throw new Error(`Подгруппа '${t}' не найдена`);d.title=o.trim()||d.title})}async function Vo(e,t,n){!D.value||!E.value||tr(e,t,n)}async function Ho(e){if(!D.value||!E.value)return;const t=Se(E.value,e);if(t){if(E.value.groups.length<=1){Z.value="error",V.value="Нельзя удалить последнюю группу.";return}window.confirm(`Удалить группу "${t.title}"?`)&&await pe(n=>{const o=(n.groups||[]).findIndex(i=>i.id===e);if(o<0)return!1;n.groups.splice(o,1),I.groupKey="",I.subgroupId="",I.itemId=""})}}async function Fo(e,t){if(!D.value||!E.value)return;const n=Se(E.value,e),o=((n==null?void 0:n.subgroups)||[]).find(i=>i.id===t);if(!(!n||!o)){if(n.subgroups.length<=1){Z.value="error",V.value="В группе должна остаться хотя бы одна подгруппа.";return}window.confirm(`Удалить подгруппу "${o.title}"?`)&&await pe(i=>{const d=Se(i,e);if(!d)return!1;const b=(d.subgroups||[]).findIndex(_=>_.id===t);if(b<0)return!1;d.subgroups.splice(b,1),I.subgroupId="",I.itemId=""})}}async function Ko(e,t,n){if(!D.value||!E.value)return;const o=be(E.value,e,t),i=((o==null?void 0:o.items)||[]).find(d=>d.id===n);if(!(!o||!i)){if(o.items.length<=1){Z.value="error",V.value="В подгруппе должен остаться хотя бы один элемент.";return}window.confirm(`Удалить сервис "${i.title}"?`)&&await pe(d=>{const b=be(d,e,t);if(!b)return!1;const _=(b.items||[]).findIndex(H=>H.id===n);if(_<0)return!1;b.items.splice(_,1),I.itemId===n&&(I.itemId="")})}}function je(){P.type="",P.groupId="",P.subgroupId="",P.itemId=""}function zo(e,t){if(!D.value||!zt(t))return;const n=t.id;P.type="group",P.groupId=n,P.subgroupId="",P.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`group:${n}`))}function jo(e,t,n){D.value&&(P.type="subgroup",P.groupId=t,P.subgroupId=n,P.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`subgroup:${n}`)))}function qo(e,t,n,o){D.value&&(P.type="item",P.groupId=t,P.subgroupId=n,P.itemId=o,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`item:${o}`)))}function Wo(e,t){if(!D.value||!zt(t))return;const n=t.id;P.type==="group"&&P.groupId!==n&&e.preventDefault()}async function Jo(e,t){if(!D.value||!zt(t))return;const n=t.id;if(P.type!=="group"||!P.groupId||P.groupId===n)return;e.preventDefault();const o=P.groupId;je(),await pe(i=>zr(i,o,n))}function Yo(e,t,n){if(D.value){if(P.type==="subgroup"){if(P.subgroupId===n)return;e.preventDefault();return}P.type==="item"&&e.preventDefault()}}async function Qo(e,t,n){if(D.value){if(P.type==="subgroup"){e.preventDefault();const o=P.groupId,i=P.subgroupId;je(),await pe(d=>jr(d,o,i,t,n));return}if(P.type==="item"){e.preventDefault();const o=P.groupId,i=P.subgroupId,d=P.itemId;je(),await pe(b=>Wr(b,o,i,d,t,n))}}}function Zo(e,t,n,o){D.value&&P.type==="item"&&P.itemId!==o&&e.preventDefault()}async function Xo(e,t,n,o){if(!D.value||P.type!=="item"||!P.itemId||P.itemId===o)return;e.preventDefault();const i=P.groupId,d=P.subgroupId,b=P.itemId;je(),await pe(_=>qr(_,i,d,b,t,n,o))}function rr(e){return(e==null?void 0:e.type)==="widget_row"||(e==null?void 0:e.type)==="widget_grid"}function or(e=[]){return e.map(t=>Rt.value.get(t)).filter(Boolean)}function pt(e){return m.has(String((e==null?void 0:e.type)||""))}function ei(e){return yr(e).slice(0,2)}function ir(e){const t=Ot.value.find(n=>n.id===e);!t||!pt(t)||(ee.value=t.id)}function ti(e){pt(e)&&ir(e.id)}function un(e=[]){const t=[];for(const n of e){const o=nn.value.get(n);if(o){t.push({key:`group:${o.id}`,id:o.id,title:o.title,icon:o.icon||null,description:o.description||"",layout:o.layout||"auto",subgroups:o.subgroups||[]});continue}const i=Kn.value.get(n);i&&t.push({key:`subgroup:${i.subgroup.id}`,id:i.group.id,title:i.group.title,icon:i.group.icon||null,description:i.group.description||"",layout:i.group.layout||"auto",subgroups:[i.subgroup]})}return t}function gt(){const e=new Set(ze.value.map(t=>t.key));for(const t of Object.keys(ae))e.has(t)||delete ae[t];for(const t of ze.value)ae[t.key]==null&&(ae[t.key]=!0);I.groupKey&&!e.has(I.groupKey)&&Gt()}function Gt(){I.groupKey="",I.subgroupId="",I.itemId=""}function ni(e){try{return new URL(String(e||"")).hostname||""}catch{return""}}function ri(e,t,n){const o=String((e==null?void 0:e.site)||"").trim();if(o)return o;const i=String((t==null?void 0:t.site)||"").trim();if(i)return i;const d=(n||[]).find(b=>String(b||"").toLowerCase().startsWith("site:"));return d?String(d).slice(5).trim():""}function sr(e){return((e==null?void 0:e.tags)||[]).map(t=>String(t||"").trim()).filter(Boolean)}function oi(e){const t=String(e||"");return t.startsWith("group:")&&nn.value.get(t.slice(6))||null}function mt(e,t=null){return ri(e,t,sr(e))}function ii(e,t=""){const n=oi((e==null?void 0:e.__originGroupKey)||t);return mt(e,n)}function ar(e=[]){return ce.value==="all"?e:e.map(t=>{const n=(t.subgroups||[]).map(o=>({...o,items:(o.items||[]).filter(i=>mt(i,t).toLowerCase()===ce.value)})).filter(o=>o.items.length>0);return n.length?{...t,subgroups:n}:null}).filter(Boolean)}function si(e){const t=String(e||"all").trim().toLowerCase(),n=new Set(Mt.value.map(o=>o.value));ce.value=n.has(t)?t:"all"}function lr(){it.value="",de.value=0,Pt.value=!0}function Nt(){Pt.value=!1,it.value="",de.value=0}function ai(){if(Pt.value){Nt();return}lr()}function ur(){Oe.open=!0}function li(){Oe.open=!1}function ui(){Oe.open=!Oe.open}function ci(e){it.value=String(e||""),de.value=0}function di(e){const t=dt.value.length-1;if(t<0){de.value=0;return}de.value=Math.min(Math.max(e,0),t)}function fi(e){const t=dt.value.length;if(!t){de.value=0;return}const o=(de.value+e+t)%t;de.value=o}function pi(e){e&&(e.pageId&&(Q.value=e.pageId),cn(e.groupKey,e.subgroupId,e.item.id))}function cr(e){if(e){if(e.type==="action"&&e.action==="open_settings_panel"){Nt(),ur();return}pi(e),yn(e.item),Nt()}}function gi(){cr(jn.value)}async function mi(e){var t;(e==null?void 0:e.type)!=="item"||!((t=e==null?void 0:e.item)!=null&&t.url)||await Sr(e.item.url)}function vi(e){ae[e]=!fr(e),I.groupKey=e,I.subgroupId="",I.itemId=""}function dr(e,t){ae[e]=!0,I.groupKey=e,I.subgroupId=t,I.itemId=""}function cn(e,t,n){ae[e]=!0,I.groupKey=e,I.subgroupId=t,I.itemId=n}function fr(e){return!!ae[e]}function pr(e){return I.groupKey===e&&!I.subgroupId&&!I.itemId}function gr(e,t){return I.groupKey===e&&I.subgroupId===t&&!I.itemId}function bi(e){return I.itemId===e}function yi(e=[]){const t=un(e),n=ar(t),o=Dt.value?n:wi(n),i=ki(o),d=i.length;return i.map(b=>({...b,__visibleCount:d}))}function hi(){return!!(I.groupKey||I.subgroupId||I.itemId)}function Ii(e){return String(e||"").trim()||"Без тега"}function mr(e){const t=new Set(sr(e).map(n=>Ii(n)).filter(Boolean));return t.size||t.add("Без тега"),Array.from(t)}function dn(e,t,n){return{...e,__originGroupKey:t,__originSubgroupId:n}}function wi(e=[]){return hi()?e.map(t=>{if(I.groupKey&&t.key!==I.groupKey)return null;let n=t.subgroups||[];return I.subgroupId&&(n=n.filter(o=>o.id===I.subgroupId)),I.itemId&&(n=n.map(o=>({...o,items:(o.items||[]).filter(i=>i.id===I.itemId)})).filter(o=>o.items.length>0)),n.length?{...t,subgroups:n}:null}).filter(Boolean):e}function _i(e=[]){return e.map(t=>{const n=new Map;for(const d of t.subgroups||[])for(const b of d.items||[])for(const _ of mr(b))n.has(_)||n.set(_,[]),n.get(_).push(dn(b,t.key,d.id));const i=Array.from(n.entries()).sort(([d],[b])=>d.localeCompare(b,"ru",{sensitivity:"base"})).map(([d,b])=>({id:`tag-${Et(`${t.id}-${d}`,"tag")}`,title:`#${d}`,icon:"tag",items:b}));return i.length?{...t,subgroups:i}:null}).filter(Boolean)}function Si(e=[]){const t=new Map;for(const o of e)for(const i of o.subgroups||[])for(const d of i.items||[])for(const b of mr(d))t.has(b)||t.set(b,[]),t.get(b).push(dn(d,o.key,i.id));return Array.from(t.entries()).sort(([o],[i])=>o.localeCompare(i,"ru",{sensitivity:"base"})).map(([o,i])=>{const d=Et(o,"tag");return{key:`tags:${d}`,id:`tags-${d}`,title:`#${o}`,icon:"tag",description:"Сервисы, сгруппированные только по тегам.",layout:"inline",subgroups:[{id:`tags-${d}-items`,title:"Сервисы",items:i}]}})}function vr(e=[]){const t=[];for(const n of e)for(const o of n.subgroups||[])for(const i of o.items||[])t.push(dn(i,n.key,o.id));return t.length?[{key:"flat:all",id:"flat-all",title:"Все сервисы",icon:"layout-grid",description:"Плоское отображение без группировки.",layout:"full",subgroups:[{id:"flat-all-items",title:"Плитка",items:t}]}]:[]}function ki(e=[]){return Dt.value?vr(e):ve.value==="tags_in_groups"?_i(e):ve.value==="tags"?Si(e):ve.value==="flat"?vr(e):e}function Ei(e){const t=String((e==null?void 0:e.layout)||"auto").toLowerCase();return t==="inline"?!0:t==="full"?!1:Number((e==null?void 0:e.__visibleCount)||0)>1}function Ci(e){return(e.subgroups||[]).reduce((t,n)=>t+(n.items||[]).length,0)}function Ti(e){return((e==null?void 0:e.items)||[]).length}function $i(e){var n;let t=0;for(const o of e.subgroups||[])for(const i of o.items||[])(n=Je(i.id))!=null&&n.ok&&(t+=1);return t}function br(){for(const e of Object.keys(ct))delete ct[e]}function fn(e){return Ia(e)}function pn(e){const t=fn(e==null?void 0:e.url);return t?`${String((e==null?void 0:e.id)||"")}|${t}`:""}function Pi(e){const t=fn(e==null?void 0:e.url);if(!t)return"";const n=pn(e);return n&&ct[n]?"":`${t}/favicon.ico`}function Li(e){const t=pn(e);t&&(ct[t]=!0)}function Ai(e){return ga(e)}function xi(e){return ma(e)}function Di(e){return va(e)}function Mi(e){return ba(e)}function Ri(e){return ya(e)}function qe(e){return Pe[e]||null}function gn(e,t){return`${e}:${t}`}function Bi(e,t){return!!Lt[gn(e,t)]}function De(e,t){if(!t||typeof t!="string")return null;if(t==="$")return e;if(!t.startsWith("$."))return null;let n=e;const o=t.slice(2).split(".");for(const i of o){if(n==null)return null;const d=i.match(/^(.*)\[\*\]$/);if(d){const b=d[1],_=b?n==null?void 0:n[b]:n;return Array.isArray(_)?_:[]}n=n==null?void 0:n[i]}return n}function Oi(e){var o,i,d;const t=(o=qe(e.id))==null?void 0:o.payload;return De(t,(d=(i=e.data)==null?void 0:i.mapping)==null?void 0:d.value)??"—"}function Gi(e){var o,i,d;const t=(o=qe(e.id))==null?void 0:o.payload;return De(t,(d=(i=e.data)==null?void 0:i.mapping)==null?void 0:d.subtitle)??""}function Ni(e){var o,i,d;const t=(o=qe(e.id))==null?void 0:o.payload;return De(t,(d=(i=e.data)==null?void 0:i.mapping)==null?void 0:d.trend)??""}function yr(e){var i,d;const t=(i=qe(e.id))==null?void 0:i.payload,n=((d=e.data)==null?void 0:d.mapping)||{},o=De(t,n.items);return Array.isArray(o)?o.map(b=>{const _=De(b,n.item_title)??"-",H=De(b,n.item_value)??"-";return{title:_,value:H}}):[]}function Ui(e){var i,d,b;const t=(i=qe(e.id))==null?void 0:i.payload,n=(b=(d=e.data)==null?void 0:d.mapping)==null?void 0:b.rows,o=De(t,n);return Array.isArray(o)?o:Array.isArray(t)?t:Array.isArray(t==null?void 0:t.items)?t.items:[]}function Ut(e){return e?e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/")?e:`/${e}`:""}function vt(){for(const e of At.values())clearInterval(e);At.clear()}function We(){at&&(clearTimeout(at),at=0)}function Je(e){return ut[e]||null}function Vi(e){return!!(e!=null&&e.ok&&e.latency_ms!=null&&e.latency_ms>=u)}function mn(e){if(!e)return"unknown";const t=String(e.level||"").toLowerCase();return["online","degraded","down","unknown","indirect_failure"].includes(t)?t:Vi(e)?"degraded":e.ok?"online":"down"}function Hi(e){const t=Je(e),n=mn(t);return n==="online"?"ok":n==="degraded"?"degraded":n==="down"||n==="indirect_failure"?"down":"unknown"}function Fi(e){const t=Je(e);if(!t)return"Проверка...";const n=mn(t);return n==="online"?t.latency_ms!=null?`Online • ${t.latency_ms} ms`:"Online":n==="degraded"?t.latency_ms!=null?`Degraded • ${t.latency_ms} ms`:t.status_code!=null?`Degraded • HTTP ${t.status_code}`:t.error?`Degraded • ${t.error}`:t.reason?`Degraded • ${String(t.reason).replaceAll("_"," ")}`:"Degraded":n==="indirect_failure"?"Indirect failure":n==="down"?t.error?`Offline • ${t.error}`:t.status_code!=null?`Offline • HTTP ${t.status_code}`:"Offline":"Unknown"}async function Ye(e=null){if(!Array.isArray(e)&&!Y.value)return;const t=Array.isArray(e)&&e.length?e:ft.value,n=Array.from(new Set(t.map(o=>String(o||"").trim()).filter(Boolean)));if(n.length)try{const o=await sa(n);for(const i of o.items||[])ut[i.item_id]=i}catch{for(const o of n)ut[o]||(ut[o]={item_id:o,ok:!1,checked_url:"",status_code:null,latency_ms:null,error:"healthcheck unavailable"})}}async function vn(){We(),await Ye(),hr()}function Ki(){let e=!1,t=!1;for(const n of ft.value){const o=mn(Je(n));if(o==="down"||o==="indirect_failure"){e=!0;break}o==="degraded"&&(t=!0)}return e?c:t?l:a}function hr(){if(We(),!Y.value)return;const e=Ki();at=window.setTimeout(async()=>{await Ye(),hr()},e)}async function Vt(e){var i;const t=Rt.value.get(e);if(!t)return;const n=Ut((i=t.data)==null?void 0:i.endpoint);if(!n)return;Pe[e]||(Pe[e]={loading:!1,error:"",payload:null,lastUpdated:0});const o=Pe[e];o.loading=!0,o.error="";try{o.payload=await Be(n),o.lastUpdated=Date.now()}catch(d){o.error=(d==null?void 0:d.message)||"Ошибка загрузки виджета"}finally{o.loading=!1}}async function bn(){var t,n;vt();const e=[];for(const o of en.value){if(e.push(Vt(o.id)),!Ut((t=o.data)==null?void 0:t.endpoint))continue;const i=Math.max(1,Number(((n=o.data)==null?void 0:n.refresh_sec)||0))*1e3,d=window.setInterval(()=>{Vt(o.id)},i);At.set(o.id,d)}await Promise.all(e)}async function zi(e,t){const n=gn(e,t.id),o=Ut(t.endpoint);if(o){Lt[n]=!0;try{await Be(o,{method:String(t.method||"GET").toUpperCase()}),await Vt(e)}catch(i){Pe[e]||(Pe[e]={loading:!1,error:"",payload:null,lastUpdated:0}),Pe[e].error=(i==null?void 0:i.message)||"Не удалось выполнить действие"}finally{Lt[n]=!1}}}async function Ir(){var e,t,n;j.value=!0,me.value="",Z.value="idle",V.value="",br();try{const o=await oa();E.value=o,(!Q.value||!Ae.value.some(i=>i.id===Q.value))&&(Q.value=((e=Ae.value[0])==null?void 0:e.id)||""),gt(),Jn((t=o==null?void 0:o.ui)==null?void 0:t.theme),Yn((n=o==null?void 0:o.ui)==null?void 0:n.grid),await bn(),await vn(),Y.value||kr()}catch(o){me.value=(o==null?void 0:o.message)||"Не удалось загрузить dashboard-конфигурацию",E.value=null,vt(),We()}finally{j.value=!1}}async function wr(e){var o,i,d,b,_,H;const t=!!(((d=(i=(o=E.value)==null?void 0:o.security)==null?void 0:i.iframe)==null?void 0:d.default_sandbox)??!0),n=(b=e==null?void 0:e.iframe)==null?void 0:b.sandbox;te.open=!0,te.title=e.title,te.src="",te.error="",te.loading=!0,te.sandbox=n==null?t:!!n,te.allow=Array.isArray((_=e==null?void 0:e.iframe)==null?void 0:_.allow)?e.iframe.allow.join("; "):"",te.referrerPolicy=((H=e==null?void 0:e.iframe)==null?void 0:H.referrer_policy)||"";try{const ie=await ia(e.id);te.src=ie.src}catch(ie){te.error=(ie==null?void 0:ie.message)||"Не удалось подготовить iframe"}finally{te.loading=!1}}function ji(){te.open=!1,te.title="",te.src="",te.error="",te.loading=!1,te.sandbox=!1,te.allow="",te.referrerPolicy=""}function _r(e){if(e.open==="same_tab"){window.location.assign(e.url);return}window.open(e.url,"_blank","noopener,noreferrer")}function qi(e){e!=null&&e.url&&window.open(e.url,"_blank","noopener,noreferrer")}function yn(e){if(e.type==="iframe"){wr(e);return}_r(e)}function hn(e){return zn.value.get(String(e||""))||""}async function In(e){var n;const t=String(e||"");if(t&&(n=navigator.clipboard)!=null&&n.writeText)try{await navigator.clipboard.writeText(t)}catch{}}async function Sr(e){await In(e)}async function Wi(e){const t=hn(e);t&&await In(t)}async function Ji(e){const t=hn(e);t&&await In(`ssh ${t}`)}async function Yi(e){e&&await Ye([e])}function Qi(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?"—":t.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function Zi(e){const t=Number(e||0);return!Number.isFinite(t)||t<=0?"—":t<1e3?`${Math.round(t)} ms`:`${(t/1e3).toFixed(2)} s`}function Xi(e){e&&(st.host=e,st.open=!0)}function wn(){st.open=!1,st.host=null}function es(e){const t=(e==null?void 0:e.open_ports)||[];return t.length?t.map(n=>n!=null&&n.service?`${n.port} (${n.service})`:`${n.port}`).join(", "):"—"}function ts(e){return e?e.error?e.error:e.status_code==null?"—":`HTTP ${e.status_code}`:"—"}async function bt({silent:e=!1}={}){if(!xt){xt=!0,e||(Zt.value=!0);try{Ke.value=await la(),ot.value=""}catch(t){ot.value=(t==null?void 0:t.message)||"Не удалось загрузить состояние сканера LAN"}finally{xt=!1,e||(Zt.value=!1)}}}function yt(){lt&&(window.clearInterval(lt),lt=0)}function _n(){yt(),lt=window.setInterval(()=>{bt({silent:!0})},p)}function kr(){We(),yt(),vt()}async function ns(){!E.value||j.value||(await bn(),await vn(),rn.value&&(await bt({silent:!0}),_n()))}async function rs(){if(!Xt){Xt=!0;try{Y.value?await ns():kr()}finally{Xt=!1}}}function Er(){Y.value=document.visibilityState!=="hidden",rs()}async function os(){var e;if(!$t.value){$t.value=!0;try{const t=await ua();Ke.value=(t==null?void 0:t.state)||Ke.value,ot.value=t!=null&&t.accepted||(e=t==null?void 0:t.state)!=null&&e.queued?"":(t==null?void 0:t.message)||""}catch(t){ot.value=(t==null?void 0:t.message)||"Не удалось запустить сканирование LAN"}finally{$t.value=!1,bt({silent:!0})}}}function is(){var e,t;return((t=(e=document.documentElement)==null?void 0:e.dataset)==null?void 0:t.fxMode)||"full"}function ss(e){const t=document.documentElement;let n="high",o="1";e>=120?(n="low",o="0.42"):e>=70&&(n="medium",o="0.68"),t.dataset.motionBudget=n,t.style.setProperty("--motion-budget",o)}function as(e){const t=is();if(t==="off")return null;const n=JSON.parse(JSON.stringify(e));return n.fps_limit=t==="lite"?34:58,t!=="lite"||(n.particles.number.value=Math.max(24,Math.round(n.particles.number.value*.56)),n.particles.opacity.value=Number((n.particles.opacity.value*.72).toFixed(2)),n.particles.move.speed=Number((n.particles.move.speed*.74).toFixed(2)),n.particles.line_linked.opacity=Number((n.particles.line_linked.opacity*.56).toFixed(2)),n.particles.line_linked.distance=Math.max(80,Math.round(n.particles.line_linked.distance*.84)),n.retina_detect=!1),n}function Sn(e){const t=document.getElementById(e);t&&(t.innerHTML="",delete t.dataset.particlesReady)}function ls(){Sn(S),Sn(k),Sn(w)}async function us(){Le&&(window.cancelAnimationFrame(Le),Le=0),Le=window.requestAnimationFrame(async()=>{Le=0,ls(),await kn(),await ht()})}function Cr(){us()}async function Ht(e,t){const n=document.getElementById(e);if(!n)return;const o=as(t);if(!o){n.innerHTML="",delete n.dataset.particlesReady;return}n.dataset.particlesReady==="1"||!await pa()||!window.particlesJS||document.getElementById(e)&&n.dataset.particlesReady!=="1"&&(n.innerHTML="",window.particlesJS(e,o),n.dataset.particlesReady="1")}async function kn(){await Ht(S,$)}async function ht(){await Promise.all([Ht(k,F),Ht(w,F)])}let Tr=!1;return le(()=>{var e;return(e=xe.value)==null?void 0:e.id},async()=>{Tr?(ee.value="",se.value="",Gt()):Tr=!0,gt(),Ye(),await Re(),await ht()}),le(()=>{var e;return(e=Wn.value)==null?void 0:e.id},async()=>{await Re(),await ht()}),le(()=>Bt.value,e=>{ee.value&&!e.includes(ee.value)&&(ee.value="")},{deep:!0}),le(()=>ze.value,()=>{gt(),Ye()},{deep:!0}),le(()=>dt.value.length,e=>{if(!e){de.value=0;return}de.value>=e&&(de.value=e-1)}),le(()=>Mt.value.map(e=>e.value).join("|"),()=>{Mt.value.some(e=>e.value===ce.value)||(ce.value="all")}),le(()=>rn.value,e=>{if(e){Y.value&&(bt(),_n());return}wn(),yt()}),le(()=>ft.value.length,e=>{ss(e)},{immediate:!0}),le(()=>({activePageId:Q.value,treeFilter:se.value,activeIndicatorViewId:ee.value,statsExpanded:_e.value,editMode:D.value,serviceCardView:re.value,serviceGroupingMode:ve.value,siteFilter:ce.value,sidebarView:M.value,settingsPanelOpen:Oe.open,selectedNode:{groupKey:I.groupKey,subgroupId:I.subgroupId,itemId:I.itemId},expandedGroups:{...ae}}),e=>{Ee(e)},{deep:!0}),et(async()=>{window.addEventListener("visibilitychange",Er),window.addEventListener("oko:fx-mode-change",Cr),await kn(),await Ir(),await Re(),await ht()}),tt(()=>{vt(),We(),yt(),wn(),window.removeEventListener("visibilitychange",Er),window.removeEventListener("oko:fx-mode-change",Cr),Le&&(window.cancelAnimationFrame(Le),Le=0),Ge&&(clearTimeout(Ge),Ge=0),delete document.documentElement.dataset.motionBudget,document.documentElement.style.removeProperty("--motion-budget"),St=null}),St={BRAND_ICON_BY_KEY:Jt,DEFAULT_ITEM_URL:h,EMBLEM_SRC:r,HEALTH_REFRESH_MS:a,HERO_CONTROLS_PARTICLES_ID:w,HERO_PARTICLES_CONFIG:F,HERO_TITLE_PARTICLES_ID:k,ICON_BY_KEY:Yt,ICON_RULES:uo,LAN_PAGE_ID:g,LAN_SCAN_POLL_MS:p,LARGE_INDICATOR_TYPES:m,SIDEBAR_PARTICLES_CONFIG:$,SIDEBAR_PARTICLES_ID:S,actionBusy:Lt,actionKey:gn,activeCommandPaletteEntry:jn,activeIndicatorViewId:ee,activeIndicatorWidget:Wn,activePage:xe,activePageGroupBlocks:To,activePageId:Q,activePageWidgetIds:Bt,addGroup:Ro,addItem:Oo,addSubgroup:Bo,allItemIds:Kt,allSubgroupIds:Qt,appTagline:mo,appTitle:go,applyConfigMutation:pe,applyGrid:Yn,applyTheme:Jn,authProfileOptions:Nn,buildDefaultItem:sn,buildItemFromEditorForm:nr,clampNumber:ln,clearDragState:je,clearItemFaviconFailures:br,clearSelectedNode:Gt,cloneConfig:Qn,closeIframeModal:ji,closeItemEditor:Xn,closeLanHostModal:wn,closeCommandPalette:Nt,closeSettingsPanel:li,commandPaletteActiveIndex:de,commandPaletteOpen:Pt,commandPaletteQuery:it,commandPaletteResults:dt,config:E,configError:me,copyItemIp:Wi,copyItemSshShortcut:Ji,copyCommandPaletteEntryUrl:mi,copyUrl:Sr,createBrandIcon:L,defaultItemEditorForm:oe,dragState:P,editGroup:No,editItem:Vo,editMode:D,editSubgroup:Uo,ensureAbsoluteUrl:on,ensurePageGroupsReference:Kr,expandedGroups:ae,faviconOriginFromUrl:fn,filteredBlockGroups:yi,filteredTreeGroups:qn,findGroup:Se,findSubgroup:be,formatLanDuration:Zi,formatLanHttpStatus:ts,formatLanMoment:Qi,fromToken:fo,groupById:nn,groupOnlineItems:$i,groupTotalItems:Ci,healthClass:Hi,healthLabel:Fi,healthPollTimer:at,healthState:Je,healthStates:ut,iframeModal:te,indicatorPreviewEntries:ei,initHeroParticles:ht,initParticles:Ht,initSidebarParticles:kn,initWidgetPolling:bn,isActionBusy:Bi,isDirectGroupNode:zt,isGroupExpanded:fr,isGroupSelected:pr,isIconCardView:Un,isSidebarDetailed:tn,isSidebarHidden:Dt,isTileCardView:Vn,isCompactServiceCardView:Hn,isInlineGroupLayout:Ei,isItemSelected:bi,isLanPage:rn,isLargeIndicator:pt,isSidebarIconActive:Ao,isSidebarIconOnly:yo,isSubgroupSelected:gr,isWidgetBlock:rr,itemEditor:T,itemFaviconFailures:ct,itemFaviconKey:pn,itemFaviconSrc:Pi,itemIp:hn,itemSite:ii,lanCidrsLabel:Io,lanHostModal:st,lanHosts:Fn,lanPortsLabel:es,lanScanActionBusy:$t,lanScanError:ot,lanScanLoading:Zt,lanScanPollTimer:lt,lanScanRefreshInFlight:xt,lanScanState:Ke,loadConfig:Ir,loadingConfig:j,makeUniqueId:Ue,markItemFaviconFailed:Li,moveGroup:zr,moveCommandPaletteSelection:fi,moveItemBefore:qr,moveItemToSubgroupEnd:Wr,moveSubgroup:jr,normalizeEndpoint:Ut,normalizeIconToken:co,normalizeId:Et,normalizeLayoutBlocks:Fr,normalizeStringList:an,onGroupDragOver:Wo,onGroupDragStart:zo,onGroupDrop:Jo,onItemCardClick:Mo,onItemDragOver:Zo,onItemDragStart:qo,onItemDrop:Xo,onSubgroupDragOver:Yo,onSubgroupDragStart:jo,onSubgroupDrop:Qo,activateCommandPaletteEntry:cr,activateCommandPaletteSelection:gi,openCommandPalette:lr,openSettingsPanel:ur,openCreateItemEditor:er,openEditItemEditor:tr,openIframeItem:wr,openIndicatorView:ir,openItem:yn,openItemInNewTab:qi,openLanHostModal:Xi,openLinkItem:_r,pageHealthSummary:Eo,pages:Ae,persistConfig:Zn,pickSemanticIcon:rt,refreshHealth:Ye,recheckItem:Yi,refreshLanScanState:bt,refreshWidget:Vt,removeGroup:Ho,removeItem:Ko,removeSubgroup:Fo,resetWidgetPolling:vt,resolveBlockGroups:un,resolveExpression:De,resolveGroupIcon:xi,resolveItemIcon:Mi,resolvePageIcon:Ai,resolveSubgroupIcon:Di,resolveWidgetIcon:Ri,resolveWidgets:or,runLanScanNow:os,runWidgetAction:zi,saveError:V,saveStatus:Z,saveStatusLabel:wo,saveStatusTimer:Ge,setCommandPaletteActiveIndex:di,setCommandPaletteQuery:ci,setSiteFilter:si,settingsPanel:Oe,sidebarViewToggleTitle:ho,selectItemNode:cn,selectSidebarIconNode:Do,selectSidebarIndicator:ti,selectSubgroupNode:dr,selectedNode:I,serviceCardView:re,siteFilter:ce,siteFilterOptions:Mt,serviceGroupingMode:ve,serviceGroupingOptions:bo,servicePresentationOptions:vo,sidebarIconNodeTitle:xo,sidebarIconNodes:ko,sidebarIndicatorSummary:Co,sidebarIndicators:Ot,sidebarView:M,startHealthPolling:vn,startLanScanPolling:_n,statCardSubtitle:Gi,statCardTrend:Ni,statCardValue:Oi,statListEntries:yr,statsExpanded:_e,stopHealthPolling:We,stopLanScanPolling:yt,subgroupById:Kn,subgroupTotalItems:Ti,submitItemEditor:Go,syncTreeGroupsState:gt,tableRows:Ui,toggleCommandPalette:ai,toggleEditMode:$o,toggleGroupNode:vi,toggleSettingsPanel:ui,toggleServiceCardView:Po,toggleSidebarView:Lo,treeFilter:se,treeGroups:ze,visibleTreeItemIds:ft,widgetById:Rt,widgetIntervals:At,widgetState:qe,widgetStates:Pe,widgets:en},St}const wa=["title"],_a={key:0,class:"item-compact-body"},Sa=["src"],ka={class:"item-tile-head"},Ea=["src"],Ca={class:"item-tile-title"},Ta={class:"item-head"},$a={class:"item-title-row"},Pa=["src"],La={class:"item-type"},Aa={class:"item-url"},xa={class:"item-health"},Da={key:0,class:"item-tags"},Ma={key:0,class:"tag-pill site-pill"},Ra={class:"item-actions"},Ba={key:1,class:"item-ssh-shortcut"},Oa={__name:"ServiceItemCard",props:{groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0},item:{type:Object,required:!0}},setup(r){const a=r,l=qt(a,"groupKey"),c=qt(a,"subgroupId"),u=qt(a,"item"),p=ue(),{isIconCardView:g,isTileCardView:m,isCompactServiceCardView:h,isItemSelected:S,onItemCardClick:k,itemFaviconSrc:w,markItemFaviconFailed:$,resolveItemIcon:F,healthClass:B,healthLabel:W,itemIp:x,itemSite:U,copyItemIp:J,copyItemSshShortcut:O,openItem:R,openItemInNewTab:Te,recheckItem:$e,copyUrl:Ee}=p,oe=C(()=>B(u.value.id)),E=C(()=>W(u.value.id)),j=C(()=>x(u.value.id)),me=C(()=>`ssh ${j.value}`),Q=C(()=>U(u.value,l.value)),se=N(!1),_e=N(!1);let ee=0,D=0;const Y=C(()=>({selected:!h.value&&S(u.value.id),compact:h.value,tile:m.value,[`status-${oe.value}`]:!0,"data-updated":_e.value}));function re(){ee&&clearTimeout(ee),se.value=!1,window.requestAnimationFrame(()=>{se.value=!0,ee=window.setTimeout(()=>{se.value=!1,ee=0},900)})}function ve(){D&&clearTimeout(D),_e.value=!1,window.requestAnimationFrame(()=>{_e.value=!0,D=window.setTimeout(()=>{_e.value=!1,D=0},1250)})}return le([oe,E],([ce,M],[Z,V])=>{Z===void 0&&V===void 0||((ce!==Z||M!==V)&&ve(),M!==V&&re())}),tt(()=>{ee&&(clearTimeout(ee),ee=0),D&&(clearTimeout(D),D=0)}),(ce,M)=>{var Z;return f(),y("article",{class:q(["item-card",Y.value]),title:s(h)?u.value.title:void 0,onClick:M[9]||(M[9]=V=>s(k)(l.value,c.value,u.value))},[s(g)?(f(),y("div",_a,[s(w)(u.value)?(f(),y("img",{key:0,src:s(w)(u.value),class:"service-favicon compact-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:M[0]||(M[0]=V=>s($)(u.value))},null,40,Sa)):(f(),z(ke(s(F)(u.value)),{key:1,class:"ui-icon item-icon compact-item-icon"})),v("span",{class:q(["health-dot compact-health-dot",oe.value])},null,2)])):s(m)?(f(),y(ne,{key:1},[v("div",ka,[s(w)(u.value)?(f(),y("img",{key:0,src:s(w)(u.value),class:"service-favicon tile-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:M[1]||(M[1]=V=>s($)(u.value))},null,40,Ea)):(f(),z(ke(s(F)(u.value)),{key:1,class:"ui-icon item-icon tile-item-icon"})),v("span",{class:q(["health-dot tile-health-dot",oe.value])},null,2)]),v("p",Ca,G(u.value.title),1)],64)):(f(),y(ne,{key:2},[v("div",Ta,[v("div",$a,[s(w)(u.value)?(f(),y("img",{key:0,src:s(w)(u.value),class:"service-favicon item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:M[2]||(M[2]=V=>s($)(u.value))},null,40,Pa)):(f(),z(ke(s(F)(u.value)),{key:1,class:"ui-icon item-icon"})),v("h4",null,G(u.value.title),1)]),v("span",La,G(u.value.type),1)]),v("p",Aa,G(u.value.url),1),v("div",xa,[v("span",{class:q(["health-dot",oe.value])},null,2),v("span",{class:q(["health-text",{"is-updating":se.value}])},G(E.value),3)]),Q.value||(Z=u.value.tags)!=null&&Z.length?(f(),y("div",Da,[Q.value?(f(),y("span",Ma,"site:"+G(Q.value),1)):K("",!0),(f(!0),y(ne,null,we(u.value.tags,V=>(f(),y("span",{key:V,class:"tag-pill"},G(V),1))),128))])):K("",!0),v("div",Ra,[A(Ie,{title:u.value.type==="iframe"?"Открыть iframe":"Открыть","aria-label":u.value.type==="iframe"?"Открыть iframe":"Открыть",onClick:M[3]||(M[3]=X(V=>s(R)(u.value),["stop"]))},{default:ge(()=>[(f(),z(ke(u.value.type==="iframe"?s(Rn):s(Bn)),{class:"ui-icon item-action-icon"}))]),_:1},8,["title","aria-label"]),A(Ie,{title:"Открыть в новой вкладке","aria-label":"Открыть в новой вкладке",onClick:M[4]||(M[4]=X(V=>s(Te)(u.value),["stop"]))},{default:ge(()=>[A(s(Ks),{class:"ui-icon item-action-icon"})]),_:1}),A(Ie,{title:"Recheck health","aria-label":"Recheck health",onClick:M[5]||(M[5]=X(V=>s($e)(u.value.id),["stop"]))},{default:ge(()=>[A(s(zs),{class:"ui-icon item-action-icon"})]),_:1}),j.value?(f(),z(Ie,{key:0,title:"Копировать IP","aria-label":"Копировать IP",onClick:M[6]||(M[6]=X(V=>s(J)(u.value.id),["stop"]))},{default:ge(()=>[A(s(He),{class:"ui-icon item-action-icon"})]),_:1})):K("",!0),j.value?(f(),z(Ie,{key:1,title:"Копировать SSH shortcut","aria-label":"Копировать SSH shortcut",onClick:M[7]||(M[7]=X(V=>s(O)(u.value.id),["stop"]))},{default:ge(()=>[A(s(no),{class:"ui-icon item-action-icon"})]),_:1})):K("",!0),A(Ie,{title:"Копировать URL","aria-label":"Копировать URL",onClick:M[8]||(M[8]=X(V=>s(Ee)(u.value.url),["stop"]))},{default:ge(()=>[A(s(js),{class:"ui-icon item-action-icon"})]),_:1})]),j.value?(f(),y("p",Ba,[M[10]||(M[10]=fs(" SSH: ",-1)),v("code",null,G(me.value),1)])):K("",!0)],64))],10,wa)}}},Ga={class:"virtual-item-grid"},Na=120,Pn=72,Ua={__name:"VirtualizedItemGrid",props:{items:{type:Array,required:!0},groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0}},setup(r){const l=qt(r,"items"),c=ue(),{isIconCardView:u,isTileCardView:p}=c,g=N(null),m=N(Pn);let h=null;const S=C(()=>l.value.length>Na),k=C(()=>S.value&&m.value<l.value.length),w=C(()=>S.value?l.value.slice(0,m.value):l.value);function $(){m.value=Math.min(l.value.length,m.value+Pn)}function F(){m.value=Pn}function B(){h&&(h.disconnect(),!(!k.value||!g.value)&&h.observe(g.value))}return le(()=>l.value,async()=>{F(),await Re(),B()},{deep:!0}),le(()=>k.value,async()=>{await Re(),B()}),et(async()=>{h=new IntersectionObserver(W=>{for(const x of W)if(x.isIntersecting){$();break}},{root:null,rootMargin:"260px 0px",threshold:0}),await Re(),B()}),tt(()=>{h==null||h.disconnect(),h=null}),(W,x)=>(f(),y("div",Ga,[A(ps,{name:"item-grid-transition",tag:"div",class:q(["item-grid",{"icon-card-grid":s(u),"tile-card-grid":s(p)}])},{default:ge(()=>[(f(!0),y(ne,null,we(w.value,U=>(f(),z(Oa,{key:U.id,"group-key":U.__originGroupKey||r.groupKey,"subgroup-id":U.__originSubgroupId||r.subgroupId,item:U},null,8,["group-key","subgroup-id","item"]))),128))]),_:1},8,["class"]),k.value?(f(),y("div",{key:0,ref_key:"sentinelRef",ref:g,class:"item-grid-sentinel","aria-hidden":"true"},null,512)):K("",!0)]))}},Va={class:"group-header"},Ha={class:"group-title-row"},Fa={key:0,class:"subtitle"},Ka={class:"subgroup-title"},za={__name:"ServiceGroupCard",props:{group:{type:Object,required:!0}},setup(r){const a=ue(),{isInlineGroupLayout:l,resolveGroupIcon:c,resolveSubgroupIcon:u}=a;return(p,g)=>(f(),y("article",{class:q(["panel group-panel",{"group-panel-inline":s(l)(r.group)}])},[v("header",Va,[v("div",Ha,[(f(),z(ke(s(c)(r.group)),{class:"ui-icon group-icon"})),v("h2",null,G(r.group.title),1)]),r.group.description?(f(),y("p",Fa,G(r.group.description),1)):K("",!0)]),(f(!0),y(ne,null,we(r.group.subgroups,m=>(f(),y("section",{key:m.id,class:"subgroup"},[v("h3",Ka,[(f(),z(ke(s(u)(m)),{class:"ui-icon subgroup-icon"})),v("span",null,G(m.title),1)]),A(Ua,{items:m.items,"group-key":r.group.key,"subgroup-id":m.id},null,8,["items","group-key","subgroup-id"])]))),128))],2))}},ja={class:"groups-grid"},qa={key:0,class:"panel group-panel group-empty"},Wa={key:0,class:"panel group-panel group-empty"},Ja={__name:"ServicesGroupsPanel",setup(r){const a=ue(),{activePage:l,activePageGroupBlocks:c,filteredBlockGroups:u}=a,p=N(null);let g=null;const m={duration:180,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};function h(){if(!(!g||!p.value))for(const S of p.value.querySelectorAll(".block-wrap"))S.dataset.offscreen="0",g.observe(S)}return le(()=>{var S;return[(S=l.value)==null?void 0:S.id,c.value.length]},async()=>{g&&(g.disconnect(),await Re(),h())}),et(async()=>{g=new IntersectionObserver(S=>{for(const k of S)k.target.dataset.offscreen=k.isIntersecting?"0":"1"},{root:null,rootMargin:"140px 0px",threshold:.02}),await Re(),h()}),tt(()=>{g==null||g.disconnect(),g=null}),(S,k)=>(f(),y("section",{ref_key:"blocksRootRef",ref:p,class:"page-stack"},[(f(!0),y(ne,null,we(s(c),(w,$)=>(f(),y("section",{key:`${s(l).id}:${$}:groups`,class:"block-wrap"},[Mn((f(),y("section",ja,[(f(!0),y(ne,null,we(s(u)(w.group_ids),F=>(f(),z(za,{key:F.key,group:F},null,8,["group"]))),128)),s(u)(w.group_ids).length?K("",!0):(f(),y("article",qa,[...k[0]||(k[0]=[v("h2",null,"Нет данных для выбранного узла",-1),v("p",{class:"subtitle"},"Выберите другую ветку в боковом дереве.",-1)])]))])),[[s(Yr),m]])]))),128)),s(c).length?K("",!0):(f(),y("article",Wa,[...k[1]||(k[1]=[v("h2",null,"Для этой страницы нет групп",-1),v("p",{class:"subtitle"},"Откройте нужный индикатор в аккордеоне слева.",-1)])]))],512))}},Ya={key:0,class:"hero-logo-square","aria-hidden":"true"},Qa=["src"],Za=["title","aria-label","aria-selected","onClick"],Xa={class:"hero-page-tab-label"},el={__name:"HeroPageTabs",setup(r){let a=!1;const l=ue(),{EMBLEM_SRC:c,isSidebarHidden:u,pages:p,activePage:g,activePageId:m,resolvePageIcon:h}=l,S=N(!a),k=C(()=>u.value);let w=0;return et(()=>{S.value&&(w=globalThis.setTimeout(()=>{S.value=!1,a=!0},700))}),tt(()=>{w&&(globalThis.clearTimeout(w),w=0),S.value&&(a=!0)}),($,F)=>(f(),y("nav",{class:q(["hero-page-tabs",{"hero-page-tabs--intro":S.value,"has-logo-tile":k.value}]),role:"tablist","aria-label":"Разделы"},[k.value?(f(),y("div",Ya,[v("img",{src:s(c),alt:""},null,8,Qa)])):K("",!0),(f(!0),y(ne,null,we(s(p),B=>{var W,x,U;return f(),y("button",{key:B.id,class:q(["hero-page-tab-btn",{active:((W=s(g))==null?void 0:W.id)===B.id,"hero-page-tab-btn--intro-active":S.value&&((x=s(g))==null?void 0:x.id)===B.id}]),type:"button",role:"tab",title:B.title,"aria-label":B.title,"aria-selected":((U=s(g))==null?void 0:U.id)===B.id,onClick:J=>m.value=B.id},[(f(),z(ke(s(h)(B)),{class:"ui-icon hero-page-tab-icon"})),v("span",Xa,G(B.title),1)],10,Za)}),128))],2))}},tl={class:"hero-layout"},nl={class:"hero panel hero-title-panel"},rl={class:"hero-title-content"},ol={class:"hero-controls-content"},il={key:0,id:"hero-controls-drawer",class:"hero-controls-drawer"},sl=["title","aria-label"],al=["aria-expanded","title"],ll={key:0,class:"editor-error hero-editor-error"},Jr="oko:hero-controls-open:v1",ul={__name:"ServicesHeroPanel",setup(r){const a=ue(),l=N(!1),{editMode:c,isSidebarDetailed:u,saveStatus:p,saveStatusLabel:g,saveError:m,sidebarViewToggleTitle:h,toggleEditMode:S,addGroup:k,openCommandPalette:w,openSettingsPanel:$,toggleSidebarView:F}=a;return et(()=>{if(!window.localStorage)return;const B=window.localStorage.getItem(Jr);l.value=B==="1"}),le(()=>l.value,B=>{window.localStorage&&window.localStorage.setItem(Jr,B?"1":"0")}),(B,W)=>(f(),y("section",tl,[v("header",nl,[W[1]||(W[1]=v("div",{id:"hero-title-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),v("div",rl,[A(el)])]),v("aside",{class:q(["panel hero-control-panel service-hero-controls",{active:s(c)}])},[W[2]||(W[2]=v("div",{id:"hero-controls-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),v("div",ol,[v("div",{class:q(["hero-controls-accordion",{open:l.value}])},[A(gs,{name:"hero-controls-drawer-transition"},{default:ge(()=>[l.value?(f(),y("div",il,[A(Ie,{"button-class":"hero-icon-btn hero-accordion-action editor-toggle",active:s(c),title:s(c)?"Выключить режим редактирования":"Включить режим редактирования","aria-label":s(c)?"Выключить режим редактирования":"Включить режим редактирования",onClick:s(S)},{default:ge(()=>[A(s(On),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),s(c)?(f(),z(Ie,{key:0,"button-class":"hero-icon-btn hero-accordion-action",title:"Добавить группу","aria-label":"Добавить группу",onClick:s(k)},{default:ge(()=>[A(s(Gn),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"])):K("",!0),A(Ie,{"button-class":"hero-icon-btn hero-accordion-action",title:"Быстрый поиск сервисов (Ctrl/Cmd+K)","aria-label":"Быстрый поиск сервисов",onClick:s(w)},{default:ge(()=>[A(s(qs),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"]),A(Ie,{"button-class":"hero-icon-btn hero-accordion-action",title:"Панель настроек","aria-label":"Открыть панель настроек",onClick:s($)},{default:ge(()=>[A(s(Ws),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"]),A(Ie,{"button-class":"hero-icon-btn hero-accordion-action",active:!s(u),title:s(h),"aria-label":s(h),onClick:s(F)},{default:ge(()=>[A(s(so),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),s(c)?(f(),y("span",{key:1,class:q(["hero-save-indicator hero-accordion-status",s(p)]),role:"status",title:s(g),"aria-label":s(g)},[A(s(Js),{class:"ui-icon hero-save-icon"})],10,sl)):K("",!0)])):K("",!0)]),_:1}),v("button",{class:"hero-controls-trigger",type:"button","aria-expanded":l.value,"aria-controls":"hero-controls-drawer",title:l.value?"Скрыть панель действий":"Показать панель действий",onClick:W[0]||(W[0]=x=>l.value=!l.value)},[A(s(oo),{class:"ui-icon hero-action-icon"}),A(s(Ys),{class:q(["ui-icon hero-accordion-caret",{open:l.value}])},null,8,["class"])],8,al)],2),s(c)&&s(m)?(f(),y("p",ll,G(s(m)),1)):K("",!0)])],2)]))}},cl={key:0,class:"panel status-panel"},dl={key:1,class:"panel status-panel error-state"},fl={class:"subtitle"},pl={key:3,class:"panel status-panel"},gl={__name:"DashboardMainView",setup(r){const a=Ve(()=>he(()=>import("./IndicatorTabPanel-CFw2TNfg.js"),__vite__mapDeps([0,1,2]))),l=Ve(()=>he(()=>import("./LanPageView-DQnpOuUY.js"),__vite__mapDeps([3,1,2]))),c=ue(),{activePage:u,activeIndicatorWidget:p,loadingConfig:g,configError:m,isLanPage:h,loadConfig:S}=c;return(k,w)=>{var $;return f(),y("main",{key:(($=s(u))==null?void 0:$.id)||"empty",class:q(["page",{"indicator-open":!!s(p),"page--lan":s(h)&&!s(p)}])},[s(g)?(f(),y("section",cl,[...w[1]||(w[1]=[v("h2",null,"Загрузка конфигурации...",-1),v("p",{class:"subtitle"},"Получаем dashboard-модель из backend.",-1)])])):s(m)?(f(),y("section",dl,[w[2]||(w[2]=v("h2",null,"Ошибка загрузки конфигурации",-1)),v("p",fl,G(s(m)),1),v("button",{class:"ghost",type:"button",onClick:w[0]||(w[0]=(...F)=>s(S)&&s(S)(...F))},"Повторить")])):s(u)?(f(),y(ne,{key:2},[s(p)?(f(),z(s(a),{key:0})):(f(),y(ne,{key:1},[s(h)?(f(),z(s(l),{key:0})):(f(),y(ne,{key:1},[A(ul),A(Ja)],64))],64))],64)):(f(),y("section",pl,[...w[3]||(w[3]=[v("h2",null,"Нет доступных страниц",-1),v("p",{class:"subtitle"},"Проверьте `layout.pages` в `dashboard.yaml`.",-1)])]))],2)}}},ml={class:"brand"},vl=["src"],bl={class:"brand-title"},yl={class:"brand-subtitle"},hl={__name:"SidebarHeaderTabs",setup(r){const a=ue(),{EMBLEM_SRC:l,appTitle:c,appTagline:u}=a;return(p,g)=>(f(),y("div",ml,[v("img",{src:s(l),alt:"Oko"},null,8,vl),v("div",null,[v("p",bl,G(s(c)),1),v("p",yl,G(s(u)),1)])]))}},Il={class:"sidebar-stats-accordion","aria-label":"Индикаторы"},wl=["aria-expanded"],_l={class:"sidebar-stats-toggle-values"},Sl={key:0,class:"sidebar-indicators"},kl=["onClick"],El={class:"widget-head sidebar-indicator-head"},Cl={class:"widget-title"},Tl={class:"item-type"},$l={key:0,class:"widget-error"},Pl={key:1,class:"widget-loading"},Ll={class:"widget-value sidebar-indicator-value"},Al={class:"widget-subtitle"},xl={key:0,class:"widget-trend"},Dl={key:0,class:"widget-list sidebar-list-preview"},Ml={key:1,class:"widget-empty"},Rl={class:"widget-subtitle"},Bl={key:5,class:"widget-empty"},Ol={key:6,class:"widget-actions sidebar-indicator-actions"},Gl=["onClick"],Nl=["disabled","onClick"],Ul={key:1,class:"widget-empty"},Vl={__name:"SidebarIndicatorsAccordion",setup(r){const a=ue(),{statsExpanded:l,sidebarIndicatorSummary:c,sidebarIndicators:u,isLargeIndicator:p,activeIndicatorWidget:g,selectSidebarIndicator:m,resolveWidgetIcon:h,widgetState:S,statCardValue:k,statCardSubtitle:w,statCardTrend:$,indicatorPreviewEntries:F,tableRows:B,openIndicatorView:W,isActionBusy:x,runWidgetAction:U}=a;return(J,O)=>(f(),y("div",Il,[v("button",{class:"sidebar-stats-toggle",type:"button","aria-controls":"sidebar-stats-panel","aria-expanded":s(l),onClick:O[0]||(O[0]=R=>l.value=!s(l))},[O[1]||(O[1]=v("span",{class:"sidebar-stats-toggle-text"},"Индикаторы",-1)),v("span",_l,G(s(c)),1),v("span",{class:q(["sidebar-stats-toggle-caret",{open:s(l)}])},"▴",2)],8,wl),v("div",{id:"sidebar-stats-panel",class:q(["sidebar-stats-panel",{open:s(l)}])},[s(u).length?(f(),y("div",Sl,[(f(!0),y(ne,null,we(s(u),R=>{var Te,$e,Ee,oe,E;return f(),y("article",{key:R.id,class:q(["sidebar-indicator",{interactive:s(p)(R),active:((Te=s(g))==null?void 0:Te.id)===R.id}]),onClick:j=>s(m)(R)},[v("header",El,[v("div",Cl,[(f(),z(ke(s(h)(R)),{class:"ui-icon widget-icon"})),v("h3",null,G(R.title),1)]),v("span",Tl,G(R.type),1)]),($e=s(S)(R.id))!=null&&$e.error?(f(),y("p",$l,G((Ee=s(S)(R.id))==null?void 0:Ee.error),1)):(oe=s(S)(R.id))!=null&&oe.loading?(f(),y("p",Pl,"Обновление...")):R.type==="stat_card"?(f(),y(ne,{key:2},[v("p",Ll,G(s(k)(R)),1),v("p",Al,G(s(w)(R)),1),s($)(R)?(f(),y("p",xl,G(s($)(R)),1)):K("",!0)],64)):R.type==="stat_list"?(f(),y(ne,{key:3},[s(F)(R).length?(f(),y("ul",Dl,[(f(!0),y(ne,null,we(s(F)(R),j=>(f(),y("li",{key:j.title+j.value},[v("span",null,G(j.title),1),v("strong",null,G(j.value),1)]))),128))])):(f(),y("p",Ml,"Нет данных")),O[2]||(O[2]=v("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):R.type==="table"?(f(),y(ne,{key:4},[v("p",Rl,"Строк: "+G(s(B)(R).length),1),O[3]||(O[3]=v("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):(f(),y("p",Bl,"Неподдерживаемый тип виджета")),(E=R.data.actions)!=null&&E.length||s(p)(R)?(f(),y("div",Ol,[s(p)(R)?(f(),y("button",{key:0,class:"ghost",type:"button",onClick:X(j=>s(W)(R.id),["stop"])},"Открыть вкладку",8,Gl)):K("",!0),(f(!0),y(ne,null,we(R.data.actions||[],j=>(f(),y("button",{key:j.id,class:"ghost",type:"button",disabled:s(x)(R.id,j.id),onClick:X(me=>s(U)(R.id,j),["stop"])},G(j.title),9,Nl))),128))])):K("",!0)],10,kl)}),128))])):(f(),y("p",Ul,"Для выбранной страницы индикаторы не настроены."))],2)]))}},Hl=["draggable"],Fl={class:"tree-node-row"},Kl={class:"tree-text"},zl={class:"tree-meta"},jl={key:0,class:"tree-inline-actions"},ql={__name:"SidebarTreeSubgroupNode",props:{group:{type:Object,required:!0},subgroup:{type:Object,required:!0}},setup(r){const a=ue(),{dragState:l,editMode:c,onSubgroupDragStart:u,clearDragState:p,onSubgroupDragOver:g,onSubgroupDrop:m,isSubgroupSelected:h,selectSubgroupNode:S,resolveSubgroupIcon:k,subgroupTotalItems:w,editSubgroup:$,addItem:F,removeSubgroup:B}=a;return(W,x)=>(f(),y("li",{class:q(["tree-subgroup-item",{dragging:s(l).type==="subgroup"&&s(l).subgroupId===r.subgroup.id}]),draggable:s(c),onDragstart:x[4]||(x[4]=X(U=>s(u)(U,r.group.id,r.subgroup.id),["stop"])),onDragend:x[5]||(x[5]=X((...U)=>s(p)&&s(p)(...U),["stop"])),onDragover:x[6]||(x[6]=X(U=>s(g)(U,r.group.id,r.subgroup.id),["stop"])),onDrop:x[7]||(x[7]=X(U=>s(m)(U,r.group.id,r.subgroup.id),["stop"]))},[v("div",Fl,[v("button",{class:q(["tree-node tree-subgroup",{active:s(h)(r.group.key,r.subgroup.id)}]),type:"button",onClick:x[0]||(x[0]=U=>s(S)(r.group.key,r.subgroup.id))},[(f(),z(ke(s(k)(r.subgroup)),{class:"ui-icon tree-icon tree-sub-icon"})),v("span",Kl,G(r.subgroup.title),1),v("span",zl,G(s(w)(r.subgroup)),1)],2),s(c)?(f(),y("div",jl,[A(s(ao),{class:"ui-icon tree-grip"}),v("button",{class:"tree-mini-btn",type:"button",title:"Редактировать подгруппу",onClick:x[1]||(x[1]=X(U=>s($)(r.group.id,r.subgroup.id),["stop"]))},[A(s(On),{class:"ui-icon"})]),v("button",{class:"tree-mini-btn",type:"button",title:"Добавить элемент",onClick:x[2]||(x[2]=X(U=>s(F)(r.group.id,r.subgroup.id),["stop"]))},[A(s(Gn),{class:"ui-icon"})]),v("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить подгруппу",onClick:x[3]||(x[3]=X(U=>s(B)(r.group.id,r.subgroup.id),["stop"]))},[A(s(lo),{class:"ui-icon"})])])):K("",!0)])],42,Hl))}},Wl=["draggable"],Jl={class:"tree-node-row"},Yl={class:"tree-text"},Ql={class:"tree-meta"},Zl={key:0,class:"tree-inline-actions"},Xl={class:"tree-subgroups"},eu={__name:"SidebarTreeGroupNode",props:{group:{type:Object,required:!0}},setup(r){const a=ue(),{dragState:l,editMode:c,isDirectGroupNode:u,onGroupDragStart:p,clearDragState:g,onGroupDragOver:m,onGroupDrop:h,isGroupSelected:S,toggleGroupNode:k,isGroupExpanded:w,resolveGroupIcon:$,groupTotalItems:F,editGroup:B,addSubgroup:W,removeGroup:x}=a;return(U,J)=>(f(),y("li",{class:q(["tree-group-item",{dragging:s(l).type==="group"&&s(l).groupId===r.group.id&&s(u)(r.group)}]),draggable:s(c)&&s(u)(r.group),onDragstart:J[4]||(J[4]=X(O=>s(p)(O,r.group),["stop"])),onDragend:J[5]||(J[5]=X((...O)=>s(g)&&s(g)(...O),["stop"])),onDragover:J[6]||(J[6]=X(O=>s(m)(O,r.group),["stop"])),onDrop:J[7]||(J[7]=X(O=>s(h)(O,r.group),["stop"]))},[v("div",Jl,[v("button",{class:q(["tree-node tree-group",{active:s(S)(r.group.key)}]),type:"button",onClick:J[0]||(J[0]=O=>s(k)(r.group.key))},[v("span",{class:q(["tree-caret",{open:s(w)(r.group.key)}])},"▾",2),(f(),z(ke(s($)(r.group)),{class:"ui-icon tree-icon"})),v("span",Yl,G(r.group.title),1),v("span",Ql,G(s(F)(r.group)),1)],2),s(c)&&s(u)(r.group)?(f(),y("div",Zl,[A(s(ao),{class:"ui-icon tree-grip"}),v("button",{class:"tree-mini-btn",type:"button",title:"Редактировать группу",onClick:J[1]||(J[1]=X(O=>s(B)(r.group.id),["stop"]))},[A(s(On),{class:"ui-icon"})]),v("button",{class:"tree-mini-btn",type:"button",title:"Добавить подгруппу",onClick:J[2]||(J[2]=X(O=>s(W)(r.group.id),["stop"]))},[A(s(Gn),{class:"ui-icon"})]),v("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить группу",onClick:J[3]||(J[3]=X(O=>s(x)(r.group.id),["stop"]))},[A(s(lo),{class:"ui-icon"})])])):K("",!0)]),Mn(v("ul",Xl,[(f(!0),y(ne,null,we(r.group.subgroups,O=>(f(),z(ql,{key:O.id,group:r.group,subgroup:O},null,8,["group","subgroup"]))),128))],512),[[ms,s(w)(r.group.key)]])],42,Wl))}},tu={key:0,class:"sidebar-tree","aria-label":"Дерево сервисов"},nu={key:0,class:"tree-root"},ru={key:1,class:"tree-empty"},ou={__name:"SidebarTreePanel",setup(r){const a=ue(),{treeGroups:l,filteredTreeGroups:c}=a,u={duration:160,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};return(p,g)=>s(l).length?(f(),y("section",tu,[s(c).length?Mn((f(),y("ul",nu,[(f(!0),y(ne,null,we(s(c),m=>(f(),z(eu,{key:m.key,group:m},null,8,["group"]))),128))])),[[s(Yr),u]]):(f(),y("p",ru,"По вашему запросу ничего не найдено."))])):K("",!0)}},iu={class:"sidebar"},su={class:"sidebar-content"},au={__name:"DashboardSidebarView",setup(r){const a=ue(),{isSidebarDetailed:l}=a;return(c,u)=>(f(),y("aside",iu,[u[0]||(u[0]=v("div",{id:"sidebar-particles",class:"sidebar-particles","aria-hidden":"true"},null,-1)),v("div",su,[A(hl),s(l)?(f(),z(ou,{key:0})):K("",!0),s(l)?(f(),z(Vl,{key:1})):K("",!0)])]))}},lu=["src"],uu={__name:"App",setup(r){const a=()=>he(()=>import("./LanHostModal-Ct00IqDy.js"),__vite__mapDeps([4,1,5,2])),l=()=>he(()=>import("./IframeModal-DC9UTip8.js"),__vite__mapDeps([6,5,1,2])),c=()=>he(()=>import("./ItemEditorModal-CJSmesRy.js"),__vite__mapDeps([7,1,5,2])),u=()=>he(()=>import("./DashboardSettingsModal-B8escnY1.js"),__vite__mapDeps([8,1,5,2])),p=()=>he(()=>import("./CommandPaletteModal-ehn6US3D.js"),__vite__mapDeps([9,1,5,2])),g=()=>he(()=>import("./IndicatorTabPanel-CFw2TNfg.js"),__vite__mapDeps([0,1,2])),m=()=>he(()=>import("./LanPageView-DQnpOuUY.js"),__vite__mapDeps([3,1,2])),h=Ve(a),S=Ve(l),k=Ve(c),w=Ve(u),$=Ve(p),F=ue(),{EMBLEM_SRC:B,closeCommandPalette:W,closeSettingsPanel:x,commandPaletteOpen:U,iframeModal:J,isSidebarHidden:O,itemEditor:R,lanHostModal:Te,openSettingsPanel:$e,settingsPanel:Ee,toggleCommandPalette:oe}=F,E=N(!1);let j=0,me=0,Q=0;function se(){Promise.allSettled([a(),l(),c(),u(),p(),g(),m()])}function _e(){if("requestIdleCallback"in window){Q=window.requestIdleCallback(()=>{Q=0,se()},{timeout:2e3});return}me=window.setTimeout(()=>{me=0,se()},1400)}function ee(Y){if((Y.metaKey||Y.ctrlKey)&&!Y.altKey&&!Y.shiftKey&&Y.key.toLowerCase()==="k"){Y.preventDefault(),oe();return}if(Y.key==="Escape"&&U.value){Y.preventDefault(),W();return}Y.key==="Escape"&&Ee.open&&(Y.preventDefault(),x())}function D(Y){var ve;const re=String(((ve=Y==null?void 0:Y.detail)==null?void 0:ve.action)||"");if(re){if(re==="open-search"){oe();return}re==="open-settings"&&$e()}}return et(()=>{j=globalThis.setTimeout(()=>{E.value=!0},1e3),window.addEventListener("keydown",ee),window.addEventListener("oko:desktop-action",D),_e()}),tt(()=>{j&&(globalThis.clearTimeout(j),j=0),me&&(window.clearTimeout(me),me=0),Q&&"cancelIdleCallback"in window&&(window.cancelIdleCallback(Q),Q=0),window.removeEventListener("keydown",ee),window.removeEventListener("oko:desktop-action",D)}),(Y,re)=>(f(),y("div",{class:q(["shell",{"shell-motion-static":E.value}])},[v("img",{class:"center-emblem",src:s(B),alt:"","aria-hidden":"true"},null,8,lu),v("div",{class:q(["app-shell",{"sidebar-hidden":s(O)}])},[s(O)?K("",!0):(f(),z(au,{key:0})),A(gl)],2),s(Te).open?(f(),z(s(h),{key:0})):K("",!0),s(J).open?(f(),z(s(S),{key:1})):K("",!0),s(R).open?(f(),z(s(k),{key:2})):K("",!0),s(Ee).open?(f(),z(s(w),{key:3})):K("",!0),s(U)?(f(),z(s($),{key:4})):K("",!0)],2))}},Ze="http://127.0.0.1:8090";let Fe={desktop:!1,mode:"web",apiBaseUrl:"",remoteBaseUrl:Ze,embeddedRunning:!1},jt=null,Ct=null;function cu(){return typeof window<"u"&&!!window.__TAURI_INTERNALS__}function Dn(r){const a=String(r||"").trim();return a?a.endsWith("/")?a.slice(0,-1):a:""}function Tt(r){const a=r,l={desktop:!!(a!=null&&a.desktop),mode:String((a==null?void 0:a.mode)||"web"),apiBaseUrl:Dn(a==null?void 0:a.apiBaseUrl),remoteBaseUrl:Dn(a==null?void 0:a.remoteBaseUrl)||Ze,embeddedRunning:!!(a!=null&&a.embeddedRunning)};return Fe=l,typeof window<"u"&&(window.__OKO_API_BASE__=l.apiBaseUrl||"",window.__OKO_DESKTOP_RUNTIME__=l,window.dispatchEvent(new CustomEvent("oko:api-base-change",{detail:{apiBaseUrl:l.apiBaseUrl}}))),l}function du(r){typeof window>"u"||window.dispatchEvent(new CustomEvent("oko:desktop-action",{detail:{action:String(r||"")}}))}async function fu(){const[r,a]=await Promise.all([he(()=>import("./vendor-D1bzbGly.js").then(c=>c.J),[]),he(()=>import("./vendor-D1bzbGly.js").then(c=>c.K),[])]);Ct=r.invoke;const l=await Ct("desktop_get_runtime_profile");return Tt(l),await a.listen("desktop://runtime-profile",c=>{Tt(c.payload)}),await a.listen("desktop://action",c=>{du(c.payload)}),Fe}function Iu(){return{...Fe}}async function po(){return cu()?(jt||(jt=fu().catch(r=>(jt=null,Tt({desktop:!0,mode:"remote",apiBaseUrl:Ze,remoteBaseUrl:Ze,embeddedRunning:!1}),Fe))),jt):(Tt({desktop:!1,mode:"web",apiBaseUrl:"",remoteBaseUrl:Ze,embeddedRunning:!1}),Fe)}async function wu(r){if(!Ct&&(!(await po()).desktop||!Ct))throw new Error("Desktop runtime bridge is not available");const a={mode:String((r==null?void 0:r.mode)||Fe.mode),remote_base_url:Dn((r==null?void 0:r.remoteBaseUrl)||Fe.remoteBaseUrl||Ze)},l=await Ct("desktop_set_runtime_profile",a);return Tt(l)}async function pu(r){}function gu(){var c,u,p,g;if((u=(c=globalThis.matchMedia)==null?void 0:c.call(globalThis,"(prefers-reduced-motion: reduce)"))==null?void 0:u.matches)return"off";const a=Number(((p=globalThis.navigator)==null?void 0:p.hardwareConcurrency)||8),l=Number(((g=globalThis.navigator)==null?void 0:g.deviceMemory)||8);return a<=4||l<=4?"lite":"full"}function mu(r){const a=document.documentElement,l=a.dataset.fxMode||"";a.dataset.fxMode=r,r==="off"?a.style.setProperty("--glow-enabled","0"):r==="lite"?a.style.setProperty("--glow-enabled","0.58"):a.style.setProperty("--glow-enabled","1"),l&&l!==r&&window.dispatchEvent(new CustomEvent("oko:fx-mode-change",{detail:{mode:r,previousMode:l}}))}function vu(){var l;const r=(l=globalThis.matchMedia)==null?void 0:l.call(globalThis,"(prefers-reduced-motion: reduce)"),a=()=>mu(gu());a(),r!=null&&r.addEventListener?r.addEventListener("change",a):r!=null&&r.addListener&&r.addListener(a)}vu();pu();async function bu(){await po(),vs(uu).use(bs).mount("#app")}bu();export{el as _,Ie as a,Iu as g,po as i,wu as s,ue as u};
