const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/IndicatorTabPanel-CYeVkpjf.js","assets/vendor-DqjHc5v_.js","assets/vendor-icons-Bgfr6t_F.js","assets/LanPageView-Co2-vu4u.js","assets/LanHostModal-BYgcEE-z.js","assets/BaseModal-CjQ9uAF-.js","assets/IframeModal-BJRQ5AbA.js","assets/ItemEditorModal-Bw4lyO0p.js","assets/DashboardSettingsModal-B7LKA9Hn.js","assets/CommandPaletteModal-CtjQnrmf.js"])))=>i.map(i=>d[i]);
import{o as f,c as b,r as os,n as W,h as _r,w as ie,a as Re,b as Ze,d as Xe,e as N,f as ye,g as C,u as s,i as q,j as we,k as v,F as te,t as G,l as j,m as he,p as x,q as fe,s as Z,v as is,x as Ft,T as ss,y as $n,z as Ur,A as as,B as Ve,C as ls,D as us,M as cs}from"./vendor-DqjHc5v_.js";import{s as kr,a as Er,b as ds,c as fs,d as Cr,e as ps,f as In,g as gs,h as Tr,i as $r,j as Pr,k as ht,l as ms,m as Lr,n as vs,o as ys,p as xr,q as bs,r as hs,t as wn,H as St,N as Kt,S as Fe,F as jr,C as zr,u as qr,T as En,v as Wr,w as Jr,D as Cn,x as Is,y as ws,W as Ss,A as _s,E as ks,z as Es,M as Ar,P as Cs,B as Yr,G as Pn,L as Ln,I as Ts,K as $s,J as Ps,O as Mr,Q as Qr,R as Dr,U as Rr,V as Ls,X as xs,Y as As,Z as Ms,_ as Sn,$ as Zr,a0 as Ds,a1 as Xr,a2 as Rs,a3 as Os,a4 as eo,a5 as Bs,a6 as Gs,a7 as Ns,a8 as xn,a9 as An,aa as Hs,ab as Vs,ac as Fs,ad as Ks,ae as to,af as no}from"./vendor-icons-Bgfr6t_F.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))d(a);new MutationObserver(a=>{for(const p of a)if(p.type==="childList")for(const g of p.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&d(g)}).observe(document,{childList:!0,subtree:!0});function l(a){const p={};return a.integrity&&(p.integrity=a.integrity),a.referrerPolicy&&(p.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?p.credentials="include":a.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function d(a){if(a.ep)return;a.ep=!0;const p=l(a);fetch(a.href,p)}})();const Us="modulepreload",js=function(r){return"/static/"+r},Or={},Ee=function(u,l,d){let a=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),m=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));a=Promise.allSettled(l.map(h=>{if(h=js(h),h in Or)return;Or[h]=!0;const _=h.endsWith(".css"),E=_?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${E}`))return;const w=document.createElement("link");if(w.rel=_?"stylesheet":Us,_||(w.as="script"),w.crossOrigin="",w.href=h,m&&w.setAttribute("nonce",m),document.head.appendChild(w),_)return new Promise(($,U)=>{w.addEventListener("load",$),w.addEventListener("error",()=>U(new Error(`Unable to preload CSS for ${h}`)))})}))}function p(g){const m=new Event("vite:preloadError",{cancelable:!0});if(m.payload=g,window.dispatchEvent(m),!m.defaultPrevented)throw g}return a.then(g=>{for(const m of g||[])m.status==="rejected"&&p(m.reason);return u().catch(p)})},zs=["type","title","aria-label","disabled"],be={__name:"IconButton",props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"button"},title:{type:String,default:""},ariaLabel:{type:String,default:""},buttonClass:{type:String,default:""}},emits:["click"],setup(r){return(u,l)=>(f(),b("button",{class:W(["ghost icon-btn",[r.buttonClass,{active:r.active}]]),type:r.type,title:r.title,"aria-label":r.ariaLabel||r.title,disabled:r.disabled,onClick:l[0]||(l[0]=d=>u.$emit("click",d))},[os(u.$slots,"default")],10,zs))}},qs="X-Dashboard-Token";function Ws(){var l;if(typeof window>"u")return"";const r=((l=window.localStorage)==null?void 0:l.getItem("dashboard_admin_token"))||"";if(String(r).trim())return String(r).trim();const u=window.__DASHBOARD_ADMIN_TOKEN__||"";return String(u).trim()}function Js(r,u,l){const d=u&&typeof r=="object"&&r!==null?r.detail:null;let a=`Request failed: ${l}`;return Array.isArray(d)?a=d.map(p=>typeof p=="object"&&p!==null&&"message"in p?String(p.message||""):JSON.stringify(p)).join("; "):typeof d=="string"&&d?a=d:typeof r=="string"&&r&&(a=r),a}async function Oe(r,u={}){const{requireAdminToken:l=!1,headers:d={},...a}=u,p={};if(d instanceof Headers)d.forEach((w,$)=>{p[$]=w});else if(Array.isArray(d))for(const[w,$]of d)p[w]=String($);else Object.assign(p,d);const g={Accept:"application/json",...p};if(l){const w=Ws();w&&(g[qs]=w)}const m=await fetch(r,{credentials:"same-origin",headers:g,...a}),_=(m.headers.get("content-type")||"").includes("application/json"),E=_?await m.json():await m.text();if(!m.ok){const $=new Error(Js(E,_,m.status));throw $.status=m.status,$.body=E,$}return E}const et="/api/v1/dashboard";function Ys(){return Oe(`${et}/config`)}function Qs(r){return Oe(`${et}/iframe/${encodeURIComponent(r)}/source`,{requireAdminToken:!0})}function Zs(r=[]){const u=new URLSearchParams;for(const d of r)u.append("item_id",d);const l=u.toString();return Oe(`${et}/health${l?`?${l}`:""}`)}function Xs(r){return Oe(`${et}/config`,{requireAdminToken:!0,method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}function ea(){return Oe(`${et}/lan/state`)}function ta(){return Oe(`${et}/lan/run`,{requireAdminToken:!0,method:"POST"})}const _n="oko-particles-js",na="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js",ra=7e3;let It=null;function Tn(){return typeof window.particlesJS=="function"}function oa(r){return new Promise(u=>{let l=!1;const d=p=>{l||(l=!0,u(p))},a=window.setTimeout(()=>{d(Tn())},ra);r.addEventListener("load",()=>{window.clearTimeout(a),d(Tn())},{once:!0}),r.addEventListener("error",()=>{window.clearTimeout(a),d(!1)},{once:!0})})}async function ia(){return typeof window>"u"||typeof document>"u"?!1:Tn()?!0:It||(It=(async()=>{let r=document.getElementById(_n)instanceof HTMLScriptElement?document.getElementById(_n):null;r||(r=document.createElement("script"),r.id=_n,r.src=na,r.async=!0,r.defer=!0,document.head.appendChild(r));const u=await oa(r);return u||(It=null),u})(),It)}function L(r){const u=`#${r.hex}`;return(l,{attrs:d})=>_r("svg",{...d,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",role:"img","aria-hidden":"true",style:d.style?[d.style,{color:u}]:{color:u}},[_r("path",{d:r.path})])}const Ut={homeassistant:L(wn),"home-assistant":L(wn),ha:L(wn),openwrt:L(hs),adguard:L(bs),proxmox:L(xr),pve:L(xr),grafana:L(ys),gitea:L(vs),jellyfin:L(Lr),jellyseerr:L(Lr),sonarr:L(ht),radarr:L(ms),lidarr:L(ht),readarr:L(ht),bazarr:L(ht),prowlarr:L(ht),qbittorrent:L(Pr),qb:L(Pr),postgres:L($r),postgresql:L($r),docker:L(Tr),dockge:L(Tr),cockpit:L(gs),npm:L(In),nginxproxymanager:L(In),"nginx-proxy-manager":L(In),nginx:L(ps),openai:L(Cr),ai:L(Cr),portainer:L(fs),ytsync:L(Er),youtube:L(ds),youtubeshorts:L(Er),termius:L(kr),termix:L(kr)},jt={home:St,house:St,дом:St,dom:St,route:Rs,net:Kt,network:Kt,сеть:Kt,dashboard:Xr,infra:Fe,infrastructure:Fe,инфраструктура:Fe,server:Fe,core:Ds,ops:Zr,media:Sn,медиа:Sn,tv:Sn,iot:zr,cloud:Ms,wifi:As,monitor:xs,cockpit:Ls,proxmox:Fe,grafana:qr,gitea:Rr,git:Rr,jellyfin:jr,navidrome:Ar,tunnel:Dr,tunnels:Dr,stats:Qr,services:Mr,service:Mr,health:Wr,alerts:En,alert:En,security:Jr,auth:Ps,key:$s,db:Cn,database:Cn,storage:Ts,link:Ln,iframe:Pn,terminal:Yr,package:Cs,music:Ar,camera:Es,eye:ks,observability:_s,workflow:Ss,settings:ws,spark:Is},ro=[{re:/\b(home|house|dom|дом)\b/,icon:St},{re:/\b(net|network|route|vpn|edge|сеть|маршрут|туннел)\b/,icon:Kt},{re:/\b(infra|server|cluster|pve|проксмокс|инфраструктур)\b/,icon:Fe},{re:/\b(media|tv|video|stream|jellyfin|медиа)\b/,icon:jr},{re:/\b(iot|sensor|home-assistant|умн|дом)\b/,icon:zr},{re:/\b(stat|metric|chart|grafana|аналит|monitor)\b/,icon:qr},{re:/\b(alert|error|warn|critical|ошиб|авар)\b/,icon:En},{re:/\b(health|status|pulse|heart|состояни)\b/,icon:Wr},{re:/\b(auth|token|secret|lock|ключ|безопас)\b/,icon:Jr},{re:/\b(db|database|postgres|mysql|redis)\b/,icon:Cn}],Qe={page:Xr,group:eo,subgroup:Os,itemLink:Ln,itemIframe:Pn,widget:Qr};function oo(r){return String(r||"").toLowerCase().replace(/[^a-z0-9а-яё._-]+/gi," ").split(/[\s._-]+/).filter(Boolean)}function io(r){if(Ut[r])return Ut[r];for(const[u,l]of Object.entries(Ut))if(r.includes(u))return l;if(jt[r])return jt[r];for(const[u,l]of Object.entries(jt))if(r.includes(u))return l;return null}function tt(r,u){for(const d of r)for(const a of oo(d)){const p=io(a);if(p)return p}const l=r.map(d=>String(d||"").toLowerCase()).filter(Boolean).join(" ");for(const d of ro)if(d.re.test(l))return d.icon;return u}function sa(r){return tt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],Qe.page)}function aa(r){return tt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.description],Qe.group)}function la(r){return tt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],Qe.subgroup)}function ua(r){return tt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,r==null?void 0:r.url,...(r==null?void 0:r.tags)||[]],(r==null?void 0:r.type)==="iframe"?Qe.itemIframe:Qe.itemLink)}function ca(r){var u;return tt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,(u=r==null?void 0:r.data)==null?void 0:u.endpoint],Qe.widget)}function _t(r,u="node"){return String(r||"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")||u}function He(r,u){const l=_t(r,"node");let d=l,a=2;for(;u.has(d);)d=`${l}-${a}`,a+=1;return d}function zt(r){const u=new Set;for(const l of r.groups||[])for(const d of l.subgroups||[])u.add(d.id);return u}function Ht(r){const u=new Set;for(const l of r.groups||[])for(const d of l.subgroups||[])for(const a of d.items||[])u.add(a.id);return u}function Ie(r,u){return(r.groups||[]).find(l=>l.id===u)||null}function me(r,u,l){const d=Ie(r,u);return d&&(d.subgroups||[]).find(a=>a.id===l)||null}function Vt(r){return String((r==null?void 0:r.key)||"").startsWith("group:")}function Br(r){var a,p;const u=new Set((r.groups||[]).map(g=>g.id)),l=zt(r),d=new Set([...u,...l]);for(const g of((a=r.layout)==null?void 0:a.pages)||[]){const m=[];for(const h of g.blocks||[]){if(h.type==="groups"){h.group_ids=(h.group_ids||[]).filter(_=>d.has(_)),h.group_ids.length&&m.push(h);continue}(h.widgets||[]).length&&m.push(h)}!m.length&&((p=r.groups)!=null&&p.length)&&m.push({type:"groups",group_ids:[r.groups[0].id]}),g.blocks=m}}function Gr(r,u,l){var g;const d=((g=r.layout)==null?void 0:g.pages)||[];if(!d.length)return;const a=d.find(m=>m.id===u)||d[0];let p=a.blocks.find(m=>m.type==="groups");if(!p){p={type:"groups",group_ids:[l]},a.blocks.push(p);return}p.group_ids.includes(l)||p.group_ids.push(l)}function Nr(r,u,l){const d=r.groups||[],a=d.findIndex(h=>h.id===u),p=d.findIndex(h=>h.id===l);if(a<0||p<0||a===p)return!1;const[g]=d.splice(a,1),m=a<p?p-1:p;return d.splice(m,0,g),!0}function Hr(r,u,l,d,a){const p=Ie(r,u),g=Ie(r,d);if(!p||!g)return!1;const m=(p.subgroups||[]).findIndex(E=>E.id===l),h=(g.subgroups||[]).findIndex(E=>E.id===a);if(m<0||h<0)return!1;if(u!==d&&p.subgroups.length<=1)throw new Error("В исходной группе должна остаться минимум одна подгруппа.");const[_]=p.subgroups.splice(m,1);if(u===d){const E=m<h?h-1:h;return p.subgroups.splice(E,0,_),!0}return g.subgroups.splice(h,0,_),!0}function Vr(r,u,l,d,a,p,g){const m=me(r,u,l),h=me(r,a,p);if(!m||!h)return!1;const _=(m.items||[]).findIndex($=>$.id===d),E=(h.items||[]).findIndex($=>$.id===g);if(_<0||E<0)return!1;if(l!==p&&m.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[w]=m.items.splice(_,1);if(l===p){const $=_<E?E-1:E;return m.items.splice($,0,w),!0}return h.items.splice(E,0,w),!0}function Fr(r,u,l,d,a,p){const g=me(r,u,l),m=me(r,a,p);if(!g||!m)return!1;const h=(g.items||[]).findIndex(E=>E.id===d);if(h<0)return!1;if(l!==p&&g.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[_]=g.items.splice(h,1);return m.items.push(_),!0}function da(r){const u=String(r||"").trim();if(!u)throw new Error("URL не может быть пустым");const l=/^https?:\/\//i.test(u)?u:`https://${u}`;let d;try{d=new URL(l)}catch{throw new Error(`Некорректный URL: ${u}`)}if(!["http:","https:"].includes(d.protocol))throw new Error(`Разрешены только http/https URL: ${u}`);return d.toString()}function fa(r){const u=String(r||"").trim();if(!u)return"";const l=/^https?:\/\//i.test(u)?u:`https://${u}`;try{const d=new URL(l);return["http:","https:"].includes(d.protocol)?d.origin:""}catch{return""}}let wt=null;function se(){if(wt)return wt;const r="/static/img/emblem-mark.png",u=3e4,l=16e3,d=9e3,a=700,p=1e4,g="lan",m=new Set(["stat_list","table"]),h="https://example.com",_="sidebar-particles",E="hero-title-particles",w="hero-controls-particles",$={fps_limit:58,particles:{number:{value:88,density:{enable:!0,value_area:700}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.36,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:120,color:"#2dd4bf",opacity:.24,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},U={fps_limit:58,particles:{number:{value:92,density:{enable:!0,value_area:720}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.4,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:132,color:"#2dd4bf",opacity:.26,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},O=Object.freeze([{value:"detailed",label:"Карточки"},{value:"tile",label:"Плитка"},{value:"icon",label:"Значки"}]),J=Object.freeze([{value:"groups",label:"Только группы"},{value:"tags_in_groups",label:"Группы + теги"},{value:"tags",label:"Только теги"},{value:"flat",label:"Без групп (плитка)"}]),A=["detailed","hidden"],H=18,Y=10,B="oko:dashboard-ui-state:v1",R=new Set(O.map(e=>e.value)),Ce=new Set(J.map(e=>e.value));function Se(){if(typeof window>"u"||!window.localStorage)return null;try{const e=window.localStorage.getItem(B);if(!e)return null;const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}function Te(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(B,JSON.stringify(e))}catch{}}function ne(){return{id:"",title:"",type:"link",url:h,icon:"",siteInput:"",tagsInput:"",open:"new_tab",healthcheckEnabled:!1,healthcheckUrl:"",healthcheckIntervalSec:30,healthcheckTimeoutMs:1500,iframeSandboxMode:"default",iframeAllowInput:"",iframeReferrerPolicy:"",authProfile:""}}const k=N(null),z=N(!0),pe=N(""),ee=N(""),ae=N(""),ve=N(!1),V=N(""),D=N(!1),$e=N(typeof document>"u"?!0:document.visibilityState!=="hidden"),ge=N("detailed"),_e=N("groups"),le=N("all"),M=N("detailed"),Q=N("idle"),F=N(""),Ke=N(null),qt=N(!1),kt=N(!1),nt=N(""),Et=N(!1),rt=N(""),ue=N(0),Be=ye({open:!1}),ot=ye({open:!1,host:null}),Pe=ye({}),Ct=ye({}),Tt=new Map;let it=0,Ge=0,st=0,$t=!1,Wt=!1,Le=0;const I=ye({groupKey:"",subgroupId:"",itemId:""}),oe=ye({}),at=ye({}),P=ye({type:"",groupId:"",subgroupId:"",itemId:""}),lt=ye({}),ce=Se();if(ce){const e=String(ce.serviceCardView||"");R.has(e)&&(ge.value=e);const t=String(ce.serviceGroupingMode||"");Ce.has(t)&&(_e.value=t);const n=String(ce.sidebarView||"");A.includes(n)&&(M.value=n);const o=String(ce.siteFilter||"").trim().toLowerCase();le.value=o||"all",ee.value=String(ce.activePageId||""),ae.value=String(ce.treeFilter||""),V.value=String(ce.activeIndicatorViewId||""),ve.value=!!ce.statsExpanded,D.value=!!ce.editMode,Be.open=!!ce.settingsPanelOpen;const i=ce.selectedNode;i&&typeof i=="object"&&(I.groupKey=String(i.groupKey||""),I.subgroupId=String(i.subgroupId||""),I.itemId=String(i.itemId||""));const c=ce.expandedGroups;if(c&&typeof c=="object")for(const[y,S]of Object.entries(c)){const K=String(y||"");K&&(oe[K]=!!S)}}const X=ye({open:!1,title:"",src:"",allow:"",sandbox:!1,referrerPolicy:"",loading:!1,error:""}),T=ye({open:!1,mode:"create",groupId:"",subgroupId:"",originalItemId:"",submitting:!1,error:"",form:ne()}),xe=C(()=>{var t,n;if(!k.value)return[];const e=((n=(t=k.value)==null?void 0:t.layout)==null?void 0:n.pages)||[];return e.some(o=>o.id===g)?e:[...e,{id:g,title:"LAN",icon:"network",blocks:[]}]}),Jt=C(()=>{var e;return((e=k.value)==null?void 0:e.widgets)||[]}),Mn=C(()=>{var e,t;return((t=(e=k.value)==null?void 0:e.security)==null?void 0:t.auth_profiles)||[]}),so=C(()=>{var e,t;return((t=(e=k.value)==null?void 0:e.app)==null?void 0:t.title)||"Oko"}),ao=C(()=>{var e,t;return((t=(e=k.value)==null?void 0:e.app)==null?void 0:t.tagline)||"Your Infrastructure in Sight"}),lo=C(()=>O),uo=C(()=>J),Dn=C(()=>ge.value==="icon"),Rn=C(()=>ge.value==="tile"),On=C(()=>Dn.value||Rn.value),Yt=C(()=>M.value!=="hidden"),Pt=C(()=>M.value==="hidden"),co=C(()=>!1),fo=C(()=>Yt.value?"Режим меню: полное. Нажмите, чтобы скрыть меню":"Режим меню: скрыто. Нажмите, чтобы вернуть полное меню"),Bn=C(()=>{var e,t;return((t=(e=Ke.value)==null?void 0:e.result)==null?void 0:t.hosts)||[]}),po=C(()=>{var t,n;const e=((n=(t=Ke.value)==null?void 0:t.result)==null?void 0:n.scanned_cidrs)||[];return e.length?e.join(", "):"нет данных"}),go=C(()=>Q.value==="saving"?"Сохранение...":Q.value==="saved"?"Сохранено":Q.value==="error"?"Ошибка сохранения":D.value?"Готово":"Сохранение выключено"),Lt=C(()=>{var n;const e=new Map;for(const o of((n=k.value)==null?void 0:n.groups)||[])for(const i of o.subgroups||[])for(const c of i.items||[]){const y=pt(c,o);if(!y)continue;const S=y.toLowerCase();e.has(S)||e.set(S,y)}const t=Array.from(e.entries()).sort((o,i)=>o[1].localeCompare(i[1],"ru",{sensitivity:"base"}));return[{value:"all",label:"Все sites"},...t.map(([o,i])=>({value:o,label:i}))]}),xt=C(()=>{const e=new Map;for(const t of Jt.value)e.set(t.id,t);return e}),Qt=C(()=>{var t;const e=new Map;for(const n of((t=k.value)==null?void 0:t.groups)||[])e.set(n.id,n);return e}),Gn=C(()=>{var t;const e=new Map;for(const n of((t=k.value)==null?void 0:t.groups)||[])for(const o of n.subgroups||[])e.set(o.id,{group:n,subgroup:o});return e}),mo=C(()=>{const e=new Map;for(const t of xe.value)for(const n of t.blocks||[])if((n==null?void 0:n.type)==="groups")for(const o of n.group_ids||[])e.has(o)||e.set(o,t.id);return e}),Nn=C(()=>{const e=new Map;for(const t of Bn.value||[]){const n=String((t==null?void 0:t.ip)||"").trim();if(n)for(const o of(t==null?void 0:t.dashboard_items)||[]){const i=String((o==null?void 0:o.id)||"").trim();i&&!e.has(i)&&e.set(i,n)}}return e}),vo=C(()=>{var n;const e=[],t=mo.value;e.push({id:"action:open-settings-panel",type:"action",action:"open_settings_panel",item:null,title:"Открыть панель настроек",titleLower:"открыть панель настроек",host:"",ip:"",site:"",tagsLower:[],groupId:"",groupKey:"",groupTitle:"Команда",subgroupId:"",subgroupTitle:"Интерфейс",pageId:"",searchBlob:"открыть панель настроек settings ui интерфейс control panel параметры фильтры"});for(const o of((n=k.value)==null?void 0:n.groups)||[])for(const i of o.subgroups||[])for(const c of i.items||[]){const y=Jo(c==null?void 0:c.url),S=Nn.value.get(c.id)||"",K=(c.tags||[]).map(ke=>String(ke||"").trim()).filter(Boolean),re=pt(c,o);if(le.value!=="all"&&re.toLowerCase()!==le.value)continue;const Ne=t.get(o.id)||t.get(i.id)||"",De=String(c.title||"").trim(),Ye=[De,String(c.id||""),String(c.url||""),y,S,re,String(o.title||""),String(i.title||""),...K].join(" ").toLowerCase();e.push({id:c.id,type:"item",action:"",item:c,title:De,titleLower:De.toLowerCase(),host:y.toLowerCase(),ip:S.toLowerCase(),site:re.toLowerCase(),tagsLower:K.map(ke=>ke.toLowerCase()),groupId:o.id,groupKey:`group:${o.id}`,groupTitle:String(o.title||""),subgroupId:i.id,subgroupTitle:String(i.title||""),pageId:Ne,searchBlob:Ye})}return e}),ut=C(()=>{const e=String(rt.value||"").trim().toLowerCase(),t=vo.value;if(!e){const i=t.filter(y=>y.type==="action"),c=t.filter(y=>y.type!=="action").slice().sort((y,S)=>y.title.localeCompare(S.title,"ru",{sensitivity:"base"}));return[...i,...c].slice(0,Y)}const n=e.split(/\s+/).filter(Boolean),o=[];for(const i of t){let c=0,y=!0;for(const S of n){if(!i.searchBlob.includes(S)){y=!1;break}i.titleLower.startsWith(S)?c+=12:i.titleLower.includes(S)&&(c+=8),i.host.startsWith(S)?c+=7:i.host.includes(S)&&(c+=4),i.ip===S?c+=14:i.ip.includes(S)&&(c+=6),i.site&&i.site.includes(S)&&(c+=5),i.tagsLower.some(K=>K.includes(S))&&(c+=3)}y&&o.push({entry:i,score:c})}return o.sort((i,c)=>c.score!==i.score?c.score-i.score:i.entry.title.localeCompare(c.entry.title,"ru",{sensitivity:"base"})),o.slice(0,H).map(i=>i.entry)}),Hn=C(()=>ut.value[ue.value]||null),Ae=C(()=>xe.value.find(e=>e.id===ee.value)||xe.value[0]||null),Zt=C(()=>{var e;return((e=Ae.value)==null?void 0:e.id)===g}),Ue=C(()=>{if(!Ae.value)return[];const e=[];for(const t of Ae.value.blocks||[])(t==null?void 0:t.type)==="groups"&&e.push(...t.group_ids||[]);return rn(e)}),Vn=C(()=>{const e=tr(Ue.value),t=ae.value.trim().toLowerCase();return t?e.map(n=>{if(String(n.title||"").toLowerCase().includes(t)||String(n.description||"").toLowerCase().includes(t))return{...n,subgroups:n.subgroups||[]};const i=(n.subgroups||[]).map(c=>{if(String(c.title||"").toLowerCase().includes(t))return{...c,items:c.items||[]};const S=(c.items||[]).filter(K=>{const re=String(K.title||"").toLowerCase().includes(t),Ne=String(K.url||"").toLowerCase().includes(t),De=(K.tags||[]).some(ke=>String(ke).toLowerCase().includes(t)),Ye=pt(K,n).toLowerCase().includes(t);return re||Ne||De||Ye});return S.length?{...c,items:S}:null}).filter(Boolean);return i.length?{...n,subgroups:i}:null}).filter(Boolean):e}),yo=C(()=>{const e=[];for(const t of Vn.value){e.push({key:`group:${t.key}`,type:"group",groupKey:t.key,group:t});for(const n of t.subgroups||[])e.push({key:`subgroup:${t.key}:${n.id}`,type:"subgroup",groupKey:t.key,subgroupId:n.id,subgroup:n})}return e}),ct=C(()=>{const e=[];for(const t of Ue.value)for(const n of t.subgroups||[])for(const o of n.items||[])e.push(o.id);return e}),bo=C(()=>{var n;const e=ct.value;let t=0;for(const o of e)(n=We(o))!=null&&n.ok&&(t+=1);return{online:t,total:e.length}}),At=C(()=>{if(!Ae.value)return[];const e=[];for(const t of Ae.value.blocks||[])Qn(t)&&e.push(...t.widgets||[]);return Array.from(new Set(e))}),Mt=C(()=>Zn(At.value)),ho=C(()=>{const e=Mt.value.length;if(!e)return"нет данных";const t=Mt.value.filter(n=>dt(n)).length;return`${e} · больших ${t}`}),Io=C(()=>{var e;return(((e=Ae.value)==null?void 0:e.blocks)||[]).filter(t=>(t==null?void 0:t.type)==="groups")}),Fn=C(()=>{const e=xt.value.get(V.value);return!e||!dt(e)?null:At.value.includes(e.id)?e:null});function Kn(e){if(!e)return;const t=document.documentElement;e.accent&&(t.style.setProperty("--accent",e.accent),t.style.setProperty("--accent-soft",e.accent)),e.background&&t.style.setProperty("--bg",e.background),e.border&&t.style.setProperty("--border",e.border),e.card&&(t.style.setProperty("--surface",e.card),t.style.setProperty("--surface-strong",e.card)),t.style.setProperty("--glow-enabled",e.glow===!1?"0":"1")}function Un(e){if(!e)return;const t=document.documentElement;e.gap!=null&&t.style.setProperty("--grid-gap",`${Number(e.gap)}px`),e.card_radius!=null&&t.style.setProperty("--card-radius",`${Number(e.card_radius)}px`),e.columns!=null&&t.style.setProperty("--layout-columns",String(Number(e.columns)))}function wo(){D.value=!D.value,F.value="",D.value||je()}function So(){if(ge.value==="detailed"){ge.value="tile";return}if(ge.value==="tile"){ge.value="icon";return}ge.value="detailed"}function _o(){M.value!=="detailed"&&M.value!=="hidden"&&(M.value="detailed");const e=A.indexOf(M.value),n=((e>=0?e:0)+1)%A.length;M.value=A[n],Yt.value||(ae.value="",Dt()),Pt.value&&(_e.value="flat")}function ko(e){return e?e.type==="group"?ar(e.groupKey):e.type==="subgroup"?lr(e.groupKey,e.subgroupId):!1:!1}function Eo(e){var t,n;return e?e.type==="group"?`Группа: ${((t=e.group)==null?void 0:t.title)||""}`:e.type==="subgroup"?`Подгруппа: ${((n=e.subgroup)==null?void 0:n.title)||""}`:"":""}function Co(e){if(e){if(e.type==="group"){oe[e.groupKey]=!0,I.groupKey=e.groupKey,I.subgroupId="",I.itemId="";return}e.type==="subgroup"&&ir(e.groupKey,e.subgroupId)}}function To(e,t,n){if(!On.value)return;const o=(n==null?void 0:n.__originGroupKey)||e,i=(n==null?void 0:n.__originSubgroupId)||t;on(o,i,n.id),pn(n)}function jn(e){return JSON.parse(JSON.stringify(e))}function Xt(e){return da(e)}async function zn(){var e;if(k.value){Q.value="saving",F.value="";try{const t=await Xs(k.value);k.value=t.config,(!ee.value||!xe.value.some(n=>n.id===ee.value))&&(ee.value=((e=xe.value[0])==null?void 0:e.id)||""),Q.value="saved",Ge&&clearTimeout(Ge),Ge=window.setTimeout(()=>{Q.value==="saved"&&(Q.value="idle")},1400)}catch(t){throw Q.value="error",F.value=(t==null?void 0:t.message)||"Ошибка сохранения YAML",t}}}async function de(e){if(!k.value)return!1;const t=jn(k.value);try{return e(k.value)===!1?!1:(Br(k.value),ft(),await zn(),!0)}catch(n){return k.value=t,Q.value="error",F.value=(n==null?void 0:n.message)||"Не удалось применить изменения",!1}}function en(e,t){return{id:e,type:"link",title:t,url:h,icon:null,site:null,tags:[],open:"new_tab"}}async function $o(){if(!D.value||!k.value)return;const e=window.prompt("Название новой группы","Новая группа");if(e==null)return;const t=e.trim();t&&await de(n=>{const o=new Set((n.groups||[]).map(re=>re.id)),i=zt(n),c=Ht(n),y=He(t,o),S=He(`${y}-core`,i),K=He(`${y}-service`,c);n.groups.push({id:y,title:t,icon:"folder",description:"",layout:"auto",subgroups:[{id:S,title:"Core",items:[en(K,"Новый сервис")]}]}),Gr(n,ee.value,y),oe[`group:${y}`]=!0,I.groupKey=`group:${y}`,I.subgroupId=S,I.itemId=K})}async function Po(e){if(!D.value||!k.value)return;const t=window.prompt("Название подгруппы","Новая подгруппа");if(t==null)return;const n=t.trim();n&&await de(o=>{const i=Ie(o,e);if(!i)throw new Error(`Группа '${e}' не найдена`);const c=zt(o),y=Ht(o),S=He(`${e}-${n}`,c),K=He(`${S}-service`,y);i.subgroups.push({id:S,title:n,items:[en(K,"Новый сервис")]}),oe[`group:${e}`]=!0,I.groupKey=`group:${e}`,I.subgroupId=S,I.itemId=K})}async function Lo(e,t){!D.value||!k.value||Wn(e,t)}function tn(e){return String(e||"").split(",").map(t=>t.trim()).filter(Boolean)}function nn(e,t,n,o){const i=Number(e);if(!Number.isFinite(i))return t;const c=Math.trunc(i);return Math.min(o,Math.max(n,c))}function qn(e=!1){T.submitting&&!e||(T.open=!1,T.mode="create",T.groupId="",T.subgroupId="",T.originalItemId="",T.error="",T.submitting=!1,T.form=ne())}function Wn(e,t){if(!me(k.value,e,t)){Q.value="error",F.value=`Подгруппа '${t}' не найдена`;return}T.open=!0,T.mode="create",T.groupId=e,T.subgroupId=t,T.originalItemId="",T.error="",T.submitting=!1,T.form=ne()}function Jn(e,t,n){var c,y,S;const o=me(k.value,e,t),i=((o==null?void 0:o.items)||[]).find(K=>K.id===n);if(!o||!i){Q.value="error",F.value=`Элемент '${n}' не найден`;return}T.open=!0,T.mode="edit",T.groupId=e,T.subgroupId=t,T.originalItemId=n,T.error="",T.submitting=!1,T.form={id:i.id,title:i.title,type:i.type,url:String(i.url||h),icon:i.icon||"",siteInput:String(i.site||""),tagsInput:(i.tags||[]).join(", "),open:i.open||"new_tab",healthcheckEnabled:!!(i.type==="link"&&i.healthcheck),healthcheckUrl:i.type==="link"&&i.healthcheck?String(i.healthcheck.url):String(i.url||h),healthcheckIntervalSec:i.type==="link"&&i.healthcheck?Number(i.healthcheck.interval_sec||30):30,healthcheckTimeoutMs:i.type==="link"&&i.healthcheck?Number(i.healthcheck.timeout_ms||1500):1500,iframeSandboxMode:i.type==="iframe"?((c=i.iframe)==null?void 0:c.sandbox)==null?"default":i.iframe.sandbox?"enabled":"disabled":"default",iframeAllowInput:i.type==="iframe"?(((y=i.iframe)==null?void 0:y.allow)||[]).join(", "):"",iframeReferrerPolicy:i.type==="iframe"&&((S=i.iframe)==null?void 0:S.referrer_policy)||"",authProfile:i.type==="iframe"&&i.auth_profile||""}}function Yn(e){const t=T.form,n=String(t.title||"").trim();if(!n)throw new Error("Название сервиса обязательно");const o=String(t.type||"").trim().toLowerCase();if(!["link","iframe"].includes(o))throw new Error("Тип сервиса должен быть 'link' или 'iframe'");const i=String(t.open||"new_tab");if(!["new_tab","same_tab"].includes(i))throw new Error("Параметр open должен быть 'new_tab' или 'same_tab'");const c=Xt(t.url||h),y=Ht(e);T.mode==="edit"&&y.delete(T.originalItemId);const S=String(t.id||"").trim(),K=`${T.subgroupId}-${n}`,re=_t(S||K,"service"),Ne=S?re:He(re,y);if(S&&y.has(Ne))throw new Error(`ID '${Ne}' уже существует`);const De={id:Ne,type:o,title:n,url:c,icon:String(t.icon||"").trim()||null,site:String(t.siteInput||"").trim()||null,tags:tn(t.tagsInput),open:i};if(o==="link"){const Nt={...De};if(t.healthcheckEnabled){const rs=Xt(t.healthcheckUrl||c);Nt.healthcheck={type:"http",url:rs,interval_sec:nn(t.healthcheckIntervalSec,30,1,3600),timeout_ms:nn(t.healthcheckTimeoutMs,1500,100,12e4)}}return Nt}const Ye=String(t.iframeSandboxMode||"default");let ke=null;Ye==="enabled"&&(ke=!0),Ye==="disabled"&&(ke=!1);const bt=String(t.authProfile||"").trim();if(bt&&!Mn.value.some(Nt=>Nt.id===bt))throw new Error(`Auth profile '${bt}' не найден`);const Sr={...De,iframe:{sandbox:ke,allow:tn(t.iframeAllowInput),referrer_policy:String(t.iframeReferrerPolicy||"").trim()||null}};return bt&&(Sr.auth_profile=bt),Sr}async function xo(){if(!T.open||T.submitting||!k.value)return;T.submitting=!0,T.error="";const e=await de(t=>{const n=me(t,T.groupId,T.subgroupId);if(!n)throw new Error(`Подгруппа '${T.subgroupId}' не найдена`);const o=Yn(t);if(T.mode==="create")return n.items.push(o),I.groupKey=`group:${T.groupId}`,I.subgroupId=T.subgroupId,I.itemId=o.id,!0;const i=(n.items||[]).findIndex(c=>c.id===T.originalItemId);if(i<0)throw new Error(`Элемент '${T.originalItemId}' не найден`);return n.items.splice(i,1,o),I.groupKey=`group:${T.groupId}`,I.subgroupId=T.subgroupId,(I.itemId===T.originalItemId||!I.itemId)&&(I.itemId=o.id),!0});T.submitting=!1,e?qn(!0):T.error=F.value||"Не удалось сохранить сервис"}async function Ao(e){if(!D.value||!k.value)return;const t=Ie(k.value,e);if(!t)return;const n=window.prompt("Название группы",t.title);if(n==null)return;const o=window.prompt("Описание группы",t.description||"");if(o==null)return;const i=window.prompt("Режим группы (auto | full | inline)",t.layout||"auto");i!=null&&await de(c=>{const y=Ie(c,e);if(!y)throw new Error(`Группа '${e}' не найдена`);const S=String(i||"").trim().toLowerCase()||"auto";if(!["auto","full","inline"].includes(S))throw new Error("Режим группы должен быть 'auto', 'full' или 'inline'");y.title=n.trim()||y.title,y.description=o.trim(),y.layout=S})}async function Mo(e,t){if(!D.value||!k.value)return;const n=me(k.value,e,t);if(!n)return;const o=window.prompt("Название подгруппы",n.title);o!=null&&await de(i=>{const c=me(i,e,t);if(!c)throw new Error(`Подгруппа '${t}' не найдена`);c.title=o.trim()||c.title})}async function Do(e,t,n){!D.value||!k.value||Jn(e,t,n)}async function Ro(e){if(!D.value||!k.value)return;const t=Ie(k.value,e);if(t){if(k.value.groups.length<=1){Q.value="error",F.value="Нельзя удалить последнюю группу.";return}window.confirm(`Удалить группу "${t.title}"?`)&&await de(n=>{const o=(n.groups||[]).findIndex(i=>i.id===e);if(o<0)return!1;n.groups.splice(o,1),I.groupKey="",I.subgroupId="",I.itemId=""})}}async function Oo(e,t){if(!D.value||!k.value)return;const n=Ie(k.value,e),o=((n==null?void 0:n.subgroups)||[]).find(i=>i.id===t);if(!(!n||!o)){if(n.subgroups.length<=1){Q.value="error",F.value="В группе должна остаться хотя бы одна подгруппа.";return}window.confirm(`Удалить подгруппу "${o.title}"?`)&&await de(i=>{const c=Ie(i,e);if(!c)return!1;const y=(c.subgroups||[]).findIndex(S=>S.id===t);if(y<0)return!1;c.subgroups.splice(y,1),I.subgroupId="",I.itemId=""})}}async function Bo(e,t,n){if(!D.value||!k.value)return;const o=me(k.value,e,t),i=((o==null?void 0:o.items)||[]).find(c=>c.id===n);if(!(!o||!i)){if(o.items.length<=1){Q.value="error",F.value="В подгруппе должен остаться хотя бы один элемент.";return}window.confirm(`Удалить сервис "${i.title}"?`)&&await de(c=>{const y=me(c,e,t);if(!y)return!1;const S=(y.items||[]).findIndex(K=>K.id===n);if(S<0)return!1;y.items.splice(S,1),I.itemId===n&&(I.itemId="")})}}function je(){P.type="",P.groupId="",P.subgroupId="",P.itemId=""}function Go(e,t){if(!D.value||!Vt(t))return;const n=t.id;P.type="group",P.groupId=n,P.subgroupId="",P.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`group:${n}`))}function No(e,t,n){D.value&&(P.type="subgroup",P.groupId=t,P.subgroupId=n,P.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`subgroup:${n}`)))}function Ho(e,t,n,o){D.value&&(P.type="item",P.groupId=t,P.subgroupId=n,P.itemId=o,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`item:${o}`)))}function Vo(e,t){if(!D.value||!Vt(t))return;const n=t.id;P.type==="group"&&P.groupId!==n&&e.preventDefault()}async function Fo(e,t){if(!D.value||!Vt(t))return;const n=t.id;if(P.type!=="group"||!P.groupId||P.groupId===n)return;e.preventDefault();const o=P.groupId;je(),await de(i=>Nr(i,o,n))}function Ko(e,t,n){if(D.value){if(P.type==="subgroup"){if(P.subgroupId===n)return;e.preventDefault();return}P.type==="item"&&e.preventDefault()}}async function Uo(e,t,n){if(D.value){if(P.type==="subgroup"){e.preventDefault();const o=P.groupId,i=P.subgroupId;je(),await de(c=>Hr(c,o,i,t,n));return}if(P.type==="item"){e.preventDefault();const o=P.groupId,i=P.subgroupId,c=P.itemId;je(),await de(y=>Fr(y,o,i,c,t,n))}}}function jo(e,t,n,o){D.value&&P.type==="item"&&P.itemId!==o&&e.preventDefault()}async function zo(e,t,n,o){if(!D.value||P.type!=="item"||!P.itemId||P.itemId===o)return;e.preventDefault();const i=P.groupId,c=P.subgroupId,y=P.itemId;je(),await de(S=>Vr(S,i,c,y,t,n,o))}function Qn(e){return(e==null?void 0:e.type)==="widget_row"||(e==null?void 0:e.type)==="widget_grid"}function Zn(e=[]){return e.map(t=>xt.value.get(t)).filter(Boolean)}function dt(e){return m.has(String((e==null?void 0:e.type)||""))}function qo(e){return fr(e).slice(0,2)}function Xn(e){const t=Mt.value.find(n=>n.id===e);!t||!dt(t)||(V.value=t.id)}function Wo(e){dt(e)&&Xn(e.id)}function rn(e=[]){const t=[];for(const n of e){const o=Qt.value.get(n);if(o){t.push({key:`group:${o.id}`,id:o.id,title:o.title,icon:o.icon||null,description:o.description||"",layout:o.layout||"auto",subgroups:o.subgroups||[]});continue}const i=Gn.value.get(n);i&&t.push({key:`subgroup:${i.subgroup.id}`,id:i.group.id,title:i.group.title,icon:i.group.icon||null,description:i.group.description||"",layout:i.group.layout||"auto",subgroups:[i.subgroup]})}return t}function ft(){const e=new Set(Ue.value.map(t=>t.key));for(const t of Object.keys(oe))e.has(t)||delete oe[t];for(const t of Ue.value)oe[t.key]==null&&(oe[t.key]=!0);I.groupKey&&!e.has(I.groupKey)&&Dt()}function Dt(){I.groupKey="",I.subgroupId="",I.itemId=""}function Jo(e){try{return new URL(String(e||"")).hostname||""}catch{return""}}function Yo(e,t,n){const o=String((e==null?void 0:e.site)||"").trim();if(o)return o;const i=String((t==null?void 0:t.site)||"").trim();if(i)return i;const c=(n||[]).find(y=>String(y||"").toLowerCase().startsWith("site:"));return c?String(c).slice(5).trim():""}function er(e){return((e==null?void 0:e.tags)||[]).map(t=>String(t||"").trim()).filter(Boolean)}function Qo(e){const t=String(e||"");return t.startsWith("group:")&&Qt.value.get(t.slice(6))||null}function pt(e,t=null){return Yo(e,t,er(e))}function Zo(e,t=""){const n=Qo((e==null?void 0:e.__originGroupKey)||t);return pt(e,n)}function tr(e=[]){return le.value==="all"?e:e.map(t=>{const n=(t.subgroups||[]).map(o=>({...o,items:(o.items||[]).filter(i=>pt(i,t).toLowerCase()===le.value)})).filter(o=>o.items.length>0);return n.length?{...t,subgroups:n}:null}).filter(Boolean)}function Xo(e){const t=String(e||"all").trim().toLowerCase(),n=new Set(Lt.value.map(o=>o.value));le.value=n.has(t)?t:"all"}function nr(){rt.value="",ue.value=0,Et.value=!0}function Rt(){Et.value=!1,rt.value="",ue.value=0}function ei(){if(Et.value){Rt();return}nr()}function rr(){Be.open=!0}function ti(){Be.open=!1}function ni(){Be.open=!Be.open}function ri(e){rt.value=String(e||""),ue.value=0}function oi(e){const t=ut.value.length-1;if(t<0){ue.value=0;return}ue.value=Math.min(Math.max(e,0),t)}function ii(e){const t=ut.value.length;if(!t){ue.value=0;return}const o=(ue.value+e+t)%t;ue.value=o}function si(e){e&&(e.pageId&&(ee.value=e.pageId),on(e.groupKey,e.subgroupId,e.item.id))}function or(e){if(e){if(e.type==="action"&&e.action==="open_settings_panel"){Rt(),rr();return}si(e),pn(e.item),Rt()}}function ai(){or(Hn.value)}async function li(e){var t;(e==null?void 0:e.type)!=="item"||!((t=e==null?void 0:e.item)!=null&&t.url)||await yr(e.item.url)}function ui(e){oe[e]=!sr(e),I.groupKey=e,I.subgroupId="",I.itemId=""}function ir(e,t){oe[e]=!0,I.groupKey=e,I.subgroupId=t,I.itemId=""}function on(e,t,n){oe[e]=!0,I.groupKey=e,I.subgroupId=t,I.itemId=n}function sr(e){return!!oe[e]}function ar(e){return I.groupKey===e&&!I.subgroupId&&!I.itemId}function lr(e,t){return I.groupKey===e&&I.subgroupId===t&&!I.itemId}function ci(e){return I.itemId===e}function di(e=[]){const t=rn(e),n=tr(t),o=Pt.value?n:gi(n),i=yi(o),c=i.length;return i.map(y=>({...y,__visibleCount:c}))}function fi(){return!!(I.groupKey||I.subgroupId||I.itemId)}function pi(e){return String(e||"").trim()||"Без тега"}function ur(e){const t=new Set(er(e).map(n=>pi(n)).filter(Boolean));return t.size||t.add("Без тега"),Array.from(t)}function sn(e,t,n){return{...e,__originGroupKey:t,__originSubgroupId:n}}function gi(e=[]){return fi()?e.map(t=>{if(I.groupKey&&t.key!==I.groupKey)return null;let n=t.subgroups||[];return I.subgroupId&&(n=n.filter(o=>o.id===I.subgroupId)),I.itemId&&(n=n.map(o=>({...o,items:(o.items||[]).filter(i=>i.id===I.itemId)})).filter(o=>o.items.length>0)),n.length?{...t,subgroups:n}:null}).filter(Boolean):e}function mi(e=[]){return e.map(t=>{const n=new Map;for(const c of t.subgroups||[])for(const y of c.items||[])for(const S of ur(y))n.has(S)||n.set(S,[]),n.get(S).push(sn(y,t.key,c.id));const i=Array.from(n.entries()).sort(([c],[y])=>c.localeCompare(y,"ru",{sensitivity:"base"})).map(([c,y])=>({id:`tag-${_t(`${t.id}-${c}`,"tag")}`,title:`#${c}`,icon:"tag",items:y}));return i.length?{...t,subgroups:i}:null}).filter(Boolean)}function vi(e=[]){const t=new Map;for(const o of e)for(const i of o.subgroups||[])for(const c of i.items||[])for(const y of ur(c))t.has(y)||t.set(y,[]),t.get(y).push(sn(c,o.key,i.id));return Array.from(t.entries()).sort(([o],[i])=>o.localeCompare(i,"ru",{sensitivity:"base"})).map(([o,i])=>{const c=_t(o,"tag");return{key:`tags:${c}`,id:`tags-${c}`,title:`#${o}`,icon:"tag",description:"Сервисы, сгруппированные только по тегам.",layout:"inline",subgroups:[{id:`tags-${c}-items`,title:"Сервисы",items:i}]}})}function cr(e=[]){const t=[];for(const n of e)for(const o of n.subgroups||[])for(const i of o.items||[])t.push(sn(i,n.key,o.id));return t.length?[{key:"flat:all",id:"flat-all",title:"Все сервисы",icon:"layout-grid",description:"Плоское отображение без группировки.",layout:"full",subgroups:[{id:"flat-all-items",title:"Плитка",items:t}]}]:[]}function yi(e=[]){return Pt.value?cr(e):_e.value==="tags_in_groups"?mi(e):_e.value==="tags"?vi(e):_e.value==="flat"?cr(e):e}function bi(e){const t=String((e==null?void 0:e.layout)||"auto").toLowerCase();return t==="inline"?!0:t==="full"?!1:Number((e==null?void 0:e.__visibleCount)||0)>1}function hi(e){return(e.subgroups||[]).reduce((t,n)=>t+(n.items||[]).length,0)}function Ii(e){return((e==null?void 0:e.items)||[]).length}function wi(e){var n;let t=0;for(const o of e.subgroups||[])for(const i of o.items||[])(n=We(i.id))!=null&&n.ok&&(t+=1);return t}function dr(){for(const e of Object.keys(lt))delete lt[e]}function an(e){return fa(e)}function ln(e){const t=an(e==null?void 0:e.url);return t?`${String((e==null?void 0:e.id)||"")}|${t}`:""}function Si(e){const t=an(e==null?void 0:e.url);if(!t)return"";const n=ln(e);return n&&lt[n]?"":`${t}/favicon.ico`}function _i(e){const t=ln(e);t&&(lt[t]=!0)}function ki(e){return sa(e)}function Ei(e){return aa(e)}function Ci(e){return la(e)}function Ti(e){return ua(e)}function $i(e){return ca(e)}function ze(e){return Pe[e]||null}function un(e,t){return`${e}:${t}`}function Pi(e,t){return!!Ct[un(e,t)]}function Me(e,t){if(!t||typeof t!="string")return null;if(t==="$")return e;if(!t.startsWith("$."))return null;let n=e;const o=t.slice(2).split(".");for(const i of o){if(n==null)return null;const c=i.match(/^(.*)\[\*\]$/);if(c){const y=c[1],S=y?n==null?void 0:n[y]:n;return Array.isArray(S)?S:[]}n=n==null?void 0:n[i]}return n}function Li(e){var o,i,c;const t=(o=ze(e.id))==null?void 0:o.payload;return Me(t,(c=(i=e.data)==null?void 0:i.mapping)==null?void 0:c.value)??"—"}function xi(e){var o,i,c;const t=(o=ze(e.id))==null?void 0:o.payload;return Me(t,(c=(i=e.data)==null?void 0:i.mapping)==null?void 0:c.subtitle)??""}function Ai(e){var o,i,c;const t=(o=ze(e.id))==null?void 0:o.payload;return Me(t,(c=(i=e.data)==null?void 0:i.mapping)==null?void 0:c.trend)??""}function fr(e){var i,c;const t=(i=ze(e.id))==null?void 0:i.payload,n=((c=e.data)==null?void 0:c.mapping)||{},o=Me(t,n.items);return Array.isArray(o)?o.map(y=>{const S=Me(y,n.item_title)??"-",K=Me(y,n.item_value)??"-";return{title:S,value:K}}):[]}function Mi(e){var i,c,y;const t=(i=ze(e.id))==null?void 0:i.payload,n=(y=(c=e.data)==null?void 0:c.mapping)==null?void 0:y.rows,o=Me(t,n);return Array.isArray(o)?o:Array.isArray(t)?t:Array.isArray(t==null?void 0:t.items)?t.items:[]}function Ot(e){return e?e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/")?e:`/${e}`:""}function gt(){for(const e of Tt.values())clearInterval(e);Tt.clear()}function qe(){it&&(clearTimeout(it),it=0)}function We(e){return at[e]||null}function Di(e){return!!(e!=null&&e.ok&&e.latency_ms!=null&&e.latency_ms>=a)}function cn(e){if(!e)return"unknown";const t=String(e.level||"").toLowerCase();return["online","degraded","down","unknown","indirect_failure"].includes(t)?t:Di(e)?"degraded":e.ok?"online":"down"}function Ri(e){const t=We(e),n=cn(t);return n==="online"?"ok":n==="degraded"?"degraded":n==="down"||n==="indirect_failure"?"down":"unknown"}function Oi(e){const t=We(e);if(!t)return"Проверка...";const n=cn(t);return n==="online"?t.latency_ms!=null?`Online • ${t.latency_ms} ms`:"Online":n==="degraded"?t.latency_ms!=null?`Degraded • ${t.latency_ms} ms`:t.status_code!=null?`Degraded • HTTP ${t.status_code}`:t.error?`Degraded • ${t.error}`:t.reason?`Degraded • ${String(t.reason).replaceAll("_"," ")}`:"Degraded":n==="indirect_failure"?"Indirect failure":n==="down"?t.error?`Offline • ${t.error}`:t.status_code!=null?`Offline • HTTP ${t.status_code}`:"Offline":"Unknown"}async function Je(e=null){if(!Array.isArray(e)&&!$e.value)return;const t=Array.isArray(e)&&e.length?e:ct.value,n=Array.from(new Set(t.map(o=>String(o||"").trim()).filter(Boolean)));if(n.length)try{const o=await Zs(n);for(const i of o.items||[])at[i.item_id]=i}catch{for(const o of n)at[o]||(at[o]={item_id:o,ok:!1,checked_url:"",status_code:null,latency_ms:null,error:"healthcheck unavailable"})}}async function dn(){qe(),await Je(),pr()}function Bi(){let e=!1,t=!1;for(const n of ct.value){const o=cn(We(n));if(o==="down"||o==="indirect_failure"){e=!0;break}o==="degraded"&&(t=!0)}return e?d:t?l:u}function pr(){if(qe(),!$e.value)return;const e=Bi();it=window.setTimeout(async()=>{await Je(),pr()},e)}async function Bt(e){var i;const t=xt.value.get(e);if(!t)return;const n=Ot((i=t.data)==null?void 0:i.endpoint);if(!n)return;Pe[e]||(Pe[e]={loading:!1,error:"",payload:null,lastUpdated:0});const o=Pe[e];o.loading=!0,o.error="";try{o.payload=await Oe(n),o.lastUpdated=Date.now()}catch(c){o.error=(c==null?void 0:c.message)||"Ошибка загрузки виджета"}finally{o.loading=!1}}async function fn(){var t,n;gt();const e=[];for(const o of Jt.value){if(e.push(Bt(o.id)),!Ot((t=o.data)==null?void 0:t.endpoint))continue;const i=Math.max(1,Number(((n=o.data)==null?void 0:n.refresh_sec)||0))*1e3,c=window.setInterval(()=>{Bt(o.id)},i);Tt.set(o.id,c)}await Promise.all(e)}async function Gi(e,t){const n=un(e,t.id),o=Ot(t.endpoint);if(o){Ct[n]=!0;try{await Oe(o,{method:String(t.method||"GET").toUpperCase()}),await Bt(e)}catch(i){Pe[e]||(Pe[e]={loading:!1,error:"",payload:null,lastUpdated:0}),Pe[e].error=(i==null?void 0:i.message)||"Не удалось выполнить действие"}finally{Ct[n]=!1}}}async function gr(){var e,t,n;z.value=!0,pe.value="",Q.value="idle",F.value="",dr();try{const o=await Ys();k.value=o,(!ee.value||!xe.value.some(i=>i.id===ee.value))&&(ee.value=((e=xe.value[0])==null?void 0:e.id)||""),ft(),Kn((t=o==null?void 0:o.ui)==null?void 0:t.theme),Un((n=o==null?void 0:o.ui)==null?void 0:n.grid),await fn(),await dn(),$e.value||br()}catch(o){pe.value=(o==null?void 0:o.message)||"Не удалось загрузить dashboard-конфигурацию",k.value=null,gt(),qe()}finally{z.value=!1}}async function mr(e){var o,i,c,y,S,K;const t=!!(((c=(i=(o=k.value)==null?void 0:o.security)==null?void 0:i.iframe)==null?void 0:c.default_sandbox)??!0),n=(y=e==null?void 0:e.iframe)==null?void 0:y.sandbox;X.open=!0,X.title=e.title,X.src="",X.error="",X.loading=!0,X.sandbox=n==null?t:!!n,X.allow=Array.isArray((S=e==null?void 0:e.iframe)==null?void 0:S.allow)?e.iframe.allow.join("; "):"",X.referrerPolicy=((K=e==null?void 0:e.iframe)==null?void 0:K.referrer_policy)||"";try{const re=await Qs(e.id);X.src=re.src}catch(re){X.error=(re==null?void 0:re.message)||"Не удалось подготовить iframe"}finally{X.loading=!1}}function Ni(){X.open=!1,X.title="",X.src="",X.error="",X.loading=!1,X.sandbox=!1,X.allow="",X.referrerPolicy=""}function vr(e){if(e.open==="same_tab"){window.location.assign(e.url);return}window.open(e.url,"_blank","noopener,noreferrer")}function Hi(e){e!=null&&e.url&&window.open(e.url,"_blank","noopener,noreferrer")}function pn(e){if(e.type==="iframe"){mr(e);return}vr(e)}function gn(e){return Nn.value.get(String(e||""))||""}async function mn(e){var n;const t=String(e||"");if(t&&(n=navigator.clipboard)!=null&&n.writeText)try{await navigator.clipboard.writeText(t)}catch{}}async function yr(e){await mn(e)}async function Vi(e){const t=gn(e);t&&await mn(t)}async function Fi(e){const t=gn(e);t&&await mn(`ssh ${t}`)}async function Ki(e){e&&await Je([e])}function Ui(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?"—":t.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function ji(e){const t=Number(e||0);return!Number.isFinite(t)||t<=0?"—":t<1e3?`${Math.round(t)} ms`:`${(t/1e3).toFixed(2)} s`}function zi(e){e&&(ot.host=e,ot.open=!0)}function vn(){ot.open=!1,ot.host=null}function qi(e){const t=(e==null?void 0:e.open_ports)||[];return t.length?t.map(n=>n!=null&&n.service?`${n.port} (${n.service})`:`${n.port}`).join(", "):"—"}function Wi(e){return e?e.error?e.error:e.status_code==null?"—":`HTTP ${e.status_code}`:"—"}async function mt({silent:e=!1}={}){if(!$t){$t=!0,e||(qt.value=!0);try{Ke.value=await ea(),nt.value=""}catch(t){nt.value=(t==null?void 0:t.message)||"Не удалось загрузить состояние сканера LAN"}finally{$t=!1,e||(qt.value=!1)}}}function vt(){st&&(window.clearInterval(st),st=0)}function yn(){vt(),st=window.setInterval(()=>{mt({silent:!0})},p)}function br(){qe(),vt(),gt()}async function Ji(){!k.value||z.value||(await fn(),await dn(),Zt.value&&(await mt({silent:!0}),yn()))}async function Yi(){if(!Wt){Wt=!0;try{$e.value?await Ji():br()}finally{Wt=!1}}}function hr(){$e.value=document.visibilityState!=="hidden",Yi()}async function Qi(){var e;if(!kt.value){kt.value=!0;try{const t=await ta();Ke.value=(t==null?void 0:t.state)||Ke.value,nt.value=t!=null&&t.accepted||(e=t==null?void 0:t.state)!=null&&e.queued?"":(t==null?void 0:t.message)||""}catch(t){nt.value=(t==null?void 0:t.message)||"Не удалось запустить сканирование LAN"}finally{kt.value=!1,mt({silent:!0})}}}function Zi(){var e,t;return((t=(e=document.documentElement)==null?void 0:e.dataset)==null?void 0:t.fxMode)||"full"}function Xi(e){const t=document.documentElement;let n="high",o="1";e>=120?(n="low",o="0.42"):e>=70&&(n="medium",o="0.68"),t.dataset.motionBudget=n,t.style.setProperty("--motion-budget",o)}function es(e){const t=Zi();if(t==="off")return null;const n=JSON.parse(JSON.stringify(e));return n.fps_limit=t==="lite"?34:58,t!=="lite"||(n.particles.number.value=Math.max(24,Math.round(n.particles.number.value*.56)),n.particles.opacity.value=Number((n.particles.opacity.value*.72).toFixed(2)),n.particles.move.speed=Number((n.particles.move.speed*.74).toFixed(2)),n.particles.line_linked.opacity=Number((n.particles.line_linked.opacity*.56).toFixed(2)),n.particles.line_linked.distance=Math.max(80,Math.round(n.particles.line_linked.distance*.84)),n.retina_detect=!1),n}function bn(e){const t=document.getElementById(e);t&&(t.innerHTML="",delete t.dataset.particlesReady)}function ts(){bn(_),bn(E),bn(w)}async function ns(){Le&&(window.cancelAnimationFrame(Le),Le=0),Le=window.requestAnimationFrame(async()=>{Le=0,ts(),await hn(),await yt()})}function Ir(){ns()}async function Gt(e,t){const n=document.getElementById(e);if(!n)return;const o=es(t);if(!o){n.innerHTML="",delete n.dataset.particlesReady;return}n.dataset.particlesReady==="1"||!await ia()||!window.particlesJS||document.getElementById(e)&&n.dataset.particlesReady!=="1"&&(n.innerHTML="",window.particlesJS(e,o),n.dataset.particlesReady="1")}async function hn(){await Gt(_,$)}async function yt(){await Promise.all([Gt(E,U),Gt(w,U)])}let wr=!1;return ie(()=>{var e;return(e=Ae.value)==null?void 0:e.id},async()=>{wr?(V.value="",ae.value="",Dt()):wr=!0,ft(),Je(),await Re(),await yt()}),ie(()=>{var e;return(e=Fn.value)==null?void 0:e.id},async()=>{await Re(),await yt()}),ie(()=>At.value,e=>{V.value&&!e.includes(V.value)&&(V.value="")},{deep:!0}),ie(()=>Ue.value,()=>{ft(),Je()},{deep:!0}),ie(()=>ut.value.length,e=>{if(!e){ue.value=0;return}ue.value>=e&&(ue.value=e-1)}),ie(()=>Lt.value.map(e=>e.value).join("|"),()=>{Lt.value.some(e=>e.value===le.value)||(le.value="all")}),ie(()=>Zt.value,e=>{if(e){$e.value&&(mt(),yn());return}vn(),vt()}),ie(()=>ct.value.length,e=>{Xi(e)},{immediate:!0}),ie(()=>({activePageId:ee.value,treeFilter:ae.value,activeIndicatorViewId:V.value,statsExpanded:ve.value,editMode:D.value,serviceCardView:ge.value,serviceGroupingMode:_e.value,siteFilter:le.value,sidebarView:M.value,settingsPanelOpen:Be.open,selectedNode:{groupKey:I.groupKey,subgroupId:I.subgroupId,itemId:I.itemId},expandedGroups:{...oe}}),e=>{Te(e)},{deep:!0}),Ze(async()=>{window.addEventListener("visibilitychange",hr),window.addEventListener("oko:fx-mode-change",Ir),await hn(),await gr(),await Re(),await yt()}),Xe(()=>{gt(),qe(),vt(),vn(),window.removeEventListener("visibilitychange",hr),window.removeEventListener("oko:fx-mode-change",Ir),Le&&(window.cancelAnimationFrame(Le),Le=0),Ge&&(clearTimeout(Ge),Ge=0),delete document.documentElement.dataset.motionBudget,document.documentElement.style.removeProperty("--motion-budget"),wt=null}),wt={BRAND_ICON_BY_KEY:Ut,DEFAULT_ITEM_URL:h,EMBLEM_SRC:r,HEALTH_REFRESH_MS:u,HERO_CONTROLS_PARTICLES_ID:w,HERO_PARTICLES_CONFIG:U,HERO_TITLE_PARTICLES_ID:E,ICON_BY_KEY:jt,ICON_RULES:ro,LAN_PAGE_ID:g,LAN_SCAN_POLL_MS:p,LARGE_INDICATOR_TYPES:m,SIDEBAR_PARTICLES_CONFIG:$,SIDEBAR_PARTICLES_ID:_,actionBusy:Ct,actionKey:un,activeCommandPaletteEntry:Hn,activeIndicatorViewId:V,activeIndicatorWidget:Fn,activePage:Ae,activePageGroupBlocks:Io,activePageId:ee,activePageWidgetIds:At,addGroup:$o,addItem:Lo,addSubgroup:Po,allItemIds:Ht,allSubgroupIds:zt,appTagline:ao,appTitle:so,applyConfigMutation:de,applyGrid:Un,applyTheme:Kn,authProfileOptions:Mn,buildDefaultItem:en,buildItemFromEditorForm:Yn,clampNumber:nn,clearDragState:je,clearItemFaviconFailures:dr,clearSelectedNode:Dt,cloneConfig:jn,closeIframeModal:Ni,closeItemEditor:qn,closeLanHostModal:vn,closeCommandPalette:Rt,closeSettingsPanel:ti,commandPaletteActiveIndex:ue,commandPaletteOpen:Et,commandPaletteQuery:rt,commandPaletteResults:ut,config:k,configError:pe,copyItemIp:Vi,copyItemSshShortcut:Fi,copyCommandPaletteEntryUrl:li,copyUrl:yr,createBrandIcon:L,defaultItemEditorForm:ne,dragState:P,editGroup:Ao,editItem:Do,editMode:D,editSubgroup:Mo,ensureAbsoluteUrl:Xt,ensurePageGroupsReference:Gr,expandedGroups:oe,faviconOriginFromUrl:an,filteredBlockGroups:di,filteredTreeGroups:Vn,findGroup:Ie,findSubgroup:me,formatLanDuration:ji,formatLanHttpStatus:Wi,formatLanMoment:Ui,fromToken:io,groupById:Qt,groupOnlineItems:wi,groupTotalItems:hi,healthClass:Ri,healthLabel:Oi,healthPollTimer:it,healthState:We,healthStates:at,iframeModal:X,indicatorPreviewEntries:qo,initHeroParticles:yt,initParticles:Gt,initSidebarParticles:hn,initWidgetPolling:fn,isActionBusy:Pi,isDirectGroupNode:Vt,isGroupExpanded:sr,isGroupSelected:ar,isIconCardView:Dn,isSidebarDetailed:Yt,isSidebarHidden:Pt,isTileCardView:Rn,isCompactServiceCardView:On,isInlineGroupLayout:bi,isItemSelected:ci,isLanPage:Zt,isLargeIndicator:dt,isSidebarIconActive:ko,isSidebarIconOnly:co,isSubgroupSelected:lr,isWidgetBlock:Qn,itemEditor:T,itemFaviconFailures:lt,itemFaviconKey:ln,itemFaviconSrc:Si,itemIp:gn,itemSite:Zo,lanCidrsLabel:po,lanHostModal:ot,lanHosts:Bn,lanPortsLabel:qi,lanScanActionBusy:kt,lanScanError:nt,lanScanLoading:qt,lanScanPollTimer:st,lanScanRefreshInFlight:$t,lanScanState:Ke,loadConfig:gr,loadingConfig:z,makeUniqueId:He,markItemFaviconFailed:_i,moveGroup:Nr,moveCommandPaletteSelection:ii,moveItemBefore:Vr,moveItemToSubgroupEnd:Fr,moveSubgroup:Hr,normalizeEndpoint:Ot,normalizeIconToken:oo,normalizeId:_t,normalizeLayoutBlocks:Br,normalizeStringList:tn,onGroupDragOver:Vo,onGroupDragStart:Go,onGroupDrop:Fo,onItemCardClick:To,onItemDragOver:jo,onItemDragStart:Ho,onItemDrop:zo,onSubgroupDragOver:Ko,onSubgroupDragStart:No,onSubgroupDrop:Uo,activateCommandPaletteEntry:or,activateCommandPaletteSelection:ai,openCommandPalette:nr,openSettingsPanel:rr,openCreateItemEditor:Wn,openEditItemEditor:Jn,openIframeItem:mr,openIndicatorView:Xn,openItem:pn,openItemInNewTab:Hi,openLanHostModal:zi,openLinkItem:vr,pageHealthSummary:bo,pages:xe,persistConfig:zn,pickSemanticIcon:tt,refreshHealth:Je,recheckItem:Ki,refreshLanScanState:mt,refreshWidget:Bt,removeGroup:Ro,removeItem:Bo,removeSubgroup:Oo,resetWidgetPolling:gt,resolveBlockGroups:rn,resolveExpression:Me,resolveGroupIcon:Ei,resolveItemIcon:Ti,resolvePageIcon:ki,resolveSubgroupIcon:Ci,resolveWidgetIcon:$i,resolveWidgets:Zn,runLanScanNow:Qi,runWidgetAction:Gi,saveError:F,saveStatus:Q,saveStatusLabel:go,saveStatusTimer:Ge,setCommandPaletteActiveIndex:oi,setCommandPaletteQuery:ri,setSiteFilter:Xo,settingsPanel:Be,sidebarViewToggleTitle:fo,selectItemNode:on,selectSidebarIconNode:Co,selectSidebarIndicator:Wo,selectSubgroupNode:ir,selectedNode:I,serviceCardView:ge,siteFilter:le,siteFilterOptions:Lt,serviceGroupingMode:_e,serviceGroupingOptions:uo,servicePresentationOptions:lo,sidebarIconNodeTitle:Eo,sidebarIconNodes:yo,sidebarIndicatorSummary:ho,sidebarIndicators:Mt,sidebarView:M,startHealthPolling:dn,startLanScanPolling:yn,statCardSubtitle:xi,statCardTrend:Ai,statCardValue:Li,statListEntries:fr,statsExpanded:ve,stopHealthPolling:qe,stopLanScanPolling:vt,subgroupById:Gn,subgroupTotalItems:Ii,submitItemEditor:xo,syncTreeGroupsState:ft,tableRows:Mi,toggleCommandPalette:ei,toggleEditMode:wo,toggleGroupNode:ui,toggleSettingsPanel:ni,toggleServiceCardView:So,toggleSidebarView:_o,treeFilter:ae,treeGroups:Ue,visibleTreeItemIds:ct,widgetById:xt,widgetIntervals:Tt,widgetState:ze,widgetStates:Pe,widgets:Jt},wt}const pa=["title"],ga={key:0,class:"item-compact-body"},ma=["src"],va={class:"item-tile-head"},ya=["src"],ba={class:"item-tile-title"},ha={class:"item-head"},Ia={class:"item-title-row"},wa=["src"],Sa={class:"item-type"},_a={class:"item-url"},ka={class:"item-health"},Ea={key:0,class:"item-tags"},Ca={key:0,class:"tag-pill site-pill"},Ta={class:"item-actions"},$a={key:1,class:"item-ssh-shortcut"},Pa={__name:"ServiceItemCard",props:{groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0},item:{type:Object,required:!0}},setup(r){const u=r,l=Ft(u,"groupKey"),d=Ft(u,"subgroupId"),a=Ft(u,"item"),p=se(),{isIconCardView:g,isTileCardView:m,isCompactServiceCardView:h,isItemSelected:_,onItemCardClick:E,itemFaviconSrc:w,markItemFaviconFailed:$,resolveItemIcon:U,healthClass:O,healthLabel:J,itemIp:A,itemSite:H,copyItemIp:Y,copyItemSshShortcut:B,openItem:R,openItemInNewTab:Ce,recheckItem:Se,copyUrl:Te}=p,ne=C(()=>O(a.value.id)),k=C(()=>J(a.value.id)),z=C(()=>A(a.value.id)),pe=C(()=>`ssh ${z.value}`),ee=C(()=>H(a.value,l.value)),ae=N(!1),ve=N(!1);let V=0,D=0;const $e=C(()=>({selected:!h.value&&_(a.value.id),compact:h.value,tile:m.value,[`status-${ne.value}`]:!0,"data-updated":ve.value}));function ge(){V&&clearTimeout(V),ae.value=!1,window.requestAnimationFrame(()=>{ae.value=!0,V=window.setTimeout(()=>{ae.value=!1,V=0},900)})}function _e(){D&&clearTimeout(D),ve.value=!1,window.requestAnimationFrame(()=>{ve.value=!0,D=window.setTimeout(()=>{ve.value=!1,D=0},1250)})}return ie([ne,k],([le,M],[Q,F])=>{Q===void 0&&F===void 0||((le!==Q||M!==F)&&_e(),M!==F&&ge())}),Xe(()=>{V&&(clearTimeout(V),V=0),D&&(clearTimeout(D),D=0)}),(le,M)=>{var Q;return f(),b("article",{class:W(["item-card",$e.value]),title:s(h)?a.value.title:void 0,onClick:M[9]||(M[9]=F=>s(E)(l.value,d.value,a.value))},[s(g)?(f(),b("div",ga,[s(w)(a.value)?(f(),b("img",{key:0,src:s(w)(a.value),class:"service-favicon compact-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:M[0]||(M[0]=F=>s($)(a.value))},null,40,ma)):(f(),q(we(s(U)(a.value)),{key:1,class:"ui-icon item-icon compact-item-icon"})),v("span",{class:W(["health-dot compact-health-dot",ne.value])},null,2)])):s(m)?(f(),b(te,{key:1},[v("div",va,[s(w)(a.value)?(f(),b("img",{key:0,src:s(w)(a.value),class:"service-favicon tile-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:M[1]||(M[1]=F=>s($)(a.value))},null,40,ya)):(f(),q(we(s(U)(a.value)),{key:1,class:"ui-icon item-icon tile-item-icon"})),v("span",{class:W(["health-dot tile-health-dot",ne.value])},null,2)]),v("p",ba,G(a.value.title),1)],64)):(f(),b(te,{key:2},[v("div",ha,[v("div",Ia,[s(w)(a.value)?(f(),b("img",{key:0,src:s(w)(a.value),class:"service-favicon item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:M[2]||(M[2]=F=>s($)(a.value))},null,40,wa)):(f(),q(we(s(U)(a.value)),{key:1,class:"ui-icon item-icon"})),v("h4",null,G(a.value.title),1)]),v("span",Sa,G(a.value.type),1)]),v("p",_a,G(a.value.url),1),v("div",ka,[v("span",{class:W(["health-dot",ne.value])},null,2),v("span",{class:W(["health-text",{"is-updating":ae.value}])},G(k.value),3)]),ee.value||(Q=a.value.tags)!=null&&Q.length?(f(),b("div",Ea,[ee.value?(f(),b("span",Ca,"site:"+G(ee.value),1)):j("",!0),(f(!0),b(te,null,he(a.value.tags,F=>(f(),b("span",{key:F,class:"tag-pill"},G(F),1))),128))])):j("",!0),v("div",Ta,[x(be,{title:a.value.type==="iframe"?"Открыть iframe":"Открыть","aria-label":a.value.type==="iframe"?"Открыть iframe":"Открыть",onClick:M[3]||(M[3]=Z(F=>s(R)(a.value),["stop"]))},{default:fe(()=>[(f(),q(we(a.value.type==="iframe"?s(Pn):s(Ln)),{class:"ui-icon item-action-icon"}))]),_:1},8,["title","aria-label"]),x(be,{title:"Открыть в новой вкладке","aria-label":"Открыть в новой вкладке",onClick:M[4]||(M[4]=Z(F=>s(Ce)(a.value),["stop"]))},{default:fe(()=>[x(s(Bs),{class:"ui-icon item-action-icon"})]),_:1}),x(be,{title:"Recheck health","aria-label":"Recheck health",onClick:M[5]||(M[5]=Z(F=>s(Se)(a.value.id),["stop"]))},{default:fe(()=>[x(s(Gs),{class:"ui-icon item-action-icon"})]),_:1}),z.value?(f(),q(be,{key:0,title:"Копировать IP","aria-label":"Копировать IP",onClick:M[6]||(M[6]=Z(F=>s(Y)(a.value.id),["stop"]))},{default:fe(()=>[x(s(Fe),{class:"ui-icon item-action-icon"})]),_:1})):j("",!0),z.value?(f(),q(be,{key:1,title:"Копировать SSH shortcut","aria-label":"Копировать SSH shortcut",onClick:M[7]||(M[7]=Z(F=>s(B)(a.value.id),["stop"]))},{default:fe(()=>[x(s(Yr),{class:"ui-icon item-action-icon"})]),_:1})):j("",!0),x(be,{title:"Копировать URL","aria-label":"Копировать URL",onClick:M[8]||(M[8]=Z(F=>s(Te)(a.value.url),["stop"]))},{default:fe(()=>[x(s(Ns),{class:"ui-icon item-action-icon"})]),_:1})]),z.value?(f(),b("p",$a,[M[10]||(M[10]=is(" SSH: ",-1)),v("code",null,G(pe.value),1)])):j("",!0)],64))],10,pa)}}},La={class:"virtual-item-grid"},xa=120,kn=72,Aa={__name:"VirtualizedItemGrid",props:{items:{type:Array,required:!0},groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0}},setup(r){const l=Ft(r,"items"),d=se(),{isIconCardView:a,isTileCardView:p}=d,g=N(null),m=N(kn);let h=null;const _=C(()=>l.value.length>xa),E=C(()=>_.value&&m.value<l.value.length),w=C(()=>_.value?l.value.slice(0,m.value):l.value);function $(){m.value=Math.min(l.value.length,m.value+kn)}function U(){m.value=kn}function O(){h&&(h.disconnect(),!(!E.value||!g.value)&&h.observe(g.value))}return ie(()=>l.value,async()=>{U(),await Re(),O()},{deep:!0}),ie(()=>E.value,async()=>{await Re(),O()}),Ze(async()=>{h=new IntersectionObserver(J=>{for(const A of J)if(A.isIntersecting){$();break}},{root:null,rootMargin:"260px 0px",threshold:0}),await Re(),O()}),Xe(()=>{h==null||h.disconnect(),h=null}),(J,A)=>(f(),b("div",La,[x(ss,{name:"item-grid-transition",tag:"div",class:W(["item-grid",{"icon-card-grid":s(a),"tile-card-grid":s(p)}])},{default:fe(()=>[(f(!0),b(te,null,he(w.value,H=>(f(),q(Pa,{key:H.id,"group-key":H.__originGroupKey||r.groupKey,"subgroup-id":H.__originSubgroupId||r.subgroupId,item:H},null,8,["group-key","subgroup-id","item"]))),128))]),_:1},8,["class"]),E.value?(f(),b("div",{key:0,ref_key:"sentinelRef",ref:g,class:"item-grid-sentinel","aria-hidden":"true"},null,512)):j("",!0)]))}},Ma={class:"group-header"},Da={class:"group-title-row"},Ra={key:0,class:"subtitle"},Oa={class:"subgroup-title"},Ba={__name:"ServiceGroupCard",props:{group:{type:Object,required:!0}},setup(r){const u=se(),{isInlineGroupLayout:l,resolveGroupIcon:d,resolveSubgroupIcon:a}=u;return(p,g)=>(f(),b("article",{class:W(["panel group-panel",{"group-panel-inline":s(l)(r.group)}])},[v("header",Ma,[v("div",Da,[(f(),q(we(s(d)(r.group)),{class:"ui-icon group-icon"})),v("h2",null,G(r.group.title),1)]),r.group.description?(f(),b("p",Ra,G(r.group.description),1)):j("",!0)]),(f(!0),b(te,null,he(r.group.subgroups,m=>(f(),b("section",{key:m.id,class:"subgroup"},[v("h3",Oa,[(f(),q(we(s(a)(m)),{class:"ui-icon subgroup-icon"})),v("span",null,G(m.title),1)]),x(Aa,{items:m.items,"group-key":r.group.key,"subgroup-id":m.id},null,8,["items","group-key","subgroup-id"])]))),128))],2))}},Ga={class:"groups-grid"},Na={key:0,class:"panel group-panel group-empty"},Ha={key:0,class:"panel group-panel group-empty"},Va={__name:"ServicesGroupsPanel",setup(r){const u=se(),{activePage:l,activePageGroupBlocks:d,filteredBlockGroups:a}=u,p=N(null);let g=null;const m={duration:180,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};function h(){if(!(!g||!p.value))for(const _ of p.value.querySelectorAll(".block-wrap"))_.dataset.offscreen="0",g.observe(_)}return ie(()=>{var _;return[(_=l.value)==null?void 0:_.id,d.value.length]},async()=>{g&&(g.disconnect(),await Re(),h())}),Ze(async()=>{g=new IntersectionObserver(_=>{for(const E of _)E.target.dataset.offscreen=E.isIntersecting?"0":"1"},{root:null,rootMargin:"140px 0px",threshold:.02}),await Re(),h()}),Xe(()=>{g==null||g.disconnect(),g=null}),(_,E)=>(f(),b("section",{ref_key:"blocksRootRef",ref:p,class:"page-stack"},[(f(!0),b(te,null,he(s(d),(w,$)=>(f(),b("section",{key:`${s(l).id}:${$}:groups`,class:"block-wrap"},[$n((f(),b("section",Ga,[(f(!0),b(te,null,he(s(a)(w.group_ids),U=>(f(),q(Ba,{key:U.key,group:U},null,8,["group"]))),128)),s(a)(w.group_ids).length?j("",!0):(f(),b("article",Na,[...E[0]||(E[0]=[v("h2",null,"Нет данных для выбранного узла",-1),v("p",{class:"subtitle"},"Выберите другую ветку в боковом дереве.",-1)])]))])),[[s(Ur),m]])]))),128)),s(d).length?j("",!0):(f(),b("article",Ha,[...E[1]||(E[1]=[v("h2",null,"Для этой страницы нет групп",-1),v("p",{class:"subtitle"},"Откройте нужный индикатор в аккордеоне слева.",-1)])]))],512))}},Fa={key:0,class:"hero-logo-square","aria-hidden":"true"},Ka=["src"],Ua=["title","aria-label","aria-selected","onClick"],ja={class:"hero-page-tab-label"},za={__name:"HeroPageTabs",setup(r){let u=!1;const l=se(),{EMBLEM_SRC:d,isSidebarHidden:a,pages:p,activePage:g,activePageId:m,resolvePageIcon:h}=l,_=N(!u),E=C(()=>a.value);let w=0;return Ze(()=>{_.value&&(w=globalThis.setTimeout(()=>{_.value=!1,u=!0},700))}),Xe(()=>{w&&(globalThis.clearTimeout(w),w=0),_.value&&(u=!0)}),($,U)=>(f(),b("nav",{class:W(["hero-page-tabs",{"hero-page-tabs--intro":_.value,"has-logo-tile":E.value}]),role:"tablist","aria-label":"Разделы"},[E.value?(f(),b("div",Fa,[v("img",{src:s(d),alt:""},null,8,Ka)])):j("",!0),(f(!0),b(te,null,he(s(p),O=>{var J,A,H;return f(),b("button",{key:O.id,class:W(["hero-page-tab-btn",{active:((J=s(g))==null?void 0:J.id)===O.id,"hero-page-tab-btn--intro-active":_.value&&((A=s(g))==null?void 0:A.id)===O.id}]),type:"button",role:"tab",title:O.title,"aria-label":O.title,"aria-selected":((H=s(g))==null?void 0:H.id)===O.id,onClick:Y=>m.value=O.id},[(f(),q(we(s(h)(O)),{class:"ui-icon hero-page-tab-icon"})),v("span",ja,G(O.title),1)],10,Ua)}),128))],2))}},qa={class:"hero-layout"},Wa={class:"hero panel hero-title-panel"},Ja={class:"hero-title-content"},Ya={class:"hero-controls-content"},Qa={key:0,id:"hero-controls-drawer",class:"hero-controls-drawer"},Za=["title","aria-label"],Xa=["aria-expanded","title"],el={key:0,class:"editor-error hero-editor-error"},Kr="oko:hero-controls-open:v1",tl={__name:"ServicesHeroPanel",setup(r){const u=se(),l=N(!1),{editMode:d,isSidebarDetailed:a,saveStatus:p,saveStatusLabel:g,saveError:m,sidebarViewToggleTitle:h,toggleEditMode:_,addGroup:E,openCommandPalette:w,openSettingsPanel:$,toggleSidebarView:U}=u;return Ze(()=>{if(!window.localStorage)return;const O=window.localStorage.getItem(Kr);l.value=O==="1"}),ie(()=>l.value,O=>{window.localStorage&&window.localStorage.setItem(Kr,O?"1":"0")}),(O,J)=>(f(),b("section",qa,[v("header",Wa,[J[1]||(J[1]=v("div",{id:"hero-title-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),v("div",Ja,[x(za)])]),v("aside",{class:W(["panel hero-control-panel service-hero-controls",{active:s(d)}])},[J[2]||(J[2]=v("div",{id:"hero-controls-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),v("div",Ya,[v("div",{class:W(["hero-controls-accordion",{open:l.value}])},[x(as,{name:"hero-controls-drawer-transition"},{default:fe(()=>[l.value?(f(),b("div",Qa,[x(be,{"button-class":"hero-icon-btn hero-accordion-action editor-toggle",active:s(d),title:s(d)?"Выключить режим редактирования":"Включить режим редактирования","aria-label":s(d)?"Выключить режим редактирования":"Включить режим редактирования",onClick:s(_)},{default:fe(()=>[x(s(xn),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),s(d)?(f(),q(be,{key:0,"button-class":"hero-icon-btn hero-accordion-action",title:"Добавить группу","aria-label":"Добавить группу",onClick:s(E)},{default:fe(()=>[x(s(An),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"])):j("",!0),x(be,{"button-class":"hero-icon-btn hero-accordion-action",title:"Быстрый поиск сервисов (Ctrl/Cmd+K)","aria-label":"Быстрый поиск сервисов",onClick:s(w)},{default:fe(()=>[x(s(Hs),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"]),x(be,{"button-class":"hero-icon-btn hero-accordion-action",title:"Панель настроек","aria-label":"Открыть панель настроек",onClick:s($)},{default:fe(()=>[x(s(Vs),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"]),x(be,{"button-class":"hero-icon-btn hero-accordion-action",active:!s(a),title:s(h),"aria-label":s(h),onClick:s(U)},{default:fe(()=>[x(s(eo),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),s(d)?(f(),b("span",{key:1,class:W(["hero-save-indicator hero-accordion-status",s(p)]),role:"status",title:s(g),"aria-label":s(g)},[x(s(Fs),{class:"ui-icon hero-save-icon"})],10,Za)):j("",!0)])):j("",!0)]),_:1}),v("button",{class:"hero-controls-trigger",type:"button","aria-expanded":l.value,"aria-controls":"hero-controls-drawer",title:l.value?"Скрыть панель действий":"Показать панель действий",onClick:J[0]||(J[0]=A=>l.value=!l.value)},[x(s(Zr),{class:"ui-icon hero-action-icon"}),x(s(Ks),{class:W(["ui-icon hero-accordion-caret",{open:l.value}])},null,8,["class"])],8,Xa)],2),s(d)&&s(m)?(f(),b("p",el,G(s(m)),1)):j("",!0)])],2)]))}},nl={key:0,class:"panel status-panel"},rl={key:1,class:"panel status-panel error-state"},ol={class:"subtitle"},il={key:3,class:"panel status-panel"},sl={__name:"DashboardMainView",setup(r){const u=Ve(()=>Ee(()=>import("./IndicatorTabPanel-CYeVkpjf.js"),__vite__mapDeps([0,1,2]))),l=Ve(()=>Ee(()=>import("./LanPageView-Co2-vu4u.js"),__vite__mapDeps([3,1,2]))),d=se(),{activePage:a,activeIndicatorWidget:p,loadingConfig:g,configError:m,isLanPage:h,loadConfig:_}=d;return(E,w)=>{var $;return f(),b("main",{key:(($=s(a))==null?void 0:$.id)||"empty",class:W(["page",{"indicator-open":!!s(p),"page--lan":s(h)&&!s(p)}])},[s(g)?(f(),b("section",nl,[...w[1]||(w[1]=[v("h2",null,"Загрузка конфигурации...",-1),v("p",{class:"subtitle"},"Получаем dashboard-модель из backend.",-1)])])):s(m)?(f(),b("section",rl,[w[2]||(w[2]=v("h2",null,"Ошибка загрузки конфигурации",-1)),v("p",ol,G(s(m)),1),v("button",{class:"ghost",type:"button",onClick:w[0]||(w[0]=(...U)=>s(_)&&s(_)(...U))},"Повторить")])):s(a)?(f(),b(te,{key:2},[s(p)?(f(),q(s(u),{key:0})):(f(),b(te,{key:1},[s(h)?(f(),q(s(l),{key:0})):(f(),b(te,{key:1},[x(tl),x(Va)],64))],64))],64)):(f(),b("section",il,[...w[3]||(w[3]=[v("h2",null,"Нет доступных страниц",-1),v("p",{class:"subtitle"},"Проверьте `layout.pages` в `dashboard.yaml`.",-1)])]))],2)}}},al={class:"brand"},ll=["src"],ul={class:"brand-title"},cl={class:"brand-subtitle"},dl={__name:"SidebarHeaderTabs",setup(r){const u=se(),{EMBLEM_SRC:l,appTitle:d,appTagline:a}=u;return(p,g)=>(f(),b("div",al,[v("img",{src:s(l),alt:"Oko"},null,8,ll),v("div",null,[v("p",ul,G(s(d)),1),v("p",cl,G(s(a)),1)])]))}},fl={class:"sidebar-stats-accordion","aria-label":"Индикаторы"},pl=["aria-expanded"],gl={class:"sidebar-stats-toggle-values"},ml={key:0,class:"sidebar-indicators"},vl=["onClick"],yl={class:"widget-head sidebar-indicator-head"},bl={class:"widget-title"},hl={class:"item-type"},Il={key:0,class:"widget-error"},wl={key:1,class:"widget-loading"},Sl={class:"widget-value sidebar-indicator-value"},_l={class:"widget-subtitle"},kl={key:0,class:"widget-trend"},El={key:0,class:"widget-list sidebar-list-preview"},Cl={key:1,class:"widget-empty"},Tl={class:"widget-subtitle"},$l={key:5,class:"widget-empty"},Pl={key:6,class:"widget-actions sidebar-indicator-actions"},Ll=["onClick"],xl=["disabled","onClick"],Al={key:1,class:"widget-empty"},Ml={__name:"SidebarIndicatorsAccordion",setup(r){const u=se(),{statsExpanded:l,sidebarIndicatorSummary:d,sidebarIndicators:a,isLargeIndicator:p,activeIndicatorWidget:g,selectSidebarIndicator:m,resolveWidgetIcon:h,widgetState:_,statCardValue:E,statCardSubtitle:w,statCardTrend:$,indicatorPreviewEntries:U,tableRows:O,openIndicatorView:J,isActionBusy:A,runWidgetAction:H}=u;return(Y,B)=>(f(),b("div",fl,[v("button",{class:"sidebar-stats-toggle",type:"button","aria-controls":"sidebar-stats-panel","aria-expanded":s(l),onClick:B[0]||(B[0]=R=>l.value=!s(l))},[B[1]||(B[1]=v("span",{class:"sidebar-stats-toggle-text"},"Индикаторы",-1)),v("span",gl,G(s(d)),1),v("span",{class:W(["sidebar-stats-toggle-caret",{open:s(l)}])},"▴",2)],8,pl),v("div",{id:"sidebar-stats-panel",class:W(["sidebar-stats-panel",{open:s(l)}])},[s(a).length?(f(),b("div",ml,[(f(!0),b(te,null,he(s(a),R=>{var Ce,Se,Te,ne,k;return f(),b("article",{key:R.id,class:W(["sidebar-indicator",{interactive:s(p)(R),active:((Ce=s(g))==null?void 0:Ce.id)===R.id}]),onClick:z=>s(m)(R)},[v("header",yl,[v("div",bl,[(f(),q(we(s(h)(R)),{class:"ui-icon widget-icon"})),v("h3",null,G(R.title),1)]),v("span",hl,G(R.type),1)]),(Se=s(_)(R.id))!=null&&Se.error?(f(),b("p",Il,G((Te=s(_)(R.id))==null?void 0:Te.error),1)):(ne=s(_)(R.id))!=null&&ne.loading?(f(),b("p",wl,"Обновление...")):R.type==="stat_card"?(f(),b(te,{key:2},[v("p",Sl,G(s(E)(R)),1),v("p",_l,G(s(w)(R)),1),s($)(R)?(f(),b("p",kl,G(s($)(R)),1)):j("",!0)],64)):R.type==="stat_list"?(f(),b(te,{key:3},[s(U)(R).length?(f(),b("ul",El,[(f(!0),b(te,null,he(s(U)(R),z=>(f(),b("li",{key:z.title+z.value},[v("span",null,G(z.title),1),v("strong",null,G(z.value),1)]))),128))])):(f(),b("p",Cl,"Нет данных")),B[2]||(B[2]=v("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):R.type==="table"?(f(),b(te,{key:4},[v("p",Tl,"Строк: "+G(s(O)(R).length),1),B[3]||(B[3]=v("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):(f(),b("p",$l,"Неподдерживаемый тип виджета")),(k=R.data.actions)!=null&&k.length||s(p)(R)?(f(),b("div",Pl,[s(p)(R)?(f(),b("button",{key:0,class:"ghost",type:"button",onClick:Z(z=>s(J)(R.id),["stop"])},"Открыть вкладку",8,Ll)):j("",!0),(f(!0),b(te,null,he(R.data.actions||[],z=>(f(),b("button",{key:z.id,class:"ghost",type:"button",disabled:s(A)(R.id,z.id),onClick:Z(pe=>s(H)(R.id,z),["stop"])},G(z.title),9,xl))),128))])):j("",!0)],10,vl)}),128))])):(f(),b("p",Al,"Для выбранной страницы индикаторы не настроены."))],2)]))}},Dl=["draggable"],Rl={class:"tree-node-row"},Ol={class:"tree-text"},Bl={class:"tree-meta"},Gl={key:0,class:"tree-inline-actions"},Nl={__name:"SidebarTreeSubgroupNode",props:{group:{type:Object,required:!0},subgroup:{type:Object,required:!0}},setup(r){const u=se(),{dragState:l,editMode:d,onSubgroupDragStart:a,clearDragState:p,onSubgroupDragOver:g,onSubgroupDrop:m,isSubgroupSelected:h,selectSubgroupNode:_,resolveSubgroupIcon:E,subgroupTotalItems:w,editSubgroup:$,addItem:U,removeSubgroup:O}=u;return(J,A)=>(f(),b("li",{class:W(["tree-subgroup-item",{dragging:s(l).type==="subgroup"&&s(l).subgroupId===r.subgroup.id}]),draggable:s(d),onDragstart:A[4]||(A[4]=Z(H=>s(a)(H,r.group.id,r.subgroup.id),["stop"])),onDragend:A[5]||(A[5]=Z((...H)=>s(p)&&s(p)(...H),["stop"])),onDragover:A[6]||(A[6]=Z(H=>s(g)(H,r.group.id,r.subgroup.id),["stop"])),onDrop:A[7]||(A[7]=Z(H=>s(m)(H,r.group.id,r.subgroup.id),["stop"]))},[v("div",Rl,[v("button",{class:W(["tree-node tree-subgroup",{active:s(h)(r.group.key,r.subgroup.id)}]),type:"button",onClick:A[0]||(A[0]=H=>s(_)(r.group.key,r.subgroup.id))},[(f(),q(we(s(E)(r.subgroup)),{class:"ui-icon tree-icon tree-sub-icon"})),v("span",Ol,G(r.subgroup.title),1),v("span",Bl,G(s(w)(r.subgroup)),1)],2),s(d)?(f(),b("div",Gl,[x(s(to),{class:"ui-icon tree-grip"}),v("button",{class:"tree-mini-btn",type:"button",title:"Редактировать подгруппу",onClick:A[1]||(A[1]=Z(H=>s($)(r.group.id,r.subgroup.id),["stop"]))},[x(s(xn),{class:"ui-icon"})]),v("button",{class:"tree-mini-btn",type:"button",title:"Добавить элемент",onClick:A[2]||(A[2]=Z(H=>s(U)(r.group.id,r.subgroup.id),["stop"]))},[x(s(An),{class:"ui-icon"})]),v("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить подгруппу",onClick:A[3]||(A[3]=Z(H=>s(O)(r.group.id,r.subgroup.id),["stop"]))},[x(s(no),{class:"ui-icon"})])])):j("",!0)])],42,Dl))}},Hl=["draggable"],Vl={class:"tree-node-row"},Fl={class:"tree-text"},Kl={class:"tree-meta"},Ul={key:0,class:"tree-inline-actions"},jl={class:"tree-subgroups"},zl={__name:"SidebarTreeGroupNode",props:{group:{type:Object,required:!0}},setup(r){const u=se(),{dragState:l,editMode:d,isDirectGroupNode:a,onGroupDragStart:p,clearDragState:g,onGroupDragOver:m,onGroupDrop:h,isGroupSelected:_,toggleGroupNode:E,isGroupExpanded:w,resolveGroupIcon:$,groupTotalItems:U,editGroup:O,addSubgroup:J,removeGroup:A}=u;return(H,Y)=>(f(),b("li",{class:W(["tree-group-item",{dragging:s(l).type==="group"&&s(l).groupId===r.group.id&&s(a)(r.group)}]),draggable:s(d)&&s(a)(r.group),onDragstart:Y[4]||(Y[4]=Z(B=>s(p)(B,r.group),["stop"])),onDragend:Y[5]||(Y[5]=Z((...B)=>s(g)&&s(g)(...B),["stop"])),onDragover:Y[6]||(Y[6]=Z(B=>s(m)(B,r.group),["stop"])),onDrop:Y[7]||(Y[7]=Z(B=>s(h)(B,r.group),["stop"]))},[v("div",Vl,[v("button",{class:W(["tree-node tree-group",{active:s(_)(r.group.key)}]),type:"button",onClick:Y[0]||(Y[0]=B=>s(E)(r.group.key))},[v("span",{class:W(["tree-caret",{open:s(w)(r.group.key)}])},"▾",2),(f(),q(we(s($)(r.group)),{class:"ui-icon tree-icon"})),v("span",Fl,G(r.group.title),1),v("span",Kl,G(s(U)(r.group)),1)],2),s(d)&&s(a)(r.group)?(f(),b("div",Ul,[x(s(to),{class:"ui-icon tree-grip"}),v("button",{class:"tree-mini-btn",type:"button",title:"Редактировать группу",onClick:Y[1]||(Y[1]=Z(B=>s(O)(r.group.id),["stop"]))},[x(s(xn),{class:"ui-icon"})]),v("button",{class:"tree-mini-btn",type:"button",title:"Добавить подгруппу",onClick:Y[2]||(Y[2]=Z(B=>s(J)(r.group.id),["stop"]))},[x(s(An),{class:"ui-icon"})]),v("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить группу",onClick:Y[3]||(Y[3]=Z(B=>s(A)(r.group.id),["stop"]))},[x(s(no),{class:"ui-icon"})])])):j("",!0)]),$n(v("ul",jl,[(f(!0),b(te,null,he(r.group.subgroups,B=>(f(),q(Nl,{key:B.id,group:r.group,subgroup:B},null,8,["group","subgroup"]))),128))],512),[[ls,s(w)(r.group.key)]])],42,Hl))}},ql={key:0,class:"sidebar-tree","aria-label":"Дерево сервисов"},Wl={key:0,class:"tree-root"},Jl={key:1,class:"tree-empty"},Yl={__name:"SidebarTreePanel",setup(r){const u=se(),{treeGroups:l,filteredTreeGroups:d}=u,a={duration:160,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};return(p,g)=>s(l).length?(f(),b("section",ql,[s(d).length?$n((f(),b("ul",Wl,[(f(!0),b(te,null,he(s(d),m=>(f(),q(zl,{key:m.key,group:m},null,8,["group"]))),128))])),[[s(Ur),a]]):(f(),b("p",Jl,"По вашему запросу ничего не найдено."))])):j("",!0)}},Ql={class:"sidebar"},Zl={class:"sidebar-content"},Xl={__name:"DashboardSidebarView",setup(r){const u=se(),{isSidebarDetailed:l}=u;return(d,a)=>(f(),b("aside",Ql,[a[0]||(a[0]=v("div",{id:"sidebar-particles",class:"sidebar-particles","aria-hidden":"true"},null,-1)),v("div",Zl,[x(dl),s(l)?(f(),q(Yl,{key:0})):j("",!0),s(l)?(f(),q(Ml,{key:1})):j("",!0)])]))}},eu=["src"],tu={__name:"App",setup(r){const u=()=>Ee(()=>import("./LanHostModal-BYgcEE-z.js"),__vite__mapDeps([4,1,5,2])),l=()=>Ee(()=>import("./IframeModal-BJRQ5AbA.js"),__vite__mapDeps([6,5,1,2])),d=()=>Ee(()=>import("./ItemEditorModal-Bw4lyO0p.js"),__vite__mapDeps([7,1,5,2])),a=()=>Ee(()=>import("./DashboardSettingsModal-B7LKA9Hn.js"),__vite__mapDeps([8,5,1,2])),p=()=>Ee(()=>import("./CommandPaletteModal-CtjQnrmf.js"),__vite__mapDeps([9,1,5,2])),g=()=>Ee(()=>import("./IndicatorTabPanel-CYeVkpjf.js"),__vite__mapDeps([0,1,2])),m=()=>Ee(()=>import("./LanPageView-Co2-vu4u.js"),__vite__mapDeps([3,1,2])),h=Ve(u),_=Ve(l),E=Ve(d),w=Ve(a),$=Ve(p),U=se(),{EMBLEM_SRC:O,closeCommandPalette:J,closeSettingsPanel:A,commandPaletteOpen:H,iframeModal:Y,isSidebarHidden:B,itemEditor:R,lanHostModal:Ce,settingsPanel:Se,toggleCommandPalette:Te}=U,ne=N(!1);let k=0,z=0,pe=0;function ee(){Promise.allSettled([u(),l(),d(),a(),p(),g(),m()])}function ae(){if("requestIdleCallback"in window){pe=window.requestIdleCallback(()=>{pe=0,ee()},{timeout:2e3});return}z=window.setTimeout(()=>{z=0,ee()},1400)}function ve(V){if((V.metaKey||V.ctrlKey)&&!V.altKey&&!V.shiftKey&&V.key.toLowerCase()==="k"){V.preventDefault(),Te();return}if(V.key==="Escape"&&H.value){V.preventDefault(),J();return}V.key==="Escape"&&Se.open&&(V.preventDefault(),A())}return Ze(()=>{k=globalThis.setTimeout(()=>{ne.value=!0},1e3),window.addEventListener("keydown",ve),ae()}),Xe(()=>{k&&(globalThis.clearTimeout(k),k=0),z&&(window.clearTimeout(z),z=0),pe&&"cancelIdleCallback"in window&&(window.cancelIdleCallback(pe),pe=0),window.removeEventListener("keydown",ve)}),(V,D)=>(f(),b("div",{class:W(["shell",{"shell-motion-static":ne.value}])},[v("img",{class:"center-emblem",src:s(O),alt:"","aria-hidden":"true"},null,8,eu),v("div",{class:W(["app-shell",{"sidebar-hidden":s(B)}])},[s(B)?j("",!0):(f(),q(Xl,{key:0})),x(sl)],2),s(Ce).open?(f(),q(s(h),{key:0})):j("",!0),s(Y).open?(f(),q(s(_),{key:1})):j("",!0),s(R).open?(f(),q(s(E),{key:2})):j("",!0),s(Se).open?(f(),q(s(w),{key:3})):j("",!0),s(H)?(f(),q(s($),{key:4})):j("",!0)],2))}};async function nu(r){}function ru(){var d,a,p,g;if((a=(d=globalThis.matchMedia)==null?void 0:d.call(globalThis,"(prefers-reduced-motion: reduce)"))==null?void 0:a.matches)return"off";const u=Number(((p=globalThis.navigator)==null?void 0:p.hardwareConcurrency)||8),l=Number(((g=globalThis.navigator)==null?void 0:g.deviceMemory)||8);return u<=4||l<=4?"lite":"full"}function ou(r){const u=document.documentElement,l=u.dataset.fxMode||"";u.dataset.fxMode=r,r==="off"?u.style.setProperty("--glow-enabled","0"):r==="lite"?u.style.setProperty("--glow-enabled","0.58"):u.style.setProperty("--glow-enabled","1"),l&&l!==r&&window.dispatchEvent(new CustomEvent("oko:fx-mode-change",{detail:{mode:r,previousMode:l}}))}function iu(){var l;const r=(l=globalThis.matchMedia)==null?void 0:l.call(globalThis,"(prefers-reduced-motion: reduce)"),u=()=>ou(ru());u(),r!=null&&r.addEventListener?r.addEventListener("change",u):r!=null&&r.addListener&&r.addListener(u)}iu();nu();us(tu).use(cs).mount("#app");export{za as _,be as a,se as u};
