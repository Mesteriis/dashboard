import{e as v,b as X,d as Y,o as l,i as Z,q as tt,k as t,u as a,c as u,F as $,m as x,n as _,t as d,l as R,y as et,E as st,p as c,g as at}from"./vendor-D1bzbGly.js";import{_ as nt}from"./BaseModal-DEo4-NpV.js";import{u as it,g as V,i as ot,s as lt,f as ut,r as dt}from"./index-C0sXGkiO.js";import{ag as ct,ah as h,ai as rt,a8 as vt,aa as pt,aj as mt,ak as gt}from"./vendor-icons-Cq_RiAeh.js";const bt={class:"settings-modal-header"},kt={class:"settings-modal-grid"},ft={class:"settings-modal-section"},yt={class:"settings-state-group"},_t={class:"settings-state-switcher",role:"radiogroup","aria-label":"Режим отображения сервисов"},ht=["aria-pressed","onClick"],Ct={class:"settings-state-group"},wt={class:"settings-state-switcher",role:"radiogroup","aria-label":"Группировка сервисов"},Bt=["aria-pressed","disabled","onClick"],Rt={key:0,class:"settings-state-hint"},St={class:"settings-state-group"},Dt={class:"settings-state-switcher wrap",role:"radiogroup","aria-label":"Фильтр по площадке"},Ut=["aria-pressed","onClick"],$t={key:0,class:"settings-modal-section settings-modal-section-wide"},xt={class:"settings-state-group"},Et={class:"settings-state-switcher",role:"radiogroup","aria-label":"Режим backend"},Lt=["disabled","aria-pressed"],Mt=["disabled","aria-pressed"],Pt={class:"settings-state-group"},Ft=["disabled"],Ot={class:"settings-runtime-actions"},Vt=["disabled"],jt={class:"settings-nav-action-main"},zt={key:0,class:"settings-state-hint settings-state-error"},Gt={class:"settings-modal-section"},Nt={class:"settings-modal-actions"},At={class:"settings-nav-action-main"},Tt={class:"settings-nav-action-main"},qt={class:"settings-nav-action-main"},Ht={class:"settings-modal-section"},Kt={class:"settings-modal-actions"},It=["disabled"],Jt={class:"settings-nav-action-main"},Qt={class:"settings-runtime-input settings-file-input"},Wt=["disabled"],Xt={key:0,class:"settings-state-hint settings-state-error"},Yt={key:1,class:"settings-state-hint"},ne={__name:"DashboardSettingsModal",setup(Zt){const j=it(),{closeSettingsPanel:C,editMode:z,isSidebarHidden:w,openCommandPalette:G,serviceCardView:S,serviceGroupingMode:D,serviceGroupingOptions:N,servicePresentationOptions:A,settingsPanel:T,siteFilter:E,siteFilterOptions:q,setSiteFilter:H,toggleEditMode:L,toggleSidebarView:M,loadConfig:P}=j,i=v(V()),r=v(i.value.mode==="web"?"embedded":i.value.mode),b=v(i.value.remoteBaseUrl||"http://127.0.0.1:8090"),p=v(!1),B=v(""),k=v(!1),f=v(!1),m=v(""),g=v(""),F=at(()=>{if(!i.value.desktop)return!1;const n=String(b.value||"").trim();return r.value!==i.value.mode||n!==String(i.value.remoteBaseUrl||"").trim()});function U(){r.value=i.value.mode==="web"?"embedded":i.value.mode,b.value=i.value.remoteBaseUrl||"http://127.0.0.1:8090"}function K(n){w.value||(D.value=n)}function I(){C(),G()}async function J(){if(!(!i.value.desktop||!F.value||p.value)){p.value=!0,B.value="";try{const n=await lt({mode:r.value,remoteBaseUrl:b.value});i.value=n,U(),await P()}catch(n){B.value=(n==null?void 0:n.message)||"Не удалось применить desktop runtime"}finally{p.value=!1}}}async function Q(){if(!k.value){k.value=!0,m.value="",g.value="";try{const n=await ut(),e=new Blob([n.yaml],{type:"application/x-yaml;charset=utf-8"}),s=URL.createObjectURL(e),o=document.createElement("a");o.href=s,o.download=n.filename||"dashboard-backup.yaml",o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s),g.value=`Backup сохранен: ${o.download}`}catch(n){m.value=(n==null?void 0:n.message)||"Не удалось скачать backup"}finally{k.value=!1}}}async function W(n){var o;const e=(n==null?void 0:n.target)||null,s=(o=e==null?void 0:e.files)==null?void 0:o[0];if(!(!s||f.value)){f.value=!0,m.value="",g.value="";try{const y=await s.text();await dt(y),await P(),g.value=`Backup импортирован: ${s.name}`}catch(y){m.value=(y==null?void 0:y.message)||"Не удалось импортировать backup"}finally{f.value=!1,e&&(e.value="")}}}X(async()=>{const n=await ot();i.value=n,U(),window.addEventListener("oko:api-base-change",O)}),Y(()=>{window.removeEventListener("oko:api-base-change",O)});function O(){i.value=V(),U()}return(n,e)=>(l(),Z(nt,{open:a(T).open,"backdrop-class":"settings-modal-backdrop","modal-class":"settings-modal",onBackdrop:a(C)},{default:tt(()=>[t("header",bt,[e[6]||(e[6]=t("div",null,[t("h3",null,"Настройки панели"),t("p",null,"Единая точка управления интерфейсом и режимами отображения.")],-1)),t("button",{class:"ghost",type:"button",onClick:e[0]||(e[0]=(...s)=>a(C)&&a(C)(...s))},"Закрыть")]),t("div",kt,[t("section",ft,[e[10]||(e[10]=t("h4",null,"Отображение",-1)),t("div",yt,[e[7]||(e[7]=t("p",{class:"settings-state-label"},"Вид",-1)),t("div",_t,[(l(!0),u($,null,x(a(A),s=>(l(),u("button",{key:`view:${s.value}`,class:_(["settings-state-btn",{active:a(S)===s.value}]),type:"button","aria-pressed":a(S)===s.value,onClick:o=>S.value=s.value},d(s.label),11,ht))),128))])]),t("div",Ct,[e[8]||(e[8]=t("p",{class:"settings-state-label"},"Группировка",-1)),t("div",wt,[(l(!0),u($,null,x(a(N),s=>(l(),u("button",{key:`grouping:${s.value}`,class:_(["settings-state-btn",{active:a(D)===s.value}]),type:"button","aria-pressed":a(D)===s.value,disabled:a(w),onClick:o=>K(s.value)},d(s.label),11,Bt))),128))]),a(w)?(l(),u("p",Rt,"Группировка недоступна при скрытом меню.")):R("",!0)]),t("div",St,[e[9]||(e[9]=t("p",{class:"settings-state-label"},"Site",-1)),t("div",Dt,[(l(!0),u($,null,x(a(q),s=>(l(),u("button",{key:`site:${s.value}`,class:_(["settings-state-btn",{active:a(E)===s.value}]),type:"button","aria-pressed":a(E)===s.value,onClick:o=>a(H)(s.value)},d(s.label),11,Ut))),128))])])]),i.value.desktop?(l(),u("section",$t,[e[13]||(e[13]=t("h4",null,"Desktop Runtime (macOS Apple Silicon)",-1)),t("div",xt,[e[11]||(e[11]=t("p",{class:"settings-state-label"},"Режим backend",-1)),t("div",Et,[t("button",{class:_(["settings-state-btn",{active:r.value==="embedded"}]),type:"button",disabled:p.value,"aria-pressed":r.value==="embedded",onClick:e[1]||(e[1]=s=>r.value="embedded")}," Embedded (inside app) ",10,Lt),t("button",{class:_(["settings-state-btn",{active:r.value==="remote"}]),type:"button",disabled:p.value,"aria-pressed":r.value==="remote",onClick:e[2]||(e[2]=s=>r.value="remote")}," Remote (external server) ",10,Mt)])]),t("div",Pt,[e[12]||(e[12]=t("p",{class:"settings-state-label"},"Remote URL",-1)),et(t("input",{"onUpdate:modelValue":e[3]||(e[3]=s=>b.value=s),class:"settings-runtime-input",type:"text",autocomplete:"off",spellcheck:"false",placeholder:"http://127.0.0.1:8090",disabled:p.value||r.value!=="remote"},null,8,Ft),[[st,b.value,void 0,{trim:!0}]])]),t("div",Ot,[t("button",{class:"settings-nav-action",type:"button",disabled:p.value||!F.value,onClick:J},[t("span",jt,[c(a(ct),{class:"ui-icon settings-nav-action-icon"}),t("span",null,d(p.value?"Применяем...":"Применить runtime"),1)]),c(a(h),{class:"ui-icon settings-nav-action-caret"})],8,Vt)]),B.value?(l(),u("p",zt,d(B.value),1)):R("",!0)])):R("",!0),t("section",Gt,[e[15]||(e[15]=t("h4",null,"Быстрые действия",-1)),t("div",Nt,[t("button",{class:"settings-nav-action",type:"button",onClick:e[4]||(e[4]=(...s)=>a(M)&&a(M)(...s))},[t("span",At,[c(a(rt),{class:"ui-icon settings-nav-action-icon"}),t("span",null,d(a(w)?"Показать меню":"Скрыть меню"),1)]),c(a(h),{class:"ui-icon settings-nav-action-caret"})]),t("button",{class:"settings-nav-action",type:"button",onClick:e[5]||(e[5]=(...s)=>a(L)&&a(L)(...s))},[t("span",Tt,[c(a(vt),{class:"ui-icon settings-nav-action-icon"}),t("span",null,d(a(z)?"Выключить edit mode":"Включить edit mode"),1)]),c(a(h),{class:"ui-icon settings-nav-action-caret"})]),t("button",{class:"settings-nav-action",type:"button",onClick:I},[t("span",qt,[c(a(pt),{class:"ui-icon settings-nav-action-icon"}),e[14]||(e[14]=t("span",null,"Открыть поиск (Ctrl/Cmd+K)",-1))]),c(a(h),{class:"ui-icon settings-nav-action-caret"})])])]),t("section",Ht,[e[16]||(e[16]=t("h4",null,"Backup конфигурации",-1)),t("div",Kt,[t("button",{class:"settings-nav-action",type:"button",disabled:k.value,onClick:Q},[t("span",Jt,[c(a(mt),{class:"ui-icon settings-nav-action-icon"}),t("span",null,d(k.value?"Готовим backup...":"Скачать backup (.yaml)"),1)]),c(a(h),{class:"ui-icon settings-nav-action-caret"})],8,It),t("label",Qt,[c(a(gt),{class:"ui-icon settings-nav-action-icon"}),t("span",null,d(f.value?"Импортируем backup...":"Импортировать backup (.yaml)"),1),t("input",{type:"file",accept:".yaml,.yml,text/yaml",disabled:f.value,onChange:W},null,40,Wt)])]),m.value?(l(),u("p",Xt,d(m.value),1)):g.value?(l(),u("p",Yt,d(g.value),1)):R("",!0)])])]),_:1},8,["open","onBackdrop"]))}};export{ne as default};
