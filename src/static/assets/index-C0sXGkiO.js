const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/IndicatorTabPanel-Oi-WR4EO.js","assets/vendor-D1bzbGly.js","assets/vendor-icons-Cq_RiAeh.js","assets/LanPageView-qhhjPDAM.js","assets/LanHostModal-Bp5pTARe.js","assets/BaseModal-DEo4-NpV.js","assets/IframeModal-BqOmNQy8.js","assets/ItemEditorModal-BsviEw0h.js","assets/DashboardSettingsModal-CpBW8lLC.js","assets/CommandPaletteModal-wIEP8qV5.js"])))=>i.map(i=>d[i]);
import{o as f,c as y,r as ms,n as j,h as Ar,w as se,a as Oe,b as nt,d as rt,e as U,f as Ie,g as C,u as i,i as z,j as Ee,k as m,F as ee,t as O,l as H,m as Se,p as x,q as ve,s as Q,v as vs,x as Jt,T as bs,y as Bn,z as Xr,A as ys,B as He,C as hs,D as Is,M as ws}from"./vendor-D1bzbGly.js";import{s as Rr,a as Dr,b as _s,c as Ss,d as Mr,e as ks,f as $n,g as Es,h as Br,i as Or,j as Gr,k as _t,l as Cs,m as Nr,n as $s,o as Ts,p as Ur,q as Ps,r as Ls,t as Tn,H as Et,N as Yt,S as Ke,F as eo,C as to,u as no,T as An,v as ro,w as oo,D as Rn,x as xs,y as As,W as Rs,A as Ds,E as Ms,z as Bs,M as Vr,P as Os,B as io,G as On,L as Gn,I as Gs,K as Ns,J as Us,O as Fr,Q as so,R as Hr,U as Kr,V as Vs,X as Fs,Y as Hs,Z as Ks,_ as Pn,$ as ao,a0 as zs,a1 as lo,a2 as js,a3 as Ws,a4 as uo,a5 as qs,a6 as Js,a7 as Ys,a8 as Nn,a9 as Un,aa as Qs,ab as Zs,ac as Xs,ad as ea,ae as co,af as fo}from"./vendor-icons-Cq_RiAeh.js";(function(){const a=document.createElement("link").relList;if(a&&a.supports&&a.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))c(u);new MutationObserver(u=>{for(const p of u)if(p.type==="childList")for(const g of p.addedNodes)g.tagName==="LINK"&&g.rel==="modulepreload"&&c(g)}).observe(document,{childList:!0,subtree:!0});function l(u){const p={};return u.integrity&&(p.integrity=u.integrity),u.referrerPolicy&&(p.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?p.credentials="include":u.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function c(u){if(u.ep)return;u.ep=!0;const p=l(u);fetch(u.href,p)}})();const ta="modulepreload",na=function(r){return"/static/"+r},zr={},we=function(a,l,c){let u=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const g=document.querySelector("meta[property=csp-nonce]"),h=(g==null?void 0:g.nonce)||(g==null?void 0:g.getAttribute("nonce"));u=Promise.allSettled(l.map(b=>{if(b=na(b),b in zr)return;zr[b]=!0;const S=b.endsWith(".css"),E=S?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${b}"]${E}`))return;const _=document.createElement("link");if(_.rel=S?"stylesheet":ta,S||(_.as="script"),_.crossOrigin="",_.href=b,h&&_.setAttribute("nonce",h),document.head.appendChild(_),S)return new Promise((D,K)=>{_.addEventListener("load",D),_.addEventListener("error",()=>K(new Error(`Unable to preload CSS for ${b}`)))})}))}function p(g){const h=new Event("vite:preloadError",{cancelable:!0});if(h.payload=g,window.dispatchEvent(h),!h.defaultPrevented)throw g}return u.then(g=>{for(const h of g||[])h.status==="rejected"&&p(h.reason);return a().catch(p)})},ra=["type","title","aria-label","disabled"],_e={__name:"IconButton",props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"button"},title:{type:String,default:""},ariaLabel:{type:String,default:""},buttonClass:{type:String,default:""}},emits:["click"],setup(r){return(a,l)=>(f(),y("button",{class:j(["ghost icon-btn",[r.buttonClass,{active:r.active}]]),type:r.type,title:r.title,"aria-label":r.ariaLabel||r.title,disabled:r.disabled,onClick:l[0]||(l[0]=c=>a.$emit("click",c))},[ms(a.$slots,"default")],10,ra))}};function Vn(r){const a=String(r||"");if(!a||/^https?:\/\//i.test(a))return a;const l=typeof window>"u"?"":String(window.__OKO_API_BASE__||"").trim();if(!l)return a;const c=l.endsWith("/")?l.slice(0,-1):l,u=a.startsWith("/")?a:`/${a}`;return`${c}${u}`}function oa(r,a,l){const c=a&&typeof r=="object"&&r!==null?r.detail:null;let u=`Request failed: ${l}`;return Array.isArray(c)?u=c.map(p=>typeof p=="object"&&p!==null&&"message"in p?String(p.message||""):JSON.stringify(p)).join("; "):typeof c=="string"&&c?u=c:typeof r=="string"&&r&&(u=r),u}async function Pe(r,a={}){const{headers:l={},...c}=a,u={};if(l instanceof Headers)l.forEach((E,_)=>{u[_]=E});else if(Array.isArray(l))for(const[E,_]of l)u[E]=String(_);else Object.assign(u,l);const p={Accept:"application/json",...u},g=await fetch(Vn(r),{credentials:"include",headers:p,...c}),b=(g.headers.get("content-type")||"").includes("application/json"),S=b?await g.json():await g.text();if(!g.ok){const _=new Error(oa(S,b,g.status));throw _.status=g.status,_.body=S,_}return S}const Ge="/api/v1/dashboard";function ia(){return Pe(`${Ge}/config`)}async function wu(){const r=await fetch(Vn(`${Ge}/config/backup`),{credentials:"include",headers:{Accept:"application/x-yaml, text/yaml, text/plain, */*"}}),a=await r.text();if(!r.ok)throw new Error(a||`Request failed: ${r.status}`);const c=String(r.headers.get("content-disposition")||"").match(/filename="?([^";]+)"?/i),u=`dashboard-backup-${new Date().toISOString().slice(0,19).replaceAll(":","-")}.yaml`;return{yaml:a,filename:(c==null?void 0:c[1])||u}}function sa(r){return Pe(`${Ge}/iframe/${encodeURIComponent(r)}/source`).then(a=>{if(!a||typeof a!="object")return a;const l=a;return typeof l.src!="string"?a:{...a,src:Vn(l.src)}})}function aa(r=[]){const a=new URLSearchParams;for(const c of r)a.append("item_id",c);const l=a.toString();return Pe(`${Ge}/health${l?`?${l}`:""}`)}function la(r){return Pe(`${Ge}/config`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}function _u(r){return Pe(`${Ge}/config/restore`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({yaml:String(r||"")})})}function ua(){return Pe(`${Ge}/lan/state`)}function ca(){return Pe(`${Ge}/lan/run`,{method:"POST"})}const Ln="oko-particles-js",da="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js",fa=7e3;let St=null;function Dn(){return typeof window.particlesJS=="function"}function pa(r){return new Promise(a=>{let l=!1;const c=p=>{l||(l=!0,a(p))},u=window.setTimeout(()=>{c(Dn())},fa);r.addEventListener("load",()=>{window.clearTimeout(u),c(Dn())},{once:!0}),r.addEventListener("error",()=>{window.clearTimeout(u),c(!1)},{once:!0})})}async function ga(){return typeof window>"u"||typeof document>"u"?!1:Dn()?!0:St||(St=(async()=>{let r=document.getElementById(Ln)instanceof HTMLScriptElement?document.getElementById(Ln):null;r||(r=document.createElement("script"),r.id=Ln,r.src=da,r.async=!0,r.defer=!0,document.head.appendChild(r));const a=await pa(r);return a||(St=null),a})(),St)}function L(r){const a=`#${r.hex}`;return(l,{attrs:c})=>Ar("svg",{...c,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",role:"img","aria-hidden":"true",style:c.style?[c.style,{color:a}]:{color:a}},[Ar("path",{d:r.path})])}const Qt={homeassistant:L(Tn),"home-assistant":L(Tn),ha:L(Tn),openwrt:L(Ls),adguard:L(Ps),proxmox:L(Ur),pve:L(Ur),grafana:L(Ts),gitea:L($s),jellyfin:L(Nr),jellyseerr:L(Nr),sonarr:L(_t),radarr:L(Cs),lidarr:L(_t),readarr:L(_t),bazarr:L(_t),prowlarr:L(_t),qbittorrent:L(Gr),qb:L(Gr),postgres:L(Or),postgresql:L(Or),docker:L(Br),dockge:L(Br),cockpit:L(Es),npm:L($n),nginxproxymanager:L($n),"nginx-proxy-manager":L($n),nginx:L(ks),openai:L(Mr),ai:L(Mr),portainer:L(Ss),ytsync:L(Dr),youtube:L(_s),youtubeshorts:L(Dr),termius:L(Rr),termix:L(Rr)},Zt={home:Et,house:Et,дом:Et,dom:Et,route:js,net:Yt,network:Yt,сеть:Yt,dashboard:lo,infra:Ke,infrastructure:Ke,инфраструктура:Ke,server:Ke,core:zs,ops:ao,media:Pn,медиа:Pn,tv:Pn,iot:to,cloud:Ks,wifi:Hs,monitor:Fs,cockpit:Vs,proxmox:Ke,grafana:no,gitea:Kr,git:Kr,jellyfin:eo,navidrome:Vr,tunnel:Hr,tunnels:Hr,stats:so,services:Fr,service:Fr,health:ro,alerts:An,alert:An,security:oo,auth:Us,key:Ns,db:Rn,database:Rn,storage:Gs,link:Gn,iframe:On,terminal:io,package:Os,music:Vr,camera:Bs,eye:Ms,observability:Ds,workflow:Rs,settings:As,spark:xs},po=[{re:/\b(home|house|dom|дом)\b/,icon:Et},{re:/\b(net|network|route|vpn|edge|сеть|маршрут|туннел)\b/,icon:Yt},{re:/\b(infra|server|cluster|pve|проксмокс|инфраструктур)\b/,icon:Ke},{re:/\b(media|tv|video|stream|jellyfin|медиа)\b/,icon:eo},{re:/\b(iot|sensor|home-assistant|умн|дом)\b/,icon:to},{re:/\b(stat|metric|chart|grafana|аналит|monitor)\b/,icon:no},{re:/\b(alert|error|warn|critical|ошиб|авар)\b/,icon:An},{re:/\b(health|status|pulse|heart|состояни)\b/,icon:ro},{re:/\b(auth|token|secret|lock|ключ|безопас)\b/,icon:oo},{re:/\b(db|database|postgres|mysql|redis)\b/,icon:Rn}],tt={page:lo,group:uo,subgroup:Ws,itemLink:Gn,itemIframe:On,widget:so};function go(r){return String(r||"").toLowerCase().replace(/[^a-z0-9а-яё._-]+/gi," ").split(/[\s._-]+/).filter(Boolean)}function mo(r){if(Qt[r])return Qt[r];for(const[a,l]of Object.entries(Qt))if(r.includes(a))return l;if(Zt[r])return Zt[r];for(const[a,l]of Object.entries(Zt))if(r.includes(a))return l;return null}function ot(r,a){for(const c of r)for(const u of go(c)){const p=mo(u);if(p)return p}const l=r.map(c=>String(c||"").toLowerCase()).filter(Boolean).join(" ");for(const c of po)if(c.re.test(l))return c.icon;return a}function ma(r){return ot([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],tt.page)}function va(r){return ot([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.description],tt.group)}function ba(r){return ot([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],tt.subgroup)}function ya(r){return ot([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,r==null?void 0:r.url,...(r==null?void 0:r.tags)||[]],(r==null?void 0:r.type)==="iframe"?tt.itemIframe:tt.itemLink)}function ha(r){var a;return ot([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,(a=r==null?void 0:r.data)==null?void 0:a.endpoint],tt.widget)}function Ct(r,a="node"){return String(r||"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")||a}function Fe(r,a){const l=Ct(r,"node");let c=l,u=2;for(;a.has(c);)c=`${l}-${u}`,u+=1;return c}function Xt(r){const a=new Set;for(const l of r.groups||[])for(const c of l.subgroups||[])a.add(c.id);return a}function zt(r){const a=new Set;for(const l of r.groups||[])for(const c of l.subgroups||[])for(const u of c.items||[])a.add(u.id);return a}function ke(r,a){return(r.groups||[]).find(l=>l.id===a)||null}function he(r,a,l){const c=ke(r,a);return c&&(c.subgroups||[]).find(u=>u.id===l)||null}function jt(r){return String((r==null?void 0:r.key)||"").startsWith("group:")}function jr(r){var u,p;const a=new Set((r.groups||[]).map(g=>g.id)),l=Xt(r),c=new Set([...a,...l]);for(const g of((u=r.layout)==null?void 0:u.pages)||[]){const h=[];for(const b of g.blocks||[]){if(b.type==="groups"){b.group_ids=(b.group_ids||[]).filter(S=>c.has(S)),b.group_ids.length&&h.push(b);continue}(b.widgets||[]).length&&h.push(b)}!h.length&&((p=r.groups)!=null&&p.length)&&h.push({type:"groups",group_ids:[r.groups[0].id]}),g.blocks=h}}function Wr(r,a,l){var g;const c=((g=r.layout)==null?void 0:g.pages)||[];if(!c.length)return;const u=c.find(h=>h.id===a)||c[0];let p=u.blocks.find(h=>h.type==="groups");if(!p){p={type:"groups",group_ids:[l]},u.blocks.push(p);return}p.group_ids.includes(l)||p.group_ids.push(l)}function qr(r,a,l){const c=r.groups||[],u=c.findIndex(b=>b.id===a),p=c.findIndex(b=>b.id===l);if(u<0||p<0||u===p)return!1;const[g]=c.splice(u,1),h=u<p?p-1:p;return c.splice(h,0,g),!0}function Jr(r,a,l,c,u){const p=ke(r,a),g=ke(r,c);if(!p||!g)return!1;const h=(p.subgroups||[]).findIndex(E=>E.id===l),b=(g.subgroups||[]).findIndex(E=>E.id===u);if(h<0||b<0)return!1;if(a!==c&&p.subgroups.length<=1)throw new Error("В исходной группе должна остаться минимум одна подгруппа.");const[S]=p.subgroups.splice(h,1);if(a===c){const E=h<b?b-1:b;return p.subgroups.splice(E,0,S),!0}return g.subgroups.splice(b,0,S),!0}function Yr(r,a,l,c,u,p,g){const h=he(r,a,l),b=he(r,u,p);if(!h||!b)return!1;const S=(h.items||[]).findIndex(D=>D.id===c),E=(b.items||[]).findIndex(D=>D.id===g);if(S<0||E<0)return!1;if(l!==p&&h.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[_]=h.items.splice(S,1);if(l===p){const D=S<E?E-1:E;return h.items.splice(D,0,_),!0}return b.items.splice(E,0,_),!0}function Qr(r,a,l,c,u,p){const g=he(r,a,l),h=he(r,u,p);if(!g||!h)return!1;const b=(g.items||[]).findIndex(E=>E.id===c);if(b<0)return!1;if(l!==p&&g.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[S]=g.items.splice(b,1);return h.items.push(S),!0}function Ia(r){const a=String(r||"").trim();if(!a)throw new Error("URL не может быть пустым");const l=/^https?:\/\//i.test(a)?a:`https://${a}`;let c;try{c=new URL(l)}catch{throw new Error(`Некорректный URL: ${a}`)}if(!["http:","https:"].includes(c.protocol))throw new Error(`Разрешены только http/https URL: ${a}`);return c.toString()}function wa(r){const a=String(r||"").trim();if(!a)return"";const l=/^https?:\/\//i.test(a)?a:`https://${a}`;try{const c=new URL(l);return["http:","https:"].includes(c.protocol)?c.origin:""}catch{return""}}let kt=null;function ae(){if(kt)return kt;const r="/static/img/emblem-mark.png",a=3e4,l=16e3,c=9e3,u=700,p=1e4,g="lan",h=new Set(["stat_list","table"]),b="https://example.com",S="sidebar-particles",E="hero-title-particles",_="hero-controls-particles",D={fps_limit:58,particles:{number:{value:88,density:{enable:!0,value_area:700}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.36,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:120,color:"#2dd4bf",opacity:.24,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},K={fps_limit:58,particles:{number:{value:92,density:{enable:!0,value_area:720}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.4,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:132,color:"#2dd4bf",opacity:.26,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},V=Object.freeze([{value:"detailed",label:"Карточки"},{value:"tile",label:"Плитка"},{value:"icon",label:"Значки"}]),J=Object.freeze([{value:"groups",label:"Только группы"},{value:"tags_in_groups",label:"Группы + теги"},{value:"tags",label:"Только теги"},{value:"flat",label:"Без групп (плитка)"}]),$=["detailed","hidden"],G=18,W=10,B="oko:dashboard-ui-state:v1",R=new Set(V.map(e=>e.value)),Le=new Set(J.map(e=>e.value));function Ce(){if(typeof window>"u")return null;try{return window.localStorage||null}catch{return null}}function $e(){const e=Ce();if(!e)return null;try{const t=e.getItem(B);if(!t)return null;const n=JSON.parse(t);return n&&typeof n=="object"?n:null}catch{return null}}function le(e){const t=Ce();if(t)try{t.setItem(B,JSON.stringify(e))}catch{}}function ue(){return{id:"",title:"",type:"link",url:b,icon:"",siteInput:"",tagsInput:"",open:"new_tab",healthcheckEnabled:!1,healthcheckUrl:"",healthcheckIntervalSec:30,healthcheckTimeoutMs:1500,iframeSandboxMode:"default",iframeAllowInput:"",iframeReferrerPolicy:"",authProfile:""}}const I=U(null),be=U(!0),ce=U(""),Y=U(""),oe=U(""),de=U(!1),Z=U(""),N=U(!1),q=U(typeof document>"u"?!0:document.visibilityState!=="hidden"),te=U("detailed"),fe=U("groups"),A=U("all"),ne=U("detailed"),M=U("idle"),ye=U(""),je=U(null),en=U(!1),Pt=U(!1),it=U(""),Lt=U(!1),st=U(""),pe=U(0),Ne=Ie({open:!1}),at=Ie({open:!1,host:null}),xe=Ie({}),xt=Ie({}),At=new Map;let lt=0,Ue=0,ut=0,Rt=!1,tn=!1,Ae=0;const w=Ie({groupKey:"",subgroupId:"",itemId:""}),ie=Ie({}),ct=Ie({}),P=Ie({type:"",groupId:"",subgroupId:"",itemId:""}),dt=Ie({}),ge=$e();if(ge){const e=String(ge.serviceCardView||"");R.has(e)&&(te.value=e);const t=String(ge.serviceGroupingMode||"");Le.has(t)&&(fe.value=t);const n=String(ge.sidebarView||"");$.includes(n)&&(ne.value=n);const o=String(ge.siteFilter||"").trim().toLowerCase();A.value=o||"all",Y.value=String(ge.activePageId||""),oe.value=String(ge.treeFilter||""),Z.value=String(ge.activeIndicatorViewId||""),de.value=!!ge.statsExpanded,N.value=!!ge.editMode,Ne.open=!!ge.settingsPanelOpen;const s=ge.selectedNode;s&&typeof s=="object"&&(w.groupKey=String(s.groupKey||""),w.subgroupId=String(s.subgroupId||""),w.itemId=String(s.itemId||""));const d=ge.expandedGroups;if(d&&typeof d=="object")for(const[v,k]of Object.entries(d)){const F=String(v||"");F&&(ie[F]=!!k)}}const X=Ie({open:!1,title:"",src:"",allow:"",sandbox:!1,referrerPolicy:"",loading:!1,error:""}),T=Ie({open:!1,mode:"create",groupId:"",subgroupId:"",originalItemId:"",submitting:!1,error:"",form:ue()}),Re=C(()=>{var t,n;if(!I.value)return[];const e=((n=(t=I.value)==null?void 0:t.layout)==null?void 0:n.pages)||[];return e.some(o=>o.id===g)?e:[...e,{id:g,title:"LAN",icon:"network",blocks:[]}]}),nn=C(()=>{var e;return((e=I.value)==null?void 0:e.widgets)||[]}),Fn=C(()=>{var e,t;return((t=(e=I.value)==null?void 0:e.security)==null?void 0:t.auth_profiles)||[]}),yo=C(()=>{var e,t;return((t=(e=I.value)==null?void 0:e.app)==null?void 0:t.title)||"Oko"}),ho=C(()=>{var e,t;return((t=(e=I.value)==null?void 0:e.app)==null?void 0:t.tagline)||"Your Infrastructure in Sight"}),Io=C(()=>V),wo=C(()=>J),Hn=C(()=>te.value==="icon"),Kn=C(()=>te.value==="tile"),zn=C(()=>Hn.value||Kn.value),rn=C(()=>ne.value!=="hidden"),Dt=C(()=>ne.value==="hidden"),_o=C(()=>!1),So=C(()=>rn.value?"Режим меню: полное. Нажмите, чтобы скрыть меню":"Режим меню: скрыто. Нажмите, чтобы вернуть полное меню"),jn=C(()=>{var e,t;return((t=(e=je.value)==null?void 0:e.result)==null?void 0:t.hosts)||[]}),ko=C(()=>{var t,n;const e=((n=(t=je.value)==null?void 0:t.result)==null?void 0:n.scanned_cidrs)||[];return e.length?e.join(", "):"нет данных"}),Eo=C(()=>M.value==="saving"?"Сохранение...":M.value==="saved"?"Сохранено":M.value==="error"?"Ошибка сохранения":N.value?"Готово":"Сохранение выключено"),Mt=C(()=>{var n;const e=new Map;for(const o of((n=I.value)==null?void 0:n.groups)||[])for(const s of o.subgroups||[])for(const d of s.items||[]){const v=vt(d,o);if(!v)continue;const k=v.toLowerCase();e.has(k)||e.set(k,v)}const t=Array.from(e.entries()).sort((o,s)=>o[1].localeCompare(s[1],"ru",{sensitivity:"base"}));return[{value:"all",label:"Все sites"},...t.map(([o,s])=>({value:o,label:s}))]}),Bt=C(()=>{const e=new Map;for(const t of nn.value)e.set(t.id,t);return e}),on=C(()=>{var t;const e=new Map;for(const n of((t=I.value)==null?void 0:t.groups)||[])e.set(n.id,n);return e}),Wn=C(()=>{var t;const e=new Map;for(const n of((t=I.value)==null?void 0:t.groups)||[])for(const o of n.subgroups||[])e.set(o.id,{group:n,subgroup:o});return e}),Co=C(()=>{const e=new Map;for(const t of Re.value)for(const n of t.blocks||[])if((n==null?void 0:n.type)==="groups")for(const o of n.group_ids||[])e.has(o)||e.set(o,t.id);return e}),qn=C(()=>{const e=new Map;for(const t of jn.value||[]){const n=String((t==null?void 0:t.ip)||"").trim();if(n)for(const o of(t==null?void 0:t.dashboard_items)||[]){const s=String((o==null?void 0:o.id)||"").trim();s&&!e.has(s)&&e.set(s,n)}}return e}),$o=C(()=>{var n;const e=[],t=Co.value;e.push({id:"action:open-settings-panel",type:"action",action:"open_settings_panel",item:null,title:"Открыть панель настроек",titleLower:"открыть панель настроек",host:"",ip:"",site:"",tagsLower:[],groupId:"",groupKey:"",groupTitle:"Команда",subgroupId:"",subgroupTitle:"Интерфейс",pageId:"",searchBlob:"открыть панель настроек settings ui интерфейс control panel параметры фильтры"});for(const o of((n=I.value)==null?void 0:n.groups)||[])for(const s of o.subgroups||[])for(const d of s.items||[]){const v=si(d==null?void 0:d.url),k=qn.value.get(d.id)||"",F=(d.tags||[]).map(Te=>String(Te||"").trim()).filter(Boolean),re=vt(d,o);if(A.value!=="all"&&re.toLowerCase()!==A.value)continue;const Ve=t.get(o.id)||t.get(s.id)||"",Be=String(d.title||"").trim(),Xe=[Be,String(d.id||""),String(d.url||""),v,k,re,String(o.title||""),String(s.title||""),...F].join(" ").toLowerCase();e.push({id:d.id,type:"item",action:"",item:d,title:Be,titleLower:Be.toLowerCase(),host:v.toLowerCase(),ip:k.toLowerCase(),site:re.toLowerCase(),tagsLower:F.map(Te=>Te.toLowerCase()),groupId:o.id,groupKey:`group:${o.id}`,groupTitle:String(o.title||""),subgroupId:s.id,subgroupTitle:String(s.title||""),pageId:Ve,searchBlob:Xe})}return e}),ft=C(()=>{const e=String(st.value||"").trim().toLowerCase(),t=$o.value;if(!e){const s=t.filter(v=>v.type==="action"),d=t.filter(v=>v.type!=="action").slice().sort((v,k)=>v.title.localeCompare(k.title,"ru",{sensitivity:"base"}));return[...s,...d].slice(0,W)}const n=e.split(/\s+/).filter(Boolean),o=[];for(const s of t){let d=0,v=!0;for(const k of n){if(!s.searchBlob.includes(k)){v=!1;break}s.titleLower.startsWith(k)?d+=12:s.titleLower.includes(k)&&(d+=8),s.host.startsWith(k)?d+=7:s.host.includes(k)&&(d+=4),s.ip===k?d+=14:s.ip.includes(k)&&(d+=6),s.site&&s.site.includes(k)&&(d+=5),s.tagsLower.some(F=>F.includes(k))&&(d+=3)}v&&o.push({entry:s,score:d})}return o.sort((s,d)=>d.score!==s.score?d.score-s.score:s.entry.title.localeCompare(d.entry.title,"ru",{sensitivity:"base"})),o.slice(0,G).map(s=>s.entry)}),Jn=C(()=>ft.value[pe.value]||null),De=C(()=>Re.value.find(e=>e.id===Y.value)||Re.value[0]||null),sn=C(()=>{var e;return((e=De.value)==null?void 0:e.id)===g}),We=C(()=>{if(!De.value)return[];const e=[];for(const t of De.value.blocks||[])(t==null?void 0:t.type)==="groups"&&e.push(...t.group_ids||[]);return dn(e)}),Yn=C(()=>{const e=cr(We.value),t=oe.value.trim().toLowerCase();return t?e.map(n=>{if(String(n.title||"").toLowerCase().includes(t)||String(n.description||"").toLowerCase().includes(t))return{...n,subgroups:n.subgroups||[]};const s=(n.subgroups||[]).map(d=>{if(String(d.title||"").toLowerCase().includes(t))return{...d,items:d.items||[]};const k=(d.items||[]).filter(F=>{const re=String(F.title||"").toLowerCase().includes(t),Ve=String(F.url||"").toLowerCase().includes(t),Be=(F.tags||[]).some(Te=>String(Te).toLowerCase().includes(t)),Xe=vt(F,n).toLowerCase().includes(t);return re||Ve||Be||Xe});return k.length?{...d,items:k}:null}).filter(Boolean);return s.length?{...n,subgroups:s}:null}).filter(Boolean):e}),To=C(()=>{const e=[];for(const t of Yn.value){e.push({key:`group:${t.key}`,type:"group",groupKey:t.key,group:t});for(const n of t.subgroups||[])e.push({key:`subgroup:${t.key}:${n.id}`,type:"subgroup",groupKey:t.key,subgroupId:n.id,subgroup:n})}return e}),pt=C(()=>{const e=[];for(const t of We.value)for(const n of t.subgroups||[])for(const o of n.items||[])e.push(o.id);return e}),Po=C(()=>{var n;const e=pt.value;let t=0;for(const o of e)(n=Qe(o))!=null&&n.ok&&(t+=1);return{online:t,total:e.length}}),Ot=C(()=>{if(!De.value)return[];const e=[];for(const t of De.value.blocks||[])sr(t)&&e.push(...t.widgets||[]);return Array.from(new Set(e))}),Gt=C(()=>ar(Ot.value)),Lo=C(()=>{const e=Gt.value.length;if(!e)return"нет данных";const t=Gt.value.filter(n=>gt(n)).length;return`${e} · больших ${t}`}),xo=C(()=>{var e;return(((e=De.value)==null?void 0:e.blocks)||[]).filter(t=>(t==null?void 0:t.type)==="groups")}),Qn=C(()=>{const e=Bt.value.get(Z.value);return!e||!gt(e)?null:Ot.value.includes(e.id)?e:null});function Zn(e){if(!e)return;const t=document.documentElement;e.accent&&(t.style.setProperty("--accent",e.accent),t.style.setProperty("--accent-soft",e.accent)),e.background&&t.style.setProperty("--bg",e.background),e.border&&t.style.setProperty("--border",e.border),e.card&&(t.style.setProperty("--surface",e.card),t.style.setProperty("--surface-strong",e.card)),t.style.setProperty("--glow-enabled",e.glow===!1?"0":"1")}function Xn(e){if(!e)return;const t=document.documentElement;e.gap!=null&&t.style.setProperty("--grid-gap",`${Number(e.gap)}px`),e.card_radius!=null&&t.style.setProperty("--card-radius",`${Number(e.card_radius)}px`),e.columns!=null&&t.style.setProperty("--layout-columns",String(Number(e.columns)))}function Ao(){N.value=!N.value,ye.value="",N.value||qe()}function Ro(){if(te.value==="detailed"){te.value="tile";return}if(te.value==="tile"){te.value="icon";return}te.value="detailed"}function Do(){ne.value!=="detailed"&&ne.value!=="hidden"&&(ne.value="detailed");const e=$.indexOf(ne.value),n=((e>=0?e:0)+1)%$.length;ne.value=$[n],rn.value||(oe.value="",Nt()),Dt.value&&(fe.value="flat")}function Mo(e){return e?e.type==="group"?vr(e.groupKey):e.type==="subgroup"?br(e.groupKey,e.subgroupId):!1:!1}function Bo(e){var t,n;return e?e.type==="group"?`Группа: ${((t=e.group)==null?void 0:t.title)||""}`:e.type==="subgroup"?`Подгруппа: ${((n=e.subgroup)==null?void 0:n.title)||""}`:"":""}function Oo(e){if(e){if(e.type==="group"){ie[e.groupKey]=!0,w.groupKey=e.groupKey,w.subgroupId="",w.itemId="";return}e.type==="subgroup"&&gr(e.groupKey,e.subgroupId)}}function Go(e,t,n){if(!zn.value)return;const o=(n==null?void 0:n.__originGroupKey)||e,s=(n==null?void 0:n.__originSubgroupId)||t;fn(o,s,n.id),In(n)}function er(e){return JSON.parse(JSON.stringify(e))}function an(e){return Ia(e)}async function tr(){var e;if(I.value){M.value="saving",ye.value="";try{const t=await la(I.value);I.value=t.config,(!Y.value||!Re.value.some(n=>n.id===Y.value))&&(Y.value=((e=Re.value[0])==null?void 0:e.id)||""),M.value="saved",Ue&&clearTimeout(Ue),Ue=window.setTimeout(()=>{M.value==="saved"&&(M.value="idle")},1400)}catch(t){throw M.value="error",ye.value=(t==null?void 0:t.message)||"Ошибка сохранения YAML",t}}}async function me(e){if(!I.value)return!1;const t=er(I.value);try{return e(I.value)===!1?!1:(jr(I.value),mt(),await tr(),!0)}catch(n){return I.value=t,M.value="error",ye.value=(n==null?void 0:n.message)||"Не удалось применить изменения",!1}}function ln(e,t){return{id:e,type:"link",title:t,url:b,icon:null,site:null,tags:[],open:"new_tab"}}async function No(){if(!N.value||!I.value)return;const e=window.prompt("Название новой группы","Новая группа");if(e==null)return;const t=e.trim();t&&await me(n=>{const o=new Set((n.groups||[]).map(re=>re.id)),s=Xt(n),d=zt(n),v=Fe(t,o),k=Fe(`${v}-core`,s),F=Fe(`${v}-service`,d);n.groups.push({id:v,title:t,icon:"folder",description:"",layout:"auto",subgroups:[{id:k,title:"Core",items:[ln(F,"Новый сервис")]}]}),Wr(n,Y.value,v),ie[`group:${v}`]=!0,w.groupKey=`group:${v}`,w.subgroupId=k,w.itemId=F})}async function Uo(e){if(!N.value||!I.value)return;const t=window.prompt("Название подгруппы","Новая подгруппа");if(t==null)return;const n=t.trim();n&&await me(o=>{const s=ke(o,e);if(!s)throw new Error(`Группа '${e}' не найдена`);const d=Xt(o),v=zt(o),k=Fe(`${e}-${n}`,d),F=Fe(`${k}-service`,v);s.subgroups.push({id:k,title:n,items:[ln(F,"Новый сервис")]}),ie[`group:${e}`]=!0,w.groupKey=`group:${e}`,w.subgroupId=k,w.itemId=F})}async function Vo(e,t){!N.value||!I.value||rr(e,t)}function un(e){return String(e||"").split(",").map(t=>t.trim()).filter(Boolean)}function cn(e,t,n,o){const s=Number(e);if(!Number.isFinite(s))return t;const d=Math.trunc(s);return Math.min(o,Math.max(n,d))}function nr(e=!1){T.submitting&&!e||(T.open=!1,T.mode="create",T.groupId="",T.subgroupId="",T.originalItemId="",T.error="",T.submitting=!1,T.form=ue())}function rr(e,t){if(!he(I.value,e,t)){M.value="error",ye.value=`Подгруппа '${t}' не найдена`;return}T.open=!0,T.mode="create",T.groupId=e,T.subgroupId=t,T.originalItemId="",T.error="",T.submitting=!1,T.form=ue()}function or(e,t,n){var d,v,k;const o=he(I.value,e,t),s=((o==null?void 0:o.items)||[]).find(F=>F.id===n);if(!o||!s){M.value="error",ye.value=`Элемент '${n}' не найден`;return}T.open=!0,T.mode="edit",T.groupId=e,T.subgroupId=t,T.originalItemId=n,T.error="",T.submitting=!1,T.form={id:s.id,title:s.title,type:s.type,url:String(s.url||b),icon:s.icon||"",siteInput:String(s.site||""),tagsInput:(s.tags||[]).join(", "),open:s.open||"new_tab",healthcheckEnabled:!!(s.type==="link"&&s.healthcheck),healthcheckUrl:s.type==="link"&&s.healthcheck?String(s.healthcheck.url):String(s.url||b),healthcheckIntervalSec:s.type==="link"&&s.healthcheck?Number(s.healthcheck.interval_sec||30):30,healthcheckTimeoutMs:s.type==="link"&&s.healthcheck?Number(s.healthcheck.timeout_ms||1500):1500,iframeSandboxMode:s.type==="iframe"?((d=s.iframe)==null?void 0:d.sandbox)==null?"default":s.iframe.sandbox?"enabled":"disabled":"default",iframeAllowInput:s.type==="iframe"?(((v=s.iframe)==null?void 0:v.allow)||[]).join(", "):"",iframeReferrerPolicy:s.type==="iframe"&&((k=s.iframe)==null?void 0:k.referrer_policy)||"",authProfile:s.type==="iframe"&&s.auth_profile||""}}function ir(e){const t=T.form,n=String(t.title||"").trim();if(!n)throw new Error("Название сервиса обязательно");const o=String(t.type||"").trim().toLowerCase();if(!["link","iframe"].includes(o))throw new Error("Тип сервиса должен быть 'link' или 'iframe'");const s=String(t.open||"new_tab");if(!["new_tab","same_tab"].includes(s))throw new Error("Параметр open должен быть 'new_tab' или 'same_tab'");const d=an(t.url||b),v=zt(e);T.mode==="edit"&&v.delete(T.originalItemId);const k=String(t.id||"").trim(),F=`${T.subgroupId}-${n}`,re=Ct(k||F,"service"),Ve=k?re:Fe(re,v);if(k&&v.has(Ve))throw new Error(`ID '${Ve}' уже существует`);const Be={id:Ve,type:o,title:n,url:d,icon:String(t.icon||"").trim()||null,site:String(t.siteInput||"").trim()||null,tags:un(t.tagsInput),open:s};if(o==="link"){const Kt={...Be};if(t.healthcheckEnabled){const gs=an(t.healthcheckUrl||d);Kt.healthcheck={type:"http",url:gs,interval_sec:cn(t.healthcheckIntervalSec,30,1,3600),timeout_ms:cn(t.healthcheckTimeoutMs,1500,100,12e4)}}return Kt}const Xe=String(t.iframeSandboxMode||"default");let Te=null;Xe==="enabled"&&(Te=!0),Xe==="disabled"&&(Te=!1);const wt=String(t.authProfile||"").trim();if(wt&&!Fn.value.some(Kt=>Kt.id===wt))throw new Error(`Auth profile '${wt}' не найден`);const xr={...Be,iframe:{sandbox:Te,allow:un(t.iframeAllowInput),referrer_policy:String(t.iframeReferrerPolicy||"").trim()||null}};return wt&&(xr.auth_profile=wt),xr}async function Fo(){if(!T.open||T.submitting||!I.value)return;T.submitting=!0,T.error="";const e=await me(t=>{const n=he(t,T.groupId,T.subgroupId);if(!n)throw new Error(`Подгруппа '${T.subgroupId}' не найдена`);const o=ir(t);if(T.mode==="create")return n.items.push(o),w.groupKey=`group:${T.groupId}`,w.subgroupId=T.subgroupId,w.itemId=o.id,!0;const s=(n.items||[]).findIndex(d=>d.id===T.originalItemId);if(s<0)throw new Error(`Элемент '${T.originalItemId}' не найден`);return n.items.splice(s,1,o),w.groupKey=`group:${T.groupId}`,w.subgroupId=T.subgroupId,(w.itemId===T.originalItemId||!w.itemId)&&(w.itemId=o.id),!0});T.submitting=!1,e?nr(!0):T.error=ye.value||"Не удалось сохранить сервис"}async function Ho(e){if(!N.value||!I.value)return;const t=ke(I.value,e);if(!t)return;const n=window.prompt("Название группы",t.title);if(n==null)return;const o=window.prompt("Описание группы",t.description||"");if(o==null)return;const s=window.prompt("Режим группы (auto | full | inline)",t.layout||"auto");s!=null&&await me(d=>{const v=ke(d,e);if(!v)throw new Error(`Группа '${e}' не найдена`);const k=String(s||"").trim().toLowerCase()||"auto";if(!["auto","full","inline"].includes(k))throw new Error("Режим группы должен быть 'auto', 'full' или 'inline'");v.title=n.trim()||v.title,v.description=o.trim(),v.layout=k})}async function Ko(e,t){if(!N.value||!I.value)return;const n=he(I.value,e,t);if(!n)return;const o=window.prompt("Название подгруппы",n.title);o!=null&&await me(s=>{const d=he(s,e,t);if(!d)throw new Error(`Подгруппа '${t}' не найдена`);d.title=o.trim()||d.title})}async function zo(e,t,n){!N.value||!I.value||or(e,t,n)}async function jo(e){if(!N.value||!I.value)return;const t=ke(I.value,e);if(t){if(I.value.groups.length<=1){M.value="error",ye.value="Нельзя удалить последнюю группу.";return}window.confirm(`Удалить группу "${t.title}"?`)&&await me(n=>{const o=(n.groups||[]).findIndex(s=>s.id===e);if(o<0)return!1;n.groups.splice(o,1),w.groupKey="",w.subgroupId="",w.itemId=""})}}async function Wo(e,t){if(!N.value||!I.value)return;const n=ke(I.value,e),o=((n==null?void 0:n.subgroups)||[]).find(s=>s.id===t);if(!(!n||!o)){if(n.subgroups.length<=1){M.value="error",ye.value="В группе должна остаться хотя бы одна подгруппа.";return}window.confirm(`Удалить подгруппу "${o.title}"?`)&&await me(s=>{const d=ke(s,e);if(!d)return!1;const v=(d.subgroups||[]).findIndex(k=>k.id===t);if(v<0)return!1;d.subgroups.splice(v,1),w.subgroupId="",w.itemId=""})}}async function qo(e,t,n){if(!N.value||!I.value)return;const o=he(I.value,e,t),s=((o==null?void 0:o.items)||[]).find(d=>d.id===n);if(!(!o||!s)){if(o.items.length<=1){M.value="error",ye.value="В подгруппе должен остаться хотя бы один элемент.";return}window.confirm(`Удалить сервис "${s.title}"?`)&&await me(d=>{const v=he(d,e,t);if(!v)return!1;const k=(v.items||[]).findIndex(F=>F.id===n);if(k<0)return!1;v.items.splice(k,1),w.itemId===n&&(w.itemId="")})}}function qe(){P.type="",P.groupId="",P.subgroupId="",P.itemId=""}function Jo(e,t){if(!N.value||!jt(t))return;const n=t.id;P.type="group",P.groupId=n,P.subgroupId="",P.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`group:${n}`))}function Yo(e,t,n){N.value&&(P.type="subgroup",P.groupId=t,P.subgroupId=n,P.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`subgroup:${n}`)))}function Qo(e,t,n,o){N.value&&(P.type="item",P.groupId=t,P.subgroupId=n,P.itemId=o,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`item:${o}`)))}function Zo(e,t){if(!N.value||!jt(t))return;const n=t.id;P.type==="group"&&P.groupId!==n&&e.preventDefault()}async function Xo(e,t){if(!N.value||!jt(t))return;const n=t.id;if(P.type!=="group"||!P.groupId||P.groupId===n)return;e.preventDefault();const o=P.groupId;qe(),await me(s=>qr(s,o,n))}function ei(e,t,n){if(N.value){if(P.type==="subgroup"){if(P.subgroupId===n)return;e.preventDefault();return}P.type==="item"&&e.preventDefault()}}async function ti(e,t,n){if(N.value){if(P.type==="subgroup"){e.preventDefault();const o=P.groupId,s=P.subgroupId;qe(),await me(d=>Jr(d,o,s,t,n));return}if(P.type==="item"){e.preventDefault();const o=P.groupId,s=P.subgroupId,d=P.itemId;qe(),await me(v=>Qr(v,o,s,d,t,n))}}}function ni(e,t,n,o){N.value&&P.type==="item"&&P.itemId!==o&&e.preventDefault()}async function ri(e,t,n,o){if(!N.value||P.type!=="item"||!P.itemId||P.itemId===o)return;e.preventDefault();const s=P.groupId,d=P.subgroupId,v=P.itemId;qe(),await me(k=>Yr(k,s,d,v,t,n,o))}function sr(e){return(e==null?void 0:e.type)==="widget_row"||(e==null?void 0:e.type)==="widget_grid"}function ar(e=[]){return e.map(t=>Bt.value.get(t)).filter(Boolean)}function gt(e){return h.has(String((e==null?void 0:e.type)||""))}function oi(e){return wr(e).slice(0,2)}function lr(e){const t=Gt.value.find(n=>n.id===e);!t||!gt(t)||(Z.value=t.id)}function ii(e){gt(e)&&lr(e.id)}function dn(e=[]){const t=[];for(const n of e){const o=on.value.get(n);if(o){t.push({key:`group:${o.id}`,id:o.id,title:o.title,icon:o.icon||null,description:o.description||"",layout:o.layout||"auto",subgroups:o.subgroups||[]});continue}const s=Wn.value.get(n);s&&t.push({key:`subgroup:${s.subgroup.id}`,id:s.group.id,title:s.group.title,icon:s.group.icon||null,description:s.group.description||"",layout:s.group.layout||"auto",subgroups:[s.subgroup]})}return t}function mt(){const e=new Set(We.value.map(t=>t.key));for(const t of Object.keys(ie))e.has(t)||delete ie[t];for(const t of We.value)ie[t.key]==null&&(ie[t.key]=!0);w.groupKey&&!e.has(w.groupKey)&&Nt()}function Nt(){w.groupKey="",w.subgroupId="",w.itemId=""}function si(e){try{return new URL(String(e||"")).hostname||""}catch{return""}}function ai(e,t,n){const o=String((e==null?void 0:e.site)||"").trim();if(o)return o;const s=String((t==null?void 0:t.site)||"").trim();if(s)return s;const d=(n||[]).find(v=>String(v||"").toLowerCase().startsWith("site:"));return d?String(d).slice(5).trim():""}function ur(e){return((e==null?void 0:e.tags)||[]).map(t=>String(t||"").trim()).filter(Boolean)}function li(e){const t=String(e||"");return t.startsWith("group:")&&on.value.get(t.slice(6))||null}function vt(e,t=null){return ai(e,t,ur(e))}function ui(e,t=""){const n=li((e==null?void 0:e.__originGroupKey)||t);return vt(e,n)}function cr(e=[]){return A.value==="all"?e:e.map(t=>{const n=(t.subgroups||[]).map(o=>({...o,items:(o.items||[]).filter(s=>vt(s,t).toLowerCase()===A.value)})).filter(o=>o.items.length>0);return n.length?{...t,subgroups:n}:null}).filter(Boolean)}function ci(e){const t=String(e||"all").trim().toLowerCase(),n=new Set(Mt.value.map(o=>o.value));A.value=n.has(t)?t:"all"}function dr(){st.value="",pe.value=0,Lt.value=!0}function Ut(){Lt.value=!1,st.value="",pe.value=0}function di(){if(Lt.value){Ut();return}dr()}function fr(){Ne.open=!0}function fi(){Ne.open=!1}function pi(){Ne.open=!Ne.open}function gi(e){st.value=String(e||""),pe.value=0}function mi(e){const t=ft.value.length-1;if(t<0){pe.value=0;return}pe.value=Math.min(Math.max(e,0),t)}function vi(e){const t=ft.value.length;if(!t){pe.value=0;return}const o=(pe.value+e+t)%t;pe.value=o}function bi(e){e&&(e.pageId&&(Y.value=e.pageId),fn(e.groupKey,e.subgroupId,e.item.id))}function pr(e){if(e){if(e.type==="action"&&e.action==="open_settings_panel"){Ut(),fr();return}bi(e),In(e.item),Ut()}}function yi(){pr(Jn.value)}async function hi(e){var t;(e==null?void 0:e.type)!=="item"||!((t=e==null?void 0:e.item)!=null&&t.url)||await Cr(e.item.url)}function Ii(e){ie[e]=!mr(e),w.groupKey=e,w.subgroupId="",w.itemId=""}function gr(e,t){ie[e]=!0,w.groupKey=e,w.subgroupId=t,w.itemId=""}function fn(e,t,n){ie[e]=!0,w.groupKey=e,w.subgroupId=t,w.itemId=n}function mr(e){return!!ie[e]}function vr(e){return w.groupKey===e&&!w.subgroupId&&!w.itemId}function br(e,t){return w.groupKey===e&&w.subgroupId===t&&!w.itemId}function wi(e){return w.itemId===e}function _i(e=[]){const t=dn(e),n=cr(t),o=Dt.value?n:Ei(n),s=Ti(o),d=s.length;return s.map(v=>({...v,__visibleCount:d}))}function Si(){return!!(w.groupKey||w.subgroupId||w.itemId)}function ki(e){return String(e||"").trim()||"Без тега"}function yr(e){const t=new Set(ur(e).map(n=>ki(n)).filter(Boolean));return t.size||t.add("Без тега"),Array.from(t)}function pn(e,t,n){return{...e,__originGroupKey:t,__originSubgroupId:n}}function Ei(e=[]){return Si()?e.map(t=>{if(w.groupKey&&t.key!==w.groupKey)return null;let n=t.subgroups||[];return w.subgroupId&&(n=n.filter(o=>o.id===w.subgroupId)),w.itemId&&(n=n.map(o=>({...o,items:(o.items||[]).filter(s=>s.id===w.itemId)})).filter(o=>o.items.length>0)),n.length?{...t,subgroups:n}:null}).filter(Boolean):e}function Ci(e=[]){return e.map(t=>{const n=new Map;for(const d of t.subgroups||[])for(const v of d.items||[])for(const k of yr(v))n.has(k)||n.set(k,[]),n.get(k).push(pn(v,t.key,d.id));const s=Array.from(n.entries()).sort(([d],[v])=>d.localeCompare(v,"ru",{sensitivity:"base"})).map(([d,v])=>({id:`tag-${Ct(`${t.id}-${d}`,"tag")}`,title:`#${d}`,icon:"tag",items:v}));return s.length?{...t,subgroups:s}:null}).filter(Boolean)}function $i(e=[]){const t=new Map;for(const o of e)for(const s of o.subgroups||[])for(const d of s.items||[])for(const v of yr(d))t.has(v)||t.set(v,[]),t.get(v).push(pn(d,o.key,s.id));return Array.from(t.entries()).sort(([o],[s])=>o.localeCompare(s,"ru",{sensitivity:"base"})).map(([o,s])=>{const d=Ct(o,"tag");return{key:`tags:${d}`,id:`tags-${d}`,title:`#${o}`,icon:"tag",description:"Сервисы, сгруппированные только по тегам.",layout:"inline",subgroups:[{id:`tags-${d}-items`,title:"Сервисы",items:s}]}})}function hr(e=[]){const t=[];for(const n of e)for(const o of n.subgroups||[])for(const s of o.items||[])t.push(pn(s,n.key,o.id));return t.length?[{key:"flat:all",id:"flat-all",title:"Все сервисы",icon:"layout-grid",description:"Плоское отображение без группировки.",layout:"full",subgroups:[{id:"flat-all-items",title:"Плитка",items:t}]}]:[]}function Ti(e=[]){return Dt.value?hr(e):fe.value==="tags_in_groups"?Ci(e):fe.value==="tags"?$i(e):fe.value==="flat"?hr(e):e}function Pi(e){const t=String((e==null?void 0:e.layout)||"auto").toLowerCase();return t==="inline"?!0:t==="full"?!1:Number((e==null?void 0:e.__visibleCount)||0)>1}function Li(e){return(e.subgroups||[]).reduce((t,n)=>t+(n.items||[]).length,0)}function xi(e){return((e==null?void 0:e.items)||[]).length}function Ai(e){var n;let t=0;for(const o of e.subgroups||[])for(const s of o.items||[])(n=Qe(s.id))!=null&&n.ok&&(t+=1);return t}function Ir(){for(const e of Object.keys(dt))delete dt[e]}function gn(e){return wa(e)}function mn(e){const t=gn(e==null?void 0:e.url);return t?`${String((e==null?void 0:e.id)||"")}|${t}`:""}function Ri(e){const t=gn(e==null?void 0:e.url);if(!t)return"";const n=mn(e);return n&&dt[n]?"":`${t}/favicon.ico`}function Di(e){const t=mn(e);t&&(dt[t]=!0)}function Mi(e){return ma(e)}function Bi(e){return va(e)}function Oi(e){return ba(e)}function Gi(e){return ya(e)}function Ni(e){return ha(e)}function Je(e){return xe[e]||null}function vn(e,t){return`${e}:${t}`}function Ui(e,t){return!!xt[vn(e,t)]}function Me(e,t){if(!t||typeof t!="string")return null;if(t==="$")return e;if(!t.startsWith("$."))return null;let n=e;const o=t.slice(2).split(".");for(const s of o){if(n==null)return null;const d=s.match(/^(.*)\[\*\]$/);if(d){const v=d[1],k=v?n==null?void 0:n[v]:n;return Array.isArray(k)?k:[]}n=n==null?void 0:n[s]}return n}function Vi(e){var o,s,d;const t=(o=Je(e.id))==null?void 0:o.payload;return Me(t,(d=(s=e.data)==null?void 0:s.mapping)==null?void 0:d.value)??"—"}function Fi(e){var o,s,d;const t=(o=Je(e.id))==null?void 0:o.payload;return Me(t,(d=(s=e.data)==null?void 0:s.mapping)==null?void 0:d.subtitle)??""}function Hi(e){var o,s,d;const t=(o=Je(e.id))==null?void 0:o.payload;return Me(t,(d=(s=e.data)==null?void 0:s.mapping)==null?void 0:d.trend)??""}function wr(e){var s,d;const t=(s=Je(e.id))==null?void 0:s.payload,n=((d=e.data)==null?void 0:d.mapping)||{},o=Me(t,n.items);return Array.isArray(o)?o.map(v=>{const k=Me(v,n.item_title)??"-",F=Me(v,n.item_value)??"-";return{title:k,value:F}}):[]}function Ki(e){var s,d,v;const t=(s=Je(e.id))==null?void 0:s.payload,n=(v=(d=e.data)==null?void 0:d.mapping)==null?void 0:v.rows,o=Me(t,n);return Array.isArray(o)?o:Array.isArray(t)?t:Array.isArray(t==null?void 0:t.items)?t.items:[]}function Vt(e){return e?e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/")?e:`/${e}`:""}function bt(){for(const e of At.values())clearInterval(e);At.clear()}function Ye(){lt&&(clearTimeout(lt),lt=0)}function Qe(e){return ct[e]||null}function zi(e){return!!(e!=null&&e.ok&&e.latency_ms!=null&&e.latency_ms>=u)}function bn(e){if(!e)return"unknown";const t=String(e.level||"").toLowerCase();return["online","degraded","down","unknown","indirect_failure"].includes(t)?t:zi(e)?"degraded":e.ok?"online":"down"}function ji(e){const t=Qe(e),n=bn(t);return n==="online"?"ok":n==="degraded"?"degraded":n==="down"||n==="indirect_failure"?"down":"unknown"}function Wi(e){const t=Qe(e);if(!t)return"Проверка...";const n=bn(t);return n==="online"?t.latency_ms!=null?`Online • ${t.latency_ms} ms`:"Online":n==="degraded"?t.latency_ms!=null?`Degraded • ${t.latency_ms} ms`:t.status_code!=null?`Degraded • HTTP ${t.status_code}`:t.error?`Degraded • ${t.error}`:t.reason?`Degraded • ${String(t.reason).replaceAll("_"," ")}`:"Degraded":n==="indirect_failure"?"Indirect failure":n==="down"?t.error?`Offline • ${t.error}`:t.status_code!=null?`Offline • HTTP ${t.status_code}`:"Offline":"Unknown"}async function Ze(e=null){if(!Array.isArray(e)&&!q.value)return;const t=Array.isArray(e)&&e.length?e:pt.value,n=Array.from(new Set(t.map(o=>String(o||"").trim()).filter(Boolean)));if(n.length)try{const o=await aa(n);for(const s of o.items||[])ct[s.item_id]=s}catch{for(const o of n)ct[o]||(ct[o]={item_id:o,ok:!1,checked_url:"",status_code:null,latency_ms:null,error:"healthcheck unavailable"})}}async function yn(){Ye(),await Ze(),_r()}function qi(){let e=!1,t=!1;for(const n of pt.value){const o=bn(Qe(n));if(o==="down"||o==="indirect_failure"){e=!0;break}o==="degraded"&&(t=!0)}return e?c:t?l:a}function _r(){if(Ye(),!q.value)return;const e=qi();lt=window.setTimeout(async()=>{await Ze(),_r()},e)}async function Ft(e){var s;const t=Bt.value.get(e);if(!t)return;const n=Vt((s=t.data)==null?void 0:s.endpoint);if(!n)return;xe[e]||(xe[e]={loading:!1,error:"",payload:null,lastUpdated:0});const o=xe[e];o.loading=!0,o.error="";try{o.payload=await Pe(n),o.lastUpdated=Date.now()}catch(d){o.error=(d==null?void 0:d.message)||"Ошибка загрузки виджета"}finally{o.loading=!1}}async function hn(){var t,n;bt();const e=[];for(const o of nn.value){if(e.push(Ft(o.id)),!Vt((t=o.data)==null?void 0:t.endpoint))continue;const s=Math.max(1,Number(((n=o.data)==null?void 0:n.refresh_sec)||0))*1e3,d=window.setInterval(()=>{Ft(o.id)},s);At.set(o.id,d)}await Promise.all(e)}async function Ji(e,t){const n=vn(e,t.id),o=Vt(t.endpoint);if(o){xt[n]=!0;try{await Pe(o,{method:String(t.method||"GET").toUpperCase()}),await Ft(e)}catch(s){xe[e]||(xe[e]={loading:!1,error:"",payload:null,lastUpdated:0}),xe[e].error=(s==null?void 0:s.message)||"Не удалось выполнить действие"}finally{xt[n]=!1}}}async function Sr(){var e,t,n;be.value=!0,ce.value="",M.value="idle",ye.value="",Ir();try{const o=await ia();I.value=o,(!Y.value||!Re.value.some(s=>s.id===Y.value))&&(Y.value=((e=Re.value[0])==null?void 0:e.id)||""),mt(),Zn((t=o==null?void 0:o.ui)==null?void 0:t.theme),Xn((n=o==null?void 0:o.ui)==null?void 0:n.grid),await hn(),await yn(),q.value||$r()}catch(o){ce.value=(o==null?void 0:o.message)||"Не удалось загрузить dashboard-конфигурацию",I.value=null,bt(),Ye()}finally{be.value=!1}}async function kr(e){var o,s,d,v,k,F;const t=!!(((d=(s=(o=I.value)==null?void 0:o.security)==null?void 0:s.iframe)==null?void 0:d.default_sandbox)??!0),n=(v=e==null?void 0:e.iframe)==null?void 0:v.sandbox;X.open=!0,X.title=e.title,X.src="",X.error="",X.loading=!0,X.sandbox=n==null?t:!!n,X.allow=Array.isArray((k=e==null?void 0:e.iframe)==null?void 0:k.allow)?e.iframe.allow.join("; "):"",X.referrerPolicy=((F=e==null?void 0:e.iframe)==null?void 0:F.referrer_policy)||"";try{const re=await sa(e.id);X.src=re.src}catch(re){X.error=(re==null?void 0:re.message)||"Не удалось подготовить iframe"}finally{X.loading=!1}}function Yi(){X.open=!1,X.title="",X.src="",X.error="",X.loading=!1,X.sandbox=!1,X.allow="",X.referrerPolicy=""}function Er(e){if(e.open==="same_tab"){window.location.assign(e.url);return}window.open(e.url,"_blank","noopener,noreferrer")}function Qi(e){e!=null&&e.url&&window.open(e.url,"_blank","noopener,noreferrer")}function In(e){if(e.type==="iframe"){kr(e);return}Er(e)}function wn(e){return qn.value.get(String(e||""))||""}async function _n(e){var n;const t=String(e||"");if(t&&(n=navigator.clipboard)!=null&&n.writeText)try{await navigator.clipboard.writeText(t)}catch{}}async function Cr(e){await _n(e)}async function Zi(e){const t=wn(e);t&&await _n(t)}async function Xi(e){const t=wn(e);t&&await _n(`ssh ${t}`)}async function es(e){e&&await Ze([e])}function ts(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?"—":t.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function ns(e){const t=Number(e||0);return!Number.isFinite(t)||t<=0?"—":t<1e3?`${Math.round(t)} ms`:`${(t/1e3).toFixed(2)} s`}function rs(e){e&&(at.host=e,at.open=!0)}function Sn(){at.open=!1,at.host=null}function os(e){const t=(e==null?void 0:e.open_ports)||[];return t.length?t.map(n=>n!=null&&n.service?`${n.port} (${n.service})`:`${n.port}`).join(", "):"—"}function is(e){return e?e.error?e.error:e.status_code==null?"—":`HTTP ${e.status_code}`:"—"}async function yt({silent:e=!1}={}){if(!Rt){Rt=!0,e||(en.value=!0);try{je.value=await ua(),it.value=""}catch(t){it.value=(t==null?void 0:t.message)||"Не удалось загрузить состояние сканера LAN"}finally{Rt=!1,e||(en.value=!1)}}}function ht(){ut&&(window.clearInterval(ut),ut=0)}function kn(){ht(),ut=window.setInterval(()=>{yt({silent:!0})},p)}function $r(){Ye(),ht(),bt()}async function ss(){!I.value||be.value||(await hn(),await yn(),sn.value&&(await yt({silent:!0}),kn()))}async function as(){if(!tn){tn=!0;try{q.value?await ss():$r()}finally{tn=!1}}}function Tr(){q.value=document.visibilityState!=="hidden",as()}async function ls(){var e;if(!Pt.value){Pt.value=!0;try{const t=await ca();je.value=(t==null?void 0:t.state)||je.value,it.value=t!=null&&t.accepted||(e=t==null?void 0:t.state)!=null&&e.queued?"":(t==null?void 0:t.message)||""}catch(t){it.value=(t==null?void 0:t.message)||"Не удалось запустить сканирование LAN"}finally{Pt.value=!1,yt({silent:!0})}}}function us(){var e,t;return((t=(e=document.documentElement)==null?void 0:e.dataset)==null?void 0:t.fxMode)||"full"}function cs(e){const t=document.documentElement;let n="high",o="1";e>=120?(n="low",o="0.42"):e>=70&&(n="medium",o="0.68"),t.dataset.motionBudget=n,t.style.setProperty("--motion-budget",o)}function ds(e){const t=us();if(t==="off")return null;const n=JSON.parse(JSON.stringify(e));return n.fps_limit=t==="lite"?34:58,t!=="lite"||(n.particles.number.value=Math.max(24,Math.round(n.particles.number.value*.56)),n.particles.opacity.value=Number((n.particles.opacity.value*.72).toFixed(2)),n.particles.move.speed=Number((n.particles.move.speed*.74).toFixed(2)),n.particles.line_linked.opacity=Number((n.particles.line_linked.opacity*.56).toFixed(2)),n.particles.line_linked.distance=Math.max(80,Math.round(n.particles.line_linked.distance*.84)),n.retina_detect=!1),n}function En(e){const t=document.getElementById(e);t&&(t.innerHTML="",delete t.dataset.particlesReady)}function fs(){En(S),En(E),En(_)}async function ps(){Ae&&(window.cancelAnimationFrame(Ae),Ae=0),Ae=window.requestAnimationFrame(async()=>{Ae=0,fs(),await Cn(),await It()})}function Pr(){ps()}async function Ht(e,t){const n=document.getElementById(e);if(!n)return;const o=ds(t);if(!o){n.innerHTML="",delete n.dataset.particlesReady;return}n.dataset.particlesReady==="1"||!await ga()||!window.particlesJS||document.getElementById(e)&&n.dataset.particlesReady!=="1"&&(n.innerHTML="",window.particlesJS(e,o),n.dataset.particlesReady="1")}async function Cn(){await Ht(S,D)}async function It(){await Promise.all([Ht(E,K),Ht(_,K)])}let Lr=!1;return se(()=>{var e;return(e=De.value)==null?void 0:e.id},async()=>{Lr?(Z.value="",oe.value="",Nt()):Lr=!0,mt(),Ze(),await Oe(),await It()}),se(()=>{var e;return(e=Qn.value)==null?void 0:e.id},async()=>{await Oe(),await It()}),se(()=>Ot.value,e=>{Z.value&&!e.includes(Z.value)&&(Z.value="")},{deep:!0}),se(()=>We.value,()=>{mt(),Ze()},{deep:!0}),se(()=>ft.value.length,e=>{if(!e){pe.value=0;return}pe.value>=e&&(pe.value=e-1)}),se(()=>Mt.value.map(e=>e.value).join("|"),()=>{Mt.value.some(e=>e.value===A.value)||(A.value="all")}),se(()=>sn.value,e=>{if(e){q.value&&(yt(),kn());return}Sn(),ht()}),se(()=>pt.value.length,e=>{cs(e)},{immediate:!0}),se(()=>({activePageId:Y.value,treeFilter:oe.value,activeIndicatorViewId:Z.value,statsExpanded:de.value,editMode:N.value,serviceCardView:te.value,serviceGroupingMode:fe.value,siteFilter:A.value,sidebarView:ne.value,settingsPanelOpen:Ne.open,selectedNode:{groupKey:w.groupKey,subgroupId:w.subgroupId,itemId:w.itemId},expandedGroups:{...ie}}),e=>{le(e)},{deep:!0}),nt(async()=>{window.addEventListener("visibilitychange",Tr),window.addEventListener("oko:fx-mode-change",Pr),await Cn(),await Sr(),await Oe(),await It()}),rt(()=>{bt(),Ye(),ht(),Sn(),window.removeEventListener("visibilitychange",Tr),window.removeEventListener("oko:fx-mode-change",Pr),Ae&&(window.cancelAnimationFrame(Ae),Ae=0),Ue&&(clearTimeout(Ue),Ue=0),delete document.documentElement.dataset.motionBudget,document.documentElement.style.removeProperty("--motion-budget"),kt=null}),kt={BRAND_ICON_BY_KEY:Qt,DEFAULT_ITEM_URL:b,EMBLEM_SRC:r,HEALTH_REFRESH_MS:a,HERO_CONTROLS_PARTICLES_ID:_,HERO_PARTICLES_CONFIG:K,HERO_TITLE_PARTICLES_ID:E,ICON_BY_KEY:Zt,ICON_RULES:po,LAN_PAGE_ID:g,LAN_SCAN_POLL_MS:p,LARGE_INDICATOR_TYPES:h,SIDEBAR_PARTICLES_CONFIG:D,SIDEBAR_PARTICLES_ID:S,actionBusy:xt,actionKey:vn,activeCommandPaletteEntry:Jn,activeIndicatorViewId:Z,activeIndicatorWidget:Qn,activePage:De,activePageGroupBlocks:xo,activePageId:Y,activePageWidgetIds:Ot,addGroup:No,addItem:Vo,addSubgroup:Uo,allItemIds:zt,allSubgroupIds:Xt,appTagline:ho,appTitle:yo,applyConfigMutation:me,applyGrid:Xn,applyTheme:Zn,authProfileOptions:Fn,buildDefaultItem:ln,buildItemFromEditorForm:ir,clampNumber:cn,clearDragState:qe,clearItemFaviconFailures:Ir,clearSelectedNode:Nt,cloneConfig:er,closeIframeModal:Yi,closeItemEditor:nr,closeLanHostModal:Sn,closeCommandPalette:Ut,closeSettingsPanel:fi,commandPaletteActiveIndex:pe,commandPaletteOpen:Lt,commandPaletteQuery:st,commandPaletteResults:ft,config:I,configError:ce,copyItemIp:Zi,copyItemSshShortcut:Xi,copyCommandPaletteEntryUrl:hi,copyUrl:Cr,createBrandIcon:L,defaultItemEditorForm:ue,dragState:P,editGroup:Ho,editItem:zo,editMode:N,editSubgroup:Ko,ensureAbsoluteUrl:an,ensurePageGroupsReference:Wr,expandedGroups:ie,faviconOriginFromUrl:gn,filteredBlockGroups:_i,filteredTreeGroups:Yn,findGroup:ke,findSubgroup:he,formatLanDuration:ns,formatLanHttpStatus:is,formatLanMoment:ts,fromToken:mo,groupById:on,groupOnlineItems:Ai,groupTotalItems:Li,healthClass:ji,healthLabel:Wi,healthPollTimer:lt,healthState:Qe,healthStates:ct,iframeModal:X,indicatorPreviewEntries:oi,initHeroParticles:It,initParticles:Ht,initSidebarParticles:Cn,initWidgetPolling:hn,isActionBusy:Ui,isDirectGroupNode:jt,isGroupExpanded:mr,isGroupSelected:vr,isIconCardView:Hn,isSidebarDetailed:rn,isSidebarHidden:Dt,isTileCardView:Kn,isCompactServiceCardView:zn,isInlineGroupLayout:Pi,isItemSelected:wi,isLanPage:sn,isLargeIndicator:gt,isSidebarIconActive:Mo,isSidebarIconOnly:_o,isSubgroupSelected:br,isWidgetBlock:sr,itemEditor:T,itemFaviconFailures:dt,itemFaviconKey:mn,itemFaviconSrc:Ri,itemIp:wn,itemSite:ui,lanCidrsLabel:ko,lanHostModal:at,lanHosts:jn,lanPortsLabel:os,lanScanActionBusy:Pt,lanScanError:it,lanScanLoading:en,lanScanPollTimer:ut,lanScanRefreshInFlight:Rt,lanScanState:je,loadConfig:Sr,loadingConfig:be,makeUniqueId:Fe,markItemFaviconFailed:Di,moveGroup:qr,moveCommandPaletteSelection:vi,moveItemBefore:Yr,moveItemToSubgroupEnd:Qr,moveSubgroup:Jr,normalizeEndpoint:Vt,normalizeIconToken:go,normalizeId:Ct,normalizeLayoutBlocks:jr,normalizeStringList:un,onGroupDragOver:Zo,onGroupDragStart:Jo,onGroupDrop:Xo,onItemCardClick:Go,onItemDragOver:ni,onItemDragStart:Qo,onItemDrop:ri,onSubgroupDragOver:ei,onSubgroupDragStart:Yo,onSubgroupDrop:ti,activateCommandPaletteEntry:pr,activateCommandPaletteSelection:yi,openCommandPalette:dr,openSettingsPanel:fr,openCreateItemEditor:rr,openEditItemEditor:or,openIframeItem:kr,openIndicatorView:lr,openItem:In,openItemInNewTab:Qi,openLanHostModal:rs,openLinkItem:Er,pageHealthSummary:Po,pages:Re,persistConfig:tr,pickSemanticIcon:ot,refreshHealth:Ze,recheckItem:es,refreshLanScanState:yt,refreshWidget:Ft,removeGroup:jo,removeItem:qo,removeSubgroup:Wo,resetWidgetPolling:bt,resolveBlockGroups:dn,resolveExpression:Me,resolveGroupIcon:Bi,resolveItemIcon:Gi,resolvePageIcon:Mi,resolveSubgroupIcon:Oi,resolveWidgetIcon:Ni,resolveWidgets:ar,runLanScanNow:ls,runWidgetAction:Ji,saveError:ye,saveStatus:M,saveStatusLabel:Eo,saveStatusTimer:Ue,setCommandPaletteActiveIndex:mi,setCommandPaletteQuery:gi,setSiteFilter:ci,settingsPanel:Ne,sidebarViewToggleTitle:So,selectItemNode:fn,selectSidebarIconNode:Oo,selectSidebarIndicator:ii,selectSubgroupNode:gr,selectedNode:w,serviceCardView:te,siteFilter:A,siteFilterOptions:Mt,serviceGroupingMode:fe,serviceGroupingOptions:wo,servicePresentationOptions:Io,sidebarIconNodeTitle:Bo,sidebarIconNodes:To,sidebarIndicatorSummary:Lo,sidebarIndicators:Gt,sidebarView:ne,startHealthPolling:yn,startLanScanPolling:kn,statCardSubtitle:Fi,statCardTrend:Hi,statCardValue:Vi,statListEntries:wr,statsExpanded:de,stopHealthPolling:Ye,stopLanScanPolling:ht,subgroupById:Wn,subgroupTotalItems:xi,submitItemEditor:Fo,syncTreeGroupsState:mt,tableRows:Ki,toggleCommandPalette:di,toggleEditMode:Ao,toggleGroupNode:Ii,toggleSettingsPanel:pi,toggleServiceCardView:Ro,toggleSidebarView:Do,treeFilter:oe,treeGroups:We,visibleTreeItemIds:pt,widgetById:Bt,widgetIntervals:At,widgetState:Je,widgetStates:xe,widgets:nn},kt}const _a=["title"],Sa={key:0,class:"item-compact-body"},ka=["src"],Ea={class:"item-tile-head"},Ca=["src"],$a={class:"item-tile-title"},Ta={class:"item-head"},Pa={class:"item-title-row"},La=["src"],xa={class:"item-type"},Aa={class:"item-url"},Ra={class:"item-health"},Da={key:0,class:"item-tags"},Ma={key:0,class:"tag-pill site-pill"},Ba={class:"item-actions"},Oa={key:1,class:"item-ssh-shortcut"},Ga={__name:"ServiceItemCard",props:{groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0},item:{type:Object,required:!0}},setup(r){const a=r,l=Jt(a,"groupKey"),c=Jt(a,"subgroupId"),u=Jt(a,"item"),p=ae(),{isIconCardView:g,isTileCardView:h,isCompactServiceCardView:b,isItemSelected:S,onItemCardClick:E,itemFaviconSrc:_,markItemFaviconFailed:D,resolveItemIcon:K,healthClass:V,healthLabel:J,itemIp:$,itemSite:G,copyItemIp:W,copyItemSshShortcut:B,openItem:R,openItemInNewTab:Le,recheckItem:Ce,copyUrl:$e}=p,le=C(()=>V(u.value.id)),ue=C(()=>J(u.value.id)),I=C(()=>$(u.value.id)),be=C(()=>`ssh ${I.value}`),ce=C(()=>G(u.value,l.value)),Y=U(!1),oe=U(!1);let de=0,Z=0;const N=C(()=>({selected:!b.value&&S(u.value.id),compact:b.value,tile:h.value,[`status-${le.value}`]:!0,"data-updated":oe.value}));function q(){de&&clearTimeout(de),Y.value=!1,window.requestAnimationFrame(()=>{Y.value=!0,de=window.setTimeout(()=>{Y.value=!1,de=0},900)})}function te(){Z&&clearTimeout(Z),oe.value=!1,window.requestAnimationFrame(()=>{oe.value=!0,Z=window.setTimeout(()=>{oe.value=!1,Z=0},1250)})}return se([le,ue],([fe,A],[ne,M])=>{ne===void 0&&M===void 0||((fe!==ne||A!==M)&&te(),A!==M&&q())}),rt(()=>{de&&(clearTimeout(de),de=0),Z&&(clearTimeout(Z),Z=0)}),(fe,A)=>{var ne;return f(),y("article",{class:j(["item-card",N.value]),title:i(b)?u.value.title:void 0,onClick:A[9]||(A[9]=M=>i(E)(l.value,c.value,u.value))},[i(g)?(f(),y("div",Sa,[i(_)(u.value)?(f(),y("img",{key:0,src:i(_)(u.value),class:"service-favicon compact-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:A[0]||(A[0]=M=>i(D)(u.value))},null,40,ka)):(f(),z(Ee(i(K)(u.value)),{key:1,class:"ui-icon item-icon compact-item-icon"})),m("span",{class:j(["health-dot compact-health-dot",le.value])},null,2)])):i(h)?(f(),y(ee,{key:1},[m("div",Ea,[i(_)(u.value)?(f(),y("img",{key:0,src:i(_)(u.value),class:"service-favicon tile-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:A[1]||(A[1]=M=>i(D)(u.value))},null,40,Ca)):(f(),z(Ee(i(K)(u.value)),{key:1,class:"ui-icon item-icon tile-item-icon"})),m("span",{class:j(["health-dot tile-health-dot",le.value])},null,2)]),m("p",$a,O(u.value.title),1)],64)):(f(),y(ee,{key:2},[m("div",Ta,[m("div",Pa,[i(_)(u.value)?(f(),y("img",{key:0,src:i(_)(u.value),class:"service-favicon item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:A[2]||(A[2]=M=>i(D)(u.value))},null,40,La)):(f(),z(Ee(i(K)(u.value)),{key:1,class:"ui-icon item-icon"})),m("h4",null,O(u.value.title),1)]),m("span",xa,O(u.value.type),1)]),m("p",Aa,O(u.value.url),1),m("div",Ra,[m("span",{class:j(["health-dot",le.value])},null,2),m("span",{class:j(["health-text",{"is-updating":Y.value}])},O(ue.value),3)]),ce.value||(ne=u.value.tags)!=null&&ne.length?(f(),y("div",Da,[ce.value?(f(),y("span",Ma,"site:"+O(ce.value),1)):H("",!0),(f(!0),y(ee,null,Se(u.value.tags,M=>(f(),y("span",{key:M,class:"tag-pill"},O(M),1))),128))])):H("",!0),m("div",Ba,[x(_e,{title:u.value.type==="iframe"?"Открыть iframe":"Открыть","aria-label":u.value.type==="iframe"?"Открыть iframe":"Открыть",onClick:A[3]||(A[3]=Q(M=>i(R)(u.value),["stop"]))},{default:ve(()=>[(f(),z(Ee(u.value.type==="iframe"?i(On):i(Gn)),{class:"ui-icon item-action-icon"}))]),_:1},8,["title","aria-label"]),x(_e,{title:"Открыть в новой вкладке","aria-label":"Открыть в новой вкладке",onClick:A[4]||(A[4]=Q(M=>i(Le)(u.value),["stop"]))},{default:ve(()=>[x(i(qs),{class:"ui-icon item-action-icon"})]),_:1}),x(_e,{title:"Recheck health","aria-label":"Recheck health",onClick:A[5]||(A[5]=Q(M=>i(Ce)(u.value.id),["stop"]))},{default:ve(()=>[x(i(Js),{class:"ui-icon item-action-icon"})]),_:1}),I.value?(f(),z(_e,{key:0,title:"Копировать IP","aria-label":"Копировать IP",onClick:A[6]||(A[6]=Q(M=>i(W)(u.value.id),["stop"]))},{default:ve(()=>[x(i(Ke),{class:"ui-icon item-action-icon"})]),_:1})):H("",!0),I.value?(f(),z(_e,{key:1,title:"Копировать SSH shortcut","aria-label":"Копировать SSH shortcut",onClick:A[7]||(A[7]=Q(M=>i(B)(u.value.id),["stop"]))},{default:ve(()=>[x(i(io),{class:"ui-icon item-action-icon"})]),_:1})):H("",!0),x(_e,{title:"Копировать URL","aria-label":"Копировать URL",onClick:A[8]||(A[8]=Q(M=>i($e)(u.value.url),["stop"]))},{default:ve(()=>[x(i(Ys),{class:"ui-icon item-action-icon"})]),_:1})]),I.value?(f(),y("p",Oa,[A[10]||(A[10]=vs(" SSH: ",-1)),m("code",null,O(be.value),1)])):H("",!0)],64))],10,_a)}}},Na={class:"virtual-item-grid"},Ua=120,xn=72,Va={__name:"VirtualizedItemGrid",props:{items:{type:Array,required:!0},groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0}},setup(r){const l=Jt(r,"items"),c=ae(),{isIconCardView:u,isTileCardView:p}=c,g=U(null),h=U(xn);let b=null;const S=C(()=>l.value.length>Ua),E=C(()=>S.value&&h.value<l.value.length),_=C(()=>S.value?l.value.slice(0,h.value):l.value);function D(){h.value=Math.min(l.value.length,h.value+xn)}function K(){h.value=xn}function V(){b&&(b.disconnect(),!(!E.value||!g.value)&&b.observe(g.value))}return se(()=>l.value,async()=>{K(),await Oe(),V()},{deep:!0}),se(()=>E.value,async()=>{await Oe(),V()}),nt(async()=>{b=new IntersectionObserver(J=>{for(const $ of J)if($.isIntersecting){D();break}},{root:null,rootMargin:"260px 0px",threshold:0}),await Oe(),V()}),rt(()=>{b==null||b.disconnect(),b=null}),(J,$)=>(f(),y("div",Na,[x(bs,{name:"item-grid-transition",tag:"div",class:j(["item-grid",{"icon-card-grid":i(u),"tile-card-grid":i(p)}])},{default:ve(()=>[(f(!0),y(ee,null,Se(_.value,G=>(f(),z(Ga,{key:G.id,"group-key":G.__originGroupKey||r.groupKey,"subgroup-id":G.__originSubgroupId||r.subgroupId,item:G},null,8,["group-key","subgroup-id","item"]))),128))]),_:1},8,["class"]),E.value?(f(),y("div",{key:0,ref_key:"sentinelRef",ref:g,class:"item-grid-sentinel","aria-hidden":"true"},null,512)):H("",!0)]))}},Fa={class:"group-header"},Ha={class:"group-title-row"},Ka={key:0,class:"subtitle"},za={class:"subgroup-title"},ja={__name:"ServiceGroupCard",props:{group:{type:Object,required:!0}},setup(r){const a=ae(),{isInlineGroupLayout:l,resolveGroupIcon:c,resolveSubgroupIcon:u}=a;return(p,g)=>(f(),y("article",{class:j(["panel group-panel",{"group-panel-inline":i(l)(r.group)}])},[m("header",Fa,[m("div",Ha,[(f(),z(Ee(i(c)(r.group)),{class:"ui-icon group-icon"})),m("h2",null,O(r.group.title),1)]),r.group.description?(f(),y("p",Ka,O(r.group.description),1)):H("",!0)]),(f(!0),y(ee,null,Se(r.group.subgroups,h=>(f(),y("section",{key:h.id,class:"subgroup"},[m("h3",za,[(f(),z(Ee(i(u)(h)),{class:"ui-icon subgroup-icon"})),m("span",null,O(h.title),1)]),x(Va,{items:h.items,"group-key":r.group.key,"subgroup-id":h.id},null,8,["items","group-key","subgroup-id"])]))),128))],2))}},Wa={class:"groups-grid"},qa={key:0,class:"panel group-panel group-empty"},Ja={key:0,class:"panel group-panel group-empty"},Ya={__name:"ServicesGroupsPanel",setup(r){const a=ae(),{activePage:l,activePageGroupBlocks:c,filteredBlockGroups:u}=a,p=U(null);let g=null;const h={duration:180,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};function b(){if(!(!g||!p.value))for(const S of p.value.querySelectorAll(".block-wrap"))S.dataset.offscreen="0",g.observe(S)}return se(()=>{var S;return[(S=l.value)==null?void 0:S.id,c.value.length]},async()=>{g&&(g.disconnect(),await Oe(),b())}),nt(async()=>{g=new IntersectionObserver(S=>{for(const E of S)E.target.dataset.offscreen=E.isIntersecting?"0":"1"},{root:null,rootMargin:"140px 0px",threshold:.02}),await Oe(),b()}),rt(()=>{g==null||g.disconnect(),g=null}),(S,E)=>(f(),y("section",{ref_key:"blocksRootRef",ref:p,class:"page-stack"},[(f(!0),y(ee,null,Se(i(c),(_,D)=>(f(),y("section",{key:`${i(l).id}:${D}:groups`,class:"block-wrap"},[Bn((f(),y("section",Wa,[(f(!0),y(ee,null,Se(i(u)(_.group_ids),K=>(f(),z(ja,{key:K.key,group:K},null,8,["group"]))),128)),i(u)(_.group_ids).length?H("",!0):(f(),y("article",qa,[...E[0]||(E[0]=[m("h2",null,"Нет данных для выбранного узла",-1),m("p",{class:"subtitle"},"Выберите другую ветку в боковом дереве.",-1)])]))])),[[i(Xr),h]])]))),128)),i(c).length?H("",!0):(f(),y("article",Ja,[...E[1]||(E[1]=[m("h2",null,"Для этой страницы нет групп",-1),m("p",{class:"subtitle"},"Откройте нужный индикатор в аккордеоне слева.",-1)])]))],512))}},Qa={key:0,class:"hero-logo-square","aria-hidden":"true"},Za=["src"],Xa=["title","aria-label","aria-selected","onClick"],el={class:"hero-page-tab-label"},tl={__name:"HeroPageTabs",setup(r){let a=!1;const l=ae(),{EMBLEM_SRC:c,isSidebarHidden:u,pages:p,activePage:g,activePageId:h,resolvePageIcon:b}=l,S=U(!a),E=C(()=>u.value);let _=0;return nt(()=>{S.value&&(_=globalThis.setTimeout(()=>{S.value=!1,a=!0},700))}),rt(()=>{_&&(globalThis.clearTimeout(_),_=0),S.value&&(a=!0)}),(D,K)=>(f(),y("nav",{class:j(["hero-page-tabs",{"hero-page-tabs--intro":S.value,"has-logo-tile":E.value}]),role:"tablist","aria-label":"Разделы"},[E.value?(f(),y("div",Qa,[m("img",{src:i(c),alt:""},null,8,Za)])):H("",!0),(f(!0),y(ee,null,Se(i(p),V=>{var J,$,G;return f(),y("button",{key:V.id,class:j(["hero-page-tab-btn",{active:((J=i(g))==null?void 0:J.id)===V.id,"hero-page-tab-btn--intro-active":S.value&&(($=i(g))==null?void 0:$.id)===V.id}]),type:"button",role:"tab",title:V.title,"aria-label":V.title,"aria-selected":((G=i(g))==null?void 0:G.id)===V.id,onClick:W=>h.value=V.id},[(f(),z(Ee(i(b)(V)),{class:"ui-icon hero-page-tab-icon"})),m("span",el,O(V.title),1)],10,Xa)}),128))],2))}},nl={class:"hero-layout"},rl={class:"hero panel hero-title-panel"},ol={class:"hero-title-content"},il={class:"hero-controls-content"},sl={key:0,id:"hero-controls-drawer",class:"hero-controls-drawer"},al=["title","aria-label"],ll=["aria-expanded","title"],ul={key:0,class:"editor-error hero-editor-error"},Zr="oko:hero-controls-open:v1",cl={__name:"ServicesHeroPanel",setup(r){const a=ae(),l=U(!1),{editMode:c,isSidebarDetailed:u,saveStatus:p,saveStatusLabel:g,saveError:h,sidebarViewToggleTitle:b,toggleEditMode:S,addGroup:E,openCommandPalette:_,openSettingsPanel:D,toggleSidebarView:K}=a;function V(){try{return window.localStorage||null}catch{return null}}return nt(()=>{const J=V();if(!J)return;const $=J.getItem(Zr);l.value=$==="1"}),se(()=>l.value,J=>{const $=V();$&&$.setItem(Zr,J?"1":"0")}),(J,$)=>(f(),y("section",nl,[m("header",rl,[$[1]||($[1]=m("div",{id:"hero-title-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),m("div",ol,[x(tl)])]),m("aside",{class:j(["panel hero-control-panel service-hero-controls",{active:i(c)}])},[$[2]||($[2]=m("div",{id:"hero-controls-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),m("div",il,[m("div",{class:j(["hero-controls-accordion",{open:l.value}])},[x(ys,{name:"hero-controls-drawer-transition"},{default:ve(()=>[l.value?(f(),y("div",sl,[x(_e,{"button-class":"hero-icon-btn hero-accordion-action editor-toggle",active:i(c),title:i(c)?"Выключить режим редактирования":"Включить режим редактирования","aria-label":i(c)?"Выключить режим редактирования":"Включить режим редактирования",onClick:i(S)},{default:ve(()=>[x(i(Nn),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),i(c)?(f(),z(_e,{key:0,"button-class":"hero-icon-btn hero-accordion-action",title:"Добавить группу","aria-label":"Добавить группу",onClick:i(E)},{default:ve(()=>[x(i(Un),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"])):H("",!0),x(_e,{"button-class":"hero-icon-btn hero-accordion-action",title:"Быстрый поиск сервисов (Ctrl/Cmd+K)","aria-label":"Быстрый поиск сервисов",onClick:i(_)},{default:ve(()=>[x(i(Qs),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"]),x(_e,{"button-class":"hero-icon-btn hero-accordion-action",title:"Панель настроек","aria-label":"Открыть панель настроек",onClick:i(D)},{default:ve(()=>[x(i(Zs),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"]),x(_e,{"button-class":"hero-icon-btn hero-accordion-action",active:!i(u),title:i(b),"aria-label":i(b),onClick:i(K)},{default:ve(()=>[x(i(uo),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),i(c)?(f(),y("span",{key:1,class:j(["hero-save-indicator hero-accordion-status",i(p)]),role:"status",title:i(g),"aria-label":i(g)},[x(i(Xs),{class:"ui-icon hero-save-icon"})],10,al)):H("",!0)])):H("",!0)]),_:1}),m("button",{class:"hero-controls-trigger",type:"button","aria-expanded":l.value,"aria-controls":"hero-controls-drawer",title:l.value?"Скрыть панель действий":"Показать панель действий",onClick:$[0]||($[0]=G=>l.value=!l.value)},[x(i(ao),{class:"ui-icon hero-action-icon"}),x(i(ea),{class:j(["ui-icon hero-accordion-caret",{open:l.value}])},null,8,["class"])],8,ll)],2),i(c)&&i(h)?(f(),y("p",ul,O(i(h)),1)):H("",!0)])],2)]))}},dl={key:0,class:"panel status-panel"},fl={key:1,class:"panel status-panel error-state"},pl={class:"subtitle"},gl={key:3,class:"panel status-panel"},ml={__name:"DashboardMainView",setup(r){const a=He(()=>we(()=>import("./IndicatorTabPanel-Oi-WR4EO.js"),__vite__mapDeps([0,1,2]))),l=He(()=>we(()=>import("./LanPageView-qhhjPDAM.js"),__vite__mapDeps([3,1,2]))),c=ae(),{activePage:u,activeIndicatorWidget:p,loadingConfig:g,configError:h,isLanPage:b,loadConfig:S}=c;return(E,_)=>{var D;return f(),y("main",{key:((D=i(u))==null?void 0:D.id)||"empty",class:j(["page",{"indicator-open":!!i(p),"page--lan":i(b)&&!i(p)}])},[i(g)?(f(),y("section",dl,[..._[1]||(_[1]=[m("h2",null,"Загрузка конфигурации...",-1),m("p",{class:"subtitle"},"Получаем dashboard-модель из backend.",-1)])])):i(h)?(f(),y("section",fl,[_[2]||(_[2]=m("h2",null,"Ошибка загрузки конфигурации",-1)),m("p",pl,O(i(h)),1),m("button",{class:"ghost",type:"button",onClick:_[0]||(_[0]=(...K)=>i(S)&&i(S)(...K))},"Повторить")])):i(u)?(f(),y(ee,{key:2},[i(p)?(f(),z(i(a),{key:0})):(f(),y(ee,{key:1},[i(b)?(f(),z(i(l),{key:0})):(f(),y(ee,{key:1},[x(cl),x(Ya)],64))],64))],64)):(f(),y("section",gl,[..._[3]||(_[3]=[m("h2",null,"Нет доступных страниц",-1),m("p",{class:"subtitle"},"Проверьте `layout.pages` в `dashboard.yaml`.",-1)])]))],2)}}},vl={class:"brand"},bl=["src"],yl={class:"brand-title"},hl={class:"brand-subtitle"},Il={__name:"SidebarHeaderTabs",setup(r){const a=ae(),{EMBLEM_SRC:l,appTitle:c,appTagline:u}=a;return(p,g)=>(f(),y("div",vl,[m("img",{src:i(l),alt:"Oko"},null,8,bl),m("div",null,[m("p",yl,O(i(c)),1),m("p",hl,O(i(u)),1)])]))}},wl={class:"sidebar-stats-accordion","aria-label":"Индикаторы"},_l=["aria-expanded"],Sl={class:"sidebar-stats-toggle-values"},kl={key:0,class:"sidebar-indicators"},El=["onClick"],Cl={class:"widget-head sidebar-indicator-head"},$l={class:"widget-title"},Tl={class:"item-type"},Pl={key:0,class:"widget-error"},Ll={key:1,class:"widget-loading"},xl={class:"widget-value sidebar-indicator-value"},Al={class:"widget-subtitle"},Rl={key:0,class:"widget-trend"},Dl={key:0,class:"widget-list sidebar-list-preview"},Ml={key:1,class:"widget-empty"},Bl={class:"widget-subtitle"},Ol={key:5,class:"widget-empty"},Gl={key:6,class:"widget-actions sidebar-indicator-actions"},Nl=["onClick"],Ul=["disabled","onClick"],Vl={key:1,class:"widget-empty"},Fl={__name:"SidebarIndicatorsAccordion",setup(r){const a=ae(),{statsExpanded:l,sidebarIndicatorSummary:c,sidebarIndicators:u,isLargeIndicator:p,activeIndicatorWidget:g,selectSidebarIndicator:h,resolveWidgetIcon:b,widgetState:S,statCardValue:E,statCardSubtitle:_,statCardTrend:D,indicatorPreviewEntries:K,tableRows:V,openIndicatorView:J,isActionBusy:$,runWidgetAction:G}=a;return(W,B)=>(f(),y("div",wl,[m("button",{class:"sidebar-stats-toggle",type:"button","aria-controls":"sidebar-stats-panel","aria-expanded":i(l),onClick:B[0]||(B[0]=R=>l.value=!i(l))},[B[1]||(B[1]=m("span",{class:"sidebar-stats-toggle-text"},"Индикаторы",-1)),m("span",Sl,O(i(c)),1),m("span",{class:j(["sidebar-stats-toggle-caret",{open:i(l)}])},"▴",2)],8,_l),m("div",{id:"sidebar-stats-panel",class:j(["sidebar-stats-panel",{open:i(l)}])},[i(u).length?(f(),y("div",kl,[(f(!0),y(ee,null,Se(i(u),R=>{var Le,Ce,$e,le,ue;return f(),y("article",{key:R.id,class:j(["sidebar-indicator",{interactive:i(p)(R),active:((Le=i(g))==null?void 0:Le.id)===R.id}]),onClick:I=>i(h)(R)},[m("header",Cl,[m("div",$l,[(f(),z(Ee(i(b)(R)),{class:"ui-icon widget-icon"})),m("h3",null,O(R.title),1)]),m("span",Tl,O(R.type),1)]),(Ce=i(S)(R.id))!=null&&Ce.error?(f(),y("p",Pl,O(($e=i(S)(R.id))==null?void 0:$e.error),1)):(le=i(S)(R.id))!=null&&le.loading?(f(),y("p",Ll,"Обновление...")):R.type==="stat_card"?(f(),y(ee,{key:2},[m("p",xl,O(i(E)(R)),1),m("p",Al,O(i(_)(R)),1),i(D)(R)?(f(),y("p",Rl,O(i(D)(R)),1)):H("",!0)],64)):R.type==="stat_list"?(f(),y(ee,{key:3},[i(K)(R).length?(f(),y("ul",Dl,[(f(!0),y(ee,null,Se(i(K)(R),I=>(f(),y("li",{key:I.title+I.value},[m("span",null,O(I.title),1),m("strong",null,O(I.value),1)]))),128))])):(f(),y("p",Ml,"Нет данных")),B[2]||(B[2]=m("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):R.type==="table"?(f(),y(ee,{key:4},[m("p",Bl,"Строк: "+O(i(V)(R).length),1),B[3]||(B[3]=m("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):(f(),y("p",Ol,"Неподдерживаемый тип виджета")),(ue=R.data.actions)!=null&&ue.length||i(p)(R)?(f(),y("div",Gl,[i(p)(R)?(f(),y("button",{key:0,class:"ghost",type:"button",onClick:Q(I=>i(J)(R.id),["stop"])},"Открыть вкладку",8,Nl)):H("",!0),(f(!0),y(ee,null,Se(R.data.actions||[],I=>(f(),y("button",{key:I.id,class:"ghost",type:"button",disabled:i($)(R.id,I.id),onClick:Q(be=>i(G)(R.id,I),["stop"])},O(I.title),9,Ul))),128))])):H("",!0)],10,El)}),128))])):(f(),y("p",Vl,"Для выбранной страницы индикаторы не настроены."))],2)]))}},Hl=["draggable"],Kl={class:"tree-node-row"},zl={class:"tree-text"},jl={class:"tree-meta"},Wl={key:0,class:"tree-inline-actions"},ql={__name:"SidebarTreeSubgroupNode",props:{group:{type:Object,required:!0},subgroup:{type:Object,required:!0}},setup(r){const a=ae(),{dragState:l,editMode:c,onSubgroupDragStart:u,clearDragState:p,onSubgroupDragOver:g,onSubgroupDrop:h,isSubgroupSelected:b,selectSubgroupNode:S,resolveSubgroupIcon:E,subgroupTotalItems:_,editSubgroup:D,addItem:K,removeSubgroup:V}=a;return(J,$)=>(f(),y("li",{class:j(["tree-subgroup-item",{dragging:i(l).type==="subgroup"&&i(l).subgroupId===r.subgroup.id}]),draggable:i(c),onDragstart:$[4]||($[4]=Q(G=>i(u)(G,r.group.id,r.subgroup.id),["stop"])),onDragend:$[5]||($[5]=Q((...G)=>i(p)&&i(p)(...G),["stop"])),onDragover:$[6]||($[6]=Q(G=>i(g)(G,r.group.id,r.subgroup.id),["stop"])),onDrop:$[7]||($[7]=Q(G=>i(h)(G,r.group.id,r.subgroup.id),["stop"]))},[m("div",Kl,[m("button",{class:j(["tree-node tree-subgroup",{active:i(b)(r.group.key,r.subgroup.id)}]),type:"button",onClick:$[0]||($[0]=G=>i(S)(r.group.key,r.subgroup.id))},[(f(),z(Ee(i(E)(r.subgroup)),{class:"ui-icon tree-icon tree-sub-icon"})),m("span",zl,O(r.subgroup.title),1),m("span",jl,O(i(_)(r.subgroup)),1)],2),i(c)?(f(),y("div",Wl,[x(i(co),{class:"ui-icon tree-grip"}),m("button",{class:"tree-mini-btn",type:"button",title:"Редактировать подгруппу",onClick:$[1]||($[1]=Q(G=>i(D)(r.group.id,r.subgroup.id),["stop"]))},[x(i(Nn),{class:"ui-icon"})]),m("button",{class:"tree-mini-btn",type:"button",title:"Добавить элемент",onClick:$[2]||($[2]=Q(G=>i(K)(r.group.id,r.subgroup.id),["stop"]))},[x(i(Un),{class:"ui-icon"})]),m("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить подгруппу",onClick:$[3]||($[3]=Q(G=>i(V)(r.group.id,r.subgroup.id),["stop"]))},[x(i(fo),{class:"ui-icon"})])])):H("",!0)])],42,Hl))}},Jl=["draggable"],Yl={class:"tree-node-row"},Ql={class:"tree-text"},Zl={class:"tree-meta"},Xl={key:0,class:"tree-inline-actions"},eu={class:"tree-subgroups"},tu={__name:"SidebarTreeGroupNode",props:{group:{type:Object,required:!0}},setup(r){const a=ae(),{dragState:l,editMode:c,isDirectGroupNode:u,onGroupDragStart:p,clearDragState:g,onGroupDragOver:h,onGroupDrop:b,isGroupSelected:S,toggleGroupNode:E,isGroupExpanded:_,resolveGroupIcon:D,groupTotalItems:K,editGroup:V,addSubgroup:J,removeGroup:$}=a;return(G,W)=>(f(),y("li",{class:j(["tree-group-item",{dragging:i(l).type==="group"&&i(l).groupId===r.group.id&&i(u)(r.group)}]),draggable:i(c)&&i(u)(r.group),onDragstart:W[4]||(W[4]=Q(B=>i(p)(B,r.group),["stop"])),onDragend:W[5]||(W[5]=Q((...B)=>i(g)&&i(g)(...B),["stop"])),onDragover:W[6]||(W[6]=Q(B=>i(h)(B,r.group),["stop"])),onDrop:W[7]||(W[7]=Q(B=>i(b)(B,r.group),["stop"]))},[m("div",Yl,[m("button",{class:j(["tree-node tree-group",{active:i(S)(r.group.key)}]),type:"button",onClick:W[0]||(W[0]=B=>i(E)(r.group.key))},[m("span",{class:j(["tree-caret",{open:i(_)(r.group.key)}])},"▾",2),(f(),z(Ee(i(D)(r.group)),{class:"ui-icon tree-icon"})),m("span",Ql,O(r.group.title),1),m("span",Zl,O(i(K)(r.group)),1)],2),i(c)&&i(u)(r.group)?(f(),y("div",Xl,[x(i(co),{class:"ui-icon tree-grip"}),m("button",{class:"tree-mini-btn",type:"button",title:"Редактировать группу",onClick:W[1]||(W[1]=Q(B=>i(V)(r.group.id),["stop"]))},[x(i(Nn),{class:"ui-icon"})]),m("button",{class:"tree-mini-btn",type:"button",title:"Добавить подгруппу",onClick:W[2]||(W[2]=Q(B=>i(J)(r.group.id),["stop"]))},[x(i(Un),{class:"ui-icon"})]),m("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить группу",onClick:W[3]||(W[3]=Q(B=>i($)(r.group.id),["stop"]))},[x(i(fo),{class:"ui-icon"})])])):H("",!0)]),Bn(m("ul",eu,[(f(!0),y(ee,null,Se(r.group.subgroups,B=>(f(),z(ql,{key:B.id,group:r.group,subgroup:B},null,8,["group","subgroup"]))),128))],512),[[hs,i(_)(r.group.key)]])],42,Jl))}},nu={key:0,class:"sidebar-tree","aria-label":"Дерево сервисов"},ru={key:0,class:"tree-root"},ou={key:1,class:"tree-empty"},iu={__name:"SidebarTreePanel",setup(r){const a=ae(),{treeGroups:l,filteredTreeGroups:c}=a,u={duration:160,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};return(p,g)=>i(l).length?(f(),y("section",nu,[i(c).length?Bn((f(),y("ul",ru,[(f(!0),y(ee,null,Se(i(c),h=>(f(),z(tu,{key:h.key,group:h},null,8,["group"]))),128))])),[[i(Xr),u]]):(f(),y("p",ou,"По вашему запросу ничего не найдено."))])):H("",!0)}},su={class:"sidebar"},au={class:"sidebar-content"},lu={__name:"DashboardSidebarView",setup(r){const a=ae(),{isSidebarDetailed:l}=a;return(c,u)=>(f(),y("aside",su,[u[0]||(u[0]=m("div",{id:"sidebar-particles",class:"sidebar-particles","aria-hidden":"true"},null,-1)),m("div",au,[x(Il),i(l)?(f(),z(iu,{key:0})):H("",!0),i(l)?(f(),z(Fl,{key:1})):H("",!0)])]))}},et="http://127.0.0.1:8090";let ze={desktop:!1,mode:"web",apiBaseUrl:"",remoteBaseUrl:et,embeddedRunning:!1},Wt=null,$t=null;function vo(){return typeof window<"u"&&!!window.__TAURI_INTERNALS__}function Mn(r){const a=String(r||"").trim();return a?a.endsWith("/")?a.slice(0,-1):a:""}function qt(r,a,l){if(!(!r||typeof r!="object")){if(a in r)return r[a];if(l in r)return r[l]}}function Tt(r){const a=r,l={desktop:!!qt(a,"desktop","desktop"),mode:String((a==null?void 0:a.mode)||"web"),apiBaseUrl:Mn(qt(a,"apiBaseUrl","api_base_url")),remoteBaseUrl:Mn(qt(a,"remoteBaseUrl","remote_base_url"))||et,embeddedRunning:!!qt(a,"embeddedRunning","embedded_running")};return ze=l,typeof window<"u"&&(window.__OKO_API_BASE__=l.apiBaseUrl||"",window.__OKO_DESKTOP_RUNTIME__=l,window.dispatchEvent(new CustomEvent("oko:api-base-change",{detail:{apiBaseUrl:l.apiBaseUrl}}))),l}function uu(r){typeof window>"u"||window.dispatchEvent(new CustomEvent("oko:desktop-action",{detail:{action:String(r||"")}}))}async function cu(){const[r,a]=await Promise.all([we(()=>import("./vendor-D1bzbGly.js").then(c=>c.J),[]),we(()=>import("./vendor-D1bzbGly.js").then(c=>c.K),[])]);$t=r.invoke;const l=await $t("desktop_get_runtime_profile");return Tt(l),await a.listen("desktop://runtime-profile",c=>{Tt(c.payload)}),await a.listen("desktop://action",c=>{uu(c.payload)}),ze}function Su(){return{...ze}}async function bo(){return vo()?(Wt||(Wt=cu().catch(r=>(Wt=null,Tt({desktop:!0,mode:"remote",apiBaseUrl:et,remoteBaseUrl:et,embeddedRunning:!1}),ze))),Wt):(Tt({desktop:!1,mode:"web",apiBaseUrl:"",remoteBaseUrl:et,embeddedRunning:!1}),ze)}async function ku(r){if(!$t&&(!(await bo()).desktop||!$t))throw new Error("Desktop runtime bridge is not available");const a={mode:String((r==null?void 0:r.mode)||ze.mode),remote_base_url:Mn((r==null?void 0:r.remoteBaseUrl)||ze.remoteBaseUrl||et)},l=await $t("desktop_set_runtime_profile",a);return Tt(l)}const du={key:0,class:"desktop-window-drag-strip","data-tauri-drag-region":"","aria-hidden":"true"},fu=["src"],pu={__name:"App",setup(r){const a=()=>we(()=>import("./LanHostModal-Bp5pTARe.js"),__vite__mapDeps([4,1,5,2])),l=()=>we(()=>import("./IframeModal-BqOmNQy8.js"),__vite__mapDeps([6,5,1,2])),c=()=>we(()=>import("./ItemEditorModal-BsviEw0h.js"),__vite__mapDeps([7,1,5,2])),u=()=>we(()=>import("./DashboardSettingsModal-CpBW8lLC.js"),__vite__mapDeps([8,1,5,2])),p=()=>we(()=>import("./CommandPaletteModal-wIEP8qV5.js"),__vite__mapDeps([9,1,5,2])),g=()=>we(()=>import("./IndicatorTabPanel-Oi-WR4EO.js"),__vite__mapDeps([0,1,2])),h=()=>we(()=>import("./LanPageView-qhhjPDAM.js"),__vite__mapDeps([3,1,2])),b=He(a),S=He(l),E=He(c),_=He(u),D=He(p),K=ae(),{EMBLEM_SRC:V,closeCommandPalette:J,closeSettingsPanel:$,commandPaletteOpen:G,iframeModal:W,isSidebarHidden:B,itemEditor:R,lanHostModal:Le,openSettingsPanel:Ce,settingsPanel:$e,toggleCommandPalette:le}=K,ue=U(!1),I=vo();let be=0,ce=0,Y=0;function oe(){Promise.allSettled([a(),l(),c(),u(),p(),g(),h()])}function de(){if("requestIdleCallback"in window){Y=window.requestIdleCallback(()=>{Y=0,oe()},{timeout:2e3});return}ce=window.setTimeout(()=>{ce=0,oe()},1400)}function Z(q){if((q.metaKey||q.ctrlKey)&&!q.altKey&&!q.shiftKey&&q.key.toLowerCase()==="k"){q.preventDefault(),le();return}if(q.key==="Escape"&&G.value){q.preventDefault(),J();return}q.key==="Escape"&&$e.open&&(q.preventDefault(),$())}function N(q){var fe;const te=String(((fe=q==null?void 0:q.detail)==null?void 0:fe.action)||"");if(te){if(te==="open-search"){le();return}te==="open-settings"&&Ce()}}return nt(()=>{be=globalThis.setTimeout(()=>{ue.value=!0},1e3),window.addEventListener("keydown",Z),window.addEventListener("oko:desktop-action",N),de()}),rt(()=>{be&&(globalThis.clearTimeout(be),be=0),ce&&(window.clearTimeout(ce),ce=0),Y&&"cancelIdleCallback"in window&&(window.cancelIdleCallback(Y),Y=0),window.removeEventListener("keydown",Z),window.removeEventListener("oko:desktop-action",N)}),(q,te)=>(f(),y("div",{class:j(["shell",{"shell-motion-static":ue.value,"shell-desktop":i(I)}])},[i(I)?(f(),y("div",du)):H("",!0),m("img",{class:"center-emblem",src:i(V),alt:"","aria-hidden":"true"},null,8,fu),m("div",{class:j(["app-shell",{"sidebar-hidden":i(B)}])},[i(B)?H("",!0):(f(),z(lu,{key:0})),x(ml)],2),i(Le).open?(f(),z(i(b),{key:1})):H("",!0),i(W).open?(f(),z(i(S),{key:2})):H("",!0),i(R).open?(f(),z(i(E),{key:3})):H("",!0),i($e).open?(f(),z(i(_),{key:4})):H("",!0),i(G)?(f(),z(i(D),{key:5})):H("",!0)],2))}};async function gu(r){}function mu(){var c,u,p,g;if((u=(c=globalThis.matchMedia)==null?void 0:c.call(globalThis,"(prefers-reduced-motion: reduce)"))==null?void 0:u.matches)return"off";const a=Number(((p=globalThis.navigator)==null?void 0:p.hardwareConcurrency)||8),l=Number(((g=globalThis.navigator)==null?void 0:g.deviceMemory)||8);return a<=4||l<=4?"lite":"full"}function vu(r){const a=document.documentElement,l=a.dataset.fxMode||"";a.dataset.fxMode=r,r==="off"?a.style.setProperty("--glow-enabled","0"):r==="lite"?a.style.setProperty("--glow-enabled","0.58"):a.style.setProperty("--glow-enabled","1"),l&&l!==r&&window.dispatchEvent(new CustomEvent("oko:fx-mode-change",{detail:{mode:r,previousMode:l}}))}function bu(){var l;const r=(l=globalThis.matchMedia)==null?void 0:l.call(globalThis,"(prefers-reduced-motion: reduce)"),a=()=>vu(mu());a(),r!=null&&r.addEventListener?r.addEventListener("change",a):r!=null&&r.addListener&&r.addListener(a)}bu();gu();async function yu(){await bo(),Is(pu).use(ws).mount("#app")}yu();export{tl as _,_e as a,wu as f,Su as g,bo as i,_u as r,ku as s,ae as u};
