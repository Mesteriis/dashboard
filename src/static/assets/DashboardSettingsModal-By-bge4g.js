import{e as r,b as ae,d as ne,o as i,i as le,q as ie,k as e,u as a,c as d,F as h,m as w,n as b,t as o,l as B,y as oe,E as ue,p as c,g as L}from"./vendor-D1bzbGly.js";import{_ as de}from"./BaseModal-DEo4-NpV.js";import{u as ce,g as A,i as re,s as ve,f as pe,r as ge}from"./index-CeL_MrPf.js";import{ag as be,ah as D,ai as me,a8 as ke,aa as he,aj as ye,ak as fe}from"./vendor-icons-Cq_RiAeh.js";const _e={class:"settings-modal-header"},Ce={class:"settings-modal-grid"},we={class:"settings-modal-section"},Be={class:"settings-state-group"},De={class:"settings-state-switcher",role:"radiogroup","aria-label":"Режим отображения сервисов"},Re=["aria-pressed","onClick"],Me={class:"settings-state-group"},Se={class:"settings-state-switcher",role:"radiogroup","aria-label":"Группировка сервисов"},Ue=["aria-pressed","disabled","onClick"],$e={key:0,class:"settings-state-hint"},xe={class:"settings-state-group"},Ee={class:"settings-state-switcher wrap",role:"radiogroup","aria-label":"Фильтр по площадке"},Le=["aria-pressed","onClick"],Pe={class:"settings-modal-section settings-modal-section-wide"},Oe={class:"settings-state-group"},Fe={class:"settings-state-switcher",role:"radiogroup","aria-label":"Режим запуска проекта"},Ve=["disabled","aria-pressed"],je={class:"settings-state-group"},ze={class:"settings-state-switcher",role:"radiogroup","aria-label":"Режим клиента приложения"},Ae=["disabled","aria-pressed","onClick"],Ge={class:"settings-state-hint"},Ne={class:"settings-state-group"},He=["disabled"],Te={class:"settings-runtime-actions"},qe=["disabled"],Ke={class:"settings-nav-action-main"},Ie={key:0,class:"settings-state-hint settings-state-error"},Je={key:0,class:"settings-modal-section settings-modal-section-wide"},Qe={class:"settings-state-group"},We={class:"settings-state-switcher"},Xe={class:"settings-state-hint"},Ye={class:"settings-modal-section"},Ze={class:"settings-modal-actions"},et={class:"settings-nav-action-main"},tt={class:"settings-nav-action-main"},st={class:"settings-nav-action-main"},at={class:"settings-modal-section"},nt={class:"settings-modal-actions"},lt=["disabled"],it={class:"settings-nav-action-main"},ot={class:"settings-runtime-input settings-file-input"},ut=["disabled"],dt={key:0,class:"settings-state-hint settings-state-error"},ct={key:1,class:"settings-state-hint"},mt={__name:"DashboardSettingsModal",setup(rt){const G=ce(),{closeSettingsPanel:R,editMode:N,isSidebarHidden:M,openCommandPalette:H,serviceCardView:U,serviceGroupingMode:$,serviceGroupingOptions:T,servicePresentationOptions:q,settingsPanel:K,siteFilter:P,siteFilterOptions:I,setSiteFilter:J,toggleEditMode:O,toggleSidebarView:F,loadConfig:V}=G,l=r(A()),v=r(l.value.deploymentMode||"docker"),p=r(l.value.appClientMode||"thin"),y=r(l.value.remoteBaseUrl||"http://127.0.0.1:8090"),g=r(!1),S=r(""),f=r(!1),_=r(!1),m=r(""),k=r(""),Q=[{value:"docker",label:"Docker"},{value:"dev",label:"Dev (Vite + backend)"},{value:"app",label:"App"}],W=[{value:"thin",label:"Тонкий клиент"},{value:"thick",label:"Толстый клиент"}],x=L(()=>p.value==="thick"?"embedded":"remote"),X=L(()=>v.value!=="app"?"Для web-режимов backend управляется внешним окружением.":p.value==="thick"?l.value.embeddedRunning?"Локальный backend уже запущен.":"Локальный backend будет запущен после применения.":l.value.embeddedRunning?"После применения локальный backend будет остановлен.":"Локальный backend отключен."),j=L(()=>{if(v.value!=="app"||!l.value.desktop)return!1;const n=String(y.value||"").trim(),t=x.value!==l.value.mode;return x.value!=="remote"?t:t||n!==String(l.value.remoteBaseUrl||"").trim()});function E(){v.value=l.value.deploymentMode||(l.value.desktop?"app":"docker"),p.value=l.value.appClientMode||(l.value.mode==="embedded"?"thick":"thin"),y.value=l.value.remoteBaseUrl||"http://127.0.0.1:8090"}function Y(n){M.value||($.value=n)}function Z(){R(),H()}async function ee(){if(!(!l.value.desktop||v.value!=="app"||!j.value||g.value)){g.value=!0,S.value="";try{const n=await ve({mode:x.value,remoteBaseUrl:y.value});l.value=n,E(),await V()}catch(n){S.value=(n==null?void 0:n.message)||"Не удалось применить desktop runtime"}finally{g.value=!1}}}async function te(){if(!f.value){f.value=!0,m.value="",k.value="";try{const n=await pe(),t=new Blob([n.yaml],{type:"application/x-yaml;charset=utf-8"}),s=URL.createObjectURL(t),u=document.createElement("a");u.href=s,u.download=n.filename||"dashboard-backup.yaml",u.style.display="none",document.body.appendChild(u),u.click(),document.body.removeChild(u),URL.revokeObjectURL(s),k.value=`Backup сохранен: ${u.download}`}catch(n){m.value=(n==null?void 0:n.message)||"Не удалось скачать backup"}finally{f.value=!1}}}async function se(n){var u;const t=(n==null?void 0:n.target)||null,s=(u=t==null?void 0:t.files)==null?void 0:u[0];if(!(!s||_.value)){_.value=!0,m.value="",k.value="";try{const C=await s.text();await ge(C),await V(),k.value=`Backup импортирован: ${s.name}`}catch(C){m.value=(C==null?void 0:C.message)||"Не удалось импортировать backup"}finally{_.value=!1,t&&(t.value="")}}}ae(async()=>{const n=await re();l.value=n,E(),window.addEventListener("oko:api-base-change",z)}),ne(()=>{window.removeEventListener("oko:api-base-change",z)});function z(){l.value=A(),E()}return(n,t)=>(i(),le(de,{open:a(K).open,"backdrop-class":"settings-modal-backdrop","modal-class":"settings-modal",onBackdrop:a(R)},{default:ie(()=>[e("header",_e,[t[4]||(t[4]=e("div",null,[e("h3",null,"Настройки панели"),e("p",null,"Единая точка управления интерфейсом и режимами отображения.")],-1)),e("button",{class:"ghost",type:"button",onClick:t[0]||(t[0]=(...s)=>a(R)&&a(R)(...s))},"Закрыть")]),e("div",Ce,[e("section",we,[t[8]||(t[8]=e("h4",null,"Отображение",-1)),e("div",Be,[t[5]||(t[5]=e("p",{class:"settings-state-label"},"Вид",-1)),e("div",De,[(i(!0),d(h,null,w(a(q),s=>(i(),d("button",{key:`view:${s.value}`,class:b(["settings-state-btn",{active:a(U)===s.value}]),type:"button","aria-pressed":a(U)===s.value,onClick:u=>U.value=s.value},o(s.label),11,Re))),128))])]),e("div",Me,[t[6]||(t[6]=e("p",{class:"settings-state-label"},"Группировка",-1)),e("div",Se,[(i(!0),d(h,null,w(a(T),s=>(i(),d("button",{key:`grouping:${s.value}`,class:b(["settings-state-btn",{active:a($)===s.value}]),type:"button","aria-pressed":a($)===s.value,disabled:a(M),onClick:u=>Y(s.value)},o(s.label),11,Ue))),128))]),a(M)?(i(),d("p",$e,"Группировка недоступна при скрытом меню.")):B("",!0)]),e("div",xe,[t[7]||(t[7]=e("p",{class:"settings-state-label"},"Site",-1)),e("div",Ee,[(i(!0),d(h,null,w(a(I),s=>(i(),d("button",{key:`site:${s.value}`,class:b(["settings-state-btn",{active:a(P)===s.value}]),type:"button","aria-pressed":a(P)===s.value,onClick:u=>a(J)(s.value)},o(s.label),11,Le))),128))])])]),e("section",Pe,[t[13]||(t[13]=e("h4",null,"Режим запуска проекта",-1)),e("div",Oe,[t[9]||(t[9]=e("p",{class:"settings-state-label"},"Deployment",-1)),e("div",Fe,[(i(),d(h,null,w(Q,s=>e("button",{key:`deploy:${s.value}`,class:b(["settings-state-btn",{active:v.value===s.value}]),type:"button",disabled:s.value!==v.value,"aria-pressed":v.value===s.value},o(s.label),11,Ve)),64))]),t[10]||(t[10]=e("p",{class:"settings-state-hint"},"Режим определяется средой запуска и доступен для чтения.",-1))]),v.value==="app"?(i(),d(h,{key:0},[e("div",je,[t[11]||(t[11]=e("p",{class:"settings-state-label"},"Режим клиента",-1)),e("div",ze,[(i(),d(h,null,w(W,s=>e("button",{key:`app-client:${s.value}`,class:b(["settings-state-btn",{active:p.value===s.value}]),type:"button",disabled:g.value,"aria-pressed":p.value===s.value,onClick:u=>p.value=s.value},o(s.label),11,Ae)),64))]),e("p",Ge,o(X.value),1)]),e("div",Ne,[t[12]||(t[12]=e("p",{class:"settings-state-label"},"Remote URL",-1)),oe(e("input",{"onUpdate:modelValue":t[1]||(t[1]=s=>y.value=s),class:"settings-runtime-input",type:"text",autocomplete:"off",spellcheck:"false",placeholder:"http://127.0.0.1:8090",disabled:g.value||p.value!=="thin"},null,8,He),[[ue,y.value,void 0,{trim:!0}]])]),e("div",Te,[e("button",{class:"settings-nav-action",type:"button",disabled:g.value||!j.value,onClick:ee},[e("span",Ke,[c(a(be),{class:"ui-icon settings-nav-action-icon"}),e("span",null,o(g.value?"Применяем...":"Применить режим клиента"),1)]),c(a(D),{class:"ui-icon settings-nav-action-caret"})],8,qe)]),S.value?(i(),d("p",Ie,o(S.value),1)):B("",!0)],64)):B("",!0)]),l.value.desktop?(i(),d("section",Je,[t[15]||(t[15]=e("h4",null,"Desktop Runtime (macOS Apple Silicon)",-1)),e("div",Qe,[t[14]||(t[14]=e("p",{class:"settings-state-label"},"Текущий backend",-1)),e("div",We,[e("button",{class:b(["settings-state-btn",{active:l.value.mode==="embedded"}]),type:"button",disabled:""}," Embedded ",2),e("button",{class:b(["settings-state-btn",{active:l.value.mode==="remote"}]),type:"button",disabled:""}," Remote ",2)]),e("p",Xe,o(l.value.embeddedRunning?"Локальный backend запущен.":"Локальный backend остановлен."),1)])])):B("",!0),e("section",Ye,[t[17]||(t[17]=e("h4",null,"Быстрые действия",-1)),e("div",Ze,[e("button",{class:"settings-nav-action",type:"button",onClick:t[2]||(t[2]=(...s)=>a(F)&&a(F)(...s))},[e("span",et,[c(a(me),{class:"ui-icon settings-nav-action-icon"}),e("span",null,o(a(M)?"Показать меню":"Скрыть меню"),1)]),c(a(D),{class:"ui-icon settings-nav-action-caret"})]),e("button",{class:"settings-nav-action",type:"button",onClick:t[3]||(t[3]=(...s)=>a(O)&&a(O)(...s))},[e("span",tt,[c(a(ke),{class:"ui-icon settings-nav-action-icon"}),e("span",null,o(a(N)?"Выключить edit mode":"Включить edit mode"),1)]),c(a(D),{class:"ui-icon settings-nav-action-caret"})]),e("button",{class:"settings-nav-action",type:"button",onClick:Z},[e("span",st,[c(a(he),{class:"ui-icon settings-nav-action-icon"}),t[16]||(t[16]=e("span",null,"Открыть поиск (Ctrl/Cmd+K)",-1))]),c(a(D),{class:"ui-icon settings-nav-action-caret"})])])]),e("section",at,[t[18]||(t[18]=e("h4",null,"Backup конфигурации",-1)),e("div",nt,[e("button",{class:"settings-nav-action",type:"button",disabled:f.value,onClick:te},[e("span",it,[c(a(ye),{class:"ui-icon settings-nav-action-icon"}),e("span",null,o(f.value?"Готовим backup...":"Скачать backup (.yaml)"),1)]),c(a(D),{class:"ui-icon settings-nav-action-caret"})],8,lt),e("label",ot,[c(a(fe),{class:"ui-icon settings-nav-action-icon"}),e("span",null,o(_.value?"Импортируем backup...":"Импортировать backup (.yaml)"),1),e("input",{type:"file",accept:".yaml,.yml,text/yaml",disabled:_.value,onChange:se},null,40,ut)])]),m.value?(i(),d("p",dt,o(m.value),1)):k.value?(i(),d("p",ct,o(k.value),1)):B("",!0)])])]),_:1},8,["open","onBackdrop"]))}};export{mt as default};
