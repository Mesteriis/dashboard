const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/IndicatorTabPanel-Bmu6I7cw.js","assets/vendor-6RIulmtG.js","assets/vendor-icons-DGPNVUz1.js","assets/LanPageView-CXCrgB97.js","assets/LanHostModal-DgBH7-XE.js","assets/BaseModal--NxFBXOw.js","assets/IframeModal-BIQlRDzz.js","assets/ItemEditorModal-BY_l70zh.js","assets/DashboardSettingsModal-DgieXorP.js","assets/CommandPaletteModal-CPr6NJPu.js"])))=>i.map(i=>d[i]);
import{o as f,c as y,r as zr,n as W,h as Cr,w as le,a as Oe,b as Ke,d as Ue,e as N,f as we,g as C,u as i,i as z,j as ke,k as g,F as ee,t as B,l as F,m as he,p as P,q as ae,s as Z,v as la,x as Ft,T as ua,y as xn,z as qr,A as Wr,B as In,C as He,D as ca,E as da,M as fa}from"./vendor-6RIulmtG.js";import{s as $r,a as Tr,b as pa,c as ga,d as Pr,e as ma,f as wn,g as va,h as Lr,i as xr,j as Ar,k as ht,l as ba,m as Mr,n as ya,o as ha,p as Dr,q as Ia,r as wa,t as Sn,H as St,N as Kt,S as Fe,F as Jr,C as Yr,u as Qr,T as $n,v as Zr,w as Xr,D as Tn,x as Sa,y as _a,W as ka,A as Ea,E as Ca,z as $a,M as Or,P as Ta,B as eo,G as An,L as Mn,I as Pa,K as La,J as xa,O as Rr,Q as to,R as Gr,U as Pn,V as Aa,X as Ma,Y as Da,Z as Oa,_ as _n,$ as no,a0 as Ra,a1 as ro,a2 as Ga,a3 as Ba,a4 as oo,a5 as Na,a6 as Va,a7 as Ha,a8 as Fa,a9 as Ka,aa as Ua,ab as Dn,ac as On,ad as ja,ae as za,af as qa,ag as Wa,ah as io,ai as ao}from"./vendor-icons-DGPNVUz1.js";(function(){const u=document.createElement("link").relList;if(u&&u.supports&&u.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))d(s);new MutationObserver(s=>{for(const p of s)if(p.type==="childList")for(const m of p.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&d(m)}).observe(document,{childList:!0,subtree:!0});function l(s){const p={};return s.integrity&&(p.integrity=s.integrity),s.referrerPolicy&&(p.referrerPolicy=s.referrerPolicy),s.crossOrigin==="use-credentials"?p.credentials="include":s.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function d(s){if(s.ep)return;s.ep=!0;const p=l(s);fetch(s.href,p)}})();const Ja="modulepreload",Ya=function(r){return"/static/"+r},Br={},$e=function(u,l,d){let s=Promise.resolve();if(l&&l.length>0){document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),v=(m==null?void 0:m.nonce)||(m==null?void 0:m.getAttribute("nonce"));s=Promise.allSettled(l.map(h=>{if(h=Ya(h),h in Br)return;Br[h]=!0;const w=h.endsWith(".css"),k=w?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${h}"]${k}`))return;const I=document.createElement("link");if(I.rel=w?"stylesheet":Ja,w||(I.as="script"),I.crossOrigin="",I.href=h,v&&I.setAttribute("nonce",v),document.head.appendChild(I),w)return new Promise((T,x)=>{I.addEventListener("load",T),I.addEventListener("error",()=>x(new Error(`Unable to preload CSS for ${h}`)))})}))}function p(m){const v=new Event("vite:preloadError",{cancelable:!0});if(v.payload=m,window.dispatchEvent(v),!v.defaultPrevented)throw m}return s.then(m=>{for(const v of m||[])v.status==="rejected"&&p(v.reason);return u().catch(p)})},Qa=["type","title","aria-label","disabled"],_e={__name:"IconButton",props:{active:{type:Boolean,default:!1},disabled:{type:Boolean,default:!1},type:{type:String,default:"button"},title:{type:String,default:""},ariaLabel:{type:String,default:""},buttonClass:{type:String,default:""}},emits:["click"],setup(r){return(u,l)=>(f(),y("button",{class:W(["ghost icon-btn",[r.buttonClass,{active:r.active}]]),type:r.type,title:r.title,"aria-label":r.ariaLabel||r.title,disabled:r.disabled,onClick:l[0]||(l[0]=d=>u.$emit("click",d))},[zr(u.$slots,"default")],10,Qa))}},Za="X-Dashboard-Token";function Xa(){var l;if(typeof window>"u")return"";const r=((l=window.localStorage)==null?void 0:l.getItem("dashboard_admin_token"))||"";if(String(r).trim())return String(r).trim();const u=window.__DASHBOARD_ADMIN_TOKEN__||"";return String(u).trim()}function es(r,u,l){const d=u&&typeof r=="object"&&r!==null?r.detail:null;let s=`Request failed: ${l}`;return Array.isArray(d)?s=d.map(p=>typeof p=="object"&&p!==null&&"message"in p?String(p.message||""):JSON.stringify(p)).join("; "):typeof d=="string"&&d?s=d:typeof r=="string"&&r&&(s=r),s}async function Re(r,u={}){const{requireAdminToken:l=!1,headers:d={},...s}=u,p={};if(d instanceof Headers)d.forEach((I,T)=>{p[T]=I});else if(Array.isArray(d))for(const[I,T]of d)p[I]=String(T);else Object.assign(p,d);const m={Accept:"application/json",...p};if(l){const I=Xa();I&&(m[Za]=I)}const v=await fetch(r,{credentials:"same-origin",headers:m,...s}),w=(v.headers.get("content-type")||"").includes("application/json"),k=w?await v.json():await v.text();if(!v.ok){const T=new Error(es(k,w,v.status));throw T.status=v.status,T.body=k,T}return k}const et="/api/v1/dashboard";function ts(){return Re(`${et}/config`)}function ns(r){return Re(`${et}/iframe/${encodeURIComponent(r)}/source`,{requireAdminToken:!0})}function rs(r=[]){const u=new URLSearchParams;for(const d of r)u.append("item_id",d);const l=u.toString();return Re(`${et}/health${l?`?${l}`:""}`)}function os(r){return Re(`${et}/config`,{requireAdminToken:!0,method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)})}function is(){return Re(`${et}/lan/state`)}function as(){return Re(`${et}/lan/run`,{requireAdminToken:!0,method:"POST"})}const kn="oko-particles-js",ss="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js",ls=7e3;let It=null;function Ln(){return typeof window.particlesJS=="function"}function us(r){return new Promise(u=>{let l=!1;const d=p=>{l||(l=!0,u(p))},s=window.setTimeout(()=>{d(Ln())},ls);r.addEventListener("load",()=>{window.clearTimeout(s),d(Ln())},{once:!0}),r.addEventListener("error",()=>{window.clearTimeout(s),d(!1)},{once:!0})})}async function cs(){return typeof window>"u"||typeof document>"u"?!1:Ln()?!0:It||(It=(async()=>{let r=document.getElementById(kn)instanceof HTMLScriptElement?document.getElementById(kn):null;r||(r=document.createElement("script"),r.id=kn,r.src=ss,r.async=!0,r.defer=!0,document.head.appendChild(r));const u=await us(r);return u||(It=null),u})(),It)}function M(r){const u=`#${r.hex}`;return(l,{attrs:d})=>Cr("svg",{...d,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",role:"img","aria-hidden":"true",style:d.style?[d.style,{color:u}]:{color:u}},[Cr("path",{d:r.path})])}const Ut={homeassistant:M(Sn),"home-assistant":M(Sn),ha:M(Sn),openwrt:M(wa),adguard:M(Ia),proxmox:M(Dr),pve:M(Dr),grafana:M(ha),gitea:M(ya),jellyfin:M(Mr),jellyseerr:M(Mr),sonarr:M(ht),radarr:M(ba),lidarr:M(ht),readarr:M(ht),bazarr:M(ht),prowlarr:M(ht),qbittorrent:M(Ar),qb:M(Ar),postgres:M(xr),postgresql:M(xr),docker:M(Lr),dockge:M(Lr),cockpit:M(va),npm:M(wn),nginxproxymanager:M(wn),"nginx-proxy-manager":M(wn),nginx:M(ma),openai:M(Pr),ai:M(Pr),portainer:M(ga),ytsync:M(Tr),youtube:M(pa),youtubeshorts:M(Tr),termius:M($r),termix:M($r)},jt={home:St,house:St,дом:St,dom:St,route:Ga,net:Kt,network:Kt,сеть:Kt,dashboard:ro,infra:Fe,infrastructure:Fe,инфраструктура:Fe,server:Fe,core:Ra,ops:no,media:_n,медиа:_n,tv:_n,iot:Yr,cloud:Oa,wifi:Da,monitor:Ma,cockpit:Aa,proxmox:Fe,grafana:Qr,gitea:Pn,git:Pn,jellyfin:Jr,navidrome:Or,tunnel:Gr,tunnels:Gr,stats:to,services:Rr,service:Rr,health:Zr,alerts:$n,alert:$n,security:Xr,auth:xa,key:La,db:Tn,database:Tn,storage:Pa,link:Mn,iframe:An,terminal:eo,package:Ta,music:Or,camera:$a,eye:Ca,observability:Ea,workflow:ka,settings:_a,spark:Sa},so=[{re:/\b(home|house|dom|дом)\b/,icon:St},{re:/\b(net|network|route|vpn|edge|сеть|маршрут|туннел)\b/,icon:Kt},{re:/\b(infra|server|cluster|pve|проксмокс|инфраструктур)\b/,icon:Fe},{re:/\b(media|tv|video|stream|jellyfin|медиа)\b/,icon:Jr},{re:/\b(iot|sensor|home-assistant|умн|дом)\b/,icon:Yr},{re:/\b(stat|metric|chart|grafana|аналит|monitor)\b/,icon:Qr},{re:/\b(alert|error|warn|critical|ошиб|авар)\b/,icon:$n},{re:/\b(health|status|pulse|heart|состояни)\b/,icon:Zr},{re:/\b(auth|token|secret|lock|ключ|безопас)\b/,icon:Xr},{re:/\b(db|database|postgres|mysql|redis)\b/,icon:Tn}],Xe={page:ro,group:oo,subgroup:Ba,itemLink:Mn,itemIframe:An,widget:to};function lo(r){return String(r||"").toLowerCase().replace(/[^a-z0-9а-яё._-]+/gi," ").split(/[\s._-]+/).filter(Boolean)}function uo(r){if(Ut[r])return Ut[r];for(const[u,l]of Object.entries(Ut))if(r.includes(u))return l;if(jt[r])return jt[r];for(const[u,l]of Object.entries(jt))if(r.includes(u))return l;return null}function tt(r,u){for(const d of r)for(const s of lo(d)){const p=uo(s);if(p)return p}const l=r.map(d=>String(d||"").toLowerCase()).filter(Boolean).join(" ");for(const d of so)if(d.re.test(l))return d.icon;return u}function ds(r){return tt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],Xe.page)}function fs(r){return tt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.description],Xe.group)}function ps(r){return tt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id],Xe.subgroup)}function gs(r){return tt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,r==null?void 0:r.url,...(r==null?void 0:r.tags)||[]],(r==null?void 0:r.type)==="iframe"?Xe.itemIframe:Xe.itemLink)}function ms(r){var u;return tt([r==null?void 0:r.icon,r==null?void 0:r.title,r==null?void 0:r.id,r==null?void 0:r.type,(u=r==null?void 0:r.data)==null?void 0:u.endpoint],Xe.widget)}function _t(r,u="node"){return String(r||"").toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/(^-|-$)/g,"")||u}function Ve(r,u){const l=_t(r,"node");let d=l,s=2;for(;u.has(d);)d=`${l}-${s}`,s+=1;return d}function zt(r){const u=new Set;for(const l of r.groups||[])for(const d of l.subgroups||[])u.add(d.id);return u}function Vt(r){const u=new Set;for(const l of r.groups||[])for(const d of l.subgroups||[])for(const s of d.items||[])u.add(s.id);return u}function Se(r,u){return(r.groups||[]).find(l=>l.id===u)||null}function ye(r,u,l){const d=Se(r,u);return d&&(d.subgroups||[]).find(s=>s.id===l)||null}function Ht(r){return String((r==null?void 0:r.key)||"").startsWith("group:")}function Nr(r){var s,p;const u=new Set((r.groups||[]).map(m=>m.id)),l=zt(r),d=new Set([...u,...l]);for(const m of((s=r.layout)==null?void 0:s.pages)||[]){const v=[];for(const h of m.blocks||[]){if(h.type==="groups"){h.group_ids=(h.group_ids||[]).filter(w=>d.has(w)),h.group_ids.length&&v.push(h);continue}(h.widgets||[]).length&&v.push(h)}!v.length&&((p=r.groups)!=null&&p.length)&&v.push({type:"groups",group_ids:[r.groups[0].id]}),m.blocks=v}}function Vr(r,u,l){var m;const d=((m=r.layout)==null?void 0:m.pages)||[];if(!d.length)return;const s=d.find(v=>v.id===u)||d[0];let p=s.blocks.find(v=>v.type==="groups");if(!p){p={type:"groups",group_ids:[l]},s.blocks.push(p);return}p.group_ids.includes(l)||p.group_ids.push(l)}function Hr(r,u,l){const d=r.groups||[],s=d.findIndex(h=>h.id===u),p=d.findIndex(h=>h.id===l);if(s<0||p<0||s===p)return!1;const[m]=d.splice(s,1),v=s<p?p-1:p;return d.splice(v,0,m),!0}function Fr(r,u,l,d,s){const p=Se(r,u),m=Se(r,d);if(!p||!m)return!1;const v=(p.subgroups||[]).findIndex(k=>k.id===l),h=(m.subgroups||[]).findIndex(k=>k.id===s);if(v<0||h<0)return!1;if(u!==d&&p.subgroups.length<=1)throw new Error("В исходной группе должна остаться минимум одна подгруппа.");const[w]=p.subgroups.splice(v,1);if(u===d){const k=v<h?h-1:h;return p.subgroups.splice(k,0,w),!0}return m.subgroups.splice(h,0,w),!0}function Kr(r,u,l,d,s,p,m){const v=ye(r,u,l),h=ye(r,s,p);if(!v||!h)return!1;const w=(v.items||[]).findIndex(T=>T.id===d),k=(h.items||[]).findIndex(T=>T.id===m);if(w<0||k<0)return!1;if(l!==p&&v.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[I]=v.items.splice(w,1);if(l===p){const T=w<k?k-1:k;return v.items.splice(T,0,I),!0}return h.items.splice(k,0,I),!0}function Ur(r,u,l,d,s,p){const m=ye(r,u,l),v=ye(r,s,p);if(!m||!v)return!1;const h=(m.items||[]).findIndex(k=>k.id===d);if(h<0)return!1;if(l!==p&&m.items.length<=1)throw new Error("В исходной подгруппе должен остаться минимум один элемент.");const[w]=m.items.splice(h,1);return v.items.push(w),!0}function vs(r){const u=String(r||"").trim();if(!u)throw new Error("URL не может быть пустым");const l=/^https?:\/\//i.test(u)?u:`https://${u}`;let d;try{d=new URL(l)}catch{throw new Error(`Некорректный URL: ${u}`)}if(!["http:","https:"].includes(d.protocol))throw new Error(`Разрешены только http/https URL: ${u}`);return d.toString()}function bs(r){const u=String(r||"").trim();if(!u)return"";const l=/^https?:\/\//i.test(u)?u:`https://${u}`;try{const d=new URL(l);return["http:","https:"].includes(d.protocol)?d.origin:""}catch{return""}}let wt=null;function ue(){if(wt)return wt;const r="/static/img/emblem-mark.png",u=3e4,l=16e3,d=9e3,s=700,p=1e4,m="lan",v=new Set(["stat_list","table"]),h="https://example.com",w="sidebar-particles",k="hero-title-particles",I="hero-controls-particles",T={fps_limit:58,particles:{number:{value:88,density:{enable:!0,value_area:700}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.36,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:120,color:"#2dd4bf",opacity:.24,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},x={fps_limit:58,particles:{number:{value:92,density:{enable:!0,value_area:720}},color:{value:"#6df6e2"},shape:{type:"circle"},opacity:{value:.4,random:!0},size:{value:2.4,random:!0},line_linked:{enable:!0,distance:132,color:"#2dd4bf",opacity:.26,width:1.2},move:{enable:!0,speed:1.2}},interactivity:{events:{onhover:{enable:!1},onclick:{enable:!1},resize:!0}},retina_detect:!0},V=Object.freeze([{value:"detailed",label:"Карточки"},{value:"tile",label:"Плитка"},{value:"icon",label:"Значки"}]),te=Object.freeze([{value:"groups",label:"Только группы"},{value:"tags_in_groups",label:"Группы + теги"},{value:"tags",label:"Только теги"},{value:"flat",label:"Без групп (плитка)"}]),A=["detailed","hidden"],H=18,J=10,G="oko:dashboard-ui-state:v1",D=new Set(V.map(e=>e.value)),ce=new Set(te.map(e=>e.value));function Y(){if(typeof window>"u"||!window.localStorage)return null;try{const e=window.localStorage.getItem(G);if(!e)return null;const t=JSON.parse(e);return t&&typeof t=="object"?t:null}catch{return null}}function re(e){if(!(typeof window>"u"||!window.localStorage))try{window.localStorage.setItem(G,JSON.stringify(e))}catch{}}function oe(){return{id:"",title:"",type:"link",url:h,icon:"",siteInput:"",tagsInput:"",open:"new_tab",healthcheckEnabled:!1,healthcheckUrl:"",healthcheckIntervalSec:30,healthcheckTimeoutMs:1500,iframeSandboxMode:"default",iframeAllowInput:"",iframeReferrerPolicy:"",authProfile:""}}const E=N(null),q=N(!0),ve=N(""),ne=N(""),de=N(""),Ie=N(!1),K=N(""),R=N(!1),Te=N(typeof document>"u"?!0:document.visibilityState!=="hidden"),be=N("detailed"),Ee=N("groups"),fe=N("all"),O=N("detailed"),Q=N("idle"),U=N(""),je=N(null),qt=N(!1),kt=N(!1),nt=N(""),Et=N(!1),rt=N(""),pe=N(0),Ge=we({open:!1}),ot=we({open:!1,host:null}),Pe=we({}),Ct=we({}),$t=new Map;let it=0,Be=0,at=0,Tt=!1,Wt=!1,Le=0;const S=we({groupKey:"",subgroupId:"",itemId:""}),se=we({}),st=we({}),L=we({type:"",groupId:"",subgroupId:"",itemId:""}),lt=we({}),ge=Y();if(ge){const e=String(ge.serviceCardView||"");D.has(e)&&(be.value=e);const t=String(ge.serviceGroupingMode||"");ce.has(t)&&(Ee.value=t);const n=String(ge.sidebarView||"");A.includes(n)&&(O.value=n);const o=String(ge.siteFilter||"").trim().toLowerCase();fe.value=o||"all",ne.value=String(ge.activePageId||""),de.value=String(ge.treeFilter||""),K.value=String(ge.activeIndicatorViewId||""),Ie.value=!!ge.statsExpanded,R.value=!!ge.editMode,Ge.open=!!ge.settingsPanelOpen;const a=ge.selectedNode;a&&typeof a=="object"&&(S.groupKey=String(a.groupKey||""),S.subgroupId=String(a.subgroupId||""),S.itemId=String(a.itemId||""));const c=ge.expandedGroups;if(c&&typeof c=="object")for(const[b,_]of Object.entries(c)){const j=String(b||"");j&&(se[j]=!!_)}}const X=we({open:!1,title:"",src:"",allow:"",sandbox:!1,referrerPolicy:"",loading:!1,error:""}),$=we({open:!1,mode:"create",groupId:"",subgroupId:"",originalItemId:"",submitting:!1,error:"",form:oe()}),xe=C(()=>{var t,n;if(!E.value)return[];const e=((n=(t=E.value)==null?void 0:t.layout)==null?void 0:n.pages)||[];return e.some(o=>o.id===m)?e:[...e,{id:m,title:"LAN",icon:"network",blocks:[]}]}),Jt=C(()=>{var e;return((e=E.value)==null?void 0:e.widgets)||[]}),Rn=C(()=>{var e,t;return((t=(e=E.value)==null?void 0:e.security)==null?void 0:t.auth_profiles)||[]}),co=C(()=>{var e,t;return((t=(e=E.value)==null?void 0:e.app)==null?void 0:t.title)||"Oko"}),fo=C(()=>{var e,t;return((t=(e=E.value)==null?void 0:e.app)==null?void 0:t.tagline)||"Your Infrastructure in Sight"}),po=C(()=>V),go=C(()=>te),Gn=C(()=>be.value==="icon"),Bn=C(()=>be.value==="tile"),Nn=C(()=>Gn.value||Bn.value),Yt=C(()=>O.value!=="hidden"),Pt=C(()=>O.value==="hidden"),mo=C(()=>!1),vo=C(()=>Yt.value?"Режим меню: полное. Нажмите, чтобы скрыть меню":"Режим меню: скрыто. Нажмите, чтобы вернуть полное меню"),Vn=C(()=>{var e,t;return((t=(e=je.value)==null?void 0:e.result)==null?void 0:t.hosts)||[]}),bo=C(()=>{var t,n;const e=((n=(t=je.value)==null?void 0:t.result)==null?void 0:n.scanned_cidrs)||[];return e.length?e.join(", "):"нет данных"}),yo=C(()=>Q.value==="saving"?"Сохранение...":Q.value==="saved"?"Сохранено":Q.value==="error"?"Ошибка сохранения":R.value?"Готово":"Сохранение выключено"),Lt=C(()=>{var n;const e=new Map;for(const o of((n=E.value)==null?void 0:n.groups)||[])for(const a of o.subgroups||[])for(const c of a.items||[]){const b=pt(c,o);if(!b)continue;const _=b.toLowerCase();e.has(_)||e.set(_,b)}const t=Array.from(e.entries()).sort((o,a)=>o[1].localeCompare(a[1],"ru",{sensitivity:"base"}));return[{value:"all",label:"Все sites"},...t.map(([o,a])=>({value:o,label:a}))]}),xt=C(()=>{const e=new Map;for(const t of Jt.value)e.set(t.id,t);return e}),Qt=C(()=>{var t;const e=new Map;for(const n of((t=E.value)==null?void 0:t.groups)||[])e.set(n.id,n);return e}),Hn=C(()=>{var t;const e=new Map;for(const n of((t=E.value)==null?void 0:t.groups)||[])for(const o of n.subgroups||[])e.set(o.id,{group:n,subgroup:o});return e}),ho=C(()=>{const e=new Map;for(const t of xe.value)for(const n of t.blocks||[])if((n==null?void 0:n.type)==="groups")for(const o of n.group_ids||[])e.has(o)||e.set(o,t.id);return e}),Fn=C(()=>{const e=new Map;for(const t of Vn.value||[]){const n=String((t==null?void 0:t.ip)||"").trim();if(n)for(const o of(t==null?void 0:t.dashboard_items)||[]){const a=String((o==null?void 0:o.id)||"").trim();a&&!e.has(a)&&e.set(a,n)}}return e}),Io=C(()=>{var n;const e=[],t=ho.value;e.push({id:"action:open-settings-panel",type:"action",action:"open_settings_panel",item:null,title:"Открыть панель настроек",titleLower:"открыть панель настроек",host:"",ip:"",site:"",tagsLower:[],groupId:"",groupKey:"",groupTitle:"Команда",subgroupId:"",subgroupTitle:"Интерфейс",pageId:"",searchBlob:"открыть панель настроек settings ui интерфейс control panel параметры фильтры"});for(const o of((n=E.value)==null?void 0:n.groups)||[])for(const a of o.subgroups||[])for(const c of a.items||[]){const b=Xo(c==null?void 0:c.url),_=Fn.value.get(c.id)||"",j=(c.tags||[]).map(Ce=>String(Ce||"").trim()).filter(Boolean),ie=pt(c,o);if(fe.value!=="all"&&ie.toLowerCase()!==fe.value)continue;const Ne=t.get(o.id)||t.get(a.id)||"",De=String(c.title||"").trim(),Ze=[De,String(c.id||""),String(c.url||""),b,_,ie,String(o.title||""),String(a.title||""),...j].join(" ").toLowerCase();e.push({id:c.id,type:"item",action:"",item:c,title:De,titleLower:De.toLowerCase(),host:b.toLowerCase(),ip:_.toLowerCase(),site:ie.toLowerCase(),tagsLower:j.map(Ce=>Ce.toLowerCase()),groupId:o.id,groupKey:`group:${o.id}`,groupTitle:String(o.title||""),subgroupId:a.id,subgroupTitle:String(a.title||""),pageId:Ne,searchBlob:Ze})}return e}),ut=C(()=>{const e=String(rt.value||"").trim().toLowerCase(),t=Io.value;if(!e){const a=t.filter(b=>b.type==="action"),c=t.filter(b=>b.type!=="action").slice().sort((b,_)=>b.title.localeCompare(_.title,"ru",{sensitivity:"base"}));return[...a,...c].slice(0,J)}const n=e.split(/\s+/).filter(Boolean),o=[];for(const a of t){let c=0,b=!0;for(const _ of n){if(!a.searchBlob.includes(_)){b=!1;break}a.titleLower.startsWith(_)?c+=12:a.titleLower.includes(_)&&(c+=8),a.host.startsWith(_)?c+=7:a.host.includes(_)&&(c+=4),a.ip===_?c+=14:a.ip.includes(_)&&(c+=6),a.site&&a.site.includes(_)&&(c+=5),a.tagsLower.some(j=>j.includes(_))&&(c+=3)}b&&o.push({entry:a,score:c})}return o.sort((a,c)=>c.score!==a.score?c.score-a.score:a.entry.title.localeCompare(c.entry.title,"ru",{sensitivity:"base"})),o.slice(0,H).map(a=>a.entry)}),Kn=C(()=>ut.value[pe.value]||null),Ae=C(()=>xe.value.find(e=>e.id===ne.value)||xe.value[0]||null),Zt=C(()=>{var e;return((e=Ae.value)==null?void 0:e.id)===m}),ze=C(()=>{if(!Ae.value)return[];const e=[];for(const t of Ae.value.blocks||[])(t==null?void 0:t.type)==="groups"&&e.push(...t.group_ids||[]);return rn(e)}),Un=C(()=>{const e=or(ze.value),t=de.value.trim().toLowerCase();return t?e.map(n=>{if(String(n.title||"").toLowerCase().includes(t)||String(n.description||"").toLowerCase().includes(t))return{...n,subgroups:n.subgroups||[]};const a=(n.subgroups||[]).map(c=>{if(String(c.title||"").toLowerCase().includes(t))return{...c,items:c.items||[]};const _=(c.items||[]).filter(j=>{const ie=String(j.title||"").toLowerCase().includes(t),Ne=String(j.url||"").toLowerCase().includes(t),De=(j.tags||[]).some(Ce=>String(Ce).toLowerCase().includes(t)),Ze=pt(j,n).toLowerCase().includes(t);return ie||Ne||De||Ze});return _.length?{...c,items:_}:null}).filter(Boolean);return a.length?{...n,subgroups:a}:null}).filter(Boolean):e}),wo=C(()=>{const e=[];for(const t of Un.value){e.push({key:`group:${t.key}`,type:"group",groupKey:t.key,group:t});for(const n of t.subgroups||[])e.push({key:`subgroup:${t.key}:${n.id}`,type:"subgroup",groupKey:t.key,subgroupId:n.id,subgroup:n})}return e}),ct=C(()=>{const e=[];for(const t of ze.value)for(const n of t.subgroups||[])for(const o of n.items||[])e.push(o.id);return e}),So=C(()=>{var n;const e=ct.value;let t=0;for(const o of e)(n=Ye(o))!=null&&n.ok&&(t+=1);return{online:t,total:e.length}}),At=C(()=>{if(!Ae.value)return[];const e=[];for(const t of Ae.value.blocks||[])er(t)&&e.push(...t.widgets||[]);return Array.from(new Set(e))}),Mt=C(()=>tr(At.value)),_o=C(()=>{const e=Mt.value.length;if(!e)return"нет данных";const t=Mt.value.filter(n=>dt(n)).length;return`${e} · больших ${t}`}),ko=C(()=>{var e;return(((e=Ae.value)==null?void 0:e.blocks)||[]).filter(t=>(t==null?void 0:t.type)==="groups")}),jn=C(()=>{const e=xt.value.get(K.value);return!e||!dt(e)?null:At.value.includes(e.id)?e:null});function zn(e){if(!e)return;const t=document.documentElement;e.accent&&(t.style.setProperty("--accent",e.accent),t.style.setProperty("--accent-soft",e.accent)),e.background&&t.style.setProperty("--bg",e.background),e.border&&t.style.setProperty("--border",e.border),e.card&&(t.style.setProperty("--surface",e.card),t.style.setProperty("--surface-strong",e.card)),t.style.setProperty("--glow-enabled",e.glow===!1?"0":"1")}function qn(e){if(!e)return;const t=document.documentElement;e.gap!=null&&t.style.setProperty("--grid-gap",`${Number(e.gap)}px`),e.card_radius!=null&&t.style.setProperty("--card-radius",`${Number(e.card_radius)}px`),e.columns!=null&&t.style.setProperty("--layout-columns",String(Number(e.columns)))}function Eo(){R.value=!R.value,U.value="",R.value||qe()}function Co(){if(be.value==="detailed"){be.value="tile";return}if(be.value==="tile"){be.value="icon";return}be.value="detailed"}function $o(){O.value!=="detailed"&&O.value!=="hidden"&&(O.value="detailed");const e=A.indexOf(O.value),n=((e>=0?e:0)+1)%A.length;O.value=A[n],Yt.value||(de.value="",Dt()),Pt.value&&(Ee.value="flat")}function To(e){return e?e.type==="group"?cr(e.groupKey):e.type==="subgroup"?dr(e.groupKey,e.subgroupId):!1:!1}function Po(e){var t,n;return e?e.type==="group"?`Группа: ${((t=e.group)==null?void 0:t.title)||""}`:e.type==="subgroup"?`Подгруппа: ${((n=e.subgroup)==null?void 0:n.title)||""}`:"":""}function Lo(e){if(e){if(e.type==="group"){se[e.groupKey]=!0,S.groupKey=e.groupKey,S.subgroupId="",S.itemId="";return}e.type==="subgroup"&&lr(e.groupKey,e.subgroupId)}}function xo(e,t,n){if(!Nn.value)return;const o=(n==null?void 0:n.__originGroupKey)||e,a=(n==null?void 0:n.__originSubgroupId)||t;on(o,a,n.id),pn(n)}function Wn(e){return JSON.parse(JSON.stringify(e))}function Xt(e){return vs(e)}async function Jn(){var e;if(E.value){Q.value="saving",U.value="";try{const t=await os(E.value);E.value=t.config,(!ne.value||!xe.value.some(n=>n.id===ne.value))&&(ne.value=((e=xe.value[0])==null?void 0:e.id)||""),Q.value="saved",Be&&clearTimeout(Be),Be=window.setTimeout(()=>{Q.value==="saved"&&(Q.value="idle")},1400)}catch(t){throw Q.value="error",U.value=(t==null?void 0:t.message)||"Ошибка сохранения YAML",t}}}async function me(e){if(!E.value)return!1;const t=Wn(E.value);try{return e(E.value)===!1?!1:(Nr(E.value),ft(),await Jn(),!0)}catch(n){return E.value=t,Q.value="error",U.value=(n==null?void 0:n.message)||"Не удалось применить изменения",!1}}function en(e,t){return{id:e,type:"link",title:t,url:h,icon:null,site:null,tags:[],open:"new_tab"}}async function Ao(){if(!R.value||!E.value)return;const e=window.prompt("Название новой группы","Новая группа");if(e==null)return;const t=e.trim();t&&await me(n=>{const o=new Set((n.groups||[]).map(ie=>ie.id)),a=zt(n),c=Vt(n),b=Ve(t,o),_=Ve(`${b}-core`,a),j=Ve(`${b}-service`,c);n.groups.push({id:b,title:t,icon:"folder",description:"",layout:"auto",subgroups:[{id:_,title:"Core",items:[en(j,"Новый сервис")]}]}),Vr(n,ne.value,b),se[`group:${b}`]=!0,S.groupKey=`group:${b}`,S.subgroupId=_,S.itemId=j})}async function Mo(e){if(!R.value||!E.value)return;const t=window.prompt("Название подгруппы","Новая подгруппа");if(t==null)return;const n=t.trim();n&&await me(o=>{const a=Se(o,e);if(!a)throw new Error(`Группа '${e}' не найдена`);const c=zt(o),b=Vt(o),_=Ve(`${e}-${n}`,c),j=Ve(`${_}-service`,b);a.subgroups.push({id:_,title:n,items:[en(j,"Новый сервис")]}),se[`group:${e}`]=!0,S.groupKey=`group:${e}`,S.subgroupId=_,S.itemId=j})}async function Do(e,t){!R.value||!E.value||Qn(e,t)}function tn(e){return String(e||"").split(",").map(t=>t.trim()).filter(Boolean)}function nn(e,t,n,o){const a=Number(e);if(!Number.isFinite(a))return t;const c=Math.trunc(a);return Math.min(o,Math.max(n,c))}function Yn(e=!1){$.submitting&&!e||($.open=!1,$.mode="create",$.groupId="",$.subgroupId="",$.originalItemId="",$.error="",$.submitting=!1,$.form=oe())}function Qn(e,t){if(!ye(E.value,e,t)){Q.value="error",U.value=`Подгруппа '${t}' не найдена`;return}$.open=!0,$.mode="create",$.groupId=e,$.subgroupId=t,$.originalItemId="",$.error="",$.submitting=!1,$.form=oe()}function Zn(e,t,n){var c,b,_;const o=ye(E.value,e,t),a=((o==null?void 0:o.items)||[]).find(j=>j.id===n);if(!o||!a){Q.value="error",U.value=`Элемент '${n}' не найден`;return}$.open=!0,$.mode="edit",$.groupId=e,$.subgroupId=t,$.originalItemId=n,$.error="",$.submitting=!1,$.form={id:a.id,title:a.title,type:a.type,url:String(a.url||h),icon:a.icon||"",siteInput:String(a.site||""),tagsInput:(a.tags||[]).join(", "),open:a.open||"new_tab",healthcheckEnabled:!!(a.type==="link"&&a.healthcheck),healthcheckUrl:a.type==="link"&&a.healthcheck?String(a.healthcheck.url):String(a.url||h),healthcheckIntervalSec:a.type==="link"&&a.healthcheck?Number(a.healthcheck.interval_sec||30):30,healthcheckTimeoutMs:a.type==="link"&&a.healthcheck?Number(a.healthcheck.timeout_ms||1500):1500,iframeSandboxMode:a.type==="iframe"?((c=a.iframe)==null?void 0:c.sandbox)==null?"default":a.iframe.sandbox?"enabled":"disabled":"default",iframeAllowInput:a.type==="iframe"?(((b=a.iframe)==null?void 0:b.allow)||[]).join(", "):"",iframeReferrerPolicy:a.type==="iframe"&&((_=a.iframe)==null?void 0:_.referrer_policy)||"",authProfile:a.type==="iframe"&&a.auth_profile||""}}function Xn(e){const t=$.form,n=String(t.title||"").trim();if(!n)throw new Error("Название сервиса обязательно");const o=String(t.type||"").trim().toLowerCase();if(!["link","iframe"].includes(o))throw new Error("Тип сервиса должен быть 'link' или 'iframe'");const a=String(t.open||"new_tab");if(!["new_tab","same_tab"].includes(a))throw new Error("Параметр open должен быть 'new_tab' или 'same_tab'");const c=Xt(t.url||h),b=Vt(e);$.mode==="edit"&&b.delete($.originalItemId);const _=String(t.id||"").trim(),j=`${$.subgroupId}-${n}`,ie=_t(_||j,"service"),Ne=_?ie:Ve(ie,b);if(_&&b.has(Ne))throw new Error(`ID '${Ne}' уже существует`);const De={id:Ne,type:o,title:n,url:c,icon:String(t.icon||"").trim()||null,site:String(t.siteInput||"").trim()||null,tags:tn(t.tagsInput),open:a};if(o==="link"){const Nt={...De};if(t.healthcheckEnabled){const sa=Xt(t.healthcheckUrl||c);Nt.healthcheck={type:"http",url:sa,interval_sec:nn(t.healthcheckIntervalSec,30,1,3600),timeout_ms:nn(t.healthcheckTimeoutMs,1500,100,12e4)}}return Nt}const Ze=String(t.iframeSandboxMode||"default");let Ce=null;Ze==="enabled"&&(Ce=!0),Ze==="disabled"&&(Ce=!1);const yt=String(t.authProfile||"").trim();if(yt&&!Rn.value.some(Nt=>Nt.id===yt))throw new Error(`Auth profile '${yt}' не найден`);const Er={...De,iframe:{sandbox:Ce,allow:tn(t.iframeAllowInput),referrer_policy:String(t.iframeReferrerPolicy||"").trim()||null}};return yt&&(Er.auth_profile=yt),Er}async function Oo(){if(!$.open||$.submitting||!E.value)return;$.submitting=!0,$.error="";const e=await me(t=>{const n=ye(t,$.groupId,$.subgroupId);if(!n)throw new Error(`Подгруппа '${$.subgroupId}' не найдена`);const o=Xn(t);if($.mode==="create")return n.items.push(o),S.groupKey=`group:${$.groupId}`,S.subgroupId=$.subgroupId,S.itemId=o.id,!0;const a=(n.items||[]).findIndex(c=>c.id===$.originalItemId);if(a<0)throw new Error(`Элемент '${$.originalItemId}' не найден`);return n.items.splice(a,1,o),S.groupKey=`group:${$.groupId}`,S.subgroupId=$.subgroupId,(S.itemId===$.originalItemId||!S.itemId)&&(S.itemId=o.id),!0});$.submitting=!1,e?Yn(!0):$.error=U.value||"Не удалось сохранить сервис"}async function Ro(e){if(!R.value||!E.value)return;const t=Se(E.value,e);if(!t)return;const n=window.prompt("Название группы",t.title);if(n==null)return;const o=window.prompt("Описание группы",t.description||"");if(o==null)return;const a=window.prompt("Режим группы (auto | full | inline)",t.layout||"auto");a!=null&&await me(c=>{const b=Se(c,e);if(!b)throw new Error(`Группа '${e}' не найдена`);const _=String(a||"").trim().toLowerCase()||"auto";if(!["auto","full","inline"].includes(_))throw new Error("Режим группы должен быть 'auto', 'full' или 'inline'");b.title=n.trim()||b.title,b.description=o.trim(),b.layout=_})}async function Go(e,t){if(!R.value||!E.value)return;const n=ye(E.value,e,t);if(!n)return;const o=window.prompt("Название подгруппы",n.title);o!=null&&await me(a=>{const c=ye(a,e,t);if(!c)throw new Error(`Подгруппа '${t}' не найдена`);c.title=o.trim()||c.title})}async function Bo(e,t,n){!R.value||!E.value||Zn(e,t,n)}async function No(e){if(!R.value||!E.value)return;const t=Se(E.value,e);if(t){if(E.value.groups.length<=1){Q.value="error",U.value="Нельзя удалить последнюю группу.";return}window.confirm(`Удалить группу "${t.title}"?`)&&await me(n=>{const o=(n.groups||[]).findIndex(a=>a.id===e);if(o<0)return!1;n.groups.splice(o,1),S.groupKey="",S.subgroupId="",S.itemId=""})}}async function Vo(e,t){if(!R.value||!E.value)return;const n=Se(E.value,e),o=((n==null?void 0:n.subgroups)||[]).find(a=>a.id===t);if(!(!n||!o)){if(n.subgroups.length<=1){Q.value="error",U.value="В группе должна остаться хотя бы одна подгруппа.";return}window.confirm(`Удалить подгруппу "${o.title}"?`)&&await me(a=>{const c=Se(a,e);if(!c)return!1;const b=(c.subgroups||[]).findIndex(_=>_.id===t);if(b<0)return!1;c.subgroups.splice(b,1),S.subgroupId="",S.itemId=""})}}async function Ho(e,t,n){if(!R.value||!E.value)return;const o=ye(E.value,e,t),a=((o==null?void 0:o.items)||[]).find(c=>c.id===n);if(!(!o||!a)){if(o.items.length<=1){Q.value="error",U.value="В подгруппе должен остаться хотя бы один элемент.";return}window.confirm(`Удалить сервис "${a.title}"?`)&&await me(c=>{const b=ye(c,e,t);if(!b)return!1;const _=(b.items||[]).findIndex(j=>j.id===n);if(_<0)return!1;b.items.splice(_,1),S.itemId===n&&(S.itemId="")})}}function qe(){L.type="",L.groupId="",L.subgroupId="",L.itemId=""}function Fo(e,t){if(!R.value||!Ht(t))return;const n=t.id;L.type="group",L.groupId=n,L.subgroupId="",L.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`group:${n}`))}function Ko(e,t,n){R.value&&(L.type="subgroup",L.groupId=t,L.subgroupId=n,L.itemId="",e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`subgroup:${n}`)))}function Uo(e,t,n,o){R.value&&(L.type="item",L.groupId=t,L.subgroupId=n,L.itemId=o,e.dataTransfer&&(e.dataTransfer.effectAllowed="move",e.dataTransfer.setData("text/plain",`item:${o}`)))}function jo(e,t){if(!R.value||!Ht(t))return;const n=t.id;L.type==="group"&&L.groupId!==n&&e.preventDefault()}async function zo(e,t){if(!R.value||!Ht(t))return;const n=t.id;if(L.type!=="group"||!L.groupId||L.groupId===n)return;e.preventDefault();const o=L.groupId;qe(),await me(a=>Hr(a,o,n))}function qo(e,t,n){if(R.value){if(L.type==="subgroup"){if(L.subgroupId===n)return;e.preventDefault();return}L.type==="item"&&e.preventDefault()}}async function Wo(e,t,n){if(R.value){if(L.type==="subgroup"){e.preventDefault();const o=L.groupId,a=L.subgroupId;qe(),await me(c=>Fr(c,o,a,t,n));return}if(L.type==="item"){e.preventDefault();const o=L.groupId,a=L.subgroupId,c=L.itemId;qe(),await me(b=>Ur(b,o,a,c,t,n))}}}function Jo(e,t,n,o){R.value&&L.type==="item"&&L.itemId!==o&&e.preventDefault()}async function Yo(e,t,n,o){if(!R.value||L.type!=="item"||!L.itemId||L.itemId===o)return;e.preventDefault();const a=L.groupId,c=L.subgroupId,b=L.itemId;qe(),await me(_=>Kr(_,a,c,b,t,n,o))}function er(e){return(e==null?void 0:e.type)==="widget_row"||(e==null?void 0:e.type)==="widget_grid"}function tr(e=[]){return e.map(t=>xt.value.get(t)).filter(Boolean)}function dt(e){return v.has(String((e==null?void 0:e.type)||""))}function Qo(e){return mr(e).slice(0,2)}function nr(e){const t=Mt.value.find(n=>n.id===e);!t||!dt(t)||(K.value=t.id)}function Zo(e){dt(e)&&nr(e.id)}function rn(e=[]){const t=[];for(const n of e){const o=Qt.value.get(n);if(o){t.push({key:`group:${o.id}`,id:o.id,title:o.title,icon:o.icon||null,description:o.description||"",layout:o.layout||"auto",subgroups:o.subgroups||[]});continue}const a=Hn.value.get(n);a&&t.push({key:`subgroup:${a.subgroup.id}`,id:a.group.id,title:a.group.title,icon:a.group.icon||null,description:a.group.description||"",layout:a.group.layout||"auto",subgroups:[a.subgroup]})}return t}function ft(){const e=new Set(ze.value.map(t=>t.key));for(const t of Object.keys(se))e.has(t)||delete se[t];for(const t of ze.value)se[t.key]==null&&(se[t.key]=!0);S.groupKey&&!e.has(S.groupKey)&&Dt()}function Dt(){S.groupKey="",S.subgroupId="",S.itemId=""}function Xo(e){try{return new URL(String(e||"")).hostname||""}catch{return""}}function ei(e,t,n){const o=String((e==null?void 0:e.site)||"").trim();if(o)return o;const a=String((t==null?void 0:t.site)||"").trim();if(a)return a;const c=(n||[]).find(b=>String(b||"").toLowerCase().startsWith("site:"));return c?String(c).slice(5).trim():""}function rr(e){return((e==null?void 0:e.tags)||[]).map(t=>String(t||"").trim()).filter(Boolean)}function ti(e){const t=String(e||"");return t.startsWith("group:")&&Qt.value.get(t.slice(6))||null}function pt(e,t=null){return ei(e,t,rr(e))}function ni(e,t=""){const n=ti((e==null?void 0:e.__originGroupKey)||t);return pt(e,n)}function or(e=[]){return fe.value==="all"?e:e.map(t=>{const n=(t.subgroups||[]).map(o=>({...o,items:(o.items||[]).filter(a=>pt(a,t).toLowerCase()===fe.value)})).filter(o=>o.items.length>0);return n.length?{...t,subgroups:n}:null}).filter(Boolean)}function ri(e){const t=String(e||"all").trim().toLowerCase(),n=new Set(Lt.value.map(o=>o.value));fe.value=n.has(t)?t:"all"}function ir(){rt.value="",pe.value=0,Et.value=!0}function Ot(){Et.value=!1,rt.value="",pe.value=0}function oi(){if(Et.value){Ot();return}ir()}function ar(){Ge.open=!0}function ii(){Ge.open=!1}function ai(){Ge.open=!Ge.open}function si(e){rt.value=String(e||""),pe.value=0}function li(e){const t=ut.value.length-1;if(t<0){pe.value=0;return}pe.value=Math.min(Math.max(e,0),t)}function ui(e){const t=ut.value.length;if(!t){pe.value=0;return}const o=(pe.value+e+t)%t;pe.value=o}function ci(e){e&&(e.pageId&&(ne.value=e.pageId),on(e.groupKey,e.subgroupId,e.item.id))}function sr(e){if(e){if(e.type==="action"&&e.action==="open_settings_panel"){Ot(),ar();return}ci(e),pn(e.item),Ot()}}function di(){sr(Kn.value)}async function fi(e){var t;(e==null?void 0:e.type)!=="item"||!((t=e==null?void 0:e.item)!=null&&t.url)||await Ir(e.item.url)}function pi(e){se[e]=!ur(e),S.groupKey=e,S.subgroupId="",S.itemId=""}function lr(e,t){se[e]=!0,S.groupKey=e,S.subgroupId=t,S.itemId=""}function on(e,t,n){se[e]=!0,S.groupKey=e,S.subgroupId=t,S.itemId=n}function ur(e){return!!se[e]}function cr(e){return S.groupKey===e&&!S.subgroupId&&!S.itemId}function dr(e,t){return S.groupKey===e&&S.subgroupId===t&&!S.itemId}function gi(e){return S.itemId===e}function mi(e=[]){const t=rn(e),n=or(t),o=Pt.value?n:yi(n),a=wi(o),c=a.length;return a.map(b=>({...b,__visibleCount:c}))}function vi(){return!!(S.groupKey||S.subgroupId||S.itemId)}function bi(e){return String(e||"").trim()||"Без тега"}function fr(e){const t=new Set(rr(e).map(n=>bi(n)).filter(Boolean));return t.size||t.add("Без тега"),Array.from(t)}function an(e,t,n){return{...e,__originGroupKey:t,__originSubgroupId:n}}function yi(e=[]){return vi()?e.map(t=>{if(S.groupKey&&t.key!==S.groupKey)return null;let n=t.subgroups||[];return S.subgroupId&&(n=n.filter(o=>o.id===S.subgroupId)),S.itemId&&(n=n.map(o=>({...o,items:(o.items||[]).filter(a=>a.id===S.itemId)})).filter(o=>o.items.length>0)),n.length?{...t,subgroups:n}:null}).filter(Boolean):e}function hi(e=[]){return e.map(t=>{const n=new Map;for(const c of t.subgroups||[])for(const b of c.items||[])for(const _ of fr(b))n.has(_)||n.set(_,[]),n.get(_).push(an(b,t.key,c.id));const a=Array.from(n.entries()).sort(([c],[b])=>c.localeCompare(b,"ru",{sensitivity:"base"})).map(([c,b])=>({id:`tag-${_t(`${t.id}-${c}`,"tag")}`,title:`#${c}`,icon:"tag",items:b}));return a.length?{...t,subgroups:a}:null}).filter(Boolean)}function Ii(e=[]){const t=new Map;for(const o of e)for(const a of o.subgroups||[])for(const c of a.items||[])for(const b of fr(c))t.has(b)||t.set(b,[]),t.get(b).push(an(c,o.key,a.id));return Array.from(t.entries()).sort(([o],[a])=>o.localeCompare(a,"ru",{sensitivity:"base"})).map(([o,a])=>{const c=_t(o,"tag");return{key:`tags:${c}`,id:`tags-${c}`,title:`#${o}`,icon:"tag",description:"Сервисы, сгруппированные только по тегам.",layout:"inline",subgroups:[{id:`tags-${c}-items`,title:"Сервисы",items:a}]}})}function pr(e=[]){const t=[];for(const n of e)for(const o of n.subgroups||[])for(const a of o.items||[])t.push(an(a,n.key,o.id));return t.length?[{key:"flat:all",id:"flat-all",title:"Все сервисы",icon:"layout-grid",description:"Плоское отображение без группировки.",layout:"full",subgroups:[{id:"flat-all-items",title:"Плитка",items:t}]}]:[]}function wi(e=[]){return Pt.value?pr(e):Ee.value==="tags_in_groups"?hi(e):Ee.value==="tags"?Ii(e):Ee.value==="flat"?pr(e):e}function Si(e){const t=String((e==null?void 0:e.layout)||"auto").toLowerCase();return t==="inline"?!0:t==="full"?!1:Number((e==null?void 0:e.__visibleCount)||0)>1}function _i(e){return(e.subgroups||[]).reduce((t,n)=>t+(n.items||[]).length,0)}function ki(e){return((e==null?void 0:e.items)||[]).length}function Ei(e){var n;let t=0;for(const o of e.subgroups||[])for(const a of o.items||[])(n=Ye(a.id))!=null&&n.ok&&(t+=1);return t}function gr(){for(const e of Object.keys(lt))delete lt[e]}function sn(e){return bs(e)}function ln(e){const t=sn(e==null?void 0:e.url);return t?`${String((e==null?void 0:e.id)||"")}|${t}`:""}function Ci(e){const t=sn(e==null?void 0:e.url);if(!t)return"";const n=ln(e);return n&&lt[n]?"":`${t}/favicon.ico`}function $i(e){const t=ln(e);t&&(lt[t]=!0)}function Ti(e){return ds(e)}function Pi(e){return fs(e)}function Li(e){return ps(e)}function xi(e){return gs(e)}function Ai(e){return ms(e)}function We(e){return Pe[e]||null}function un(e,t){return`${e}:${t}`}function Mi(e,t){return!!Ct[un(e,t)]}function Me(e,t){if(!t||typeof t!="string")return null;if(t==="$")return e;if(!t.startsWith("$."))return null;let n=e;const o=t.slice(2).split(".");for(const a of o){if(n==null)return null;const c=a.match(/^(.*)\[\*\]$/);if(c){const b=c[1],_=b?n==null?void 0:n[b]:n;return Array.isArray(_)?_:[]}n=n==null?void 0:n[a]}return n}function Di(e){var o,a,c;const t=(o=We(e.id))==null?void 0:o.payload;return Me(t,(c=(a=e.data)==null?void 0:a.mapping)==null?void 0:c.value)??"—"}function Oi(e){var o,a,c;const t=(o=We(e.id))==null?void 0:o.payload;return Me(t,(c=(a=e.data)==null?void 0:a.mapping)==null?void 0:c.subtitle)??""}function Ri(e){var o,a,c;const t=(o=We(e.id))==null?void 0:o.payload;return Me(t,(c=(a=e.data)==null?void 0:a.mapping)==null?void 0:c.trend)??""}function mr(e){var a,c;const t=(a=We(e.id))==null?void 0:a.payload,n=((c=e.data)==null?void 0:c.mapping)||{},o=Me(t,n.items);return Array.isArray(o)?o.map(b=>{const _=Me(b,n.item_title)??"-",j=Me(b,n.item_value)??"-";return{title:_,value:j}}):[]}function Gi(e){var a,c,b;const t=(a=We(e.id))==null?void 0:a.payload,n=(b=(c=e.data)==null?void 0:c.mapping)==null?void 0:b.rows,o=Me(t,n);return Array.isArray(o)?o:Array.isArray(t)?t:Array.isArray(t==null?void 0:t.items)?t.items:[]}function Rt(e){return e?e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/")?e:`/${e}`:""}function gt(){for(const e of $t.values())clearInterval(e);$t.clear()}function Je(){it&&(clearTimeout(it),it=0)}function Ye(e){return st[e]||null}function Bi(e){return!!(e!=null&&e.ok&&e.latency_ms!=null&&e.latency_ms>=s)}function cn(e){if(!e)return"unknown";const t=String(e.level||"").toLowerCase();return["online","degraded","down","unknown","indirect_failure"].includes(t)?t:Bi(e)?"degraded":e.ok?"online":"down"}function Ni(e){const t=Ye(e),n=cn(t);return n==="online"?"ok":n==="degraded"?"degraded":n==="down"||n==="indirect_failure"?"down":"unknown"}function Vi(e){const t=Ye(e);if(!t)return"Проверка...";const n=cn(t);return n==="online"?t.latency_ms!=null?`Online • ${t.latency_ms} ms`:"Online":n==="degraded"?t.latency_ms!=null?`Degraded • ${t.latency_ms} ms`:t.status_code!=null?`Degraded • HTTP ${t.status_code}`:t.error?`Degraded • ${t.error}`:t.reason?`Degraded • ${String(t.reason).replaceAll("_"," ")}`:"Degraded":n==="indirect_failure"?"Indirect failure":n==="down"?t.error?`Offline • ${t.error}`:t.status_code!=null?`Offline • HTTP ${t.status_code}`:"Offline":"Unknown"}async function Qe(e=null){if(!Array.isArray(e)&&!Te.value)return;const t=Array.isArray(e)&&e.length?e:ct.value,n=Array.from(new Set(t.map(o=>String(o||"").trim()).filter(Boolean)));if(n.length)try{const o=await rs(n);for(const a of o.items||[])st[a.item_id]=a}catch{for(const o of n)st[o]||(st[o]={item_id:o,ok:!1,checked_url:"",status_code:null,latency_ms:null,error:"healthcheck unavailable"})}}async function dn(){Je(),await Qe(),vr()}function Hi(){let e=!1,t=!1;for(const n of ct.value){const o=cn(Ye(n));if(o==="down"||o==="indirect_failure"){e=!0;break}o==="degraded"&&(t=!0)}return e?d:t?l:u}function vr(){if(Je(),!Te.value)return;const e=Hi();it=window.setTimeout(async()=>{await Qe(),vr()},e)}async function Gt(e){var a;const t=xt.value.get(e);if(!t)return;const n=Rt((a=t.data)==null?void 0:a.endpoint);if(!n)return;Pe[e]||(Pe[e]={loading:!1,error:"",payload:null,lastUpdated:0});const o=Pe[e];o.loading=!0,o.error="";try{o.payload=await Re(n),o.lastUpdated=Date.now()}catch(c){o.error=(c==null?void 0:c.message)||"Ошибка загрузки виджета"}finally{o.loading=!1}}async function fn(){var t,n;gt();const e=[];for(const o of Jt.value){if(e.push(Gt(o.id)),!Rt((t=o.data)==null?void 0:t.endpoint))continue;const a=Math.max(1,Number(((n=o.data)==null?void 0:n.refresh_sec)||0))*1e3,c=window.setInterval(()=>{Gt(o.id)},a);$t.set(o.id,c)}await Promise.all(e)}async function Fi(e,t){const n=un(e,t.id),o=Rt(t.endpoint);if(o){Ct[n]=!0;try{await Re(o,{method:String(t.method||"GET").toUpperCase()}),await Gt(e)}catch(a){Pe[e]||(Pe[e]={loading:!1,error:"",payload:null,lastUpdated:0}),Pe[e].error=(a==null?void 0:a.message)||"Не удалось выполнить действие"}finally{Ct[n]=!1}}}async function br(){var e,t,n;q.value=!0,ve.value="",Q.value="idle",U.value="",gr();try{const o=await ts();E.value=o,(!ne.value||!xe.value.some(a=>a.id===ne.value))&&(ne.value=((e=xe.value[0])==null?void 0:e.id)||""),ft(),zn((t=o==null?void 0:o.ui)==null?void 0:t.theme),qn((n=o==null?void 0:o.ui)==null?void 0:n.grid),await fn(),await dn(),Te.value||wr()}catch(o){ve.value=(o==null?void 0:o.message)||"Не удалось загрузить dashboard-конфигурацию",E.value=null,gt(),Je()}finally{q.value=!1}}async function yr(e){var o,a,c,b,_,j;const t=!!(((c=(a=(o=E.value)==null?void 0:o.security)==null?void 0:a.iframe)==null?void 0:c.default_sandbox)??!0),n=(b=e==null?void 0:e.iframe)==null?void 0:b.sandbox;X.open=!0,X.title=e.title,X.src="",X.error="",X.loading=!0,X.sandbox=n==null?t:!!n,X.allow=Array.isArray((_=e==null?void 0:e.iframe)==null?void 0:_.allow)?e.iframe.allow.join("; "):"",X.referrerPolicy=((j=e==null?void 0:e.iframe)==null?void 0:j.referrer_policy)||"";try{const ie=await ns(e.id);X.src=ie.src}catch(ie){X.error=(ie==null?void 0:ie.message)||"Не удалось подготовить iframe"}finally{X.loading=!1}}function Ki(){X.open=!1,X.title="",X.src="",X.error="",X.loading=!1,X.sandbox=!1,X.allow="",X.referrerPolicy=""}function hr(e){if(e.open==="same_tab"){window.location.assign(e.url);return}window.open(e.url,"_blank","noopener,noreferrer")}function Ui(e){e!=null&&e.url&&window.open(e.url,"_blank","noopener,noreferrer")}function pn(e){if(e.type==="iframe"){yr(e);return}hr(e)}function gn(e){return Fn.value.get(String(e||""))||""}async function mn(e){var n;const t=String(e||"");if(t&&(n=navigator.clipboard)!=null&&n.writeText)try{await navigator.clipboard.writeText(t)}catch{}}async function Ir(e){await mn(e)}async function ji(e){const t=gn(e);t&&await mn(t)}async function zi(e){const t=gn(e);t&&await mn(`ssh ${t}`)}async function qi(e){e&&await Qe([e])}function Wi(e){if(!e)return"—";const t=new Date(e);return Number.isNaN(t.getTime())?"—":t.toLocaleString("ru-RU",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit",second:"2-digit"})}function Ji(e){const t=Number(e||0);return!Number.isFinite(t)||t<=0?"—":t<1e3?`${Math.round(t)} ms`:`${(t/1e3).toFixed(2)} s`}function Yi(e){e&&(ot.host=e,ot.open=!0)}function vn(){ot.open=!1,ot.host=null}function Qi(e){const t=(e==null?void 0:e.open_ports)||[];return t.length?t.map(n=>n!=null&&n.service?`${n.port} (${n.service})`:`${n.port}`).join(", "):"—"}function Zi(e){return e?e.error?e.error:e.status_code==null?"—":`HTTP ${e.status_code}`:"—"}async function mt({silent:e=!1}={}){if(!Tt){Tt=!0,e||(qt.value=!0);try{je.value=await is(),nt.value=""}catch(t){nt.value=(t==null?void 0:t.message)||"Не удалось загрузить состояние сканера LAN"}finally{Tt=!1,e||(qt.value=!1)}}}function vt(){at&&(window.clearInterval(at),at=0)}function bn(){vt(),at=window.setInterval(()=>{mt({silent:!0})},p)}function wr(){Je(),vt(),gt()}async function Xi(){!E.value||q.value||(await fn(),await dn(),Zt.value&&(await mt({silent:!0}),bn()))}async function ea(){if(!Wt){Wt=!0;try{Te.value?await Xi():wr()}finally{Wt=!1}}}function Sr(){Te.value=document.visibilityState!=="hidden",ea()}async function ta(){var e;if(!kt.value){kt.value=!0;try{const t=await as();je.value=(t==null?void 0:t.state)||je.value,nt.value=t!=null&&t.accepted||(e=t==null?void 0:t.state)!=null&&e.queued?"":(t==null?void 0:t.message)||""}catch(t){nt.value=(t==null?void 0:t.message)||"Не удалось запустить сканирование LAN"}finally{kt.value=!1,mt({silent:!0})}}}function na(){var e,t;return((t=(e=document.documentElement)==null?void 0:e.dataset)==null?void 0:t.fxMode)||"full"}function ra(e){const t=document.documentElement;let n="high",o="1";e>=120?(n="low",o="0.42"):e>=70&&(n="medium",o="0.68"),t.dataset.motionBudget=n,t.style.setProperty("--motion-budget",o)}function oa(e){const t=na();if(t==="off")return null;const n=JSON.parse(JSON.stringify(e));return n.fps_limit=t==="lite"?34:58,t!=="lite"||(n.particles.number.value=Math.max(24,Math.round(n.particles.number.value*.56)),n.particles.opacity.value=Number((n.particles.opacity.value*.72).toFixed(2)),n.particles.move.speed=Number((n.particles.move.speed*.74).toFixed(2)),n.particles.line_linked.opacity=Number((n.particles.line_linked.opacity*.56).toFixed(2)),n.particles.line_linked.distance=Math.max(80,Math.round(n.particles.line_linked.distance*.84)),n.retina_detect=!1),n}function yn(e){const t=document.getElementById(e);t&&(t.innerHTML="",delete t.dataset.particlesReady)}function ia(){yn(w),yn(k),yn(I)}async function aa(){Le&&(window.cancelAnimationFrame(Le),Le=0),Le=window.requestAnimationFrame(async()=>{Le=0,ia(),await hn(),await bt()})}function _r(){aa()}async function Bt(e,t){const n=document.getElementById(e);if(!n)return;const o=oa(t);if(!o){n.innerHTML="",delete n.dataset.particlesReady;return}n.dataset.particlesReady==="1"||!await cs()||!window.particlesJS||document.getElementById(e)&&n.dataset.particlesReady!=="1"&&(n.innerHTML="",window.particlesJS(e,o),n.dataset.particlesReady="1")}async function hn(){await Bt(w,T)}async function bt(){await Promise.all([Bt(k,x),Bt(I,x)])}let kr=!1;return le(()=>{var e;return(e=Ae.value)==null?void 0:e.id},async()=>{kr?(K.value="",de.value="",Dt()):kr=!0,ft(),Qe(),await Oe(),await bt()}),le(()=>{var e;return(e=jn.value)==null?void 0:e.id},async()=>{await Oe(),await bt()}),le(()=>At.value,e=>{K.value&&!e.includes(K.value)&&(K.value="")},{deep:!0}),le(()=>ze.value,()=>{ft(),Qe()},{deep:!0}),le(()=>ut.value.length,e=>{if(!e){pe.value=0;return}pe.value>=e&&(pe.value=e-1)}),le(()=>Lt.value.map(e=>e.value).join("|"),()=>{Lt.value.some(e=>e.value===fe.value)||(fe.value="all")}),le(()=>Zt.value,e=>{if(e){Te.value&&(mt(),bn());return}vn(),vt()}),le(()=>ct.value.length,e=>{ra(e)},{immediate:!0}),le(()=>({activePageId:ne.value,treeFilter:de.value,activeIndicatorViewId:K.value,statsExpanded:Ie.value,editMode:R.value,serviceCardView:be.value,serviceGroupingMode:Ee.value,siteFilter:fe.value,sidebarView:O.value,settingsPanelOpen:Ge.open,selectedNode:{groupKey:S.groupKey,subgroupId:S.subgroupId,itemId:S.itemId},expandedGroups:{...se}}),e=>{re(e)},{deep:!0}),Ke(async()=>{window.addEventListener("visibilitychange",Sr),window.addEventListener("oko:fx-mode-change",_r),await hn(),await br(),await Oe(),await bt()}),Ue(()=>{gt(),Je(),vt(),vn(),window.removeEventListener("visibilitychange",Sr),window.removeEventListener("oko:fx-mode-change",_r),Le&&(window.cancelAnimationFrame(Le),Le=0),Be&&(clearTimeout(Be),Be=0),delete document.documentElement.dataset.motionBudget,document.documentElement.style.removeProperty("--motion-budget"),wt=null}),wt={BRAND_ICON_BY_KEY:Ut,DEFAULT_ITEM_URL:h,EMBLEM_SRC:r,HEALTH_REFRESH_MS:u,HERO_CONTROLS_PARTICLES_ID:I,HERO_PARTICLES_CONFIG:x,HERO_TITLE_PARTICLES_ID:k,ICON_BY_KEY:jt,ICON_RULES:so,LAN_PAGE_ID:m,LAN_SCAN_POLL_MS:p,LARGE_INDICATOR_TYPES:v,SIDEBAR_PARTICLES_CONFIG:T,SIDEBAR_PARTICLES_ID:w,actionBusy:Ct,actionKey:un,activeCommandPaletteEntry:Kn,activeIndicatorViewId:K,activeIndicatorWidget:jn,activePage:Ae,activePageGroupBlocks:ko,activePageId:ne,activePageWidgetIds:At,addGroup:Ao,addItem:Do,addSubgroup:Mo,allItemIds:Vt,allSubgroupIds:zt,appTagline:fo,appTitle:co,applyConfigMutation:me,applyGrid:qn,applyTheme:zn,authProfileOptions:Rn,buildDefaultItem:en,buildItemFromEditorForm:Xn,clampNumber:nn,clearDragState:qe,clearItemFaviconFailures:gr,clearSelectedNode:Dt,cloneConfig:Wn,closeIframeModal:Ki,closeItemEditor:Yn,closeLanHostModal:vn,closeCommandPalette:Ot,closeSettingsPanel:ii,commandPaletteActiveIndex:pe,commandPaletteOpen:Et,commandPaletteQuery:rt,commandPaletteResults:ut,config:E,configError:ve,copyItemIp:ji,copyItemSshShortcut:zi,copyCommandPaletteEntryUrl:fi,copyUrl:Ir,createBrandIcon:M,defaultItemEditorForm:oe,dragState:L,editGroup:Ro,editItem:Bo,editMode:R,editSubgroup:Go,ensureAbsoluteUrl:Xt,ensurePageGroupsReference:Vr,expandedGroups:se,faviconOriginFromUrl:sn,filteredBlockGroups:mi,filteredTreeGroups:Un,findGroup:Se,findSubgroup:ye,formatLanDuration:Ji,formatLanHttpStatus:Zi,formatLanMoment:Wi,fromToken:uo,groupById:Qt,groupOnlineItems:Ei,groupTotalItems:_i,healthClass:Ni,healthLabel:Vi,healthPollTimer:it,healthState:Ye,healthStates:st,iframeModal:X,indicatorPreviewEntries:Qo,initHeroParticles:bt,initParticles:Bt,initSidebarParticles:hn,initWidgetPolling:fn,isActionBusy:Mi,isDirectGroupNode:Ht,isGroupExpanded:ur,isGroupSelected:cr,isIconCardView:Gn,isSidebarDetailed:Yt,isSidebarHidden:Pt,isTileCardView:Bn,isCompactServiceCardView:Nn,isInlineGroupLayout:Si,isItemSelected:gi,isLanPage:Zt,isLargeIndicator:dt,isSidebarIconActive:To,isSidebarIconOnly:mo,isSubgroupSelected:dr,isWidgetBlock:er,itemEditor:$,itemFaviconFailures:lt,itemFaviconKey:ln,itemFaviconSrc:Ci,itemIp:gn,itemSite:ni,lanCidrsLabel:bo,lanHostModal:ot,lanHosts:Vn,lanPortsLabel:Qi,lanScanActionBusy:kt,lanScanError:nt,lanScanLoading:qt,lanScanPollTimer:at,lanScanRefreshInFlight:Tt,lanScanState:je,loadConfig:br,loadingConfig:q,makeUniqueId:Ve,markItemFaviconFailed:$i,moveGroup:Hr,moveCommandPaletteSelection:ui,moveItemBefore:Kr,moveItemToSubgroupEnd:Ur,moveSubgroup:Fr,normalizeEndpoint:Rt,normalizeIconToken:lo,normalizeId:_t,normalizeLayoutBlocks:Nr,normalizeStringList:tn,onGroupDragOver:jo,onGroupDragStart:Fo,onGroupDrop:zo,onItemCardClick:xo,onItemDragOver:Jo,onItemDragStart:Uo,onItemDrop:Yo,onSubgroupDragOver:qo,onSubgroupDragStart:Ko,onSubgroupDrop:Wo,activateCommandPaletteEntry:sr,activateCommandPaletteSelection:di,openCommandPalette:ir,openSettingsPanel:ar,openCreateItemEditor:Qn,openEditItemEditor:Zn,openIframeItem:yr,openIndicatorView:nr,openItem:pn,openItemInNewTab:Ui,openLanHostModal:Yi,openLinkItem:hr,pageHealthSummary:So,pages:xe,persistConfig:Jn,pickSemanticIcon:tt,refreshHealth:Qe,recheckItem:qi,refreshLanScanState:mt,refreshWidget:Gt,removeGroup:No,removeItem:Ho,removeSubgroup:Vo,resetWidgetPolling:gt,resolveBlockGroups:rn,resolveExpression:Me,resolveGroupIcon:Pi,resolveItemIcon:xi,resolvePageIcon:Ti,resolveSubgroupIcon:Li,resolveWidgetIcon:Ai,resolveWidgets:tr,runLanScanNow:ta,runWidgetAction:Fi,saveError:U,saveStatus:Q,saveStatusLabel:yo,saveStatusTimer:Be,setCommandPaletteActiveIndex:li,setCommandPaletteQuery:si,setSiteFilter:ri,settingsPanel:Ge,sidebarViewToggleTitle:vo,selectItemNode:on,selectSidebarIconNode:Lo,selectSidebarIndicator:Zo,selectSubgroupNode:lr,selectedNode:S,serviceCardView:be,siteFilter:fe,siteFilterOptions:Lt,serviceGroupingMode:Ee,serviceGroupingOptions:go,servicePresentationOptions:po,sidebarIconNodeTitle:Po,sidebarIconNodes:wo,sidebarIndicatorSummary:_o,sidebarIndicators:Mt,sidebarView:O,startHealthPolling:dn,startLanScanPolling:bn,statCardSubtitle:Oi,statCardTrend:Ri,statCardValue:Di,statListEntries:mr,statsExpanded:Ie,stopHealthPolling:Je,stopLanScanPolling:vt,subgroupById:Hn,subgroupTotalItems:ki,submitItemEditor:Oo,syncTreeGroupsState:ft,tableRows:Gi,toggleCommandPalette:oi,toggleEditMode:Eo,toggleGroupNode:pi,toggleSettingsPanel:ai,toggleServiceCardView:Co,toggleSidebarView:$o,treeFilter:de,treeGroups:ze,visibleTreeItemIds:ct,widgetById:xt,widgetIntervals:$t,widgetState:We,widgetStates:Pe,widgets:Jt},wt}const ys=["title"],hs={key:0,class:"item-compact-body"},Is=["src"],ws={class:"item-tile-head"},Ss=["src"],_s={class:"item-tile-title"},ks={class:"item-head"},Es={class:"item-title-row"},Cs=["src"],$s={class:"item-type"},Ts={class:"item-url"},Ps={class:"item-health"},Ls={key:0,class:"item-tags"},xs={key:0,class:"tag-pill site-pill"},As={class:"item-actions"},Ms={key:1,class:"item-ssh-shortcut"},Ds={__name:"ServiceItemCard",props:{groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0},item:{type:Object,required:!0}},setup(r){const u=r,l=Ft(u,"groupKey"),d=Ft(u,"subgroupId"),s=Ft(u,"item"),p=ue(),{isIconCardView:m,isTileCardView:v,isCompactServiceCardView:h,isItemSelected:w,onItemCardClick:k,itemFaviconSrc:I,markItemFaviconFailed:T,resolveItemIcon:x,healthClass:V,healthLabel:te,itemIp:A,itemSite:H,copyItemIp:J,copyItemSshShortcut:G,openItem:D,openItemInNewTab:ce,recheckItem:Y,copyUrl:re}=p,oe=C(()=>V(s.value.id)),E=C(()=>te(s.value.id)),q=C(()=>A(s.value.id)),ve=C(()=>`ssh ${q.value}`),ne=C(()=>H(s.value,l.value)),de=N(!1),Ie=N(!1);let K=0,R=0;const Te=C(()=>({selected:!h.value&&w(s.value.id),compact:h.value,tile:v.value,[`status-${oe.value}`]:!0,"data-updated":Ie.value}));function be(){K&&clearTimeout(K),de.value=!1,window.requestAnimationFrame(()=>{de.value=!0,K=window.setTimeout(()=>{de.value=!1,K=0},900)})}function Ee(){R&&clearTimeout(R),Ie.value=!1,window.requestAnimationFrame(()=>{Ie.value=!0,R=window.setTimeout(()=>{Ie.value=!1,R=0},1250)})}return le([oe,E],([fe,O],[Q,U])=>{Q===void 0&&U===void 0||((fe!==Q||O!==U)&&Ee(),O!==U&&be())}),Ue(()=>{K&&(clearTimeout(K),K=0),R&&(clearTimeout(R),R=0)}),(fe,O)=>{var Q;return f(),y("article",{class:W(["item-card",Te.value]),title:i(h)?s.value.title:void 0,onClick:O[9]||(O[9]=U=>i(k)(l.value,d.value,s.value))},[i(m)?(f(),y("div",hs,[i(I)(s.value)?(f(),y("img",{key:0,src:i(I)(s.value),class:"service-favicon compact-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:O[0]||(O[0]=U=>i(T)(s.value))},null,40,Is)):(f(),z(ke(i(x)(s.value)),{key:1,class:"ui-icon item-icon compact-item-icon"})),g("span",{class:W(["health-dot compact-health-dot",oe.value])},null,2)])):i(v)?(f(),y(ee,{key:1},[g("div",ws,[i(I)(s.value)?(f(),y("img",{key:0,src:i(I)(s.value),class:"service-favicon tile-item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:O[1]||(O[1]=U=>i(T)(s.value))},null,40,Ss)):(f(),z(ke(i(x)(s.value)),{key:1,class:"ui-icon item-icon tile-item-icon"})),g("span",{class:W(["health-dot tile-health-dot",oe.value])},null,2)]),g("p",_s,B(s.value.title),1)],64)):(f(),y(ee,{key:2},[g("div",ks,[g("div",Es,[i(I)(s.value)?(f(),y("img",{key:0,src:i(I)(s.value),class:"service-favicon item-favicon",alt:"",loading:"lazy",referrerpolicy:"no-referrer",onError:O[2]||(O[2]=U=>i(T)(s.value))},null,40,Cs)):(f(),z(ke(i(x)(s.value)),{key:1,class:"ui-icon item-icon"})),g("h4",null,B(s.value.title),1)]),g("span",$s,B(s.value.type),1)]),g("p",Ts,B(s.value.url),1),g("div",Ps,[g("span",{class:W(["health-dot",oe.value])},null,2),g("span",{class:W(["health-text",{"is-updating":de.value}])},B(E.value),3)]),ne.value||(Q=s.value.tags)!=null&&Q.length?(f(),y("div",Ls,[ne.value?(f(),y("span",xs,"site:"+B(ne.value),1)):F("",!0),(f(!0),y(ee,null,he(s.value.tags,U=>(f(),y("span",{key:U,class:"tag-pill"},B(U),1))),128))])):F("",!0),g("div",As,[P(_e,{title:s.value.type==="iframe"?"Открыть iframe":"Открыть","aria-label":s.value.type==="iframe"?"Открыть iframe":"Открыть",onClick:O[3]||(O[3]=Z(U=>i(D)(s.value),["stop"]))},{default:ae(()=>[(f(),z(ke(s.value.type==="iframe"?i(An):i(Mn)),{class:"ui-icon item-action-icon"}))]),_:1},8,["title","aria-label"]),P(_e,{title:"Открыть в новой вкладке","aria-label":"Открыть в новой вкладке",onClick:O[4]||(O[4]=Z(U=>i(ce)(s.value),["stop"]))},{default:ae(()=>[P(i(Na),{class:"ui-icon item-action-icon"})]),_:1}),P(_e,{title:"Recheck health","aria-label":"Recheck health",onClick:O[5]||(O[5]=Z(U=>i(Y)(s.value.id),["stop"]))},{default:ae(()=>[P(i(Va),{class:"ui-icon item-action-icon"})]),_:1}),q.value?(f(),z(_e,{key:0,title:"Копировать IP","aria-label":"Копировать IP",onClick:O[6]||(O[6]=Z(U=>i(J)(s.value.id),["stop"]))},{default:ae(()=>[P(i(Fe),{class:"ui-icon item-action-icon"})]),_:1})):F("",!0),q.value?(f(),z(_e,{key:1,title:"Копировать SSH shortcut","aria-label":"Копировать SSH shortcut",onClick:O[7]||(O[7]=Z(U=>i(G)(s.value.id),["stop"]))},{default:ae(()=>[P(i(eo),{class:"ui-icon item-action-icon"})]),_:1})):F("",!0),P(_e,{title:"Копировать URL","aria-label":"Копировать URL",onClick:O[8]||(O[8]=Z(U=>i(re)(s.value.url),["stop"]))},{default:ae(()=>[P(i(Ha),{class:"ui-icon item-action-icon"})]),_:1})]),q.value?(f(),y("p",Ms,[O[10]||(O[10]=la(" SSH: ",-1)),g("code",null,B(ve.value),1)])):F("",!0)],64))],10,ys)}}},Os={class:"virtual-item-grid"},Rs=120,En=72,Gs={__name:"VirtualizedItemGrid",props:{items:{type:Array,required:!0},groupKey:{type:String,required:!0},subgroupId:{type:String,required:!0}},setup(r){const l=Ft(r,"items"),d=ue(),{isIconCardView:s,isTileCardView:p}=d,m=N(null),v=N(En);let h=null;const w=C(()=>l.value.length>Rs),k=C(()=>w.value&&v.value<l.value.length),I=C(()=>w.value?l.value.slice(0,v.value):l.value);function T(){v.value=Math.min(l.value.length,v.value+En)}function x(){v.value=En}function V(){h&&(h.disconnect(),!(!k.value||!m.value)&&h.observe(m.value))}return le(()=>l.value,async()=>{x(),await Oe(),V()},{deep:!0}),le(()=>k.value,async()=>{await Oe(),V()}),Ke(async()=>{h=new IntersectionObserver(te=>{for(const A of te)if(A.isIntersecting){T();break}},{root:null,rootMargin:"260px 0px",threshold:0}),await Oe(),V()}),Ue(()=>{h==null||h.disconnect(),h=null}),(te,A)=>(f(),y("div",Os,[P(ua,{name:"item-grid-transition",tag:"div",class:W(["item-grid",{"icon-card-grid":i(s),"tile-card-grid":i(p)}])},{default:ae(()=>[(f(!0),y(ee,null,he(I.value,H=>(f(),z(Ds,{key:H.id,"group-key":H.__originGroupKey||r.groupKey,"subgroup-id":H.__originSubgroupId||r.subgroupId,item:H},null,8,["group-key","subgroup-id","item"]))),128))]),_:1},8,["class"]),k.value?(f(),y("div",{key:0,ref_key:"sentinelRef",ref:m,class:"item-grid-sentinel","aria-hidden":"true"},null,512)):F("",!0)]))}},Bs={class:"group-header"},Ns={class:"group-title-row"},Vs={key:0,class:"subtitle"},Hs={class:"subgroup-title"},Fs={__name:"ServiceGroupCard",props:{group:{type:Object,required:!0}},setup(r){const u=ue(),{isInlineGroupLayout:l,resolveGroupIcon:d,resolveSubgroupIcon:s}=u;return(p,m)=>(f(),y("article",{class:W(["panel group-panel",{"group-panel-inline":i(l)(r.group)}])},[g("header",Bs,[g("div",Ns,[(f(),z(ke(i(d)(r.group)),{class:"ui-icon group-icon"})),g("h2",null,B(r.group.title),1)]),r.group.description?(f(),y("p",Vs,B(r.group.description),1)):F("",!0)]),(f(!0),y(ee,null,he(r.group.subgroups,v=>(f(),y("section",{key:v.id,class:"subgroup"},[g("h3",Hs,[(f(),z(ke(i(s)(v)),{class:"ui-icon subgroup-icon"})),g("span",null,B(v.title),1)]),P(Gs,{items:v.items,"group-key":r.group.key,"subgroup-id":v.id},null,8,["items","group-key","subgroup-id"])]))),128))],2))}},Ks={class:"groups-grid"},Us={key:0,class:"panel group-panel group-empty"},js={key:0,class:"panel group-panel group-empty"},zs={__name:"ServicesGroupsPanel",setup(r){const u=ue(),{activePage:l,activePageGroupBlocks:d,filteredBlockGroups:s}=u,p=N(null);let m=null;const v={duration:180,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};function h(){if(!(!m||!p.value))for(const w of p.value.querySelectorAll(".block-wrap"))w.dataset.offscreen="0",m.observe(w)}return le(()=>{var w;return[(w=l.value)==null?void 0:w.id,d.value.length]},async()=>{m&&(m.disconnect(),await Oe(),h())}),Ke(async()=>{m=new IntersectionObserver(w=>{for(const k of w)k.target.dataset.offscreen=k.isIntersecting?"0":"1"},{root:null,rootMargin:"140px 0px",threshold:.02}),await Oe(),h()}),Ue(()=>{m==null||m.disconnect(),m=null}),(w,k)=>(f(),y("section",{ref_key:"blocksRootRef",ref:p,class:"page-stack"},[(f(!0),y(ee,null,he(i(d),(I,T)=>(f(),y("section",{key:`${i(l).id}:${T}:groups`,class:"block-wrap"},[xn((f(),y("section",Ks,[(f(!0),y(ee,null,he(i(s)(I.group_ids),x=>(f(),z(Fs,{key:x.key,group:x},null,8,["group"]))),128)),i(s)(I.group_ids).length?F("",!0):(f(),y("article",Us,[...k[0]||(k[0]=[g("h2",null,"Нет данных для выбранного узла",-1),g("p",{class:"subtitle"},"Выберите другую ветку в боковом дереве.",-1)])]))])),[[i(qr),v]])]))),128)),i(d).length?F("",!0):(f(),y("article",js,[...k[1]||(k[1]=[g("h2",null,"Для этой страницы нет групп",-1),g("p",{class:"subtitle"},"Откройте нужный индикатор в аккордеоне слева.",-1)])]))],512))}},qs=["aria-label","aria-expanded","disabled"],Ws={class:"hero-dropdown-label"},Js={class:"hero-dropdown-value"},Ys=["aria-label"],Qs=["aria-selected"],Zs=["onClick"],Cn={__name:"HeroDropdown",props:{modelValue:{type:String,default:""},label:{type:String,default:""},ariaLabel:{type:String,default:""},options:{type:Array,default:()=>[]},disabled:{type:Boolean,default:!1}},emits:["update:modelValue"],setup(r,{emit:u}){const l=r,d=u,s=N(!1),p=N(null),m=C(()=>{var T;const I=l.options.find(x=>x.value===l.modelValue);return I?I.label:((T=l.options[0])==null?void 0:T.label)||""});function v(){l.disabled||(s.value=!s.value)}function h(I){d("update:modelValue",I),s.value=!1}function w(I){s.value&&p.value&&!p.value.contains(I.target)&&(s.value=!1)}function k(I){I.key==="Escape"&&(s.value=!1)}return Ke(()=>{window.addEventListener("pointerdown",w),window.addEventListener("keydown",k)}),Ue(()=>{window.removeEventListener("pointerdown",w),window.removeEventListener("keydown",k)}),(I,T)=>(f(),y("div",{ref_key:"rootRef",ref:p,class:"hero-dropdown"},[g("button",{class:"hero-dropdown-trigger",type:"button","aria-label":r.ariaLabel||r.label,"aria-haspopup":"listbox","aria-expanded":s.value,disabled:r.disabled,onClick:v},[zr(I.$slots,"prefix",{},()=>[g("span",Ws,B(r.label),1)]),g("span",Js,B(m.value),1),P(i(Fa),{class:W(["ui-icon hero-dropdown-caret",{open:s.value}])},null,8,["class"])],8,qs),P(Wr,{name:"hero-dropdown-menu-transition"},{default:ae(()=>[s.value?(f(),y("ul",{key:0,class:"hero-dropdown-menu",role:"listbox","aria-label":r.ariaLabel||r.label},[(f(!0),y(ee,null,he(r.options,x=>(f(),y("li",{key:x.value,role:"option","aria-selected":r.modelValue===x.value},[g("button",{class:W(["hero-dropdown-option",{active:r.modelValue===x.value}]),type:"button",onClick:V=>h(x.value)},[g("span",null,B(x.label),1),r.modelValue===x.value?(f(),z(i(Ka),{key:0,class:"ui-icon hero-dropdown-check"})):F("",!0)],10,Zs)],8,Qs))),128))],8,Ys)):F("",!0)]),_:1})],512))}},Xs={key:0,class:"hero-logo-square","aria-hidden":"true"},el=["src"],tl=["title","aria-label","aria-selected","onClick"],nl={class:"hero-page-tab-label"},rl={__name:"HeroPageTabs",setup(r){let u=!1;const l=ue(),{EMBLEM_SRC:d,isSidebarHidden:s,pages:p,activePage:m,activePageId:v,resolvePageIcon:h}=l,w=N(!u),k=C(()=>s.value);let I=0;return Ke(()=>{w.value&&(I=globalThis.setTimeout(()=>{w.value=!1,u=!0},700))}),Ue(()=>{I&&(globalThis.clearTimeout(I),I=0),w.value&&(u=!0)}),(T,x)=>(f(),y("nav",{class:W(["hero-page-tabs",{"hero-page-tabs--intro":w.value,"has-logo-tile":k.value}]),role:"tablist","aria-label":"Разделы"},[k.value?(f(),y("div",Xs,[g("img",{src:i(d),alt:""},null,8,el)])):F("",!0),(f(!0),y(ee,null,he(i(p),V=>{var te,A,H;return f(),y("button",{key:V.id,class:W(["hero-page-tab-btn",{active:((te=i(m))==null?void 0:te.id)===V.id,"hero-page-tab-btn--intro-active":w.value&&((A=i(m))==null?void 0:A.id)===V.id}]),type:"button",role:"tab",title:V.title,"aria-label":V.title,"aria-selected":((H=i(m))==null?void 0:H.id)===V.id,onClick:J=>v.value=V.id},[(f(),z(ke(i(h)(V)),{class:"ui-icon hero-page-tab-icon"})),g("span",nl,B(V.title),1)],10,tl)}),128))],2))}},ol={class:"hero-layout"},il={class:"hero panel hero-title-panel"},al={class:"hero-title-content"},sl={class:"hero-controls-content"},ll={key:0,id:"hero-controls-drawer",class:"hero-controls-drawer"},ul={class:"hero-display-controls"},cl=["title","aria-label"],dl=["aria-expanded","title"],fl={key:0,class:"editor-error hero-editor-error"},jr="oko:hero-controls-open:v1",pl={__name:"ServicesHeroPanel",setup(r){const u=ue(),l=N(!1),{editMode:d,isSidebarDetailed:s,isSidebarHidden:p,saveStatus:m,saveStatusLabel:v,saveError:h,sidebarViewToggleTitle:w,serviceCardView:k,serviceGroupingMode:I,serviceGroupingOptions:T,servicePresentationOptions:x,siteFilter:V,siteFilterOptions:te,toggleEditMode:A,addGroup:H,openCommandPalette:J,openSettingsPanel:G,toggleSidebarView:D}=u;return Ke(()=>{if(!window.localStorage)return;const ce=window.localStorage.getItem(jr);l.value=ce==="1"}),le(()=>l.value,ce=>{window.localStorage&&window.localStorage.setItem(jr,ce?"1":"0")}),(ce,Y)=>(f(),y("section",ol,[g("header",il,[Y[5]||(Y[5]=g("div",{id:"hero-title-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),g("div",al,[P(rl)])]),g("aside",{class:W(["panel hero-control-panel service-hero-controls",{active:i(d)}])},[Y[6]||(Y[6]=g("div",{id:"hero-controls-particles",class:"hero-panel-particles","aria-hidden":"true"},null,-1)),g("div",sl,[g("button",{class:"hero-settings-secret-btn",type:"button",title:"Панель настроек","aria-label":"Открыть панель настроек",onClick:Y[0]||(Y[0]=(...re)=>i(G)&&i(G)(...re))},[P(i(Ua),{class:"ui-icon hero-action-icon"})]),g("div",{class:W(["hero-controls-accordion",{open:l.value}])},[P(Wr,{name:"hero-controls-drawer-transition"},{default:ae(()=>[l.value?(f(),y("div",ll,[P(_e,{"button-class":"hero-icon-btn hero-accordion-action editor-toggle",active:i(d),title:i(d)?"Выключить режим редактирования":"Включить режим редактирования","aria-label":i(d)?"Выключить режим редактирования":"Включить режим редактирования",onClick:i(A)},{default:ae(()=>[P(i(Dn),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),i(d)?(f(),z(_e,{key:0,"button-class":"hero-icon-btn hero-accordion-action",title:"Добавить группу","aria-label":"Добавить группу",onClick:i(H)},{default:ae(()=>[P(i(On),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"])):F("",!0),g("div",ul,[P(Cn,{modelValue:i(k),"onUpdate:modelValue":Y[1]||(Y[1]=re=>In(k)?k.value=re:null),label:"Вид","aria-label":"Режим отображения сервисов",options:i(x)},null,8,["modelValue","options"]),P(Cn,{modelValue:i(I),"onUpdate:modelValue":Y[2]||(Y[2]=re=>In(I)?I.value=re:null),label:"","aria-label":"Группировка сервисов",options:i(T),disabled:i(p)},{prefix:ae(()=>[P(i(Pn),{class:"ui-icon hero-dropdown-prefix-icon","aria-hidden":"true"})]),_:1},8,["modelValue","options","disabled"]),P(Cn,{modelValue:i(V),"onUpdate:modelValue":Y[3]||(Y[3]=re=>In(V)?V.value=re:null),label:"Site","aria-label":"Фильтр по площадке",options:i(te)},{prefix:ae(()=>[P(i(ja),{class:"ui-icon hero-dropdown-prefix-icon","aria-hidden":"true"})]),_:1},8,["modelValue","options"])]),P(_e,{"button-class":"hero-icon-btn hero-accordion-action",title:"Быстрый поиск сервисов (Ctrl/Cmd+K)","aria-label":"Быстрый поиск сервисов",onClick:i(J)},{default:ae(()=>[P(i(za),{class:"ui-icon hero-action-icon"})]),_:1},8,["onClick"]),P(_e,{"button-class":"hero-icon-btn hero-accordion-action",active:!i(s),title:i(w),"aria-label":i(w),onClick:i(D)},{default:ae(()=>[P(i(oo),{class:"ui-icon hero-action-icon"})]),_:1},8,["active","title","aria-label","onClick"]),i(d)?(f(),y("span",{key:1,class:W(["hero-save-indicator hero-accordion-status",i(m)]),role:"status",title:i(v),"aria-label":i(v)},[P(i(qa),{class:"ui-icon hero-save-icon"})],10,cl)):F("",!0)])):F("",!0)]),_:1}),g("button",{class:"hero-controls-trigger",type:"button","aria-expanded":l.value,"aria-controls":"hero-controls-drawer",title:l.value?"Скрыть панель действий":"Показать панель действий",onClick:Y[4]||(Y[4]=re=>l.value=!l.value)},[P(i(no),{class:"ui-icon hero-action-icon"}),P(i(Wa),{class:W(["ui-icon hero-accordion-caret",{open:l.value}])},null,8,["class"])],8,dl)],2),i(d)&&i(h)?(f(),y("p",fl,B(i(h)),1)):F("",!0)])],2)]))}},gl={key:0,class:"panel status-panel"},ml={key:1,class:"panel status-panel error-state"},vl={class:"subtitle"},bl={key:3,class:"panel status-panel"},yl={__name:"DashboardMainView",setup(r){const u=He(()=>$e(()=>import("./IndicatorTabPanel-Bmu6I7cw.js"),__vite__mapDeps([0,1,2]))),l=He(()=>$e(()=>import("./LanPageView-CXCrgB97.js"),__vite__mapDeps([3,1,2]))),d=ue(),{activePage:s,activeIndicatorWidget:p,loadingConfig:m,configError:v,isLanPage:h,loadConfig:w}=d;return(k,I)=>{var T;return f(),y("main",{key:((T=i(s))==null?void 0:T.id)||"empty",class:W(["page",{"indicator-open":!!i(p),"page--lan":i(h)&&!i(p)}])},[i(m)?(f(),y("section",gl,[...I[1]||(I[1]=[g("h2",null,"Загрузка конфигурации...",-1),g("p",{class:"subtitle"},"Получаем dashboard-модель из backend.",-1)])])):i(v)?(f(),y("section",ml,[I[2]||(I[2]=g("h2",null,"Ошибка загрузки конфигурации",-1)),g("p",vl,B(i(v)),1),g("button",{class:"ghost",type:"button",onClick:I[0]||(I[0]=(...x)=>i(w)&&i(w)(...x))},"Повторить")])):i(s)?(f(),y(ee,{key:2},[i(p)?(f(),z(i(u),{key:0})):(f(),y(ee,{key:1},[i(h)?(f(),z(i(l),{key:0})):(f(),y(ee,{key:1},[P(pl),P(zs)],64))],64))],64)):(f(),y("section",bl,[...I[3]||(I[3]=[g("h2",null,"Нет доступных страниц",-1),g("p",{class:"subtitle"},"Проверьте `layout.pages` в `dashboard.yaml`.",-1)])]))],2)}}},hl={class:"brand"},Il=["src"],wl={class:"brand-title"},Sl={class:"brand-subtitle"},_l={__name:"SidebarHeaderTabs",setup(r){const u=ue(),{EMBLEM_SRC:l,appTitle:d,appTagline:s}=u;return(p,m)=>(f(),y("div",hl,[g("img",{src:i(l),alt:"Oko"},null,8,Il),g("div",null,[g("p",wl,B(i(d)),1),g("p",Sl,B(i(s)),1)])]))}},kl={class:"sidebar-stats-accordion","aria-label":"Индикаторы"},El=["aria-expanded"],Cl={class:"sidebar-stats-toggle-values"},$l={key:0,class:"sidebar-indicators"},Tl=["onClick"],Pl={class:"widget-head sidebar-indicator-head"},Ll={class:"widget-title"},xl={class:"item-type"},Al={key:0,class:"widget-error"},Ml={key:1,class:"widget-loading"},Dl={class:"widget-value sidebar-indicator-value"},Ol={class:"widget-subtitle"},Rl={key:0,class:"widget-trend"},Gl={key:0,class:"widget-list sidebar-list-preview"},Bl={key:1,class:"widget-empty"},Nl={class:"widget-subtitle"},Vl={key:5,class:"widget-empty"},Hl={key:6,class:"widget-actions sidebar-indicator-actions"},Fl=["onClick"],Kl=["disabled","onClick"],Ul={key:1,class:"widget-empty"},jl={__name:"SidebarIndicatorsAccordion",setup(r){const u=ue(),{statsExpanded:l,sidebarIndicatorSummary:d,sidebarIndicators:s,isLargeIndicator:p,activeIndicatorWidget:m,selectSidebarIndicator:v,resolveWidgetIcon:h,widgetState:w,statCardValue:k,statCardSubtitle:I,statCardTrend:T,indicatorPreviewEntries:x,tableRows:V,openIndicatorView:te,isActionBusy:A,runWidgetAction:H}=u;return(J,G)=>(f(),y("div",kl,[g("button",{class:"sidebar-stats-toggle",type:"button","aria-controls":"sidebar-stats-panel","aria-expanded":i(l),onClick:G[0]||(G[0]=D=>l.value=!i(l))},[G[1]||(G[1]=g("span",{class:"sidebar-stats-toggle-text"},"Индикаторы",-1)),g("span",Cl,B(i(d)),1),g("span",{class:W(["sidebar-stats-toggle-caret",{open:i(l)}])},"▴",2)],8,El),g("div",{id:"sidebar-stats-panel",class:W(["sidebar-stats-panel",{open:i(l)}])},[i(s).length?(f(),y("div",$l,[(f(!0),y(ee,null,he(i(s),D=>{var ce,Y,re,oe,E;return f(),y("article",{key:D.id,class:W(["sidebar-indicator",{interactive:i(p)(D),active:((ce=i(m))==null?void 0:ce.id)===D.id}]),onClick:q=>i(v)(D)},[g("header",Pl,[g("div",Ll,[(f(),z(ke(i(h)(D)),{class:"ui-icon widget-icon"})),g("h3",null,B(D.title),1)]),g("span",xl,B(D.type),1)]),(Y=i(w)(D.id))!=null&&Y.error?(f(),y("p",Al,B((re=i(w)(D.id))==null?void 0:re.error),1)):(oe=i(w)(D.id))!=null&&oe.loading?(f(),y("p",Ml,"Обновление...")):D.type==="stat_card"?(f(),y(ee,{key:2},[g("p",Dl,B(i(k)(D)),1),g("p",Ol,B(i(I)(D)),1),i(T)(D)?(f(),y("p",Rl,B(i(T)(D)),1)):F("",!0)],64)):D.type==="stat_list"?(f(),y(ee,{key:3},[i(x)(D).length?(f(),y("ul",Gl,[(f(!0),y(ee,null,he(i(x)(D),q=>(f(),y("li",{key:q.title+q.value},[g("span",null,B(q.title),1),g("strong",null,B(q.value),1)]))),128))])):(f(),y("p",Bl,"Нет данных")),G[2]||(G[2]=g("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):D.type==="table"?(f(),y(ee,{key:4},[g("p",Nl,"Строк: "+B(i(V)(D).length),1),G[3]||(G[3]=g("p",{class:"sidebar-indicator-hint"},"Нажмите, чтобы открыть во вкладке",-1))],64)):(f(),y("p",Vl,"Неподдерживаемый тип виджета")),(E=D.data.actions)!=null&&E.length||i(p)(D)?(f(),y("div",Hl,[i(p)(D)?(f(),y("button",{key:0,class:"ghost",type:"button",onClick:Z(q=>i(te)(D.id),["stop"])},"Открыть вкладку",8,Fl)):F("",!0),(f(!0),y(ee,null,he(D.data.actions||[],q=>(f(),y("button",{key:q.id,class:"ghost",type:"button",disabled:i(A)(D.id,q.id),onClick:Z(ve=>i(H)(D.id,q),["stop"])},B(q.title),9,Kl))),128))])):F("",!0)],10,Tl)}),128))])):(f(),y("p",Ul,"Для выбранной страницы индикаторы не настроены."))],2)]))}},zl=["draggable"],ql={class:"tree-node-row"},Wl={class:"tree-text"},Jl={class:"tree-meta"},Yl={key:0,class:"tree-inline-actions"},Ql={__name:"SidebarTreeSubgroupNode",props:{group:{type:Object,required:!0},subgroup:{type:Object,required:!0}},setup(r){const u=ue(),{dragState:l,editMode:d,onSubgroupDragStart:s,clearDragState:p,onSubgroupDragOver:m,onSubgroupDrop:v,isSubgroupSelected:h,selectSubgroupNode:w,resolveSubgroupIcon:k,subgroupTotalItems:I,editSubgroup:T,addItem:x,removeSubgroup:V}=u;return(te,A)=>(f(),y("li",{class:W(["tree-subgroup-item",{dragging:i(l).type==="subgroup"&&i(l).subgroupId===r.subgroup.id}]),draggable:i(d),onDragstart:A[4]||(A[4]=Z(H=>i(s)(H,r.group.id,r.subgroup.id),["stop"])),onDragend:A[5]||(A[5]=Z((...H)=>i(p)&&i(p)(...H),["stop"])),onDragover:A[6]||(A[6]=Z(H=>i(m)(H,r.group.id,r.subgroup.id),["stop"])),onDrop:A[7]||(A[7]=Z(H=>i(v)(H,r.group.id,r.subgroup.id),["stop"]))},[g("div",ql,[g("button",{class:W(["tree-node tree-subgroup",{active:i(h)(r.group.key,r.subgroup.id)}]),type:"button",onClick:A[0]||(A[0]=H=>i(w)(r.group.key,r.subgroup.id))},[(f(),z(ke(i(k)(r.subgroup)),{class:"ui-icon tree-icon tree-sub-icon"})),g("span",Wl,B(r.subgroup.title),1),g("span",Jl,B(i(I)(r.subgroup)),1)],2),i(d)?(f(),y("div",Yl,[P(i(io),{class:"ui-icon tree-grip"}),g("button",{class:"tree-mini-btn",type:"button",title:"Редактировать подгруппу",onClick:A[1]||(A[1]=Z(H=>i(T)(r.group.id,r.subgroup.id),["stop"]))},[P(i(Dn),{class:"ui-icon"})]),g("button",{class:"tree-mini-btn",type:"button",title:"Добавить элемент",onClick:A[2]||(A[2]=Z(H=>i(x)(r.group.id,r.subgroup.id),["stop"]))},[P(i(On),{class:"ui-icon"})]),g("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить подгруппу",onClick:A[3]||(A[3]=Z(H=>i(V)(r.group.id,r.subgroup.id),["stop"]))},[P(i(ao),{class:"ui-icon"})])])):F("",!0)])],42,zl))}},Zl=["draggable"],Xl={class:"tree-node-row"},eu={class:"tree-text"},tu={class:"tree-meta"},nu={key:0,class:"tree-inline-actions"},ru={class:"tree-subgroups"},ou={__name:"SidebarTreeGroupNode",props:{group:{type:Object,required:!0}},setup(r){const u=ue(),{dragState:l,editMode:d,isDirectGroupNode:s,onGroupDragStart:p,clearDragState:m,onGroupDragOver:v,onGroupDrop:h,isGroupSelected:w,toggleGroupNode:k,isGroupExpanded:I,resolveGroupIcon:T,groupTotalItems:x,editGroup:V,addSubgroup:te,removeGroup:A}=u;return(H,J)=>(f(),y("li",{class:W(["tree-group-item",{dragging:i(l).type==="group"&&i(l).groupId===r.group.id&&i(s)(r.group)}]),draggable:i(d)&&i(s)(r.group),onDragstart:J[4]||(J[4]=Z(G=>i(p)(G,r.group),["stop"])),onDragend:J[5]||(J[5]=Z((...G)=>i(m)&&i(m)(...G),["stop"])),onDragover:J[6]||(J[6]=Z(G=>i(v)(G,r.group),["stop"])),onDrop:J[7]||(J[7]=Z(G=>i(h)(G,r.group),["stop"]))},[g("div",Xl,[g("button",{class:W(["tree-node tree-group",{active:i(w)(r.group.key)}]),type:"button",onClick:J[0]||(J[0]=G=>i(k)(r.group.key))},[g("span",{class:W(["tree-caret",{open:i(I)(r.group.key)}])},"▾",2),(f(),z(ke(i(T)(r.group)),{class:"ui-icon tree-icon"})),g("span",eu,B(r.group.title),1),g("span",tu,B(i(x)(r.group)),1)],2),i(d)&&i(s)(r.group)?(f(),y("div",nu,[P(i(io),{class:"ui-icon tree-grip"}),g("button",{class:"tree-mini-btn",type:"button",title:"Редактировать группу",onClick:J[1]||(J[1]=Z(G=>i(V)(r.group.id),["stop"]))},[P(i(Dn),{class:"ui-icon"})]),g("button",{class:"tree-mini-btn",type:"button",title:"Добавить подгруппу",onClick:J[2]||(J[2]=Z(G=>i(te)(r.group.id),["stop"]))},[P(i(On),{class:"ui-icon"})]),g("button",{class:"tree-mini-btn danger",type:"button",title:"Удалить группу",onClick:J[3]||(J[3]=Z(G=>i(A)(r.group.id),["stop"]))},[P(i(ao),{class:"ui-icon"})])])):F("",!0)]),xn(g("ul",ru,[(f(!0),y(ee,null,he(r.group.subgroups,G=>(f(),z(Ql,{key:G.id,group:r.group,subgroup:G},null,8,["group","subgroup"]))),128))],512),[[ca,i(I)(r.group.key)]])],42,Zl))}},iu={key:0,class:"sidebar-tree","aria-label":"Дерево сервисов"},au={key:0,class:"tree-root"},su={key:1,class:"tree-empty"},lu={__name:"SidebarTreePanel",setup(r){const u=ue(),{treeGroups:l,filteredTreeGroups:d}=u,s={duration:160,easing:"cubic-bezier(0.22, 0.72, 0.14, 1)"};return(p,m)=>i(l).length?(f(),y("section",iu,[i(d).length?xn((f(),y("ul",au,[(f(!0),y(ee,null,he(i(d),v=>(f(),z(ou,{key:v.key,group:v},null,8,["group"]))),128))])),[[i(qr),s]]):(f(),y("p",su,"По вашему запросу ничего не найдено."))])):F("",!0)}},uu={class:"sidebar"},cu={class:"sidebar-content"},du={__name:"DashboardSidebarView",setup(r){const u=ue(),{isSidebarDetailed:l}=u;return(d,s)=>(f(),y("aside",uu,[s[0]||(s[0]=g("div",{id:"sidebar-particles",class:"sidebar-particles","aria-hidden":"true"},null,-1)),g("div",cu,[P(_l),i(l)?(f(),z(lu,{key:0})):F("",!0),i(l)?(f(),z(jl,{key:1})):F("",!0)])]))}},fu=["src"],pu={__name:"App",setup(r){const u=()=>$e(()=>import("./LanHostModal-DgBH7-XE.js"),__vite__mapDeps([4,1,5,2])),l=()=>$e(()=>import("./IframeModal-BIQlRDzz.js"),__vite__mapDeps([6,5,1,2])),d=()=>$e(()=>import("./ItemEditorModal-BY_l70zh.js"),__vite__mapDeps([7,1,5,2])),s=()=>$e(()=>import("./DashboardSettingsModal-DgieXorP.js"),__vite__mapDeps([8,5,1,2])),p=()=>$e(()=>import("./CommandPaletteModal-CPr6NJPu.js"),__vite__mapDeps([9,1,5,2])),m=()=>$e(()=>import("./IndicatorTabPanel-Bmu6I7cw.js"),__vite__mapDeps([0,1,2])),v=()=>$e(()=>import("./LanPageView-CXCrgB97.js"),__vite__mapDeps([3,1,2])),h=He(u),w=He(l),k=He(d),I=He(s),T=He(p),x=ue(),{EMBLEM_SRC:V,closeCommandPalette:te,closeSettingsPanel:A,commandPaletteOpen:H,iframeModal:J,isSidebarHidden:G,itemEditor:D,lanHostModal:ce,settingsPanel:Y,toggleCommandPalette:re}=x,oe=N(!1);let E=0,q=0,ve=0;function ne(){Promise.allSettled([u(),l(),d(),s(),p(),m(),v()])}function de(){if("requestIdleCallback"in window){ve=window.requestIdleCallback(()=>{ve=0,ne()},{timeout:2e3});return}q=window.setTimeout(()=>{q=0,ne()},1400)}function Ie(K){if((K.metaKey||K.ctrlKey)&&!K.altKey&&!K.shiftKey&&K.key.toLowerCase()==="k"){K.preventDefault(),re();return}if(K.key==="Escape"&&H.value){K.preventDefault(),te();return}K.key==="Escape"&&Y.open&&(K.preventDefault(),A())}return Ke(()=>{E=globalThis.setTimeout(()=>{oe.value=!0},1e3),window.addEventListener("keydown",Ie),de()}),Ue(()=>{E&&(globalThis.clearTimeout(E),E=0),q&&(window.clearTimeout(q),q=0),ve&&"cancelIdleCallback"in window&&(window.cancelIdleCallback(ve),ve=0),window.removeEventListener("keydown",Ie)}),(K,R)=>(f(),y("div",{class:W(["shell",{"shell-motion-static":oe.value}])},[g("img",{class:"center-emblem",src:i(V),alt:"","aria-hidden":"true"},null,8,fu),g("div",{class:W(["app-shell",{"sidebar-hidden":i(G)}])},[i(G)?F("",!0):(f(),z(du,{key:0})),P(yl)],2),i(ce).open?(f(),z(i(h),{key:0})):F("",!0),i(J).open?(f(),z(i(w),{key:1})):F("",!0),i(D).open?(f(),z(i(k),{key:2})):F("",!0),i(Y).open?(f(),z(i(I),{key:3})):F("",!0),i(H)?(f(),z(i(T),{key:4})):F("",!0)],2))}};async function gu(r){}function mu(){var d,s,p,m;if((s=(d=globalThis.matchMedia)==null?void 0:d.call(globalThis,"(prefers-reduced-motion: reduce)"))==null?void 0:s.matches)return"off";const u=Number(((p=globalThis.navigator)==null?void 0:p.hardwareConcurrency)||8),l=Number(((m=globalThis.navigator)==null?void 0:m.deviceMemory)||8);return u<=4||l<=4?"lite":"full"}function vu(r){const u=document.documentElement,l=u.dataset.fxMode||"";u.dataset.fxMode=r,r==="off"?u.style.setProperty("--glow-enabled","0"):r==="lite"?u.style.setProperty("--glow-enabled","0.58"):u.style.setProperty("--glow-enabled","1"),l&&l!==r&&window.dispatchEvent(new CustomEvent("oko:fx-mode-change",{detail:{mode:r,previousMode:l}}))}function bu(){var l;const r=(l=globalThis.matchMedia)==null?void 0:l.call(globalThis,"(prefers-reduced-motion: reduce)"),u=()=>vu(mu());u(),r!=null&&r.addEventListener?r.addEventListener("change",u):r!=null&&r.addListener&&r.addListener(u)}bu();gu();da(pu).use(fa).mount("#app");export{Cn as _,rl as a,_e as b,ue as u};
